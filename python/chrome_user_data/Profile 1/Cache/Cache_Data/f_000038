import{_ as le}from"./GridTableColumn.vue_vue_type_script_setup_true_lang-BayDfMSt.js";import{D as J,_ as ie}from"./DropdownAssignmentEventGroupType.vue_vue_type_script_setup_true_lang-CSQmcDIy.js";import{a as L,fl as ue,u as X,fn as me,Z as f,b as ee,o as C,aC as Y,g as u,e as F,j,t as h,h as o,c as s,e0 as K,f as p,i as W,k as H,fD as ce,eA as ve,$ as R,l as Q,er as ge,ep as pe,eq as fe,fo as ye,eM as xe,s as se,aD as he,fm as we,gk as Se}from"./vendor-CJXdOFCa.js";import{a as ke,p as _e}from"./MakeSortable.vue_vue_type_script_setup_true_lang-DJUGCLh6.js";import{_ as Z}from"./ArtesaTimeInput.vue_vue_type_style_index_0_lang-CQRpcmmu.js";import{_ as oe}from"./DropdownAssignmentEventType.vue_vue_type_script_setup_true_lang-BMxji8cl.js";import{h as Ie,a6 as ae,a7 as re,a8 as de,ar as te,a9 as Pe}from"./index-M8nwXBBi.js";import{_ as be}from"./FeathersTablePagination.vue_vue_type_style_index_0_lang-DDfA-nHC.js";import"./hasItemsForCompany.store-D65GIO8M.js";import"./index-BCyjfQC_.js";import"./index-DX0mSCHG.js";import"./usePagination-Cs_oXynH.js";const Ee={class:"flex items-center bg-white mb-1 pr-2 rounded outline outline-2 outline-gray-100"},Ce={class:"flex items-center py-2 pl-2 flex-1 drag-handle cursor-pointer select-none"},Te={class:"text-base font-bold"},Ve={class:"flex mb-1 items-center"},De={class:"flex-1 flex outline outline-2 outline-gray-100"},$e={class:"flex flex-col items-center bg-white rounded px-2 py-0.5"},Ue={class:"text-gray-400 text-xs relative"},Ae={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},Ge={class:"text-gray-400 text-xs"},Re={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},Fe={class:"text-gray-400 text-xs"},Oe={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},qe={class:"flex items-center"},Ne={class:"text-gray-400 text-xs"},Be={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},Me={class:"text-gray-400 text-xs"},je={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},We={class:"flex items-center"},ze={class:"text-gray-400 text-xs"},He={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},Ye={class:"text-gray-400 text-xs"},Le={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},Ze={class:"text-gray-400 text-xs"},Je={class:"text-sm"},Ke={class:"flex mb-1 items-center p-2 bg-white outline outline-2 outline-gray-100 rounded"},Qe={class:"flex mb-1 items-center justify-center"},ne=L({__name:"SettingsAssignmentEventForm",props:{eventSetting:{type:Object,required:!0},size:ue,tasks:{type:Array,default:()=>[]}},emits:["remove","remove-task","create-task"],setup(r,{emit:c}){const m=r,D=c,{t:v}=X(),$=me(),b=f({get(){return(m.eventSetting.manPower??0)/3600},set(l){x.value=l*3600}}),w=f({get(){return m.eventSetting.workDays??0},async set(l){m.eventSetting.workDays=l,T()}}),E=f({get(){return m.eventSetting.workingTimePerDay??0},set(l){m.eventSetting.workingTimePerDay=l,T()}}),S=f({get(){return m.eventSetting.employeeCount??0},set(l){m.eventSetting.employeeCount=l,T()}}),x=f({get(){return m.eventSetting.manPower??0},set(l){m.eventSetting.manPower=l,V()}}),U=f({get(){return m.eventSetting.dateAnchor!=="endsAt"},set(l){const d=l?"startsAt":"endsAt";m.eventSetting.dateAnchor=d}});function T(){const l=(w.value||1)*(E.value||0)*(S.value||0);m.eventSetting.manPower=l}function V(){if(!E.value||!S.value){w.value=1;return}const l=Math.ceil((x.value||0)/E.value/S.value);w.value=Math.max(l,1)}async function z(){D("create-task",m.eventSetting),await R(),$.value.at(-1)?.focus()}function N(l){const{moved:d}=l;if(!d)return;ke(m.tasks,d.oldIndex,d.newIndex).forEach((k,O)=>{const A=O+1;k.order!==A&&(k.order=A)})}return(l,d)=>{const I=ee("font-awesome-icon"),k=Q,O=ge,A=pe,B=fe,G=ye,q=xe,M=Q;return C(),Y("div",null,[u("div",Ee,[u("div",Ce,[r.eventSetting.eventType?.icon?(C(),F(I,{key:0,icon:r.eventSetting.eventType.icon,"fixed-width":"",class:"mr-2"},null,8,["icon"])):j("",!0),u("span",Te,h(r.eventSetting.eventType?.name),1),o(s(K),{modelValue:r.eventSetting.name,"onUpdate:modelValue":d[0]||(d[0]=i=>r.eventSetting.name=i),size:"small",placeholder:l.$t("Description"),class:"flex-1 inline-edit ml-4 !w-20"},null,8,["modelValue","placeholder"])]),o(B,{trigger:"click",placement:"bottom-end"},{dropdown:p(()=>[o(A,null,{default:p(()=>[o(O,{onClick:d[1]||(d[1]=i=>l.$emit("remove",r.eventSetting))},{default:p(()=>[W(h(s(v)("actions.delete")),1)]),_:1})]),_:1})]),default:p(()=>[o(k,{text:""},{default:p(()=>[o(I,{icon:"ellipsis-v"})]),_:1})]),_:1})]),u("div",Ve,[u("div",De,[u("div",$e,[o(G,{modelValue:s(S),"onUpdate:modelValue":d[2]||(d[2]=i=>H(S)?S.value=i:null),min:0,style:{width:"40px"},"value-on-clear":0,controls:!1,class:"inline-edit"},null,8,["modelValue"]),u("div",Ue,[o(I,{icon:s(S)<=0?"user-slash":s(S)===1?"user":"users"},null,8,["icon"])])]),u("div",Ae,[o(G,{modelValue:s(w),"onUpdate:modelValue":d[3]||(d[3]=i=>H(w)?w.value=i:null),min:1,style:{width:"38px"},"value-on-clear":1,controls:!1,class:"inline-edit"},null,8,["modelValue"]),u("div",Ge,h(s(v)("Day",s(w))),1)]),u("div",Re,[o(Z,{modelValue:s(E),"onUpdate:modelValue":d[4]||(d[4]=i=>H(E)?E.value=i:null),"value-type":"number",class:"inline-edit !w-12"},null,8,["modelValue"]),u("div",Fe,h(s(v)("assignment-event-settings.form.workingTimePerDay",s(w))),1)]),u("div",Oe,[u("div",qe,[o(q,{"model-value":!r.eventSetting.isAllDay,"onUpdate:modelValue":d[5]||(d[5]=i=>r.eventSetting.isAllDay=!i)},null,8,["model-value"]),r.eventSetting.isAllDay?j("",!0):(C(),F(Z,{key:0,modelValue:r.eventSetting.startsAtTime,"onUpdate:modelValue":d[6]||(d[6]=i=>r.eventSetting.startsAtTime=i),"value-type":"time",class:"ml-1"},null,8,["modelValue"]))]),u("div",Ne,h(r.eventSetting.isAllDay?s(v)("assignment-event-settings.form.time"):s(v)("assignment-event-settings.form.defaultTime")),1)]),u("div",Be,[o(G,{modelValue:s(b),"onUpdate:modelValue":d[7]||(d[7]=i=>H(b)?b.value=i:null),precision:2,step:1*(r.eventSetting.employeeCount||1),min:0,"value-on-clear":0,controls:!1,style:{width:"70px"},class:"inline-edit"},null,8,["modelValue","step"]),u("div",Me,h(s(v)("assignment-event-settings.form.effort")),1)]),u("div",je,[u("div",We,[o(q,{modelValue:r.eventSetting.isOutward,"onUpdate:modelValue":d[8]||(d[8]=i=>r.eventSetting.isOutward=i)},null,8,["modelValue"]),r.eventSetting.isOutward?(C(),F(Z,{key:0,modelValue:r.eventSetting.durationDrive,"onUpdate:modelValue":d[9]||(d[9]=i=>r.eventSetting.durationDrive=i),"value-type":"number",class:"ml-1"},null,8,["modelValue"])):j("",!0)]),u("div",ze,[o(I,{icon:"truck"})])]),u("div",He,[o(G,{modelValue:r.eventSetting.minUploadCount,"onUpdate:modelValue":d[10]||(d[10]=i=>r.eventSetting.minUploadCount=i),min:0,"value-on-clear":0,controls:!1,style:{width:"70px"},class:"inline-edit"},null,8,["modelValue"]),u("div",Ye,h(s(v)("assignment-event-settings.form.requiredDocumentation")),1)]),u("div",Le,[o(k,{size:"small",class:"my-1",onClick:d[11]||(d[11]=i=>U.value=!s(U))},{default:p(()=>[W(h(s(U)?l.$t("Forwards"):l.$t("Backwards")),1)]),_:1}),u("div",Ze,h(s(v)("assignment-event-settings.form.scheduling")),1)])])]),u("div",Je,h(s(v)("assignmentEvent.task",r.tasks.length))+":",1),o(s(J),{"model-value":r.tasks,"item-key":"uuid",handle:".drag-task-handle",onChange:N},{item:p(({element:i})=>[u("div",Ke,[o(k,{text:"",class:"drag-task-handle"},{default:p(()=>[o(I,{icon:"sort"})]),_:1}),o(s(K),{ref:s($).set,modelValue:i.name,"onUpdate:modelValue":_=>i.name=_,class:"inline-edit",placeholder:l.$t("assignmentEvent.task")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),o(M,{icon:s(ce),text:"",onClick:_=>l.$emit("remove-task",i)},null,8,["icon","onClick"])])]),_:1},8,["model-value"]),u("div",Qe,[o(M,{text:"",icon:s(ve),onClick:z},{default:p(()=>[W(h(s(v)("assignmentEvent.addTask")),1)]),_:1},8,["icon"])])])}}}),Xe={class:"flex justify-between"},et={class:"font-bold"},tt={key:0,class:"px-2 py-1"},nt={class:"flex my-2"},st=L({__name:"StandardProcessAssignmentEventGroupSettings",props:{group:{type:Object,required:!0},events:{type:Array,required:!0}},emits:["add-event","remove-group"],setup(r,{emit:c}){const m=r,D=c,{t:v}=X(),$=Ie(),b=se(!1);function w(){b.value=!b.value}async function E(){if(m.group)try{const x=m.group.groupType?.name??"";await we.confirm(m.events.length?v("assignmentEventGroup.form.doYouWantToDeleteTheGroupAndEvents",{name:x}):v("assignmentEventGroup.form.doYouWantToDeleteTheGroup",{name:x}),"",{confirmButtonText:v("actions.Delete"),cancelButtonText:v("actions.Cancel"),type:"warning",confirmButtonClass:"el-button--danger"}),D("remove-group",m.group)}catch{}}function S(x){D("add-event",x,m.group)}return(x,U)=>{const T=ee("font-awesome-icon"),V=Q;return C(),Y("div",null,[u("div",Xe,[o(V,{text:"",class:"px-2 py-3 drag-handle flex-1 !justify-start remove-box-shadow-important",onClick:w},{default:p(()=>[o(T,{icon:"angle-right",rotation:s(b)?void 0:"90",class:"mr-2 transition-all","fixed-width":""},null,8,["rotation"]),u("span",et,h(r.group.groupType&&r.group.groupType.name),1)]),_:1}),o(V,{text:"",class:"px-4 py-2.5 remove-box-shadow-important",onClick:E},{default:p(()=>[o(T,{icon:"times"})]),_:1})]),s(b)?j("",!0):(C(),Y("div",tt,[he(x.$slots,"default",{events:r.events}),u("div",nt,[s($)?(C(),F(oe,{key:0,"company-id":s($),trigger:"click",type:"primary","onUpdate:modelValue":S},{default:p(()=>[W(h(x.$t("assignmentEvent.name"))+" ",1),o(T,{icon:"plus",class:"ml-1"})]),_:1},8,["company-id"])):j("",!0)])]))])}}}),ot={class:"flex-1"},at={class:"flex justify-between mb-2"},rt=L({__name:"StandardProcessAssignmentEventSettings",props:{standardProcess:{type:Object,required:!0}},setup(r){const c=r,m=ae().createScope(),D=re().createScope(),v=de().createScope();function $(e){return te(e)==="assignment-event-group-settings"}function b(e){return te(e)==="assignment-event-settings"}const{data:w,markForRemove:E}=m.useFeathersItems({params:f(()=>({query:{companyId:c.standardProcess.companyId,standardProcessId:c.standardProcess.id,$sort:{order:1}}})),fetchParams:f(()=>({query:{companyId:c.standardProcess.companyId,standardProcessId:c.standardProcess.id,$sort:{order:1}}})),limit:100});function S(e){return m.construct(e)}const{data:x,markForRemove:U}=D.useFeathersItems({params:f(()=>({query:{companyId:c.standardProcess.companyId,standardProcessId:c.standardProcess.id,$sort:{order:1}}})),fetchParams:f(()=>({query:{companyId:c.standardProcess.companyId,standardProcessId:c.standardProcess.id,$sort:{order:1}}})),limit:1e3});function T(e){return D.construct(e)}const{data:V,markForRemove:z}=v.useFeathersItems({params:f(()=>({query:{companyId:c.standardProcess.companyId,standardProcessId:c.standardProcess.id,$sort:{order:1}}})),fetchParams:f(()=>({query:{companyId:c.standardProcess.companyId,standardProcessId:c.standardProcess.id,$sort:{order:1}}})),limit:500});function N(e){return v.construct(e)}function l(e){c.standardProcess.company&&N({order:V.value.filter(n=>n.eventUuid===e.uuid).length+1,event:e,company:c.standardProcess.company,standardProcess:c.standardProcess})}async function d(e){const{event:n}=e;if(z(e),!n)return;await R(),V.value.filter(t=>t.eventUuid===n.uuid).forEach((t,a)=>{const g=a+1;t.order!==g&&(t.order=g)})}function I(e){return n=>"groupUuid"in n&&n.groupUuid===e.uuid}const k=f(()=>[...x.value,...w.value].sort((e,n)=>(e.order??0)-(n.order??0))),O=f(()=>[...k.value].filter(e=>!("groupUuid"in e)||!e.groupUuid).sort((e,n)=>(e.order??0)-(n.order??0))),A=f(()=>Math.max(0,...k.value.map(e=>e.order??0)));async function B(e,n){if(!e)return;const y=T({companyId:c.standardProcess.companyId,standardProcess:c.standardProcess,eventType:e,employeeCount:e.defaultEmployeeCount,workDays:e.defaultWorkDays,workingTimePerDay:e.defaultWorkingTimePerDay,isOutward:e.defaultIsOutward,dateAnchor:e.defaultDateAnchor,manPower:e.defaultManPower,durationDrive:e.defaultDurationDrive,isAllDay:e.defaultIsAllDay,startsAtTime:e.defaultStartsAtTime,minUploadCount:e.defaultMinUploadCount,order:n?(()=>{const t=Math.max(n.order??0,...k.value.filter(I(n)).map(a=>a.order??0));return Number.isFinite(t)?t+.5:0})():A.value+1,group:n??null});return await _(),y}async function G(e){if(!e)return;const n=S({companyId:c.standardProcess.companyId,standardProcess:c.standardProcess,standardProcessId:c.standardProcess?.id,groupType:e,order:A.value+1});return await _(),n}function q(e){return n=>{if(n.removed)return;const y=[...k.value].filter(t=>e?I(e)(t):!("groupUuid"in t)||!t.group&&!t.groupId&&!t.groupUuid).sort((t,a)=>(t.order??0)-(a.order??0));if(n.moved){const{moved:t}=n;let a=1;y.forEach((g,P)=>{g.order&&(P===t.newIndex&&(a=g.order),t.newIndex>t.oldIndex?P>t.oldIndex&&P<=t.newIndex&&(g.order-=1):P>=t.newIndex&&P<t.oldIndex&&(g.order+=1))}),t.element.order=a}if(n.added){const{added:t}=n,a=y[t.newIndex-1]?.order??e?.order??0;n.added.element.order=a+.5,"groupUuid"in n.added.element&&(e?n.added.element.group=e:n.added.element.group=null)}_()}}async function M(e){x.value.filter(I(e)).forEach(y=>{U(y)}),E(e),await R(),_()}async function i(e){U(e),await R(),_()}async function _(){await R(),k.value.forEach((e,n)=>{const y=n+1;e.order!==y&&(e.order=y)})}return(e,n)=>{const y=ee("font-awesome-icon");return C(),Y("div",ot,[u("div",at,[o(oe,{type:"primary",trigger:"click","company-id":r.standardProcess.companyId,"onUpdate:modelValue":B},{default:p(()=>[W(h(e.$t("assignmentEvent.name"))+" ",1),o(y,{icon:"plus",class:"ml-2 text-xs"})]),_:1},8,["company-id"]),o(ie,{"company-id":r.standardProcess.companyId,trigger:"click","onUpdate:modelValue":G},{default:p(()=>[W(h(e.$t("Group"))+" ",1),o(y,{icon:"plus",class:"ml-2 text-xs"})]),_:1},8,["company-id"])]),o(s(J),{"model-value":s(O),"item-key":"uuid",group:"standard-process",handle:".drag-handle",onChange:n[5]||(n[5]=t=>q()(t))},{item:p(({element:t})=>[b(t)?(C(),F(ne,{key:0,"event-setting":t,tasks:s(V).filter(a=>a.eventUuid===t.uuid),class:"p-2 mb-2 bg-gray-100 rounded-md drop-shadow hover:drop-shadow-log transition-all",onRemove:i,onRemoveTask:n[0]||(n[0]=a=>d(a)),onCreateTask:n[1]||(n[1]=a=>l(a))},null,8,["event-setting","tasks"])):$(t)?(C(),F(st,{key:1,group:t,events:[...s(x)].filter(I(t)),class:"mb-2 bg-gray-200 rounded border-gray-300 border-l-4 is-group",onAddEvent:n[4]||(n[4]=(a,g)=>B(a,g)),onRemoveGroup:M},{default:p(({events:a})=>[o(s(J),{"model-value":a,group:"standard-process","item-key":"uuid",class:"is-group",handle:".drag-handle",onChange:g=>q(t)(g)},{item:p(({element:g})=>[(C(),F(ne,{key:g.uuid,"event-setting":g,tasks:s(V).filter(P=>P.eventUuid===g.uuid),class:"p-2 mb-2 bg-gray-100 rounded-md drop-shadow hover:drop-shadow-log transition-all",onRemove:i,onRemoveTask:n[2]||(n[2]=P=>d(P)),onCreateTask:n[3]||(n[3]=P=>l(P))},null,8,["event-setting","tasks"]))]),_:2},1032,["model-value","onChange"])]),_:2},1032,["group","events"])):j("",!0)]),_:1},8,["model-value"])])}}}),ht=L({__name:"StandardProcessesSettings",props:{companyId:{type:Number,required:!0}},setup(r,{expose:c}){const m=r,{t:D}=X(),v=se(),$=ae().createScope(),b=re().createScope(),w=de().createScope(),E=Pe().createScope(),{data:S,save:x,hasChanges:U,reset:T,markForRemove:V}=$.useFeathersItems({params:f(()=>({query:{companyId:m.companyId,$limit:1e3}})),localOnly:!0}),{data:z,save:N,hasChanges:l,reset:d,markForRemove:I}=b.useFeathersItems({params:f(()=>({query:{companyId:m.companyId,$limit:1e3}})),localOnly:!0}),{save:k,reset:O,hasChanges:A}=w.useFeathersItems({params:f(()=>({query:{companyId:m.companyId,$limit:1e3}})),localOnly:!0});function B({item:_,items:e}){const n=S.value.filter(t=>t.standardProcessUuid===_.uuid),y=z.value.filter(t=>t.standardProcessUuid===_.uuid);n.forEach(t=>V(t)),y.forEach(t=>I(t)),e.forEach((t,a)=>{t.order!==a+1&&(t.order=a+1)})}const G=f(()=>[...v.value?.collapsed.values()??[]].every(_=>!_)),q=f(()=>v.value?.hasChanges||U.value||l.value||A.value);function M(){v.value?.reset(),T(),d(),O()}async function i(){await Promise.all([v.value?.save({saveNew:!0,saveChanged:!0,saveRemoved:!1}),N({saveRemoved:!0,saveChanged:!1,saveNew:!1})]),await R(),await Promise.all([x({saveNew:!0,saveChanged:!0,saveRemoved:!0})]),await R(),await Promise.all([v.value?.save({saveRemoved:!0,saveChanged:!1,saveNew:!1}),N({saveNew:!0,saveChanged:!0,saveRemoved:!1})]),await R(),await k({saveNew:!0,saveChanged:!0,saveRemoved:!0})}return c({tableRef:v,reset:M,save:i,hasChanges:q}),(_,e)=>{const n=Se,y=le,t=K;return C(),F(be,{ref_key:"tableRef",ref:v,store:s(E),params:{query:{companyId:r.companyId,$sort:{order:1}}},sortable:s(G),collapsable:"","create-data":({items:a})=>({companyId:r.companyId,order:a.length+1}),onSorted:e[0]||(e[0]=({items:a})=>a.forEach((g,P)=>g.order=P+1)),onDeleted:e[1]||(e[1]=({item:a,items:g})=>B({item:a,items:g}))},{"expanded-row":p(({row:a})=>[o(rt,{"standard-process":a},null,8,["standard-process"])]),default:p(()=>[o(y,{title:s(D)("color",1),width:"65px"},{default:p(({row:a})=>[o(n,{modelValue:a.color,"onUpdate:modelValue":g=>a.color=g,disable:"",predefine:s(_e)},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:1},8,["title"]),o(y,{title:s(D)("assignment-event-standard-processes.property.name"),width:"minmax(200px, 1fr)"},{default:p(({row:a})=>[o(t,{modelValue:a.name,"onUpdate:modelValue":g=>a.name=g},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"])]),_:1},8,["store","params","sortable","create-data"])}}});export{ht as default};
