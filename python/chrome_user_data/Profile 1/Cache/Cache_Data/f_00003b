import{N as Pe,L as ve}from"./floating-vue-FD3sxU32.js";import{_ as ue,a as je}from"./GridTableColumn.vue_vue_type_script_setup_true_lang-BayDfMSt.js";import{a as Oe,_ as Re}from"./ArtesaProfilePicture.vue_vue_type_script_setup_true_lang-CvX_tVhj.js";import{a as oe,o,aC as l,aD as ye,e5 as O,eo as Y,e as U,f as S,ek as Be,b as pe,h as v,g as u,t as h,j as m,c as s,aj as ae,e6 as le,u as fe,Z as C,i as H,s as $e,fx as Qe,fm as De,l as Ie,fz as Ze,fA as Xe,eZ as Je,fB as Ke,ec as Te,V as we,fC as Ye,a0 as et,a3 as tt,X as W,r as Le,f2 as Ae,f3 as st,fn as at,eh as Fe,ei as ot,$ as nt,eJ as rt,eA as it,ah as Ue}from"./vendor-CJXdOFCa.js";import{a4 as me,am as lt,e as dt,an as Se,ao as ct,ap as ut,aq as pt,ab as ke,G as ge,O as Ce,ar as Ve,b as mt,as as ft,at as He,l as gt,au as vt,av as ht,aw as yt,ax as kt,ay as _t,az as $t,aA as It,aB as wt,aC as bt,J as Tt,aD as St,ae as Ct,P as xt,a as Pt,a5 as Dt,i as Lt,aE as At}from"./index-M8nwXBBi.js";import{u as Me}from"./upload.store-BC_PBlNG.js";import{e as Ft}from"./assignment-events.helpers-DEIAJbEv.js";import{a as Ut,u as Vt,_ as qt}from"./AddressMap.vue_vue_type_script_setup_true_lang-DupxI1iS.js";import{_ as Et}from"./AssignmentEventName.vue_vue_type_script_setup_true_lang-BrVc5Ffk.js";import{A as zt}from"./ArtesaTooltip-CzaCLuSr.js";import{a as qe,b as Bt}from"./addresses.helpers-58tAVzey.js";import{a as Ht}from"./customers.helpers-B4XzAe7u.js";import{u as Mt}from"./timeTracking.store-CFdMaox0.js";import{_ as Gt}from"./ButtonAddressNavigation.vue_vue_type_script_setup_true_lang-BYrurNls.js";import{u as Nt}from"./useIsUserOfRole-BciEmr9Y.js";const Wt=["href","target"],jt=oe({inheritAttrs:!1,__name:"ConditionalLink",props:{href:{},target:{default:void 0},fallbackTag:{default:void 0},class:{default:void 0},style:{default:void 0}},setup(n){const r=n;return(k,a)=>r.href?(o(),l("a",{key:0,href:r.href,target:r.target,class:O(k.$attrs.class),style:Y(k.$attrs.style)},[ye(k.$slots,"default")],14,Wt)):r.fallbackTag?(o(),U(Be(r.fallbackTag),{key:1,class:O(k.$attrs.class),style:Y(k.$attrs.style)},{default:S(()=>[ye(k.$slots,"default")]),_:3},8,["class","style"])):ye(k.$slots,"default",{key:2})}}),Ot={class:"leading-6"},Rt={key:0,class:"mb-2"},Qt={key:0,class:"mb-2"},Zt={key:0,class:"flex gap-2 items-center"},Xt={class:"flex-1"},Jt={key:1,class:"flex gap-2 items-center"},Kt={class:"flex-1 leading-tight"},Yt={key:1,class:"flex gap-2 items-center"},es={class:"leading-tight"},ts={class:"mb-2"},ss={key:0,class:"flex items-center gap-2"},as=["href"],os={key:1,class:"flex items-center gap-2"},ns=["href"],rs={key:2,class:"flex items-center gap-2"},is={class:"flex-1"},ls={key:1,class:"mb-2 flex items-center gap-2"},ds=["href"],cs=oe({__name:"InfoCustomer",props:{modelValue:{}},setup(n){return(r,k)=>{const a=pe("font-awesome-icon");return o(),l("div",Ot,[r.modelValue?(o(),l("div",Rt,[r.modelValue.companyName||r.modelValue.fullName?(o(),l("div",Qt,[r.modelValue.companyName?(o(),l("div",Zt,[v(a,{icon:"building","fixed-width":"",class:"flex-none text-slate-500 text-xs"}),u("div",Xt,h(r.modelValue.companyName),1)])):m("",!0),r.modelValue.fullName?(o(),l("div",Jt,[v(a,{icon:"user","fixed-width":"",class:"flex-none text-slate-500 text-xs"}),u("div",Kt,h(s(Ht)(r.modelValue)),1)])):m("",!0)])):m("",!0),s(qe)(r.modelValue.address).length>0?(o(),l("div",Yt,[v(a,{icon:"map-marker-alt","fixed-width":"",class:"flex-none text-slate-500 text-xs"}),v(jt,{href:s(Bt)(r.modelValue.address),target:"_blank",class:"url"},{default:S(()=>[u("div",es,[(o(!0),l(ae,null,le(s(qe)(r.modelValue.address),_=>(o(),l("div",{key:_},h(_),1))),128))])]),_:1},8,["href"])])):m("",!0)])):m("",!0),u("div",ts,[r.modelValue?.telephone?(o(),l("div",ss,[v(a,{icon:"phone","fixed-width":"",class:"text-slate-500 text-xs flex-none"}),u("a",{href:`tel:${r.modelValue.telephone}`,target:"_blank",class:"url"},h(r.modelValue.telephone),9,as)])):m("",!0),r.modelValue?.mobile?(o(),l("div",os,[v(a,{icon:"mobile-alt","fixed-width":"",class:"text-slate-500 text-xs flex-none"}),u("a",{href:`tel:${r.modelValue.mobile}`,target:"_blank",class:"url"},h(r.modelValue.mobile),9,ns)])):m("",!0),r.modelValue?.fax?(o(),l("div",rs,[v(a,{icon:"fax","fixed-width":"",class:"text-slate-500 text-xs flex-none"}),u("div",is,h(r.modelValue.fax),1)])):m("",!0)]),r.modelValue?.email?(o(),l("div",ls,[v(a,{icon:"at","fixed-width":"",class:"text-slate-500 text-xs flex-none"}),u("a",{href:`mailto:${r.modelValue.email}`,target:"_blank",class:"url"},h(r.modelValue.email),9,ds)])):m("",!0)])}}}),us={key:0,class:"grid grid-cols-1 gap-3"},ps={key:1,class:"flex items-center"},ms={class:"flex-1 leading-tight"},fs={key:0,class:"mr-0.5"},gs={key:1},vs={key:0,class:"mr-0.5"},hs={key:1},ys={key:2},ks={class:"font-bold"},_s={key:0},$s={key:1},Is=["href"],ws={key:2},bs=["href"],Ts={key:3},Ss={class:"font-bold"},Cs={key:0},xs={key:1},Ps=["href"],Ds={key:2},Ls=["href"],As=oe({__name:"CardBuildingProject",props:{assignment:{type:Object,required:!0}},setup(n){const r=n,{t:k}=fe(),a=C(()=>{if(!r.assignment.constructionManager)return!1;const{constructionManager:c}=r.assignment;return c.name&&c.name!=""||c.tel&&c.tel!=""||c.mail&&c.mail!=""}),_=C(()=>{if(!r.assignment.architect)return!1;const{architect:c}=r.assignment;return c.name&&c.name!=""||c.tel&&c.tel!=""||c.mail&&c.mail!=""});return(c,$)=>{const V=pe("font-awesome-icon");return n.assignment?(o(),l("div",us,[n.assignment.addressProperty?(o(),U(Ut,{key:0,address:n.assignment.addressProperty,class:"w-full !h-80",readonly:""},null,8,["address"])):m("",!0),n.assignment.addressProperty?.street||n.assignment.addressProperty?.houseNumber||n.assignment.addressProperty?.zip||n.assignment.addressProperty?.city||n.assignment.addressProperty?.latitude&&n.assignment.addressProperty?.longitude?(o(),l("div",ps,[v(V,{icon:"map-marker-alt","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),u("div",ms,[n.assignment.addressProperty.street||n.assignment.addressProperty.houseNumber||n.assignment.addressProperty.zip||n.assignment.addressProperty.city?(o(),l(ae,{key:0},[n.assignment.addressProperty.street?(o(),l("span",fs,h(n.assignment.addressProperty.street),1)):m("",!0),n.assignment.addressProperty.houseNumber?(o(),l("span",gs,h(n.assignment.addressProperty.houseNumber),1)):m("",!0),u("div",null,[n.assignment.addressProperty.zip?(o(),l("span",vs,h(n.assignment.addressProperty.zip),1)):m("",!0),n.assignment.addressProperty.city?(o(),l("span",hs,h(n.assignment.addressProperty.city),1)):m("",!0)])],64)):n.assignment.addressProperty.latitude&&n.assignment.addressProperty.longitude?(o(),l(ae,{key:1},[H(h(n.assignment.addressProperty.latitude)+", "+h(n.assignment.addressProperty.longitude),1)],64)):m("",!0)]),v(Gt,{address:n.assignment.addressProperty},null,8,["address"])])):m("",!0),n.assignment.constructionManager&&s(a)?(o(),l("div",ys,[u("div",ks,h(c.$t("assignment.property.constructionManager"))+":",1),n.assignment.constructionManager.name?(o(),l("div",_s,[v(V,{icon:"user","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),H(" "+h(n.assignment.constructionManager.name),1)])):m("",!0),n.assignment.constructionManager.tel?(o(),l("div",$s,[v(V,{icon:"phone","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),u("a",{href:`tel:${n.assignment.constructionManager.tel}`,target:"_blank",class:"url"},h(n.assignment.constructionManager.tel),9,Is)])):m("",!0),n.assignment.constructionManager.mail?(o(),l("div",ws,[v(V,{icon:"at","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),u("a",{href:`mailto:${n.assignment.constructionManager.mail}`,target:"_blank",class:"url"},h(n.assignment.constructionManager.mail),9,bs)])):m("",!0)])):m("",!0),n.assignment.architect&&s(_)?(o(),l("div",Ts,[u("div",Ss,h(s(k)("cardBuildProject.architect"))+":",1),n.assignment.architect.name?(o(),l("div",Cs,[v(V,{icon:"user","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),H(" "+h(n.assignment.architect.name),1)])):m("",!0),n.assignment.architect.tel?(o(),l("div",xs,[v(V,{icon:"phone","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),u("a",{href:`tel:${n.assignment.architect.tel}`,target:"_blank",class:"url"},h(n.assignment.architect.tel),9,Ps)])):m("",!0),n.assignment.architect.mail?(o(),l("div",Ds,[v(V,{icon:"at","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),u("a",{href:`mailto:${n.assignment.architect.mail}`,target:"_blank",class:"url"},h(n.assignment.architect.mail),9,Ls)])):m("",!0)])):m("",!0)])):m("",!0)}}}),Fs={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Us=u("path",{fill:"currentColor",d:"m14 2l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm4 18V9h-5V4H6v16zm-5-10v2h-2v5a2 2 0 0 1-2 2a2 2 0 0 1-2-2a2 2 0 0 1 2-2c.4 0 .7.1 1 .3V10z"},null,-1),Vs=[Us];function qs(n,r){return o(),l("svg",Fs,Vs)}const Es={name:"mdi-file-music-outline",render:qs},zs={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Bs=u("path",{fill:"currentColor",d:"m14 2l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm4 18V9h-5V4H6v16zm-1-7v6H7l5-5l2 2m-4-5.5A1.5 1.5 0 0 1 8.5 12A1.5 1.5 0 0 1 7 10.5A1.5 1.5 0 0 1 8.5 9a1.5 1.5 0 0 1 1.5 1.5"},null,-1),Hs=[Bs];function Ms(n,r){return o(),l("svg",zs,Hs)}const Gs={name:"mdi-file-image-outline",render:Ms},Ns={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ws=u("path",{fill:"currentColor",d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-9.5 8.5c0 .8-.7 1.5-1.5 1.5H7v2H5.5V9H8c.8 0 1.5.7 1.5 1.5zm5 2c0 .8-.7 1.5-1.5 1.5h-2.5V9H13c.8 0 1.5.7 1.5 1.5zm4-3H17v1h1.5V13H17v2h-1.5V9h3zm-6.5 0h1v3h-1zm-5 0h1v1H7z"},null,-1),js=[Ws];function Os(n,r){return o(),l("svg",Ns,js)}const Rs={name:"mdi-file-pdf-box",render:Os},Qs={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Zs=u("path",{fill:"currentColor",d:"M21.17 3.25q.33 0 .59.25q.24.24.24.58v15.84q0 .34-.24.58q-.26.25-.59.25H7.83q-.33 0-.59-.25q-.24-.24-.24-.58V17H2.83q-.33 0-.59-.24Q2 16.5 2 16.17V7.83q0-.33.24-.59Q2.5 7 2.83 7H7V4.08q0-.34.24-.58q.26-.25.59-.25m-.8 8.09l1.2 3.94H9.6l1.31-6.56H9.53l-.78 3.88l-1.11-3.75H6.5l-1.19 3.77l-.78-3.9H3.09l1.31 6.56h1.37m14.98 4.22V17H8.25v2.5m12.5-3.75v-3.12H12v3.12m8.75-4.37V8.25H12v3.13M20.75 7V4.5H8.25V7Z"},null,-1),Xs=[Zs];function Js(n,r){return o(),l("svg",Qs,Xs)}const Ks={name:"mdi-microsoft-word",render:Js},Ys={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ea=u("path",{fill:"currentColor",d:"M21.17 3.25q.33 0 .59.25q.24.24.24.58v15.84q0 .34-.24.58q-.26.25-.59.25H7.83q-.33 0-.59-.25q-.24-.24-.24-.58V17H2.83q-.33 0-.59-.24Q2 16.5 2 16.17V7.83q0-.33.24-.59Q2.5 7 2.83 7H7V4.08q0-.34.24-.58q.26-.25.59-.25M7 13.06l1.18 2.22h1.79L8 12.06l1.93-3.17H8.22L7.13 10.9l-.04.06l-.03.07q-.26-.53-.56-1.07q-.25-.53-.53-1.07H4.16l1.89 3.19L4 15.28h1.78m8.1 4.22V17H8.25v2.5m5.63-3.75v-3.12H12v3.12m1.88-4.37V8.25H12v3.13M13.88 7V4.5H8.25V7m12.5 12.5V17h-5.62v2.5m5.62-3.75v-3.12h-5.62v3.12m5.62-4.37V8.25h-5.62v3.13M20.75 7V4.5h-5.62V7Z"},null,-1),ta=[ea];function sa(n,r){return o(),l("svg",Ys,ta)}const aa={name:"mdi-microsoft-excel",render:sa},oa={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},na=u("path",{fill:"currentColor",d:"M13.25 3.25q1.21 0 2.33.31q1.12.32 2.09.89q.97.55 1.77 1.36q.79.8 1.36 1.77q.58.97.89 2.09T22 12t-.31 2.33t-.89 2.09q-.57.97-1.36 1.77q-.8.81-1.77 1.36q-.97.58-2.09.89t-2.33.31q-1.07 0-2.1-.25q-1.03-.26-1.95-.74q-.92-.49-1.7-1.18q-.81-.7-1.43-1.58H2.83q-.33 0-.59-.24Q2 16.5 2 16.17V7.83q0-.33.24-.58Q2.5 7 2.83 7h3.24q.62-.88 1.43-1.58q.78-.7 1.7-1.18q.93-.48 1.95-.74q1.03-.25 2.1-.25m.63 1.28v6.84h6.84q-.12-1.37-.69-2.56T18.55 6.7q-.91-.91-2.12-1.48q-1.2-.57-2.55-.69M9.5 10.84q0-.57-.2-.97q-.19-.41-.52-.66q-.33-.26-.78-.37q-.45-.12-1-.12H4.37v6.55h1.54V13h1.03q.48 0 .93-.16q.46-.14.82-.41q.36-.26.58-.67q.23-.4.23-.92m3.75 8.66q.98 0 1.89-.24q.9-.26 1.71-.68q.81-.45 1.48-1.08q.67-.61 1.17-1.37q.5-.77.83-1.66q.31-.89.39-1.85h-8.08V4.53q-1.45.12-2.73.76T7.67 7h3.5q.33 0 .59.25q.24.25.24.58v8.34q0 .33-.24.59q-.26.24-.59.24h-3.5q.53.6 1.17 1.06q.66.44 1.35.78q.72.33 1.49.49q.77.17 1.57.17M6.85 10q.47 0 .76.19q.28.19.28.7q0 .22-.1.36t-.26.25q-.16.07-.35.1q-.18.04-.38.04h-.89V10z"},null,-1),ra=[na];function ia(n,r){return o(),l("svg",oa,ra)}const la={name:"mdi-microsoft-powerpoint",render:ia},da={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ca=u("path",{fill:"currentColor",d:"m14 2l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm4 18V9h-5V4H6v16zm-2-2l-2.5-1.7V18H8v-5h5.5v1.7L16 13z"},null,-1),ua=[ca];function pa(n,r){return o(),l("svg",da,ua)}const ma={name:"mdi-file-video-outline",render:pa},fa={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ga=u("path",{fill:"currentColor",d:"m12.89 3l1.96.4L11.11 21l-1.96-.4zm6.7 9L16 8.41V5.58L22.42 12L16 18.41v-2.83zM1.58 12L8 5.58v2.83L4.41 12L8 15.58v2.83z"},null,-1),va=[ga];function ha(n,r){return o(),l("svg",fa,va)}const ya={name:"mdi-xml",render:ha},ka={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},_a=u("path",{fill:"currentColor",d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zm-8-1l2-4H9v-5h6v5l-2 4z"},null,-1),$a=[_a];function Ia(n,r){return o(),l("svg",ka,$a)}const wa={name:"mdi-file-delimited-outline",render:Ia},ba={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ta=u("path",{fill:"currentColor",d:"M12 17v-2h2v2zm2-4v-2h-2v2zm0-4V7h-2v2zm-4 2h2V9h-2zm0 4h2v-2h-2zM21 5v14c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2m-2 0h-7v2h-2V5H5v14h14z"},null,-1),Sa=[Ta];function Ca(n,r){return o(),l("svg",ba,Sa)}const xa={name:"mdi-zip-box-outline",render:Ca},Pa={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Da=u("path",{fill:"currentColor",d:"M15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9zm4 16H5V5h9v5h5m-2 4H7v-2h10m-3 5H7v-2h7"},null,-1),La=[Da];function Aa(n,r){return o(),l("svg",Pa,La)}const Fa={name:"mdi-note-text-outline",render:Aa},Ua={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Va=u("path",{fill:"currentColor",d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zm4 18H6V4h7v5h5z"},null,-1),qa=[Va];function Ea(n,r){return o(),l("svg",Ua,qa)}const za={name:"mdi-file-outline",render:Ea},be=oe({__name:"FileIcon",props:{upload:{type:Object,required:!0}},setup(n){const r=n,k={audio:Es,video:ma,image:Gs,pdf:Rs,word:Ks,powerpoint:la,excel:aa,xml:ya,csv:wa,zip:xa,text:Fa,unknown:za},a=C(()=>r.upload.mimeType?r.upload.mimeType.startsWith("audio/")?"audio":r.upload.mimeType.startsWith("video/")?"video":r.upload.mimeType.startsWith("image/")?"image":r.upload.mimeType.startsWith("application/pdf")?"pdf":["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(r.upload.mimeType)?"word":["application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"].includes(r.upload.mimeType)?"powerpoint":["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(r.upload.mimeType)?"excel":r.upload.originalName.endsWith(".xml")?"xml":r.upload.originalName.endsWith(".csv")?"csv":["application/zip","application/x-compressed","application/x-zip-compressed","multipart/x-zip","application/x-7z-compressed","application/x-bzip","application/x-bzip2","application/x-gzip"].includes(r.upload.mimeType)?"zip":r.upload.mimeType.startsWith("text/")?"text":"unknown":"unknown"),_=C(()=>k[a.value]);return(c,$)=>(o(),U(Be(s(_))))}}),Ba=oe({inheritAttrs:!1,__name:"RenderPreview",props:{upload:{},fileIconClass:{}},setup(n){const r=n,k=C(()=>r.upload.mimeType.startsWith("image/"));return(a,_)=>s(k)?(o(),U(Oe,{key:0,upload:a.upload,"show-pointer":"",fit:"cover",lazy:!0,loading:"lazy",class:O(a.$attrs.class),style:Y(a.$attrs.style)},{error:S(()=>[u("div",{class:O(a.$attrs.class),style:Y(a.$attrs.style)},[v(be,{upload:a.upload,class:O(a.fileIconClass)},null,8,["upload","class"])],6)]),_:1},8,["upload","class","style"])):(o(),l("div",{key:1,class:O(a.$attrs.class),style:Y(a.$attrs.style)},[v(be,{upload:a.upload,class:O(a.fileIconClass)},null,8,["upload","class"])],6))}}),Ee=oe({__name:"GetUploadFromFileNode",props:{node:{}},setup(n){const r=n,k=me().createScope(),a=C(()=>k.localFind(r.node.uploadId));return(_,c)=>s(a)?ye(_.$slots,"default",{key:0,upload:s(a)}):m("",!0)}}),Ha={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ma=u("path",{fill:"currentColor",d:"M10 4H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-8z"},null,-1),Ga=[Ma];function Na(n,r){return o(),l("svg",Ha,Ga)}const ze={name:"mdi-folder",render:Na},Wa={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ja=u("path",{fill:"currentColor",d:"M9 16v-6H5l7-7l7 7h-4v6zm-4 4v-2h14v2z"},null,-1),Oa=[ja];function Ra(n,r){return o(),l("svg",Wa,Oa)}const he={name:"mdi-upload",render:Ra},Qa={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Za=u("path",{fill:"currentColor",d:"M5.5 7A1.5 1.5 0 0 1 4 5.5A1.5 1.5 0 0 1 5.5 4A1.5 1.5 0 0 1 7 5.5A1.5 1.5 0 0 1 5.5 7m15.91 4.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.11 0-2 .89-2 2v7c0 .55.22 1.05.59 1.41l8.99 9c.37.36.87.59 1.42.59s1.05-.23 1.41-.59l7-7c.37-.36.59-.86.59-1.41c0-.56-.23-1.06-.59-1.42"},null,-1),Xa=[Za];function Ja(n,r){return o(),l("svg",Qa,Xa)}const Ka={name:"mdi-tag",render:Ja},Ya={class:"flex justify-between mb-3"},eo={class:"flex-1 flex gap-2"},to=["onClick","onDragover","onDrop"],so={class:"!hidden md:!flex gap-2"},ao={class:"el-dropdown-menu min-w-44"},oo=["title","draggable","onClick","onContextmenu","onDragstart"],no={class:"flex flex-col gap-0.5 align-middle items-center border-2 rounded border-transparent w-full"},ro={class:"w-full text-center flex justify-center items-center gap-1 text-sm tracking-[-0.035em]"},io={class:"truncate"},lo=["onDragover","onDrop"],co={class:"w-full aspect-[4/3] bg-white group-hover:shadow transition flex items-center justify-center rounded"},uo={class:"relative size-2/5"},po={class:"flex gap-0.5 items-center justify-center w-full px-1 text-sm tracking-[-0.035em]"},mo={class:"truncate"},fo={class:"font-extralight text-slate-500"},go={class:"flex flex-col gap-0.5 align-middle items-center h-full w-full border-2 rounded border-transparent"},vo={class:"w-full aspect-[4/3] bg-white group-hover:shadow transition flex items-center justify-center rounded"},ho={class:"truncate w-full text-center px-1 text-sm tracking-[-0.035em]"},yo={key:1},ko=["draggable","onClick","onDragstart","onDragover","onDrop"],_o=["draggable","onClick","onDragstart","onDragover","onDrop"],$o={key:0,class:"font-extralight text-slate-500"},Io=["draggable","onClick","onDragstart","onDragover","onDrop"],wo=["draggable","onClick","onDragstart","onDragover","onDrop"],bo=["draggable","onClick","onDragstart","onDragover","onDrop"],To={class:"el-dropdown-menu min-w-44"},So=["onClick"],Co={class:"el-dropdown-menu__item"},xo={class:"el-dropdown-menu min-w-44"},Po=["onClick"],Do=["onClick"],Lo=["onClick"],Ao={key:1,class:"el-dropdown-menu__item"},Fo={key:2,class:"el-dropdown-menu__item"},Uo=oe({__name:"AssignmentFileGrid",props:{assignmentId:{},fileTreeLoader:{},readonly:{type:Boolean,default:!1}},setup(n){const r=n,k=$e("grid"),a=$e(null),{t:_}=fe(),c=C(()=>r.fileTreeLoader.selectionId.value?r.fileTreeLoader.findNodeInTreeData(r.fileTreeLoader.selectionId.value,"childrenGrid"):void 0),$=C(()=>c.value?.node?c.value.node.childrenGrid.filter(t=>t.type!=="placeholder"&&t.type!=="file-type"):[]),V=C(()=>r.fileTreeLoader.selectionId.value?r.fileTreeLoader.findNodeInTreeData(r.fileTreeLoader.selectionId.value,"childrenGrid")?.path?.at(-2):void 0),x=me().createScope();function j(t){if((t.type==="assignment-event"||t.type==="assignment-group"||t.type==="root"||t.type==="upload-category"||t.type==="upload-category-root"||t.type==="all-files-root")&&(r.fileTreeLoader.selectionId.value=t.id),t.type==="file"){const p=c.value?.node.uploads.filter(Se)??[];t.upload&&ct(t.upload,p)}}function Z(t,p){const{upload:E}=t;E&&(p?(E.categoryId=p,E.associatedParentId=r.assignmentId,E.associatedParentServicePath="stairs"):E.category=null,Pe())}const b=new Map;function Q(t,p){const E=b.get(t.id);E&&(p.preventDefault(),Pe(),E.show())}function g(t,p){p?b.set(t,p):b.delete(t)}const I=C(()=>c.value?.node.childrenGrid.some(t=>t.type==="placeholder"&&t.case==="empty")??!1);async function y(){if(!c.value)return;const t=await ut({multiple:!0});t&&r.fileTreeLoader.uploadFile(c.value.node,t)}function A(t){t.upload&&ne(t.upload)}function D(t){t.upload&&ie(t.upload)}async function ne(t){const[p,E]=pt(t.originalName??""),K=await De.prompt("",_("files.renameDialog.title"),{confirmButtonText:_("files.renameDialog.ok"),cancelButtonText:_("actions.Cancel"),inputValue:p});K.action==="confirm"&&(t.originalName=`${K.value}${E}`)}async function ie(t){await De.confirm(_("files.deleteDialog.description",{filename:t.originalName}),_("files.deleteDialog.title"))==="confirm"&&x.markForRemove(t)}const ee=lt(),[q,J]=Qe(),z=dt();return(t,p)=>{const E=Ie,K=Ze,d=Xe,f=pe("font-awesome-icon"),F=Je,M=Ke;return o(),l("div",{class:"w-full p-1 border-2 rounded border-transparent selection-target",onDragover:p[19]||(p[19]=e=>s(c)?.node&&!t.readonly&&t.fileTreeLoader.onDragOver(s(c).node)(e)),onDrop:p[20]||(p[20]=e=>s(c)?.node&&!t.readonly&&t.fileTreeLoader.onDrop(s(c).node)(e)),onDragleave:p[21]||(p[21]=e=>!t.readonly&&t.fileTreeLoader.onDragLeave(e))},[u("div",Ya,[u("div",eo,[s(V)?(o(),U(E,{key:0,onClick:p[0]||(p[0]=e=>j(s(V)))},{default:S(()=>[H("..")]),_:1})):m("",!0),s(c)?.path&&s(c).path.length>1?(o(),U(d,{key:1,separator:"/",class:"flex-1 w-0 overflow-x-auto flex whitespace-nowrap [&_.el-breadcrumb\\_\\_separator]:!mx-1"},{default:S(()=>[(o(!0),l(ae,null,le(s(c).path.slice(0,-1),e=>(o(),U(K,{key:e.id},{default:S(()=>[u("a",{class:"border-2 rounded border-transparent",onClick:i=>j(e),onDragover:i=>!t.readonly&&t.fileTreeLoader.onDragOver(e)(i),onDrop:i=>!t.readonly&&t.fileTreeLoader.onDrop(e)(i),onDragleave:p[1]||(p[1]=i=>!t.readonly&&t.fileTreeLoader.onDragLeave(i))},h(e.label),41,to)]),_:2},1024))),128)),v(K,{class:"border-2 rounded border-transparent",onDragover:p[2]||(p[2]=e=>s(c)?.node&&!t.readonly&&t.fileTreeLoader.onDragOver(s(c).node)(e)),onDrop:p[3]||(p[3]=e=>s(c)?.node&&!t.readonly&&t.fileTreeLoader.onDrop(s(c).node)(e)),onDragleave:p[4]||(p[4]=e=>!t.readonly&&t.fileTreeLoader.onDragLeave(e))},{default:S(()=>[H(h(s(c)?.node.label),1)]),_:1})]),_:1})):m("",!0)]),u("div",so,[t.readonly?m("",!0):(o(),U(E,{key:0,plain:"",type:"primary",onClick:p[5]||(p[5]=e=>y())},{default:S(()=>[v(s(he))]),_:1})),v(F,null,{default:S(()=>[v(E,{type:s(k)==="grid"?"primary":"default",disabled:s(k)==="grid",onClick:p[6]||(p[6]=e=>k.value="grid")},{default:S(()=>[v(f,{icon:"grip-horizontal",class:"text-xs"})]),_:1},8,["type","disabled"]),v(E,{type:s(k)==="list"?"primary":"default",disabled:s(k)==="list",onClick:p[7]||(p[7]=e=>k.value="list")},{default:S(()=>[v(f,{icon:"list",class:"text-xs"})]),_:1},8,["type","disabled"])]),_:1})]),v(s(ve),{class:"flex md:hidden"},{popper:S(()=>[u("ul",ao,[u("li",{class:"el-dropdown-menu__item",style:Y(s(k)==="grid"?{color:"var(--el-color-primary)"}:{}),onClick:p[8]||(p[8]=e=>k.value="grid")},[v(f,{icon:"grip-horizontal",class:"mr-3 text-xs"}),H(" "+h(t.$t("Grid")),1)],4),u("li",{class:"el-dropdown-menu__item",style:Y(s(k)==="list"?{color:"var(--el-color-primary)"}:{}),onClick:p[9]||(p[9]=e=>k.value="list")},[v(f,{icon:"list",class:"mr-3 text-xs"}),H(" "+h(t.$t("List")),1)],4),t.readonly?m("",!0):(o(),l("li",{key:0,class:"el-dropdown-menu__item",onClick:p[10]||(p[10]=e=>y())},[v(s(he),{class:"mr-2 h-4 w-4"}),H(" "+h(t.$t("uploadFile")),1)]))])]),default:S(()=>[v(E,null,{default:S(()=>[v(f,{icon:"ellipsis-v",class:"text-xs"})]),_:1})]),_:1})]),s(c)&&t.fileTreeLoader&&s(k)==="grid"?(o(),l("div",{key:0,ref_key:"gridRef",ref:a,class:"grid grid-cols-[repeat(auto-fill,minmax(125px,1fr))] gap-1 w-full"},[s(I)&&!t.fileTreeLoader.isUploading.value?(o(),U(M,{key:0,class:"col-span-full row-span-2"},{default:S(()=>[v(E,{type:"primary",onClick:p[11]||(p[11]=e=>y())},{default:S(()=>[v(s(he),{class:"mr-2"}),H(" "+h(t.$t("uploadFile")),1)]),_:1})]),_:1})):m("",!0),(o(!0),l(ae,null,le(s($),e=>(o(),l("div",{key:e.id,title:e.label,class:O(["group w-full flex justify-center hover:bg-slate-200 cursor-pointer rounded",{"is-file":e.type==="file"}]),draggable:e.type==="file"?"true":"false",onClick:i=>j(e),onContextmenu:i=>!t.readonly&&Q(e,i),onDragstart:i=>!t.readonly&&t.fileTreeLoader.onDragStart(e)(i)},[e.type==="file"?(o(),U(s(ve),{key:0,ref_for:!0,ref:i=>g(e.id,i),triggers:[],"hide-triggers":["click"],class:"h-full w-full"},{popper:S(({hide:i})=>[v(s(J),{child:e,hide:i},null,8,["child","hide"])]),default:S(()=>[u("div",no,[e.upload?(o(),U(Ba,{key:0,upload:e.upload,"file-icon-class":"size-1/2",class:"w-full aspect-[4/3] bg-white group-hover:shadow transition flex items-center justify-center rounded"},null,8,["upload"])):m("",!0),u("div",ro,[e.categoryColor?(o(),l("div",{key:0,class:"h-3 w-3 rounded-[50%] min-w-[0.75rem] min-h-[0.75rem]",style:Y({"background-color":e.categoryColor})},null,4)):m("",!0),u("p",io,h(e.label),1)])])]),_:2},1536)):m("",!0),e.type==="assignment-event"||e.type==="assignment-group"||e.type==="upload-category"||e.type==="upload-category-root"||e.type==="all-files-root"?(o(),l("div",{key:1,class:"flex flex-col gap-0.5 align-middle items-center border-2 rounded border-transparent w-full",onDragover:i=>!t.readonly&&t.fileTreeLoader.onDragOver(e)(i),onDrop:i=>!t.readonly&&t.fileTreeLoader.onDrop(e)(i),onDragleave:p[12]||(p[12]=i=>!t.readonly&&t.fileTreeLoader.onDragLeave(i))},[u("div",co,[u("div",uo,[v(s(ze),{class:O(["size-full",[e.uploadsAndChildrenUploads.length?"text-slate-600":"text-slate-400"]])},null,8,["class"]),e.type==="upload-category"?(o(),U(s(Ka),{key:0,class:"absolute bottom-0 right-0 size-3/5",style:Y(e.type==="upload-category"?{color:e.color}:{})},null,8,["style"])):m("",!0)])]),u("div",po,[u("div",mo,h(e.label),1),u("div",fo,h("uploadsAndChildrenUploads"in e&&e.uploadsAndChildrenUploads.length?` (${e.uploadsAndChildrenUploads.length})`:""),1)])],40,lo)):m("",!0)],42,oo))),128)),!t.readonly&&!s(c).node.childrenGrid.some(e=>e.type==="placeholder")&&s(c).node.type!=="upload-category-root"?(o(),l("div",{key:1,class:"group w-full flex justify-center hover:bg-slate-200 transition cursor-pointer rounded",onClick:p[13]||(p[13]=e=>y())},[u("div",go,[u("div",vo,[v(s(he),{class:"size-1/3 text-slate-500"})]),u("p",ho,[t.fileTreeLoader.isUploading.value?(o(),l(ae,{key:0},[H(h(t.fileTreeLoader.uploadProgress)+" % "+h(t.$t("uploading")),1)],64)):(o(),l(ae,{key:1},[H(h(t.$t("uploadFile")),1)],64))])])])):m("",!0)],512)):s(c)&&t.fileTreeLoader&&s(k)==="list"?(o(),l("div",yo,[v(je,{data:s($),"key-property":"id"},{default:S(()=>[v(ue,{width:"32px",class:"!p-0 !items-stretch cursor-pointer"},{default:S(({row:e})=>[u("div",{class:O(["flex-1 px-[6px] py-2 flex items-center",{"bg-slate-200":t.fileTreeLoader.dragoverId.value===e.id}]),draggable:e.type==="file"?"true":"false",onClick:()=>j(e),onDragstart:i=>!t.readonly&&t.fileTreeLoader.onDragStart(e)(i),onDragover:i=>!t.readonly&&t.fileTreeLoader.onDragOver(e)(i),onDrop:i=>!t.readonly&&t.fileTreeLoader.onDrop(e)(i),onDragleave:p[14]||(p[14]=i=>!t.readonly&&t.fileTreeLoader.onDragLeave(i))},[e.type==="file"?(o(),U(be,{key:0,class:"size-5",upload:e.upload},null,8,["upload"])):(o(),U(s(ze),{key:1,class:O(["size-5",[e.uploadsAndChildrenUploads.length?"text-slate-600":"text-slate-400"]]),style:Y(e.type==="upload-category"?{color:e.color}:{})},null,8,["class","style"]))],42,ko)]),_:1}),v(ue,{title:t.$t("files.fileName"),class:"!p-0 !items-stretch cursor-pointer",width:"minmax(200px,1fr)"},{default:S(({row:e})=>[e.type==="file"&&e.categoryColor?(o(),l("span",{key:0,class:"h-3 w-3 rounded-[50%] min-w-[0.75rem] min-h-[0.75rem] mr-1.5",style:Y({"background-color":e.categoryColor})},null,4)):m("",!0),u("div",{class:O(["flex-1 px-[6px] py-2 flex items-center",{"bg-slate-200":t.fileTreeLoader.dragoverId.value===e.id}]),draggable:e.type==="file"?"true":"false",onClick:()=>j(e),onDragstart:i=>!t.readonly&&t.fileTreeLoader.onDragStart(e)(i),onDragover:i=>!t.readonly&&t.fileTreeLoader.onDragOver(e)(i),onDrop:i=>!t.readonly&&t.fileTreeLoader.onDrop(e)(i),onDragleave:p[15]||(p[15]=i=>!t.readonly&&t.fileTreeLoader.onDragLeave(i))},[u("a",{class:O(["cursor-pointer",{"border-2 rounded border-transparent":e.type!=="file"}])},[H(h(e.label)+" ",1),e.uploadsAndChildrenUploads?.length?(o(),l("span",$o,h(` (${e.uploadsAndChildrenUploads.length})`),1)):m("",!0)],2)],42,_o)]),_:1},8,["title"]),s(z).md?(o(),U(ue,{key:0,title:t.$t("Date"),width:"max-content",class:"!p-0 !items-stretch cursor-pointer"},{default:S(({row:e})=>[u("div",{class:O(["flex-1 px-[6px] py-2 flex items-center",{"bg-slate-200":t.fileTreeLoader.dragoverId.value===e.id}]),draggable:e.type==="file"?"true":"false",onClick:()=>j(e),onDragstart:i=>!t.readonly&&t.fileTreeLoader.onDragStart(e)(i),onDragover:i=>!t.readonly&&t.fileTreeLoader.onDragOver(e)(i),onDrop:i=>!t.readonly&&t.fileTreeLoader.onDrop(e)(i),onDragleave:p[16]||(p[16]=i=>!t.readonly&&t.fileTreeLoader.onDragLeave(i))},h(e.type==="file"?e.upload.createdAt&&s(ke)(e.upload.createdAt):void 0),43,Io)]),_:1},8,["title"])):m("",!0),s(z).md?(o(),U(ue,{key:1,title:t.$t("Size"),width:"minmax(75px,max-content)",class:"!p-0 !items-stretch cursor-pointer"},{default:S(({row:e})=>[u("div",{class:O(["flex-1 px-[6px] py-2 flex items-center justify-end",{"bg-slate-200":t.fileTreeLoader.dragoverId.value===e.id}]),draggable:e.type==="file"?"true":"false",onClick:()=>j(e),onDragstart:i=>!t.readonly&&t.fileTreeLoader.onDragStart(e)(i),onDragover:i=>!t.readonly&&t.fileTreeLoader.onDragOver(e)(i),onDrop:i=>!t.readonly&&t.fileTreeLoader.onDrop(e)(i),onDragleave:p[17]||(p[17]=i=>!t.readonly&&t.fileTreeLoader.onDragLeave(i))},h(e.type==="file"?s(ee)(e.upload.fileSize):void 0),43,wo)]),_:1},8,["title"])):m("",!0),v(ue,{width:"max-content","header-class":"text-center",class:"!p-0 !items-stretch cursor-pointer"},{title:S(()=>[v(f,{icon:"user",class:"text-xs"})]),default:S(({row:e})=>[u("div",{class:O(["flex-1 px-[6px] py-2 flex items-center",{"bg-slate-200":t.fileTreeLoader.dragoverId.value===e.id}]),draggable:e.type==="file"?"true":"false",onClick:()=>j(e),onDragstart:i=>!t.readonly&&t.fileTreeLoader.onDragStart(e)(i),onDragover:i=>!t.readonly&&t.fileTreeLoader.onDragOver(e)(i),onDrop:i=>!t.readonly&&t.fileTreeLoader.onDrop(e)(i),onDragleave:p[18]||(p[18]=i=>!t.readonly&&t.fileTreeLoader.onDragLeave(i))},[e.type==="file"&&e.upload.createdBy?(o(),U(Re,{key:0,user:e.upload.createdBy,size:"small"},null,8,["user"])):m("",!0)],42,bo)]),_:1}),t.readonly?m("",!0):(o(),U(ue,{key:2,width:"min-content",class:"!p-0 !items-stretch cursor-pointer"},{default:S(({row:e})=>[u("div",{class:O(["flex-1 px-[6px] py-2 flex items-center",{"bg-slate-200":t.fileTreeLoader.dragoverId.value===e.id}])},[e.type==="file"?(o(),U(s(ve),{key:0},{popper:S(({hide:i})=>[v(s(J),{child:e,hide:i},null,8,["child","hide"])]),default:S(()=>[v(E,{text:"",size:"small"},{default:S(()=>[v(f,{icon:"ellipsis-v",class:"text-xs"})]),_:1})]),_:2},1024)):m("",!0)],2)]),_:1}))]),_:1},8,["data"])])):m("",!0),v(s(q),null,{default:S(({child:e,hide:i})=>[u("ul",To,[u("li",{class:"el-dropdown-menu__item",onClick:()=>(A(e),i())},[v(f,{icon:"pencil-alt",class:"mr-2 text-xs"}),H(" "+h(t.$t("actions.Rename")),1)],8,So),t.fileTreeLoader.uploadCategories.value.length?(o(),U(s(ve),{key:0,placement:"right-start","instant-move":""},{popper:S(()=>[u("ul",xo,[u("li",{class:"el-dropdown-menu__item",onClick:()=>(Z(e),i())},[v(f,{icon:"minus",class:"mr-2 text-xs"}),H(" "+h(t.$t("uploadCategories.noCategory")),1)],8,Po),(o(!0),l(ae,null,le(t.fileTreeLoader.uploadCategories.value,R=>(o(),l("li",{key:R.uuid,class:"el-dropdown-menu__item",onClick:()=>(Z(e,R.id),i())},[v(f,{icon:"plus",class:"mr-2 text-xs",style:Y(R.color?{color:R.color}:{})},null,8,["style"]),H(" "+h(R.name),1)],8,Do))),128))])]),default:S(()=>[u("li",Co,[v(f,{icon:"folder",class:"mr-2 text-xs"}),H(" "+h(t.$t("uploadCategories.changeCategory")),1)])]),_:2},1024)):m("",!0),u("li",{class:"el-dropdown-menu__item",onClick:()=>(D(e),i())},[v(f,{icon:"trash-alt",class:"mr-2 text-xs text-red-600"}),H(" "+h(t.$t("actions.Delete")),1)],8,Lo),s(z).md?m("",!0):(o(),l("li",Ao,[v(f,{icon:"clock",class:"mr-2 text-xs"}),e.type==="file"?(o(),U(Ee,{key:0,node:e},{default:S(({upload:R})=>[H(h(R.createdAt&&s(ke)(R.createdAt)),1)]),_:2},1032,["node"])):m("",!0)])),s(z).md?m("",!0):(o(),l("li",Fo,[v(f,{icon:"box",class:"mr-2 text-xs"}),e.type==="file"?(o(),U(Ee,{key:0,node:e},{default:S(({upload:R})=>[H(h(s(ee)(R.fileSize)),1)]),_:2},1032,["node"])):m("",!0)]))])]),_:1})],32)}}}),Vo=Te(Uo,[["__scopeId","data-v-a9419b75"]]),qo=["draggable","onDragover","onDrop","onDragstart"],Eo={class:"font-extralight text-slate-500"},zo=oe({__name:"AssignmentTreeFileBrowser",props:{assignmentId:{},fileTreeLoader:{},readonly:{type:Boolean,default:!0}},setup(n){const r=n,k=$e();function a(_){_.type!=="file"&&_.type!=="placeholder"&&(r.fileTreeLoader.selectionId.value=_.id)}return we([()=>r.fileTreeLoader.treeData.value,()=>r.fileTreeLoader.selectionId.value],([_,c])=>{_&&!c&&a(_[0])},{deep:!0,immediate:!0}),we(()=>r.fileTreeLoader.selectionId.value,_=>{if(!_)return;k.value?.setCurrentKey(_);const c=r.fileTreeLoader.findNodeInTreeData(_,"childrenTree");c&&c.path?.length&&k.value&&c.path.forEach($=>{const V=k.value.getNode($);V&&k.value.expandNode(V)})},{deep:!0,immediate:!0}),(_,c)=>(o(),U(s(Ye),{ref_key:"treeRef",ref:k,data:_.fileTreeLoader.treeData.value,props:{value:"id",label:"label",children:"childrenTree"},height:400,"expand-on-click-node":!0,"default-expanded-keys":["root","upload-category-root"],class:"[&_.el-tree-node.is-current]:bg-slate-100",onNodeClick:c[1]||(c[1]=$=>a($))},{default:S(({node:{data:$,label:V}})=>[u("div",{class:"flex drop-target w-full",draggable:$.type==="file"?"true":"false",onDragover:x=>!_.readonly&&_.fileTreeLoader.onDragOver($)(x),onDrop:x=>!_.readonly&&_.fileTreeLoader.onDrop($)(x),onDragleave:c[0]||(c[0]=x=>!_.readonly&&_.fileTreeLoader.onDragLeave(x)),onDragstart:x=>!_.readonly&&_.fileTreeLoader.onDragStart($)(x)},[$.type==="upload-category"?(o(),l("span",{key:0,class:"w-2.5 h-2.5 mt-[0.4rem] rounded-full mr-1",style:Y({background:$.category.color??void 0})},null,4)):m("",!0),u("span",{class:O({"text-slate-400":$.type==="placeholder","text-sm":$.type==="placeholder"||$.type==="file"})},[H(h(V)+" ",1),u("span",Eo,h("uploadsAndChildrenUploads"in $&&$.uploadsAndChildrenUploads.length?` (${$.uploadsAndChildrenUploads.length})`:""),1)],2)],40,qo)]),_:1},8,["data"]))}}),Bo=Te(zo,[["__scopeId","data-v-b88e1a31"]]),Ho=et("temp-item-upload-connector",()=>{const n=ge().createScope(),r=Ce().createScope(),k=me().createScope(),a=tt(new Map);function _(g){let I=null,y=null;if("associated"in g){const A=Ve(g.associated);if(A)if(g.associated.id){g.upload.associatedId=g.associated.id,g.upload.associatedServicePath=A;const D=a.get(g.upload.uuid);D&&"associatedId"in D&&(delete D.associatedId,delete D.associatedServicePath,Object.keys(D).length?a.set(g.upload.uuid,D):a.delete(g.upload.uuid))}else I={associatedId:g.associated.uuid,associatedServicePath:A}}if("parent"in g){const A=Ve(g.parent);if(A)if(g.parent.id){g.upload.associatedParentId=g.parent.id,g.upload.associatedParentServicePath=A;const D=a.get(g.upload.uuid);D&&"associatedParentId"in D&&(delete D.associatedParentId,delete D.associatedParentServicePath,Object.keys(D).length?a.set(g.upload.uuid,D):a.delete(g.upload.uuid))}else y={associatedParentId:g.parent.uuid,associatedParentServicePath:A}}if(I||y){const D={...a.get(g.upload.uuid)??{},...I??{},...y??{}};a.set(g.upload.uuid,D)}}function c(g,I){return!(g==="assignment-events"&&n.localFind(I)?.id||g==="assignment-event-groups"&&r.localFind(I)?.id)}function $(g,I){if(g==="assignment-events"){const y=n.localFind(I);if(y)return y}if(g==="assignment-event-groups"){const y=r.localFind(I);if(y)return y}}const V=C(()=>{for(const[,g]of a.entries())if("associatedId"in g&&!c(g.associatedServicePath,g.associatedId)||"associatedParentId"in g&&!c(g.associatedParentServicePath,g.associatedParentId))return!0;return!1}),x=C(()=>Array.from(a.keys())),j=C(()=>{const g=[];for(const I of a.keys()){const y=k.localFind(I);y&&y.id&&g.push(y.id)}return g});function Z(g){const I=[];for(const[y,A]of a.entries())if("associatedId"in A&&A.associatedId===g.associatedId&&A.associatedServicePath===g.associatedServicePath){const D=k.localFind(y);D&&I.push(D)}return I}async function b(){const g=new Set;for(const[I,y]of a.entries()){const A=k.localFind(I);if(A){if("associatedId"in y&&!c(y.associatedServicePath,y.associatedId)){const D=$(y.associatedServicePath,y.associatedId);D&&(A.associatedId=D.id,A.associatedServicePath=y.associatedServicePath,g.add(A))}if("associatedParentId"in y&&!c(y.associatedParentServicePath,y.associatedParentId)){const D=$(y.associatedParentServicePath,y.associatedParentId);D&&(A.associatedParentId=D.id,A.associatedParentServicePath=y.associatedParentServicePath,g.add(A))}}}await k.save(Array.from(g));for(const I of g){const y=a.get(I.uuid);y&&"associatedId"in y&&!c(y.associatedServicePath,y.associatedId)&&(delete y.associatedId,delete y.associatedServicePath,Object.keys(y).length?a.set(I.uuid,y):a.delete(I.uuid)),y&&"associatedParentId"in y&&!c(y.associatedParentServicePath,y.associatedParentId)&&(delete y.associatedParentId,delete y.associatedParentServicePath,Object.keys(y).length?a.set(I.uuid,y):a.delete(I.uuid))}}function Q(){a.clear()}return{tempItemMappings:a,postponeSetUploadService:_,postponeTimeHasCome:V,savePostponedUploads:b,reset:Q,uploadUuidsWithTempRelations:x,uploadIdsWithTempRelations:j,uploadsFor:Z}}),Mo=n=>{const r=mt(),k=ge().createScope(),a=Ce().createScope(),_=ft().createScope(),c=me().createScope(),{data:$}=a.useFind({localOnly:()=>(W(n.local)||n.eventsLocal)??!1,params:C(()=>{const q=W(n.assignmentId);return q?{query:{assignmentId:q,$sort:{order:1},$limit:100}}:null})}),{data:V}=k.useFind({localOnly:()=>(W(n.local)||n.eventsLocal)??!1,params:C(()=>{const q=W(n.assignmentId);return q?{query:{assignmentId:q,$sort:{order:1},$limit:200}}:null})}),x=C(()=>{const q=W(n.assignmentId);return q?{query:{$sort:{createdAt:1},$limit:-1,$or:[{associatedServicePath:"stairs",associatedId:q},{associatedParentServicePath:"stairs",associatedParentId:q}]}}:null}),{data:j,haveLoaded:Z}=_.useFind({params:C(()=>{const q=W(n.companyId);return q?{query:{companyId:q,$sort:{order:1},$limit:100}}:null})}),{data:b,hasChanges:Q,save:g,reset:I,haveLoaded:y}=c.useFeathersItems({localOnly:n.local,params:x}),{groupsAndEventsToShow:A}=Vt({events:C(()=>V.value),groups:C(()=>$.value)}),D=C(()=>{const q=[],J=b.value.filter(z=>z.associatedServicePath==="stairs");return q.push(...J),A.value.forEach(z=>{if(z.isGroup){const{group:t,events:p}=z.element,E=b.value.filter(K=>K.associatedServicePath==="assignment-event-groups"&&K.associatedId===t.id);q.push(...E),p.forEach(K=>{const d=b.value.filter(f=>f.associatedServicePath==="assignment-events"&&f.associatedId===K.id);q.push(...d)})}else{const t=z.element,p=b.value.filter(E=>E.associatedServicePath==="assignment-events"&&E.associatedId===t.id);q.push(...p)}}),q});function ne(q){const J=[];return q.forEach(z=>{if(!Se(z))return;const t=He(z);if(t){const p=z.description?`${z.description} - Hochgeladen: ${ke(z.createdAt)}`:`Hochgeladen: ${ke(z.createdAt)}`;J.push({title:z.originalName,alt:p,src:t})}}),J}function ie(q,J){const z=J?.sortedByEvent?D.value:b.value;return r.openFile(q,ne(z))}const{serverCount:ee}=c.useCount({fetchParams:C(()=>s(n.count)?x.value:null)});return{events:V,groups:$,groupsAndEventsToShow:A,uploadCategories:j,uploads:b,uploadsSortedByEventOrder:D,openFile:ie,count:ee,hasChanges:Q,save:g,reset:I,haveLoaded:y,haveLoadedCategories:Z}},_e={image:Se,video:vt,audio:ht,pdf:yt,word:kt,excel:_t,email:$t,xml:It,technicalDrawing:wt,zip:bt};function Go(n){const r=Ce().createScope(),k=ge().createScope(),a=me().createScope(),_=gt().createScope(),c=Ho(),{t:$}=fe(),V=Le(n.defaultSelection?typeof n.defaultSelection=="string"?n.defaultSelection:Q(n.defaultSelection.path,n.defaultSelection.item):null),x=C(()=>W(n.assignmentId)),{uploadCategories:j,uploads:Z,groupsAndEventsToShow:b}=Mo({assignmentId:n.assignmentId,companyId:n.companyId,local:n.local,eventsLocal:n.eventsLocal});function Q(d,f){return d==="uploads"?`file-${f.uuid}`:d==="assignment-events"?`event-${f.uuid}`:d==="assignment-event-groups"?`group-${f.uuid}`:d==="upload-categories"?`upload-category-${f.uuid}`:""}const g=C(()=>({image:$("files.imageFile",2),audio:$("files.audioFile",2),video:$("files.videoFile",2),excel:$("files.excelFile",2),pdf:$("files.pdfFile",2),word:$("files.wordFile",2),misc:$("files.miscFile",2),email:$("files.emailFile",2),technicalDrawing:$("files.technicalDrawingFile",2),xml:$("files.xmlFile",2),zip:$("files.zipFile",2)})),I=C(()=>{const d={id:"root",type:"root",children:[],childrenTree:[],childrenGrid:[],label:$("assignment.name"),uploads:[],uploadsAndChildrenUploads:[]},f={image:[],pdf:[],excel:[],word:[],audio:[],video:[],email:[],technicalDrawing:[],xml:[],zip:[],misc:[]},F=w=>{const T={type:"file",id:Q("uploads",w),label:w.originalName,uploadId:w.id,upload:w,categoryColor:w.category?.color??void 0};let B="misc";for(const N in _e){const X=N;if(X in _e&&_e[X](w)){B=X;break}}return B in f&&!f[B].some(N=>N.upload.id===w.id)&&f[B].push(T),T},M=Z.value;function e(w,T,B){w.children.push(...Array.isArray(T)?T:[T]),B?.includes("tree")&&w.childrenTree.push(...Array.isArray(T)?T:[T]),B?.includes("grid")&&w.childrenGrid.push(...Array.isArray(T)?T:[T])}const i={type:"all-files-root",id:"all-files-root",label:$("files.tree.allFiles"),children:[],childrenTree:[],childrenGrid:[],uploads:[],uploadsAndChildrenUploads:[]};e(d,i,["grid"]);const R=w=>{const T=w.id?M.filter(N=>N.associatedId===w.id&&N.associatedServicePath==="assignment-events"):c.uploadsFor({associatedId:w.uuid,associatedServicePath:"assignment-events"}),B={type:"assignment-event",id:Q("assignment-events",w),label:Ft(w),assignmentEventId:w.id,children:[],childrenTree:[],childrenGrid:[],uploads:T,uploadsAndChildrenUploads:T,isTemp:!w.id,assignmentEventUuid:w.uuid};return e(B,T.map(N=>F(N)),["grid"]),B};b.value.forEach(w=>{if(w.isGroup){const{group:T,events:B}=w.element,N=T.id?M.filter(P=>P.associatedId===T.id&&P.associatedServicePath==="assignment-event-groups"):c.uploadsFor({associatedId:T.uuid,associatedServicePath:"assignment-event-groups"}),X={type:"assignment-group",id:Q("assignment-event-groups",T),label:T.type?.name??"",groupId:T.id,children:[],childrenTree:[],childrenGrid:[],isTemp:!T.id,groupUuid:T.uuid,uploads:N,uploadsAndChildrenUploads:N},de=N.map(P=>F(P));e(i,de,["grid"]),e(X,B.map(P=>{const L=R(P);return e(i,L.childrenGrid.filter(se=>se.type==="file"),["grid"]),L}),["tree","grid"]),e(X,de,["grid"]),X.children.forEach(P=>{"uploadsAndChildrenUploads"in P&&X.uploadsAndChildrenUploads.push(...P.uploadsAndChildrenUploads)}),d.uploadsAndChildrenUploads.push(...X.uploadsAndChildrenUploads),i.uploads.push(...X.uploadsAndChildrenUploads),i.uploadsAndChildrenUploads.push(...X.uploadsAndChildrenUploads),e(d,X,["tree","grid"])}else{const T=w.element,B=R(T),N=B.childrenGrid.filter(X=>X.type==="file");e(d,B,["tree","grid"]),e(i,N,["grid"]),d.uploadsAndChildrenUploads.push(...B.uploads),i.uploads.push(...B.uploads),i.uploadsAndChildrenUploads.push(...B.uploads)}});const re={type:"upload-category-root",id:"upload-category-root",label:$("Category",2),children:[],childrenTree:[],childrenGrid:[],uploads:[],uploadsAndChildrenUploads:[]};for(const w of j.value){const T=Z.value.filter(N=>N.categoryId===w.id),B={type:"upload-category",id:Q("upload-categories",w),label:w.name,category:w,categoryId:w.id,children:[],childrenTree:[],childrenGrid:[],color:w.color??void 0,uploads:T,uploadsAndChildrenUploads:T};e(B,T.map(N=>F(N)),["grid"]),e(re,B,["tree","grid"])}j.value.length&&e(d,re,["grid"]),e(d,M.filter(w=>w.associatedId===x.value&&(w.associatedServicePath==="assignments"||w.associatedServicePath==="stairs")).map(w=>{const T=F(w);return d.uploads.push(w),d.uploadsAndChildrenUploads.push(w),i.uploads.push(w),i.uploadsAndChildrenUploads.push(w),e(i,T,["grid"]),T}),["grid"]);const te=[i,d];j.value.length&&te.push(re);for(const w in f){const T=f[w];if(T.length===0)continue;const B={type:"file-type",id:`file-type-${w}`,children:T,childrenGrid:T,childrenTree:[],label:g.value[w],uploads:T.map(N=>N.upload),uploadsAndChildrenUploads:T.map(N=>N.upload)};e(d,B,["grid"]),te.push(B)}return te});function y(d,f){if(d==="root"){const M=I.value.find(e=>e.type==="root");return{node:M,path:[M]}}const F=(M,e=[])=>{for(const i of M){if(i.id===d)return{node:i,path:[...e,i]};if(f in i){const R=F(i[f],[...e,i]);if(R)return R}}};return f==="childrenGrid"?F(I.value[1].childrenGrid,[I.value[1]]):F(I.value)}function A(d){return d.dataTransfer?.types.includes("artesa/file")}function D(d){return d.dataTransfer?.types.includes("Files")}const ne=Le();function ie(d){return f=>{if(d.type==="file"&&f.dataTransfer){f.dataTransfer.clearData();const F={"artesa/file":`${d.uploadId}`,DownloadURL:He(d.upload)};for(const M in F)F[M]&&f.dataTransfer.setData(M,F[M]);f.dataTransfer.dropEffect="copy"}}}function ee(d){return f=>{f.dataTransfer&&(!A(f)&&!D(f)||d.type!=="file"&&(A(f)&&d.type==="file-type"||(f.preventDefault(),f.stopPropagation(),f.dataTransfer.dropEffect="copy",f.currentTarget instanceof Element&&(f.currentTarget.classList.add("drop-target-set"),ne.value=d.id))))}}function q(d){d.currentTarget instanceof Element&&(d.currentTarget.classList.remove("drop-target-set"),ne.value=void 0)}function J(d){return f=>{if(!(d.type!=="assignment-group"&&d.type!=="assignment-event"&&d.type!=="all-files-root"&&d.type!=="root"&&d.type!=="upload-category"&&d.type!=="file-type"&&d.type!=="upload-category-root")&&!(!f.dataTransfer||!A(f)&&!D(f))&&!(A(f)&&d.type==="file-type"))if(f.currentTarget instanceof Element&&(f.currentTarget.classList.remove("drop-target-set"),ne.value=void 0),f.preventDefault(),f.stopPropagation(),A(f)){const F=f.dataTransfer.getData("artesa/file"),M=parseInt(F),e=a.localFind(M);if(!e)return;if(d.type==="assignment-event"){const i=k.localFind(d.assignmentEventUuid);i&&(c.postponeSetUploadService({associated:i,upload:e}),e.associatedParentServicePath="stairs",e.associatedParentId=x.value,W(n.permanent)&&a.save(e))}else if(d.type==="assignment-group"){const i=r.localFind(d.groupUuid);i&&(c.postponeSetUploadService({associated:i,upload:e}),e.associatedParentServicePath="stairs",e.associatedParentId=x.value,W(n.permanent)&&a.save(e))}else if(d.type==="root"||d.type==="all-files-root"){const i=_.localFind(x.value);i&&(c.postponeSetUploadService({associated:i,upload:e}),e.associatedParentServicePath="stairs",e.associatedParentId=x.value,W(n.permanent)&&a.save(e))}else if(d.type==="upload-category"){const i=_.localFind(x.value);i&&(c.postponeSetUploadService({parent:i,upload:e}),e.categoryId=d.categoryId,W(n.permanent)&&a.save(e))}}else D(f)&&z(d,Array.from(f.dataTransfer.files))}}async function z(d,f){let F,M,e;d.type==="assignment-event"&&!d.isTemp?(F="assignment-events",M=d.assignmentEventId):d.type==="assignment-group"&&!d.isTemp?(F="assignment-event-groups",M=d.groupId):d.type==="root"||d.type==="all-files-root"||d.type==="file-type"||d.type==="upload-category-root"?(F="stairs",M=x.value):d.type==="upload-category"&&(F="stairs",M=x.value,e=d.categoryId);for(const i of f){const R={forService:F,forId:M,properties:{categoryId:e,associatedParentServicePath:"stairs",associatedParentId:x.value}},re=await E(i,R);if(re){if(d.type==="assignment-event"){const te=k.localFind(d.assignmentEventUuid);te&&c.postponeSetUploadService({associated:te,upload:re})}else if(d.type==="assignment-group"){const te=r.localFind(d.groupUuid);te&&c.postponeSetUploadService({associated:te,upload:re})}}}}const{isUploading:t,uploadProgress:p,uploadFile:E}=Me().useUpload(),K=C(()=>Z.value.reduce((f,F)=>(f[F.id]=F,f),{})??{});return{treeData:I,uploads:Z,uploadsById:K,uploadCategories:j,findNodeInTreeData:y,onDragStart:ie,onDragOver:ee,onDragLeave:q,onDrop:J,isUploading:t,uploadProgress:p,uploadFile:z,itemToId:Q,selectionId:V,dragoverId:ne}}const No={class:"@container flex grow w-full"},Wo=oe({__name:"AssignmentFileBrowser",props:{assignmentId:{},companyId:{},readonly:{type:Boolean,default:!1},hideTree:{type:Boolean,default:!1},local:{type:Boolean,default:!1},eventsLocal:{type:Boolean,default:!1},permanent:{type:Boolean,default:!1},defaultSelection:{default:"all-files-root"}},setup(n){const r=n,k=Go({assignmentId:()=>r.assignmentId,companyId:()=>r.companyId,eventsLocal:r.eventsLocal,local:()=>r.local,permanent:()=>r.permanent,defaultSelection:r.defaultSelection});return(a,_)=>(o(),l("div",No,[v(Bo,{"assignment-id":a.assignmentId,readonly:a.readonly,"file-tree-loader":s(k),"hide-tree":a.hideTree,class:"max-w-[250px] w-full hidden @2xl:block"},null,8,["assignment-id","readonly","file-tree-loader","hide-tree"]),v(Vo,{"assignment-id":a.assignmentId,readonly:a.readonly,"file-tree-loader":s(k),class:"bg-slate-100"},null,8,["assignment-id","readonly","file-tree-loader"])]))}}),An=Te(Wo,[["__scopeId","data-v-67ae9d7c"]]),jo={key:0,class:"text-sm px-2 py-1 border-yellow-500 border-l-4 border bg-yellow-50 rounded-sm grid grid-cols-1 gap-2"},Oo={key:0,class:"break-normal whitespace-pre-line"},Ro={key:1,class:"break-normal whitespace-pre-line"},Qo={key:2,class:"break-normal whitespace-pre-line"},Zo=oe({__name:"DoingCommentForEvent",props:{event:{}},setup(n){return(r,k)=>r.event?.note?.trim()||r.event?.group?.note?.trim()||r.event?.assignment?.comment?.trim()?(o(),l("div",jo,[r.event.note?.trim()?(o(),l("p",Oo,h(r.event.note),1)):m("",!0),r.event.group?.note?.trim()?(o(),l("p",Ro,h(r.event.group.note),1)):m("",!0),r.event.assignment?.comment?.trim()?(o(),l("p",Qo,h(r.event.assignment.comment),1)):m("",!0)])):m("",!0)}}),Xo={key:0,class:"flex"},Jo=["onClick"],Ko=oe({__name:"FlowDiagram",props:{assignment:{},currentEvent:{}},emits:["click-event"],setup(n,{emit:r}){const k=n,a=r,_=ge().createScope(),{t:c}=fe(),{data:$}=_.useFind({params:C(()=>k.assignment?{query:{assignmentId:k.assignment.id,confirmedAt:{$ne:null},$sort:{order:1},$limit:100}}:null)});function V(x){x.id!==k.currentEvent.id&&a("click-event",x)}return(x,j)=>{const Z=pe("font-awesome-icon");return x.assignment&&s($).length>1?(o(),l("div",Xo,[(o(!0),l(ae,null,le(s($),(b,Q)=>(o(),l("div",{key:b.id,class:"flex items-center mb-2"},[v(zt,{content:s(c)("tracking.card.goToEvent",{event:b.type?.name}),disabled:!!x.currentEvent.id&&x.currentEvent.id===b.id},{default:S(()=>[u("div",{class:O(["relative rounded border-2 border-success py-2 px-1.5 select-none max-w-[120px]",[x.currentEvent.id&&x.currentEvent.id===b.id?"outline outline-[6px] outline-success/40":"cursor-pointer hover:shadow"]]),onClick:g=>V(b)},[u("div",{class:O(["bg-success absolute top-0 left-0 bottom-0 transition-all duration-200 ease-in-out",b.completedAt?"w-full":"w-0"])},null,2),u("div",{class:O(["relative text-center truncate",[b.completedAt?"text-white":"text-gray-500 hover:text-gray-800"]])},[v(Et,{value:b},null,8,["value"])],2)],10,Jo)]),_:2},1032,["content","disabled"]),Q<s($).length-1?(o(),U(Z,{key:0,icon:"long-arrow-alt-right",size:"xs",class:"mx-0.5 opacity-70"})):m("",!0)]))),128))])):m("",!0)}}}),Yo={class:"@container/task-tracker"},en={class:"mb-2"},tn={class:"text-sm text-gray-500 mb-1"},sn={class:"text-sm"},an={class:"flex flex-col mb-2"},on={class:"text-sm text-gray-500 mb-1"},nn={class:"flex flex-col gap-2 border-b border-slate-200 pb-2"},rn={class:"leading-tight"},ln={key:0,class:"font-normal text-sm"},dn={key:0,class:"border-t border-slate-200"},cn={key:0,class:"mt-2 border-b border-slate-200"},un={class:"text-sm text-gray-500"},pn={key:0,class:"flex mb-1 items-center justify-center"},mn={class:"mt-4 w-full"},fn={key:0,class:"text-slate-500 mb-2"},gn={key:0,class:"ml-0.5 font-extralight"},vn={key:0},Fn=oe({__name:"TaskTracker",props:Ae({user:{default:void 0},tasks:{},showGoToChat:{type:Boolean,default:!1},local:{type:Boolean,default:!1}},{event:{required:!0},eventModifiers:{}}),emits:Ae(["remove-task","go-to-chat"],["update:event"]),setup(n,{emit:r}){const k=n,a=st(n,"event"),_=r,c=Tt().createScope(),$=St().createScope(),V=me().createScope(),x=Ct().createScope(),j=ge().createScope(),Z=xt().createScope(),{t:b}=fe(),Q=Pt(),g=Mt(),I=C(()=>k.user||Q.value),y=at(),A=Nt(["office","admin","superadmin"]);function D(P){a.value=P}async function ne(P){const L=ee.value.find(se=>se.userId===P.id);L&&await c.remove(L)}async function ie(P){if(P&&!ee.value.some(L=>L.userId===P.id))return await c.create({companyId:a.value.companyId,eventId:a.value.id??void 0,userId:P.id??void 0,order:ee.value.length,assignedById:Q.value?.id??void 0})}const{data:ee,isPending:q}=c.useFind({localOnly:k.local,params:C(()=>a.value?{query:{eventId:a.value.id,$sort:{createdAt:1},$limit:-1}}:null)}),{data:J}=$.useFind({params:C(()=>a.value?.typeId?{query:{deactivatedAt:null,eventTypeId:a.value.typeId,$sort:{order:1},$limit:100}}:null)}),{serverCount:z,fetch:t}=V.useCount({params:C(()=>a.value?.id?{query:{associatedServicePath:"assignment-events",associatedId:a.value.id}}:null)});Dt("uploads","created",P=>{P.associatedServicePath==="assignment-events"&&a.value&&P.associatedId===a.value.id&&t()});const p=C(()=>a.value.minUploadCount??0),{workPeriods:E,stopActive:K,hasActiveWorkPeriod:d,activeWorkSince:f,hasPausedWorkPeriod:F}=g.useWorkPeriods({eventId:C(()=>a.value?.id)}),M=C(()=>g.isPaused||g.isUnaccountableActive),{uploads:e}=Me(),i=C(()=>e.filter(P=>P.localMeta?.assignmentEvent===a.value.id&&!P.complete).length);we(i,()=>{t()});const R=C(()=>p.value?i.value+(z.value??0)>=p.value:!0);function re(){return g.isPaused?(Ue({title:b("tracking.notification.startWorkButInPause.title"),type:"warning",message:b("tracking.notification.startWorkButInPause.message")}),!0):!1}function te(){return g.isUnaccountableActive?(Ue({title:b("tracking.notification.startWorkButInUnaccountable.title"),type:"warning",message:b("tracking.notification.startWorkButInUnaccountable.message")}),!0):!1}async function w(){re()||te()||(d.value?K():(await x.create({companyId:a.value.companyId,eventId:a.value.id,start:new Date,eventTypeId:a.value.typeId,assignmentId:a.value.assignmentId,userId:I.value?.id}),ie(I.value)))}const T=C(()=>{const P={};return J.value.forEach(L=>{P[L.id]=E.value.some(se=>se.typeId==L.id&&se.end==null)}),P});async function B(P){if(re()||te())return;const L=E.value.some(ce=>ce.typeId===P.id);if(await K(),L)return;await g.stopUnaccountable(),await g.stopPausedWorkPeriods(),await g.startWorkPeriod({assignmentId:a.value.assignmentId,eventId:a.value.id,eventTypeId:a.value.typeId,typeId:P.id})&&ie(I.value)}function N(){a.value.completedAt=a.value.completedAt?null:new Date,j.save(a.value)}async function X(){if(!a.value.company||!I.value||!a.value.assignment)return;const P={order:k.tasks.length+1},L=Z.construct(P);L.event=a.value,L.assignment=a.value.assignment,L.company=a.value.company,L.createdBy=I.value,await nt(),y.value.at(-1)?.focus()}function de(P){return L=>(L.target&&"blur"in L.target&&typeof L.target.blur=="function"&&L.target.blur(),P())}return(P,L)=>{const se=pe("font-awesome-icon"),ce=Ie,Ge=pe("FontAwesomeIcon"),Ne=Ie,We=rt;return o(),l("div",Yo,[a.value.assignment?(o(),U(Ko,{key:0,assignment:a.value.assignment,"current-event":a.value,class:"overflow-x-auto p-2 w-full",onClickEvent:L[0]||(L[0]=G=>D(G))},null,8,["assignment","current-event"])):m("",!0),v(Zo,{event:a.value,class:"mb-2 mx-0.5"},null,8,["event"]),u("div",en,[u("div",tn,h(s(b)("tracking.card.assignedUsers"))+":",1),(o(!0),l(ae,null,le(s(ee),G=>(o(),l("div",{key:G.uuid,class:"ml-2 flex items-center"},[u("div",sn,h(G.user?.fullName),1),G.user&&G.user.id===s(I)?.id?(o(),U(ce,{key:0,plain:"",size:"small",class:"ml-1",onClick:()=>ne(G.user)},{default:S(()=>[v(se,{icon:"times",class:"text-red-500"})]),_:2},1032,["onClick"])):m("",!0)]))),128)),s(I)&&s(ee).every(G=>G.userId!==s(I)?.id)?(o(),U(ce,{key:0,class:"mt-2",onClick:L[1]||(L[1]=()=>ie(s(I)))},{default:S(()=>[H(h(s(I)?.id===s(Q)?.id?s(b)("tracking.card.assignToMe"):s(b)("tracking.card.assignToUser",{user:s(I)?.shortName||s(I)?.fullName||""})),1)]),_:1})):m("",!0)]),u("div",{class:O(["grid gap-2",[a.value.type?.hideInfoInDoing?"":"grid-cols-1 @2xl/task-tracker:grid-cols-2"]])},[u("div",an,[u("span",on,h(s(b)("TimeTracking"))+":",1),Fe((o(),l("div",nn,[v(ce,{type:s(d)||s(F)?"primary":"",disabled:s(M),class:"!h-12",onClick:L[2]||(L[2]=G=>de(w)(G))},{default:S(()=>[v(Ge,{icon:s(d)?"stop-circle":s(F)?"hourglass-half":"play-circle",class:"mr-2"},null,8,["icon"]),u("div",rn,[H(h(s(d)?s(b)("tracking.time.stop"):s(b)("tracking.time.start"))+" ",1),s(d)||s(F)?(o(),l("div",ln,h(s(d)?s(b)("tracking.time.checkedInSince",{since:s(f)}):s(F)?s(b)("tracking.time.inPauseSince",{since:s(g).inPauseSince}):""),1)):m("",!0)])]),_:1},8,["type","disabled"]),s(J).length?(o(),l("div",dn)):m("",!0),(o(!0),l(ae,null,le(s(J),G=>(o(),U(ce,{key:G.id,type:G.id&&s(T)[G.id]?"primary":void 0,disabled:s(M),onClick:xe=>de(()=>B(G))(xe)},{default:S(()=>[H(h(G.name),1)]),_:2},1032,["type","disabled","onClick"]))),128))])),[[We,s(q)]]),P.tasks.length||s(A)?(o(),l("div",cn,[u("div",un,h(s(b)("assignmentEvent.task",2))+":",1),(o(!0),l(ae,null,le(P.tasks,G=>(o(),U(qt,{ref_for:!0,ref:s(y).set,key:G.uuid,task:G,checklist:"",onRemove:xe=>P.$emit("remove-task",G),onEnter:X},null,8,["task","onRemove"]))),128)),s(A)?(o(),l("div",pn,[v(Ne,{text:"",icon:s(it),onClick:X},{default:S(()=>[H(h(s(b)("assignmentEvent.addTask")),1)]),_:1},8,["icon"])])):m("",!0)])):m("",!0),u("div",mn,[s(R)?m("",!0):(o(),l("div",fn,[H(h(s(b)("tracking.card.youHaveToUploadXFilesYet",{count:s(p)-(s(z)??0)}))+" ",1),P.showGoToChat?(o(),l("span",{key:0,class:"underline text-primary ml-1 cursor-pointer",onClick:L[3]||(L[3]=()=>_("go-to-chat"))},[H(h(s(b)("tracking.card.goToChat"))+" ",1),v(se,{icon:"arrow-right"})])):m("",!0)])),v(ce,{disabled:!s(R),type:a.value.completedAt?"":"primary",class:"w-full",onClick:L[4]||(L[4]=G=>de(N)(G))},{default:S(()=>[Fe(v(se,{icon:"check",class:"mr-2"},null,512),[[ot,!!a.value.completedAt]]),u("span",null,h(a.value.completedAt?s(b)("tracking.card.eventCompleted"):s(b)("tracking.card.completeEvent")),1),s(p)?(o(),l("span",gn," ("+h((s(z)??0)+s(i))+"/"+h(s(p))+") ",1)):m("",!0)]),_:1},8,["disabled","type"])])]),!a.value.type?.hideInfoInDoing&&a.value.assignment?(o(),l("div",vn,[v(As,{class:"mb-2",assignment:a.value.assignment},null,8,["assignment"]),a.value.assignment.customer?(o(),U(cs,{key:0,modelValue:a.value.assignment.customer,"onUpdate:modelValue":L[5]||(L[5]=G=>a.value.assignment.customer=G)},null,8,["modelValue"])):m("",!0)])):m("",!0)],2)])}}});function Un(n){const r=Lt().createScope(),k=At().createScope(),{companyId:a,associatedId:_,associatedServicePath:c,associatedParentId:$,associatedParentServicePath:V,formType:x}=n,{serverCount:j}=r.useCount({fetchParams:C(()=>({query:{defaultedAt:{$ne:null},publishedAt:{$ne:null},deactivatedAt:null,companyId:W(a),...W(x)!==void 0?{type:{$contains:W(x)}}:{}}}))}),{data:Z,hasChanges:b,save:Q,reset:g}=k.useFeathersItems({params:C(()=>({query:{...W(c)!==void 0?{associatedServicePath:W(c)}:{},...W(_)!==void 0?{associatedId:W(_)}:{},...W(V)!==void 0?{associatedParentServicePath:W(V)}:{},...W($)!==void 0?{associatedParentId:W($)}:{},companyId:W(a)}}))}),I=C(()=>(j.value??0)>0),y=C(()=>Z.value.length>0);return{hasTemplates:I,hasForms:y,customForms:Z,hasChanges:b,save:Q,reset:g}}export{An as A,As as _,cs as a,Un as b,Fn as c,Ho as u};
