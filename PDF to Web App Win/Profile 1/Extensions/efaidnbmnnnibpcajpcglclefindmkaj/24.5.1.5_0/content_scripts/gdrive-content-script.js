/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(()=>{const e="orphanContentScript",t="application/pdf",n="data-double-click-handler-added",o="acrobat-prompt";let r,i,a,d,s,c,l,u=!1,m=new AbortController;const p=()=>!chrome.runtime?.id,w=e=>{try{chrome.runtime.sendMessage({main_op:"analytics",analytics:e})}catch(e){}},h=async()=>{if(i)return Promise.resolve(i);P();const e=k();if(i=await e,i)return Promise.resolve(i);const t=(()=>{for(let e=0;e<r?.selectors?.loggedInUserExtendedName.length;e++){const{element:t,attribute:{name:n}}=r?.selectors?.loggedInUserExtendedName[e],o=document.querySelector(t);if(o){const e=o.getAttribute(n);if(e)return e}}return null})();if(!t)return Promise.resolve("");for(let e=0;e<r?.selectors?.assetOwnerIdName.length;e++){const{element:n,attribute:{id:o,name:a}}=r?.selectors?.assetOwnerIdName[e],d=document.querySelectorAll(n);if(d&&d.length>0)for(let e=0;e<d.length;e++){const n=d[e].getAttribute(a);if(t?.includes(n)){const t=d[e].getAttribute(o);if(t)return i=t,i}}}return Promise.resolve(i)},b=()=>{setTimeout((()=>{try{const e=E();e&&g(e)}catch(e){}}),1e3)},g=e=>{try{const n=A(e);n&&n?.mimeType===t&&w([["DCBrowserExt:Gdrive:PDF:Viewer"]])}catch(e){}},f=e=>{try{e.addEventListener("dblclick",b,{signal:m.signal})}catch(e){}},v=e=>{try{for(let t of e){const e=t.closest("[role='row']");t.getAttribute(n)||(t.setAttribute(n,"true"),f(e))}}catch(e){}},y=e=>{if(u||e){const e=document.getElementById(o);e&&e.parentElement.removeChild(e),u=!1}},E=()=>((e,t)=>{if(e){const n=r?.selectors,o=n&&n[t];for(let t=0;t<o?.length;t++){let n=e.querySelector(o[t]);if(n)return n}}return null})(document,"fileDetails"),A=e=>{try{return JSON.parse(e?.textContent?.replace(/\\/g,""))}catch(e){return null}},I=e=>{const t=document.createElement("div"),n=(()=>{const e=document.createElement("img");return e.setAttribute("src",chrome.runtime.getURL("browser/images/acrobat_dc_appicon_128.png")),e.setAttribute("id","acrobat-icon"),e})(),i=(()=>{const e=document.createElement("span");return e.setAttribute("id","acrobat-prompt-text"),e.textContent=r?.acrobatPromptText||"Edit with Acrobat",e})(),a=(()=>{const e=document.createElement("div");return e.setAttribute("id","acrobat-prompt-tooltip"),e.textContent=r?.acrobatPromptText||"Edit with Acrobat",e})();return t.setAttribute("id",o),t.appendChild(n),t.appendChild(a),t.appendChild(i),t.addEventListener("click",(()=>(async e=>{w([[`DCBrowserExt:Gdrive_EditWithAcrobat:Clicked: ${e}`]]);const t=E(),n=A(t),o=await h(),i=JSON.stringify({ids:[n.id],action:"open",userId:o,resourceKeys:{}}),a=e?`&installStatus=${e}`:"",d=`${r.addOnHost}?state=${i}&origin=browser_extension${a}`;window.open(d,"_blank")})(e)),{signal:m.signal}),t},C=async(e,n)=>{try{let o=A(e);if(!o)return w([["DCBrowserExt:Gdrive:FileId:NotFound"]]),void y();if(o?.mimeType!==t)return void y();if(!await h())return w([["DCBrowserExt:Gdrive:UserId:NotFound"]]),void y();if(u)return;const i=I(n),a=(()=>{let e;for(let t=0;t<r?.selectors?.promptParentElement.length&&(e=document.querySelector(r?.selectors?.promptParentElement[t]),!e);t++);return e})();a&&a?.childNodes?.length>0?(a.insertBefore(i,a.childNodes[0]),u=!0,window.innerWidth>1080&&w([[`DCBrowserExt:Gdrive_EditWithAcrobat:Shown:${n}`]])):y()}catch(e){y()}},x=()=>{m.abort()},S=()=>{const e=E();if(e){A(e).mimeType===t?r?.enableFramingToGetAddOnInstallStatus&&chrome.runtime?.id?(e=>{try{if(a)return;let n=A(e);if(!n)return F(),y(),void w([["DCBrowserExt:Gdrive:FileId:NotFound"]]);if(n?.mimeType!==t)return F(),void y();if(!n||n?.mimeType!==t)return;const o=document.createElement("iframe"),i=window?.document?.location?.pathname.includes("/u/")?window.document.location.pathname.split("/")[3]:0;o.setAttribute("src",`https://workspace.google.com/u/${i}/marketplace/appfinder/app/${r?.addOnId}?tabId=${r?.tabId}&contentScriptIframe=true&origin=https%3A%2F%2Fdrive.google.com&extension_type=drive_app&pann=drive_app_widget&app_capability=1&hl=en&pre_installed_app_ids=${r?.addOnId}`),o.setAttribute("id","acrobat-addon-installation-page"),o.style.cssText="position:absolute; top:100px; height:500px; width:800px; visibility: hidden",document.body.append(o),a=!0,c=new Promise((e=>{s=e})),c?.then((({fileDetailsElement:e,installStatus:t})=>C(e,t)))}catch(e){}})(e):C(e):(F(),y())}else y(),F()},_=e=>{let t=!1;if(e)for(let n of e)if(n.addedNodes){t=!0;break}if(t||!e){const e=document.querySelectorAll('.O5x1db.ACGwFc:not([data-double-click-handler-added="true"])');e&&v(e);const t=document.querySelectorAll(".jGNTYb.ACGwFc:not([data-double-click-handler-added='true'])");t&&v(t)}},F=e=>{if(a||e){const e=document.getElementById("acrobat-addon-installation-page");e&&e.parentElement?.removeChild(e),a=!1,c=null,s=null}},N=e=>{if("add-on-install-status"===e.content_op){const t=E();t?s({fileDetailsElement:t,installStatus:e.installStatus}):(F(),y())}},P=()=>{document.addEventListener("userId",(e=>{const t=e?.detail?.userId;l(t),e?.detail?.userId||w([["DCBrowserExt:Gdrive:UserId:NotInMainWindow"]])}),{signal:m.signal})},k=()=>{let e=document.createElement("script");return e.src=chrome.runtime.getURL("browser/js/gdrive-inject.js"),e.onload=function(){this.remove()},(document.head||document.documentElement).appendChild(e),new Promise((e=>{l=e}))};const D=()=>{p()&&(x(),window.removeEventListener(e,D),chrome.runtime.onMessage.removeListener(N))},G=()=>{window.dispatchEvent(new Event(e)),chrome.runtime.onMessage.addListener(N),window.addEventListener(e,D),chrome.runtime.sendMessage({main_op:"gdrive-init"},(e=>{(e.enableAcrobatPromptInGSuite||window.location?.search?.includes("enableAcrobatPromptInGSuite"))&&(w([["DCBrowserExt:Gdrive:PromotionFeature:Enable"]]),r=e,d=chrome.runtime.getURL("browser/images/acrobat_dc_appicon_128.png"),function(){const e=chrome.runtime.getURL("browser/css/fonts/AdobeClean-Regular.otf"),t=new FontFace("AdobeClean-Regular",`url(${e})`);t.load().then((()=>{document.fonts.add(t)}))}(),(()=>{if(y(!0),F(!0),document?.body?.querySelector(`[${n}]`)){const e=document.querySelectorAll(`[${n}]`);for(let t=0;t<e.length;t++)e[t].removeAttribute(n)}})(),S(),_(),(()=>{try{const e={childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]},t=new MutationObserver((function(e){t.takeRecords(),p()?(t.disconnect(),y(),F(),x()):(_(e),S())}));t.observe(document.body,e)}catch(e){}})())}))};"workspace.google.com"===window?.document?.location?.host&&window?.document?.location?.ancestorOrigins.length>0&&"https://drive.google.com"===window?.document?.location?.ancestorOrigins[0]&&(window.document.location.pathname.includes("359458075047")||window.document.location.pathname.includes("80763634447")||window.document.location.pathname.includes("391079731570"))?(()=>{let e=new URLSearchParams(window.document.location.search);if(e.get("contentScriptIframe")){const t=document.querySelectorAll("#yDmH0d > c-wiz > div > c-wiz > div > c-wiz > div > div.YKOwYb > div > div > div.pANFDd > div > button:not([style*= 'display: none']) > span");let n;if(t.length>0)if(t?.length>1){n="Uninstalled";for(let e of t)if("Uninstall"===e?.textContent?.trim()){n="Installed";break}}else n="Uninstall"===t[0]?.textContent?.trim()?"Installed":"Uninstalled";else n="Unknown";chrome.runtime.sendMessage({main_op:"add-on-install-status",tabId:e.get("tabId"),installStatus:n})}})():"drive.google.com"===window?.document?.location?.host&&window.top===window.self&&0===window?.document?.location?.ancestorOrigins.length&&G()})();