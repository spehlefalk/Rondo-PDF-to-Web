const __vite__fileDeps=["assets/AssignmentEventWorkPeriodForm-BA8p1z_C.js","assets/AssignmentEventWorkPeriodForm.vue_vue_type_script_setup_true_lang-G9iZDIwp.js","assets/vendor-CJXdOFCa.js","assets/vendor-jIhZnUxc.css","assets/index-vAnxXWJT.js","assets/ArtesaTimeInput.vue_vue_type_style_index_0_lang-CQRpcmmu.js","assets/index-BCyjfQC_.js","assets/index-M8nwXBBi.js","assets/index-Cpd7lwzu.css","assets/ArtesaTimeInput-CqnzHY5J.css","assets/FeathersTablePagination.vue_vue_type_style_index_0_lang-DDfA-nHC.js","assets/index-DX0mSCHG.js","assets/GridTableColumn.vue_vue_type_script_setup_true_lang-BayDfMSt.js","assets/GridTableColumn-BGrcamLo.css","assets/MakeSortable.vue_vue_type_script_setup_true_lang-DJUGCLh6.js","assets/usePagination-Cs_oXynH.js","assets/FeathersTablePagination-BvXyPM5N.css","assets/SelectUser.vue_vue_type_script_setup_true_lang-81euLzTY.js","assets/FeathersSelectAutocomplete.vue_vue_type_style_index_0_lang-D553730i.js","assets/addLiteralPercentage-DRqvLqOk.js","assets/index-C4Rzlq_k.js","assets/FeathersSelectAutocomplete-DijEPAxR.css","assets/SelectAssignment.vue_vue_type_script_setup_true_lang-Cxd5Ad6L.js","assets/SelectAssignmentEvent.vue_vue_type_script_setup_true_lang-C9q4G1aL.js","assets/assignment-events.helpers-DEIAJbEv.js","assets/colorHelpers-D-IKRuV7.js","assets/AssignmentEventName.vue_vue_type_script_setup_true_lang-BrVc5Ffk.js","assets/ArtesaDatePicker.vue_vue_type_style_index_0_lang-CcrFwhau.js","assets/ArtesaDatePicker-DVxGPBIb.css","assets/useContainerQuery-odtNFs_8.js","assets/UnaccountablePeriodForm-4Z_fK_wf.js","assets/UnaccountablePeriodForm.vue_vue_type_script_setup_true_lang-DR3Oxmhb.js","assets/SelectAssignmentEventType.vue_vue_type_script_setup_true_lang-D-40_Wby.js","assets/DialogFormUserAbsence-cNNDodR0.js","assets/DialogFormUserAbsence.vue_vue_type_script_setup_true_lang-Cj_606mD.js","assets/ArtesaTimePickerForCalendar.vue_vue_type_style_index_0_lang-BBYnsASy.js","assets/index-zBlMUfmj.js","assets/index-B3z-Az2g.js","assets/index-CgnmzLwJ.js","assets/ArtesaTimePickerForCalendar-D-cEYG_s.css","assets/index-CsgZOv_I.js","assets/index-BVk_Mu3e.js","assets/useFullcalendar-CGsOBmOU.js","assets/SelectAbsenceType.vue_vue_type_script_setup_true_lang-q5Oe291l.js","assets/user-absences.helpers-C55N6n0p.js","assets/users.helpers-iK3u8JSc.js","assets/DialogFormUserAbsence-CjVVw7br.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{a as pt,C as Re,aJ as La,ab as et,x as kt,h as ft,aK as Xn,aL as Be,V as Ft,e as sn,ae as ya,af as ha,T as ua,ac as Ce,_ as ga,ah as Zn,d as es,G as ts,J as as,aM as on,aN as ns,aO as ss,aP as os,aQ as rs,t as is,aR as ls,y as ds,aS as us,s as cs,v as ms,aT as ps,w as fs,aU as vs,aV as qa,aW as ja,aX as za,aY as Qa,a2 as ys,aI as hs}from"./index-M8nwXBBi.js";import{fh as Aa,fi as ba,u as We,W as At,Z as u,fH as Ga,a as Le,b as tt,o as r,aC as B,h as n,f as a,g as _,t as c,c as e,e as S,j as b,e5 as Te,i as U,eI as Ht,l as lt,f1 as Lt,fI as ka,fJ as Pt,fK as qt,fL as jt,aj as me,e6 as Ke,eo as Sa,w as gs,V as Fe,Y as rn,eh as zt,k as rt,aS as wa,aR as mt,er as Qt,ep as Gt,eq as Kt,eJ as Da,d$ as ln,fx as Ka,eO as As,r as ye,fM as dn,el as ca,ei as bs,fN as Ya,fO as Ja,fP as Xa,fQ as ks,aF as Ta,aO as Xe,aP as bt,e0 as un,fR as Ss,eZ as cn,eU as ws,eQ as Ds,m as Yt,z as ma,em as Ts,aQ as Se,fS as Za,aW as mn,X as xt,a9 as _s,fT as na,J as sa,$ as Mt,D as en,s as pn,ew as Ms,d_ as Cs,fU as Ps,fV as Es,fv as Bs,fW as oa,F as Ut}from"./vendor-CJXdOFCa.js";import{s as pa}from"./index-zBlMUfmj.js";import{i as fa,e as $s}from"./index-D4alReEY.js";import{_ as Ze,f as Ne,s as it,a as tn}from"./ArtesaTimeInput.vue_vue_type_style_index_0_lang-CQRpcmmu.js";import{s as Vt}from"./index-BcEzXG89.js";import{u as Is,a as fn,b as vn,t as Os}from"./shared-DBN7Ac9_.js";import{a as an}from"./index-CgnmzLwJ.js";import{i as Us}from"./index-vAnxXWJT.js";import{_ as He,a as _a}from"./InputWrapperGroup.vue_vue_type_script_setup_true_lang-rA6cWmcO.js";import{A as oe}from"./ArtesaTooltip-CzaCLuSr.js";import{g as Ge}from"./users.helpers-iK3u8JSc.js";import{a as yn,g as Ws}from"./user-absences.helpers-C55N6n0p.js";import{_ as Ie,a as hn}from"./GridTableColumn.vue_vue_type_script_setup_true_lang-BayDfMSt.js";import{c as Ct,u as gn,s as xs}from"./timeTracking.store-CFdMaox0.js";import{u as va}from"./useIsUserOfRole-BciEmr9Y.js";import{f as An}from"./FeathersTablePagination.vue_vue_type_style_index_0_lang-DDfA-nHC.js";import{u as bn}from"./hasItemsForCompany.store-D65GIO8M.js";import{u as kn,g as Ns}from"./useAssignmentNameToShow-CT9dDVHV.js";import{u as Sn}from"./validateFormAsync-7W-wrk_Q.js";import{i as Fs}from"./index-CbtekCeJ.js";import{t as Vs}from"./index-CsgZOv_I.js";import{a as Rs,u as Hs,F as Ls}from"./useFullcalendar-CGsOBmOU.js";import{a as Wt,_ as qs}from"./ArtesaTimePickerForCalendar.vue_vue_type_style_index_0_lang-BBYnsASy.js";import{_ as js}from"./AssignmentEventWorkPeriodForm.vue_vue_type_script_setup_true_lang-G9iZDIwp.js";import{a as zs}from"./UnaccountablePeriodForm.vue_vue_type_script_setup_true_lang-DR3Oxmhb.js";import{g as wn,d as Dn}from"./assignment-events.helpers-DEIAJbEv.js";import{_ as Tn}from"./AssignmentEventName.vue_vue_type_script_setup_true_lang-BrVc5Ffk.js";import{_ as Qs}from"./ElTextareaAutosize.vue_vue_type_script_setup_true_lang-D7GYU17H.js";import{T as Gs}from"./index-C4Rzlq_k.js";import{_ as Ks}from"./ViewTitle.vue_vue_type_script_setup_true_lang-jbaBK0gh.js";import{_ as Ys}from"./PopperSelectUserSingle.vue_vue_type_script_setup_true_lang-mBOovX6F.js";import{u as Js}from"./useRole-B2COsB3X.js";import{a as Xs}from"./useIdObjectMapper-DMCCNls8.js";import{u as Zs}from"./useCSVStringify-B_CNzhVJ.js";function eo(v){Aa(1,arguments);var T=ba(v),t=T.getDay();return t}function ra(v){v.declinedAt&&(v.declinedAt=null),v.declinedById&&(v.declinedById=null),v.declinedNote&&(v.declinedNote=null)}function ia(v){v.approvedAt&&(v.approvedAt=null),v.approvedById&&(v.approvedById=null)}function to(){const v=pt();function T(g,y){const h=y??new Date;if(Array.isArray(g))return g.map(F=>T(F,h)).filter(Re);const p=g;if(!(p.submittedAt||p.approvedAt))return ia(p),ra(p),p.submittedAt=h,p}function t(g){if(Array.isArray(g))return g.map(h=>t(h)).filter(Re);const y=g;if(y.submittedAt)return ia(y),ra(y),y.submittedAt=null,y}function P(g,y){const h=y??new Date;if(Array.isArray(g))return g.map(F=>P(F,h)).filter(Re);const p=g;if(!p.approvedAt)return p.submittedAt||(p.submittedAt=h),ra(p),p.approvedAt=h,p.approvedBy=v.value,p}function m(g,y,h){const p=h??new Date;if(Array.isArray(g))return g.map(k=>m(k,y,p)).filter(Re);const F=g;if(!F.declinedAt)return F.submittedAt&&(F.submittedAt=null),ia(F),F.declinedAt=p,F.declinedBy=v.value,y?F.declinedNote=y:F.declinedNote=null,F}return{submit:T,unsubmit:t,approve:P,decline:m}}function Ma(){const{t:v}=We();return{getSubmittedMessage:y=>{if(!y?.submittedAt)return"";const h=et(y.submittedAt);return v("timeSheets.submittedAt",{date:h})},getDeclinedMessage:y=>{if(!y?.declinedAt)return"";const[h,p]=La(y.declinedAt);return y.declinedBy?p==="date"?v("timeSheets.declinedByAt",{user:Ge(y.declinedBy),date:h}):v("timeSheets.declinedByAtTime",{user:Ge(y.declinedBy),time:h}):p==="date"?v("timeSheets.declinedAt",{date:h}):v("timeSheets.declinedAtTime",{time:h})},getApprovedMessage:y=>{if(!y?.approvedAt)return"";const h=et(y.approvedAt);return y.approvedBy?v("timeSheets.approvedByAt",{user:Ge(y.approvedBy),date:h}):v("timeSheets.approvedAt",{date:h})},getAtByMessage:(y,h)=>{if(!y)return"";const[p,F]=La(y);return h?F==="date"?v("timeSheets.byAt",{user:Ge(h),date:p}):v("timeSheets.byAtTime",{user:Ge(h),time:p}):F==="date"?v("timeSheets.at",{date:p}):v("timeSheets.atTime",{time:p})},getByMessage:y=>y?v("timeSheets.by",{user:Ge(y)}):""}}function Ca(v){const{t:T}=We(),t=At(v),P=u(()=>t.value?.declinedAt?t.value.declinedBy?T("timeSheets.DeclinedBy",{user:Ge(t.value.declinedBy)}):T("timeSheets.Declined"):""),m=u(()=>{if(!t.value?.declinedAt)return"";const h=et(t.value.declinedAt);return t.value.declinedBy?T("timeSheets.declinedByAt",{user:Ge(t.value.declinedBy),date:h}):T("timeSheets.declinedAt",{date:h})}),g=u(()=>{if(!t.value?.approvedAt)return"";const h=et(t.value.approvedAt);return t.value.approvedBy?T("timeSheets.approvedByAt",{user:Ge(t.value.approvedBy),date:h}):T("timeSheets.approvedAt",{date:h})});return{submittedAtMessage:u(()=>{if(!t.value?.submittedAt)return"";const h=et(t.value.submittedAt);return T("timeSheets.submittedAt",{date:h})}),declinedAtMessage:m,approvedAtMessage:g,declinedMessage:P}}function la(v){v.declinedAt&&(v.declinedAt=null),v.declinedById&&(v.declinedById=null),v.declinedNote&&(v.declinedNote=null)}function da(v){v.approvedAt&&(v.approvedAt=null),v.approvedById&&(v.approvedById=null)}function ao(){const v=pt();function T(g){if(!(g.submittedAt||g.approvedAt))return da(g),la(g),g.submittedAt=new Date,g}function t(g){if(g.submittedAt)return da(g),la(g),g.submittedAt=null,g}function P(g){if(!g.approvedAt)return g.submittedAt||(g.submittedAt=new Date),la(g),g.approvedAt=new Date,g.approvedBy=v.value,g}function m(g,y){if(!g.declinedAt)return g.submittedAt&&(g.submittedAt=null),da(g),g.declinedAt=new Date,g.declinedBy=v.value,y?g.declinedNote=y:g.declinedNote=null,g}return{submit:T,unsubmit:t,approve:P,decline:m}}function no(v){const T=At(v.month),t=At(v.timeSheetDays),{t:P}=We(),{getDeclinedMessage:m}=Ma(),g=u(()=>{if(!T.value.declinedAt&&t.value.every(h=>!h.declinedAt))return"";if(T.value.declinedAt){const h=et(T.value.declinedAt);return T.value.declinedBy?P("timeSheets.declinedByAt",{user:T.value.declinedBy.shortName||T.value.declinedBy.fullName,date:h}):P("timeSheets.declinedAt",{date:h})}else{const h=Ga(t.value.filter(p=>!!p.declinedAt),["declinedAt"],["desc"]);return m(h[0])}});return{approvedAtMessage:u(()=>{if(!T.value.approvedAt&&t.value.some(h=>!h.approvedAt))return"";if(T.value.approvedAt){const h=et(T.value.approvedAt);return T.value.approvedBy?P("timeSheets.approvedByAt",{user:T.value.approvedBy.shortName||T.value.approvedBy.fullName,date:h}):P("timeSheets.approvedAt",{date:h})}else{const h=Ga(t.value.filter(p=>!!p.approvedAt),["declinedAt"],["desc"]);return m(h[0])}}),declinedAtMessage:g}}const so={class:"flex flex-wrap gap-2"},oo={class:"flex flex-wrap flex-1 gap-1"},ro={class:"leading-loose"},io={class:"leading-loose"},lo={key:0,class:"text-gray-400 text-xs flex py-1 leading-none"},uo={class:"leading-loose"},co={key:0,class:"text-gray-400 text-xs flex py-1 leading-none"},mo={key:3,class:"flex border-l border-slate-300 pl-1"},po={class:"leading-loose"},fo={class:"flex flex-wrap gap-1"},vo={key:0,class:"flex items-center"},yo={key:0,class:"text-sm text-danger ml-1"},ho=Le({__name:"TimeSheetMonthOverview",props:{timeSheetMonth:{},calculatedSumActual:{},calculatedSumTarget:{},calculatedCarryOverBefore:{},calculatedCarryOverAfter:{},calculatedSumActualAndPlanned:{},dayData:{},actions:{},canEdit:{type:Boolean},canReset:{type:Boolean},month:{},user:{},workingTimeModel:{},absenceToEditOrCreate:{}},emits:["submitAll","approveAll","declineAll","unsubmitAll","reset","update:absenceToEditOrCreate"],setup(v,{emit:T}){const t=v,P=T,{t:m}=We();function g(f){t.timeSheetMonth.carryOverBeforeManipulatedAt||(t.timeSheetMonth.carryOverBeforeManipulatedAt=new Date),t.timeSheetMonth.carryOverBefore=f}const{declinedAtMessage:y,approvedAtMessage:h}=no({month:u(()=>t.timeSheetMonth),timeSheetDays:u(()=>t.dayData.map(f=>f.timeSheetDay))}),p=kt().createScope(),F=ft(),k=u({get(){return t.absenceToEditOrCreate},set(f){P("update:absenceToEditOrCreate",f)}});function $(){k.value=p.construct({companyId:F.value,startsAt:pa(t.month),userUuid:t.user.uuid,status:"draft"})}return(f,M)=>{const A=tt("i18n-t"),Z=tt("font-awesome-icon"),L=Ht,x=lt,I=Lt;return r(),B("div",null,[n(_a,{class:"bg-gray-100 p-2 rounded shadow flex-col"},{default:a(()=>[_("div",so,[_("div",oo,[n(He,{title:f.$t("timeSheets.monthsOverview.sumActual"),class:"w-[4.5rem]"},{default:a(()=>[_("div",ro,c(e(Ne)(f.calculatedSumActual)),1)]),_:1},8,["title"]),f.calculatedSumTarget!==void 0?(r(),S(He,{key:0,title:f.$t("timeSheets.monthsOverview.sumTarget"),class:"w-[4.5rem]"},{default:a(()=>[_("div",io,c(e(Ne)(f.calculatedSumTarget)),1)]),_:1},8,["title"])):b("",!0),f.calculatedCarryOverBefore!==void 0?(r(),S(He,{key:1,title:f.$t("timeSheets.monthsOverview.carryOverBefore"),class:"w-20"},{default:a(()=>[n(Ze,{"model-value":f.timeSheetMonth.carryOverBefore,"value-type":"hours",disabled:!f.canEdit,class:Te(["!w-full",{"inline-edit [&_input]:!cursor-default":!f.canEdit}]),"onUpdate:modelValue":g},null,8,["model-value","disabled","class"]),f.calculatedCarryOverBefore!==void 0&&f.timeSheetMonth.carryOverBefore!==f.calculatedCarryOverBefore?(r(),B("div",lo,[n(A,{keypath:"timeSheets.monthsOverview.calculated",scope:"global"},{calc:a(()=>[U(c(e(Ne)(f.calculatedCarryOverBefore)),1)]),_:1})])):b("",!0)]),_:1},8,["title"])):b("",!0),f.calculatedCarryOverAfter!==void 0?(r(),S(He,{key:2,title:f.$t("timeSheets.monthsOverview.carryOverAfter"),class:"w-20"},{default:a(()=>[_("div",uo,c(e(Ne)(f.timeSheetMonth.carryOverAfter??0)),1),f.calculatedCarryOverAfter!==void 0&&f.timeSheetMonth.carryOverAfter!==f.calculatedCarryOverAfter?(r(),B("div",co,[n(A,{keypath:"timeSheets.monthsOverview.calculated",scope:"global"},{calc:a(()=>[U(c(e(Ne)(f.calculatedCarryOverAfter)),1)]),_:1})])):b("",!0)]),_:1},8,["title"])):b("",!0),f.calculatedSumActualAndPlanned!==void 0&&f.calculatedSumTarget!==void 0?(r(),B("div",mo,[n(He,{title:f.$t("timeSheets.monthsOverview.currentDifference"),class:"w-20"},{default:a(()=>[_("div",po,c(e(Ne)((f.calculatedSumActualAndPlanned??0)-(f.calculatedSumTarget??0)+(f.calculatedCarryOverBefore??0))),1)]),_:1},8,["title"])])):b("",!0)]),_("div",fo,[f.canEdit?(r(),S(oe,{key:0,content:e(m)("userAbsence.create")},{default:a(()=>[n(x,{plain:"",onClick:M[0]||(M[0]=ee=>$())},{default:a(()=>[n(L,null,{default:a(()=>[n(Z,{icon:["far","calendar-times"],class:"text-xs"})]),_:1})]),_:1})]),_:1},8,["content"])):b("",!0),f.canReset?(r(),S(oe,{key:1,content:e(m)("actions.reset")},{default:a(()=>[n(x,{onClick:M[1]||(M[1]=()=>P("reset"))},{default:a(()=>[n(L,null,{default:a(()=>[n(e(ka))]),_:1})]),_:1})]),_:1},8,["content"])):b("",!0),f.actions.canSubmit?(r(),S(oe,{key:2,content:e(m)("timeSheets.submitAll")},{default:a(()=>[n(x,{type:"primary",class:"allow-cursor",onClick:M[2]||(M[2]=()=>P("submitAll"))},{default:a(()=>[n(L,null,{default:a(()=>[n(e(Pt))]),_:1})]),_:1})]),_:1},8,["content"])):b("",!0),f.actions.canApprove?(r(),S(oe,{key:3,content:e(m)("timeSheets.approveAll")},{default:a(()=>[n(x,{type:"primary",plain:!!f.actions.timeSheetsToSubmit.length,disabled:!f.actions.timeSheetsToApprove.length,class:"allow-cursor",onClick:M[3]||(M[3]=()=>P("approveAll"))},{default:a(()=>[n(L,null,{default:a(()=>[n(e(qt))]),_:1})]),_:1},8,["plain","disabled"])]),_:1},8,["content"])):b("",!0),f.actions.canDecline?(r(),S(oe,{key:4,content:e(m)("timeSheets.declineAll")},{default:a(()=>[n(x,{type:"danger",plain:!!f.actions.timeSheetsToSubmit.length||!f.actions.timeSheetsToDecline.length,disabled:!f.actions.timeSheetsToDecline.length,class:"allow-cursor",onClick:M[4]||(M[4]=()=>P("declineAll"))},{default:a(()=>[n(L,null,{default:a(()=>[n(e(jt))]),_:1})]),_:1},8,["plain","disabled"])]),_:1},8,["content"])):b("",!0)])]),_("div",null,[f.dayData.some(ee=>!!ee.timeSheetDay.declinedAt)||f.timeSheetMonth.declinedAt?(r(),B("div",vo,[n(oe,{content:e(y)},{default:a(()=>[n(I,{type:"danger"},{default:a(()=>[U(c(e(m)("timeSheets.declined")),1)]),_:1})]),_:1},8,["content"]),f.timeSheetMonth.declinedAt&&f.timeSheetMonth.declinedNote?(r(),B("div",yo,c(e(m)("timeSheets.monthsOverview.declineReason",{user:e(Ge)(f.timeSheetMonth.declinedBy),reason:f.timeSheetMonth.declinedNote})),1)):b("",!0)])):f.dayData.every(ee=>!!ee.timeSheetDay.approvedAt)||f.timeSheetMonth.approvedAt?(r(),S(oe,{key:1,content:e(h)},{default:a(()=>[n(I,{type:"success"},{default:a(()=>[U(c(e(m)("timeSheets.approved")),1)]),_:1})]),_:1},8,["content"])):f.dayData.every(ee=>!!ee.timeSheetDay.submittedAt)?(r(),S(I,{key:2,type:"info"},{default:a(()=>[U(c(e(m)("timeSheets.submitted")),1)]),_:1})):(r(),S(I,{key:3,type:"warning"},{default:a(()=>[U(c(e(m)("timeSheets.notSubmittedYet")),1)]),_:1}))])]),_:1})])}}}),Rt=Le({__name:"TimeSheetDayTags",props:{data:{},hideApproved:{type:Boolean,default:!1},workingTimeModel:{}},emits:["absenceClicked"],setup(v,{emit:T}){const t=v,P=T,{t:m}=We(),{declinedAtMessage:g,approvedAtMessage:y,submittedAtMessage:h}=Ca(u(()=>t.data.timeSheetDay)),{getPauseErrorMessage:p,getDurationErrorMessage:F}=Is();return(k,$)=>{const f=Lt;return r(),B(me,null,[k.data.timeSheetDay.declinedAt?(r(),S(oe,{key:0,content:e(g)},{default:a(()=>[n(f,{type:"danger"},{default:a(()=>[U(c(e(m)("timeSheets.declined")),1)]),_:1})]),_:1},8,["content"])):b("",!0),!k.hideApproved&&k.data.timeSheetDay.approvedAt&&!k.data.timeSheetDay.declinedAt?(r(),S(oe,{key:1,content:e(y)},{default:a(()=>[n(f,{type:"success"},{default:a(()=>[U(c(e(m)("timeSheets.approved")),1)]),_:1})]),_:1},8,["content"])):b("",!0),k.data.timeSheetDay.submittedAt&&!k.data.timeSheetDay.declinedAt&&!k.data.timeSheetDay.approvedAt?(r(),S(oe,{key:2,content:e(h)},{default:a(()=>[n(f,{type:"info"},{default:a(()=>[U(c(e(m)("timeSheets.submitted")),1)]),_:1})]),_:1},8,["content"])):b("",!0),!k.data.timeSheetDay.submittedAt&&!k.data.timeSheetDay.approvedAt&&!k.data.timeSheetDay.declinedAt&&k.data.isTodayOrBefore?(r(),S(f,{key:3,type:"warning"},{default:a(()=>[U(c(e(m)("timeSheets.notSubmittedYet")),1)]),_:1})):b("",!0),k.data.durationError?(r(),S(oe,{key:4,content:e(F)(k.data.durationError)},{default:a(()=>[n(f,{type:"danger"},{default:a(()=>[U(c(k.data.durationError.type==="durationTooLong"?e(m)("timeSheets.errors.durationTooLong"):""),1)]),_:1})]),_:1},8,["content"])):b("",!0),k.data.pauseError?(r(),S(oe,{key:5,content:e(p)(k.data.pauseError)},{default:a(()=>[n(f,{type:"danger"},{default:a(()=>[U(c(k.data.pauseError.type==="pauseTooLong"?e(m)("timeSheets.errors.breakTimeTooLong"):k.data.pauseError.type==="pauseTooShort"?e(m)("timeSheets.errors.breakTimeTooShort"):""),1)]),_:1})]),_:1},8,["content"])):b("",!0),k.data.hasMultipleDays?(r(),S(oe,{key:6,content:e(m)("timeSheets.errors.multipleDays")},{default:a(()=>[n(f,{type:"warning"},{default:a(()=>[U(c(e(m)("timeSheets.errors.multipleDaysShort")),1)]),_:1})]),_:1},8,["content"])):b("",!0),k.workingTimeModel?.showIsManipulated&&(k.data.timeSheetDay.manipulatedAt||k.data.lastManipulatedPeriod)?(r(),S(oe,{key:7,content:k.data.manipulatedByUser?e(m)("timeSheets.manipulated.infoTextBy",{user:k.data.manipulatedByUser.shortName||k.data.manipulatedByUser.fullName}):e(m)("timeSheets.manipulated.infoText")},{default:a(()=>[n(f,{type:"warning"},{default:a(()=>[U(c(e(m)("timeSheets.manipulated.partly")),1)]),_:1})]),_:1},8,["content"])):b("",!0),(r(!0),B(me,null,Ke(k.data.holidays,M=>(r(),S(f,{key:M.uuid,type:"warning"},{default:a(()=>[U(c(M.name),1)]),_:2},1024))),128)),(r(!0),B(me,null,Ke(k.data.userAbsences,M=>(r(),S(f,{key:M.uuid,color:M.type?.color??void 0,theme:"plain",class:"cursor-pointer",style:Sa({"--el-tag-text-color":e(yn)(M),opacity:M.status==="approved"?1:.5}),onClick:A=>P("absenceClicked",M)},{default:a(()=>[U(c(M.type?.name??""),1)]),_:2},1032,["color","style","onClick"]))),128))],64)}}}),go={class:"sm:flex gap-x-1 text-center font-bold"},Ao={class:"flex-none"},bo={class:"flex-none"},ko={class:"border-[var(--el-border-color-lighter)] border-b w-0 flex-1 flex flex-wrap gap-1 [&:has(span)]:px-2 [&:has(span)]:pb-2"},So=Le({__name:"TimeSheetMonth",props:{month:{},user:{},dayData:{},targetSum:{},actions:{},workingTimeModel:{},isPendingCalculatedTargetWorkingTime:{type:Boolean,default:!1},absenceToEditOrCreate:{}},emits:["submitAll","approveAll","declineAll","unsubmitAll","submit","approve","decline","go-to-date","update:absenceToEditOrCreate"],setup(v,{emit:T}){const t=v,P=T,{t:m}=We(),g=pt(),y=u(()=>t.dayData.map(O=>O.timeSheetDay)),h=Ct(wa,{interval:{hours:1}}),p=Xn().createScope(),{data:F,isPending:k}=p.useFind({params:u(()=>t.user?{query:{userId:t.user.id,month:{$in:[Be(an(t.month,-1)),Be(t.month)]}}}:null)}),$=u(()=>F.value.find(O=>O.id&&O.month===Be(t.month)&&O.userId===t.user?.id)),f=u(()=>F.value.find(O=>O.id&&O.month===Be(an(t.month,-1))&&O.userId===t.user?.id)),M=u(()=>k.value===!1&&!$.value&&!!t.user);gs(M,async()=>{t.user&&p.construct({month:Be(t.month),user:t.user,companyId:t.user.companyId,sumTarget:t.workingTimeModel?t.targetSum??0:null,sumActual:t.workingTimeModel?Z.value??0:null,carryOverAfter:t.workingTimeModel?ee.value??0:null,carryOverBefore:t.workingTimeModel?x.value??0:null})});const A=u(()=>F.value.find(O=>O.month&&O.month===Be(t.month)&&O.userId===t.user?.id)),Z=u(()=>{let O=0;for(const Q of y.value)O+=Q.duration??0;return O}),L=u(()=>{if(!t.dayData.length||!t.workingTimeModel||!Us(h.value,{start:t.dayData.at(0).date,end:t.dayData.at(-1).date}))return;let O=0;for(const{timeSheetDay:Q,key:$e,date:D,userAbsences:z,holidays:_e,isTodayOrBefore:le,workingTimeModelWeekday:be}of t.dayData){if(Q.duration){O+=Q.duration;continue}if(le){O+=Q.duration??0;continue}if(Q.manipulatedAt){O+=Q.duration??0;continue}if(Q.submittedAt){O+=Q.duration??0;continue}if(!(_e.length&&!t.workingTimeModel.countHolidaysAsWorkdays)&&!(z.length&&z.some(N=>N.type?.countAsWorkingTime===!1))&&be&&be?.duration!=null){O+=be.duration;continue}}return O}),x=u(()=>t.workingTimeModel&&!k.value?f.value?.carryOverAfter??0:void 0),I=u(()=>t.targetSum??void 0),ee=u(()=>!t.workingTimeModel||Z.value===void 0||A.value?.carryOverBefore===void 0||I.value===void 0?void 0:-((I.value??0)-((Z.value??0)+(A.value.carryOverBefore??0)))),q=va(["admin","superadmin"]),te=u(()=>!!A.value&&!A.value.submittedAt),pe=u(()=>!!A.value&&(te.value||q.value&&!A.value.approvedAt)),ue=u(()=>t.user&&A.value&&Z.value!==void 0&&A.value.sumActual!==Z.value&&te.value?Z.value:void 0);Fe(ue,O=>{O===void 0||!A.value||A.value.sumActual===O||(A.value.sumActual=O)},{immediate:!0});const ce=u(()=>t.user&&A.value&&I.value!==void 0&&A.value.sumTarget!==I.value?I.value:void 0);Fe([ce,te],([O,Q])=>{!Q||O===void 0||!A.value||A.value.sumTarget===O||(A.value.sumTarget=O)},{immediate:!0});const J=u(()=>t.user&&A.value&&x.value!==void 0&&A.value.carryOverBefore!==x.value?x.value:void 0);Fe([J,te,()=>!!A.value?.carryOverBeforeManipulatedAt],([O,Q,$e])=>{!Q||O===void 0||$e||!A.value||A.value.carryOverBefore===O||(A.value.carryOverBefore=O)},{immediate:!0});const Pe=u(()=>{if(!t.user||!A.value||ee.value===void 0)return;const O=ee.value,Q=t.workingTimeModel?.carryOverMonthMaximum||Number.MAX_SAFE_INTEGER;return A.value.carryOverAfter!==Math.min(O,Q)?Math.min(O,Q):void 0});Fe([Pe,te],([O,Q])=>{!Q||O===void 0||!A.value||A.value.carryOverAfter===O||(A.value.carryOverAfter=O)},{immediate:!0});const he=u(()=>!!A.value&&pe.value&&(ue.value!==void 0||ce.value!==void 0||J.value!==void 0||Pe.value!==void 0));function K(){!he.value||!A.value||(ue.value!==void 0&&(A.value.sumActual=ue.value),ce.value!==void 0&&(A.value.sumTarget=ce.value),J.value!==void 0&&(A.value.carryOverBefore=J.value,A.value.carryOverBeforeManipulatedAt=null),Pe.value!==void 0&&(A.value.carryOverAfter=Pe.value))}const qe=u(()=>A.value?!A.value.id||p.hasChanges(A.value):!1);rn(qe,()=>{!A.value||!qe.value||p.save(A.value)},{debounce:350});function fe(){A.value&&(A.value.declinedAt=null,A.value.declinedById=null,A.value.declinedNote=null)}function ie(){P("approveAll"),!(!A.value||A.value.approvedAt)&&(A.value.approvedAt=new Date,A.value.approvedBy=g.value,A.value.declinedAt=null,A.value.declinedById=null,A.value.declinedNote=null)}function Ve(){P("unsubmitAll"),!(!A.value||!A.value.submittedAt||A.value.approvedAt)&&(A.value.submittedAt=null,fe())}const{actionsForDay:Ee}=fn(),j=u(()=>t.dayData.map((O,Q)=>Ee(O,P))),at=kt().createScope(),dt=ft(),we=u({get(){return t.absenceToEditOrCreate},set(O){P("update:absenceToEditOrCreate",O)}});function Ye(O){we.value=at.construct({companyId:dt.value,startsAt:O,endsAt:mt(O),userUuid:t.user.uuid,status:"draft"})}return(O,Q)=>{const $e=tt("font-awesome-icon"),D=lt,z=Qt,_e=Gt,le=Kt,be=Da;return r(),B("div",null,[e(A)?zt((r(),S(ho,{key:0,"absence-to-edit-or-create":e(we),"onUpdate:absenceToEditOrCreate":Q[0]||(Q[0]=N=>rt(we)?we.value=N:null),"time-sheet-month":e(A),"calculated-carry-over-after":e(ee),"calculated-carry-over-before":e(x),"calculated-sum-actual":e(Z),"calculated-sum-target":e(I),"calculated-sum-actual-and-planned":e(L),actions:O.actions,"day-data":O.dayData,"can-edit":e(pe),"can-reset":e(he),"working-time-model":O.workingTimeModel,month:O.month,user:O.user,class:"mb-2",onReset:K,onSubmitAll:Q[1]||(Q[1]=()=>P("submitAll",{timeSheetMonth:e(A)})),onApproveAll:ie,onDeclineAll:Q[2]||(Q[2]=()=>P("declineAll",{timeSheetMonth:e(A)})),onUnsubmitAll:Ve},null,8,["absence-to-edit-or-create","time-sheet-month","calculated-carry-over-after","calculated-carry-over-before","calculated-sum-actual","calculated-sum-target","calculated-sum-actual-and-planned","actions","day-data","can-edit","can-reset","working-time-model","month","user"])),[[be,O.isPendingCalculatedTargetWorkingTime]]):b("",!0),n(hn,{data:O.dayData,"row-class":N=>N.timeSheetDay.approvedAt?"bg-green-100/60":N.timeSheetDay.declinedAt?"bg-red-100/70":N.isToday?"bg-yellow-50":N.numberOfWeek===0||N.numberOfWeek===6||N.holidays.length||N.userAbsences.length?"bg-[var(--el-fill-color-lighter)]":void 0,class:"[&>tr>th]:!px-1 [&>tr>th]:md:!px-2 [&>tr>td]:!px-1 [&>tr>td]:md:!px-2 [&>tr>td]:!border-b-0 shadow"},{default:a(()=>[n(Ie,{title:"Tag","header-class":"!text-center",class:"justify-center",width:"minmax(30px, max-content)"},{default:a(({row:N})=>[_("div",go,[_("div",Ao,c(e(Ft)(N.date,"EEEEEE")),1),_("div",bo,c(e(Ft)(N.date,"dd.")),1)])]),_:1}),n(Ie,{title:"Beginn","header-class":"!text-center",class:"justify-center",width:"max-content"},{default:a(({row:N})=>[N.hasAbsenceOrHoliday?b("",!0):(r(),S(Ze,{key:0,"model-value":N.timeSheetDay.startsAt,"value-type":"date","ref-date":N.date,placeholder:N.editable?e(m)("timeSheets.form.startTime"):"-",before:N.timeSheetDay?.endsAt??void 0,class:Te({"inline-edit [&_input]:!cursor-default":!N.editable}),disabled:!N.editable,"onUpdate:modelValue":i=>N.manipulateByHand("startsAt",i)},null,8,["model-value","ref-date","placeholder","before","class","disabled","onUpdate:modelValue"]))]),_:1}),n(Ie,{title:"Ende","header-class":"!text-center",class:"justify-center",width:"max-content"},{default:a(({row:N})=>[N.hasAbsenceOrHoliday?b("",!0):(r(),S(Ze,{key:0,"model-value":N.endsAt,"value-type":"date","ref-date":N.date,after:N.timeSheetDay?.startsAt??void 0,placeholder:N.editable?e(m)("timeSheets.form.endTime"):"-",class:Te({"inline-edit [&_input]:!cursor-default":!N.editable}),disabled:!N.editable,"onUpdate:modelValue":i=>N.manipulateByHand("endsAt",i)},null,8,["model-value","ref-date","after","placeholder","class","disabled","onUpdate:modelValue"]))]),_:1}),n(Ie,{title:"Pause","header-class":"!text-center",class:"justify-center",width:"max-content"},{default:a(({row:N})=>[N.hasAbsenceOrHoliday?b("",!0):(r(),S(Ze,{key:0,"model-value":N.pauseDuration,"value-type":"number",placeholder:N.editable?e(m)("timeSheets.form.pause"):"-","typing-minutes":"",class:Te({"inline-edit [&_input]:!cursor-default":!N.editable}),disabled:!N.editable,"onUpdate:modelValue":i=>N.manipulateByHand("pauseDuration",i)},null,8,["model-value","placeholder","class","disabled","onUpdate:modelValue"]))]),_:1}),n(Ie,{title:"Dauer","header-class":"!text-center",class:"justify-center",width:"max-content"},{default:a(({row:N})=>[n(Ze,{"model-value":N.duration,"value-type":"number",placeholder:N.editable?"00:00":"-",class:Te({"inline-edit !cursor-default [&_input]:!cursor-default":!N.editable||!N.hasAbsenceOrHoliday}),disabled:!N.editable||!N.hasAbsenceOrHoliday,"onUpdate:modelValue":i=>N.manipulateByHand("duration",i)},null,8,["model-value","placeholder","class","disabled","onUpdate:modelValue"])]),_:1}),n(Ie,{width:"max-content"},{default:a(({index:N,row:i})=>[e(j)[N].length?(r(),S(le,{key:0},{dropdown:a(()=>[n(_e,null,{default:a(()=>[(r(!0),B(me,null,Ke(e(j)[N],({label:d,action:G,fontAwesomeIcon:X,ElIcon:ae})=>(r(),S(z,{key:d,icon:ae,onClick:G},{default:a(()=>[X?(r(),S($e,{key:0,icon:X,"fixed-width":"",class:"text-xs mr-1.5"},null,8,["icon"])):b("",!0),U(" "+c(d),1)]),_:2},1032,["icon","onClick"]))),128)),i.userAbsences.length?b("",!0):(r(),S(z,{key:0,onClick:d=>Ye(i.date)},{default:a(()=>[n($e,{icon:["far","calendar-times"],"fixed-width":"",class:"text-xs mr-1.5"}),U(" "+c(e(m)("userAbsence.create")),1)]),_:2},1032,["onClick"]))]),_:2},1024)]),default:a(()=>[n(D,{text:""},{default:a(()=>[n($e,{icon:"ellipsis-v"})]),_:1})]),_:2},1024)):b("",!0)]),_:1}),n(Ie,{"full-row":"",class:"!p-0 !border-b-0"},{"full-row":a(({row:N})=>[_("div",ko,[n(Rt,{data:N,"working-time-model":O.workingTimeModel,"hide-approved":"",onAbsenceClicked:Q[3]||(Q[3]=i=>we.value=i)},null,8,["data","working-time-model"])])]),_:1})]),_:1},8,["data","row-class"])])}}}),wo={key:0},Do={class:"text-danger text-xs ml-1"},To={key:1},_o={class:"text-gray-500 text-xs ml-1"},Mo={class:"gap-1 flex flex-col"},_n=Le({__name:"TimeSheetDayHintAlerts",props:{data:{},errors:{},warnings:{}},setup(v){const T=v,{t}=We(),{declinedMessage:P}=Ca(u(()=>T.data.timeSheetDay));return(m,g)=>{const y=ln;return r(),B("div",null,[m.data.timeSheetDay.declinedNote?(r(),B("div",wo,[_("p",Do,c(e(P))+":",1),n(y,{closable:!1,type:"error","show-icon":""},{title:a(()=>[U(c(m.data.timeSheetDay.declinedNote),1)]),_:1})])):b("",!0),m.errors.length>0||m.warnings.length>0?(r(),B("div",To,[_("p",_o,c(e(t)("timeSheets.hints"))+":",1),_("div",Mo,[(r(!0),B(me,null,Ke(m.errors,h=>(r(),S(y,{key:h,title:h,closable:!1,type:"warning","show-icon":""},null,8,["title"]))),128)),(r(!0),B(me,null,Ke(m.warnings,h=>(r(),S(y,{key:h,title:h,closable:!1,type:"info","show-icon":""},null,8,["title"]))),128))])])):b("",!0)])}}}),Co={class:"flex flex-1 gap-1"},Po={key:0,class:"text-gray-400 text-xs flex py-1"},Eo={class:"flex-1 w-0 text-center leading-none"},Bo={key:0,class:"text-gray-400 text-xs flex py-1"},$o={class:"flex-1 w-0 text-center leading-none"},Io={class:"flex-1"},Oo={key:0,class:"text-gray-600 text-xs text-center pt-1"},Uo={key:1,class:"text-gray-400 text-xs flex py-1"},Wo={class:"flex-1 w-0 text-center leading-none"},xo={key:0,class:"text-gray-600 text-xs text-center pt-1"},Mn=Le({__name:"TimeSheetDayTimeInputs",props:{data:{}},setup(v){const{t:T}=We();return(t,P)=>(r(),B(me,null,[t.data.showStartsAtEndsAt?(r(),S(He,{key:0,title:e(T)("timeSheets.presenceTime")},{default:a(()=>[_("div",Co,[_("div",null,[n(Ze,{"model-value":t.data.startsAt,"value-type":"date","ref-date":t.data.date,before:t.data.endsAt??void 0,placeholder:t.data.editable?e(T)("timeSheets.form.startTime"):"-",class:Te({"inline-edit [&_input]:!cursor-default":!t.data.editable}),style:{"--el-input-width":"3.6rem"},disabled:!t.data.editable,"onUpdate:modelValue":P[0]||(P[0]=m=>t.data.manipulateByHand("startsAt",m??null))},null,8,["model-value","ref-date","before","placeholder","class","disabled"]),t.data.corrected.startsAtCorrectedTypeLabel?(r(),B("div",Po,[_("div",Eo,c(t.data.corrected.startsAtCorrectedTypeLabel),1)])):b("",!0)]),_("div",null,[n(Ze,{"model-value":t.data.endsAt,"value-type":"date","ref-date":t.data.date,after:t.data.startsAt??void 0,placeholder:t.data.editable?e(T)("timeSheets.form.endTime"):"-",class:Te({"inline-edit [&_input]:!cursor-default":!t.data.editable}),style:{"--el-input-width":"3.6rem"},disabled:!t.data.editable,"onUpdate:modelValue":P[1]||(P[1]=m=>t.data.manipulateByHand("endsAt",m??null))},null,8,["model-value","ref-date","after","placeholder","class","disabled"]),t.data.corrected.endsAtCorrectedTypeLabel?(r(),B("div",Bo,[_("div",$o,c(t.data.corrected.endsAtCorrectedTypeLabel),1)])):b("",!0)])])]),_:1},8,["title"])):b("",!0),t.data.showStartsAtEndsAt?(r(),S(He,{key:1,title:e(T)("timeSheets.breakTime"),"has-error":!!t.data.pauseError},{default:a(()=>[_("div",Io,[n(Ze,{"model-value":t.data.pauseDuration,"value-type":"number",placeholder:t.data.editable?"00:00":"-","typing-minutes":"",class:Te({"inline-edit [&_input]:!cursor-default":!t.data.editable}),style:{"--el-input-width":"3.6rem"},disabled:!t.data.editable,"onUpdate:modelValue":P[2]||(P[2]=m=>t.data.manipulateByHand("pauseDuration",m??null))},null,8,["model-value","placeholder","class","disabled"]),t.data.pauseError?(r(),B("div",Oo,c(t.data.pauseError.type==="pauseTooShort"?e(T)("timeSheets.errors.breakTimeExpectedMin",{time:e(Ne)(t.data.pauseError.expected)}):t.data.pauseError.type==="pauseTooLong"?e(T)("timeSheets.errors.breakTimeExpectedMax",{time:e(Ne)(t.data.pauseError.expected)}):""),1)):t.data.corrected.pauseDurationCorrectedTypeLabel?(r(),B("div",Uo,[_("div",Wo,c(t.data.corrected.pauseDurationCorrectedTypeLabel),1)])):b("",!0)])]),_:1},8,["title","has-error"])):b("",!0),n(He,{title:t.data.showStartsAtEndsAt?e(T)("timeSheets.workTime"):e(T)("timeSheets.absenceTime"),"has-error":!!t.data.durationError},{default:a(()=>[n(Ze,{"model-value":t.data.duration,"value-type":"number",placeholder:t.data.editable?"00:00":"",class:Te([{"inline-edit [&_input]:!cursor-default":!t.data.editable||t.data.showStartsAtEndsAt},"flex-1"]),disabled:!t.data.editable||t.data.showStartsAtEndsAt,"onUpdate:modelValue":P[3]||(P[3]=m=>t.data.manipulateByHand("duration",m??null))},null,8,["model-value","placeholder","class","disabled"]),t.data.durationError?(r(),B("div",xo,c(t.data.durationError.type==="durationTooLong"?e(T)("timeSheets.errors.durationExpectedMax",{time:e(Ne)(t.data.durationError.expected)}):""),1)):b("",!0)]),_:1},8,["title","has-error"])],64))}}),No={class:"md:flex md:flex-row"},Fo={class:"sticky top-0 text-center p-2"},Vo={class:"text-sm font-bold leading-tight"},Ro={class:"text-base leading-tight pb-2"},Ho={class:"flex flex-initial flex-wrap justify-center gap-1 [&:has(span)]:mb-2"},Lo={class:"!mb-0 pr-3 font-bold text-base"},qo={class:"w-0 inline-flex gap-1 flex-1 overflow-hidden"},jo={class:"flex flex-col gap-2 flex-grow pt-2 md:pb-2"},zo={class:"flex gap-2 flex-wrap mx-2"},Qo={class:"flex flex-grow flex-row flex-wrap gap-1"},Go={class:"flex flex-wrap gap-1"},Ko={class:"hidden md:flex flex-grow justify-end"},Yo={key:0,class:"mx-2"},Jo={class:"text-gray-500 text-xs ml-1"},Xo={class:"flex flex-grow w-full"},Zo={key:1,class:"bg-white border-gray-200 border mx-0 md:mx-2"},er={class:"flex-1 flex items-center p-0.5 pl-3 text-base"},tr={class:"ml-2 gap-1 hidden sm:flex"},ar={class:"flex sm:hidden gap-1 p-3"},nr={key:0,class:"p-2 text-gray-400 text-center text-xs"},sr={class:"flex"},or={class:"flex-1 text-sm"},rr={class:"mr-0.5 text-gray-400"},ir={key:0},lr={key:0,class:"flex text-sm"},dr={class:"mr-1 text-gray-400"},ur=Ta(()=>ga(()=>import("./AssignmentEventWorkPeriodForm-BA8p1z_C.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]))),cr=Ta(()=>ga(()=>import("./UnaccountablePeriodForm-4Z_fK_wf.js"),__vite__mapDeps([30,31,7,2,3,8,4,5,6,9,10,11,12,13,14,15,16,17,18,19,20,21,32,27,28,29]))),mr=Le({__name:"TimeSheetDayForWeek",props:{day:{},user:{},data:{},workingTimeModel:{},showIsManipulated:{type:Boolean,default:!1},absenceToEditOrCreate:{}},emits:["submit","approve","decline","go-to-date","update:absenceToEditOrCreate"],setup(v,{emit:T}){const[t,P]=Ka(),[m,g]=Ka(),y=v,h=T,{t:p}=We(),F=pt(),k=sn(),$=As({interval:1e3*60*5}),f=ye(!1),M=ye(!(k.md&&y.data.combinedWorkPeriods.length===0)&&y.data.combinedWorkPeriods.length<=5),A=ya().createScope(),Z=ha().createScope(),L=pt(),{getAssignmentNameToShow:x}=kn(),I=u(()=>L.value?.role?.type!=="admin"&&L.value?.role?.type!=="superadmin"&&y.user.supervisorUuid===L.value?.uuid),ee=ye();dn(An,{formRef:ee});const q=ye(null);function te(D){if(D===!1){q.value=null;return}D!==!0&&(q.value=D)}const pe=u(()=>q.value&&Ce(q.value,"assignment-event-work-periods")?"AssignmentEventWorkPeriod":"UnaccountablePeriod");function ue(D){q.value=D}function ce(D){D==="AssignmentEventWorkPeriod"?q.value=A.construct({companyId:y.user.companyId,userId:y.user.id,start:y.day,manipulatedAt:new Date,manipulatedBy:F.value}):q.value=Z.construct({companyId:y.user.companyId,userId:y.user.id,start:y.day,manipulatedAt:new Date,manipulatedBy:F.value}),M.value=!0}const{validateAsync:J}=Sn(ee),{execute:Pe}=ua(async()=>{try{if(!q.value)return;await J(),q.value.manipulatedAt=new Date,q.value.manipulatedBy=L.value,Ce(q.value,"assignment-event-work-periods")?await A.save(q.value):await Z.save(q.value),q.value=null}catch{return}},{useNProgress:!0});function he(){q.value&&(Ce(q.value,"assignment-event-work-periods")?A.resetOrRemove(q.value):Z.resetOrRemove(q.value)),q.value=null}async function K(D){Ce(D,"assignment-event-work-periods")?await A.remove(D):await Z.remove(D)}function qe(D){return Xe(D,"eee")}function fe(D){return Xe(D,"dd.MM.")}function ie(D){return bt(D.start,D.end??$.value)?"primary":"warning"}function Ve(D){return D.start?`${et(D.start,{dateToCompare:y.day,shortToday:!0})} - ${D.end?et(D.end,{dateToCompare:y.day,shortToday:!0}):p("timeSheets.table.ongoing")}`:""}const{errors:Ee,warnings:j}=vn(u(()=>y.data)),at=u(()=>I.value&&!y.data.timeSheetDay.note),dt=bn().useHasItems("unaccountable-period-types"),we=u(()=>y.data.showStartsAtEndsAt||y.data.combinedWorkPeriods.length>0),{getApprovedMessage:Ye}=Ma(),{actionsForDay:O}=fn(),Q=u(()=>O(y.data,h));kt().createScope(),ft();const $e=u({get(){return y.absenceToEditOrCreate},set(D){h("update:absenceToEditOrCreate",D)}});return(D,z)=>{const _e=Ht,le=lt,be=tt("font-awesome-icon"),N=Qt,i=Gt,d=Kt,G=un,X=Lt,ae=Ss,Me=cn,je=ws,Y=Ds,nt=Yt;return r(),B("div",No,[n(e(t),null,{default:a(({class:R})=>[_("div",{class:Te([R,"flex gap-1"])},[e(k).md?(r(),B(me,{key:0},[D.data.canSubmit?(r(),S(oe,{key:0,content:e(p)("timeSheets.Submit")},{default:a(()=>[n(le,{type:"primary",plain:D.data.canApprove,onClick:z[0]||(z[0]=()=>h("submit",D.data.timeSheetDay))},{default:a(()=>[n(_e,null,{default:a(()=>[n(e(Pt))]),_:1})]),_:1},8,["plain"])]),_:1},8,["content"])):b("",!0),D.data.canApprove?(r(),S(oe,{key:1,content:D.data.timeSheetDay.approvedAt?e(Ye)(D.data.timeSheetDay):e(p)("timeSheets.Approve")},{default:a(()=>[n(le,{type:"primary",disabled:!!D.data.timeSheetDay.approvedAt,onClick:z[1]||(z[1]=()=>h("approve",D.data.timeSheetDay))},{default:a(()=>[n(_e,null,{default:a(()=>[n(e(qt))]),_:1})]),_:1},8,["disabled"])]),_:1},8,["content"])):b("",!0),D.data.canDecline?(r(),S(oe,{key:2,content:e(p)("actions.Decline")},{default:a(()=>[n(le,{type:"danger",disabled:!!D.data.timeSheetDay.declinedAt,plain:!D.data.timeSheetDay.declinedAt&&(!!D.data.timeSheetDay.approvedAt||!!D.data.timeSheetDay.declinedAt),onClick:z[2]||(z[2]=()=>h("decline",D.data.timeSheetDay))},{default:a(()=>[n(_e,null,{default:a(()=>[n(e(jt))]),_:1})]),_:1},8,["disabled","plain"])]),_:1},8,["content"])):b("",!0),n(oe,{content:"Gehe zu Tag"},{default:a(()=>[n(le,{onClick:z[3]||(z[3]=ze=>h("go-to-date",D.data.date))},{default:a(()=>[n(_e,null,{default:a(()=>[n(be,{icon:"external-link-alt",class:"text-xs"})]),_:1})]),_:1})]),_:1})],64)):(r(),S(d,{key:1},{dropdown:a(()=>[n(i,null,{default:a(()=>[(r(!0),B(me,null,Ke(e(Q),({label:ze,action:Et,fontAwesomeIcon:St,ElIcon:Bt})=>(r(),S(N,{key:ze,icon:Bt,onClick:Et},{default:a(()=>[St?(r(),S(be,{key:0,icon:St,"fixed-width":"",class:"text-xs mr-1.5"},null,8,["icon"])):b("",!0),U(" "+c(ze),1)]),_:2},1032,["icon","onClick"]))),128))]),_:1})]),default:a(()=>[n(le,{text:""},{default:a(()=>[n(be,{icon:"ellipsis-v",class:"text-xs"})]),_:1})]),_:1}))],2)]),_:1}),n(e(m),null,{default:a(()=>[n(le,{type:"primary",onClick:z[4]||(z[4]=ca(()=>ce("AssignmentEventWorkPeriod"),["stop"]))},{default:a(()=>[U(c(e(p)("timeSheets.AssignmentEventWorkPeriodShort"))+" ",1),n(be,{icon:"plus",class:"ml-2 text-xs"})]),_:1}),e(dt)?(r(),S(le,{key:0,type:"primary",onClick:z[5]||(z[5]=ca(()=>ce("UnaccountablePeriod"),["stop"]))},{default:a(()=>[U(c(e(p)("timeSheets.UnaccountablePeriodShort"))+" ",1),n(be,{icon:"plus",class:"ml-2 text-xs"})]),_:1})):b("",!0)]),_:1}),_("div",{class:Te(["w-28 flex-none text-center hidden md:block relative overflow-hidden border-r-gray-200 border-r",[D.data.timeSheetDay.approvedAt&&!e(Ee).length&&!e(j).length?"bg-success/10":D.data.timeSheetDay.declinedAt||e(Ee).length>0?"bg-danger/10 border-l-4 border-danger":!D.data.timeSheetDay.declinedAt&&!e(Ee).length&&e(j).length>0?"bg-warning/10 border-l-4 border-warning":e(fa)(D.day)?"bg-yellow-50":"bg-white"]])},[_("div",Fo,[_("p",Vo,c(qe(D.day)),1),_("p",Ro,c(fe(D.day)),1),_("div",Ho,[n(Rt,{data:D.data,"working-time-model":D.workingTimeModel,onAbsenceClicked:z[6]||(z[6]=R=>$e.value=R)},null,8,["data","working-time-model"])])])],2),_("div",{class:Te(["md:hidden flex flex-grow justify-between items-center p-2",[D.data.timeSheetDay.approvedAt&&!e(Ee).length&&!e(j).length?"bg-success/10":D.data.timeSheetDay.declinedAt||e(Ee).length>0?"bg-danger/10 border-l-4 border-danger":!D.data.timeSheetDay.declinedAt&&!e(Ee).length&&e(j).length>0?"bg-warning/10 border-l-4 border-warning":e(fa)(D.day)?"bg-yellow-50":"bg-white"]])},[_("div",Lo,c(qe(D.day))+" "+c(fe(D.day)),1),_("div",qo,[n(Rt,{data:D.data,"working-time-model":D.workingTimeModel,onAbsenceClicked:z[7]||(z[7]=R=>$e.value=R)},null,8,["data","working-time-model"])]),n(e(P),{class:"ml-1"})],2),_("div",jo,[_("div",zo,[_("div",Qo,[_("div",Go,[n(Mn,{data:D.data},null,8,["data"]),D.data.canRecompute?(r(),S(oe,{key:0,content:e(p)("timeSheets.Recompute")},{default:a(()=>[n(le,{type:"primary",onClick:D.data.recompute},{default:a(()=>[n(_e,null,{default:a(()=>[n(e(ka))]),_:1})]),_:1},8,["onClick"])]),_:1},8,["content"])):b("",!0),!e(f)&&!D.data.timeSheetDay.note?(r(),S(oe,{key:1,content:e(p)("timeSheets.addNote")},{default:a(()=>[n(le,{onClick:z[8]||(z[8]=R=>f.value=!0)},{default:a(()=>[n(be,{icon:["far","comment"],class:"text-xs"})]),_:1})]),_:1},8,["content"])):b("",!0)]),_("div",Ko,[n(e(P))])])]),!e(at)&&(e(f)||D.data.timeSheetDay.note)?(r(),B("div",Yo,[_("p",Jo,c(e(p)("timeSheets.note"))+":",1),_("div",Xo,[n(G,{modelValue:D.data.timeSheetDay.note,"onUpdate:modelValue":z[9]||(z[9]=R=>D.data.timeSheetDay.note=R),disabled:!D.data.canSubmit,rows:e(k).maxXs?3:e(k).maxMd?2:1,type:"textarea",placeholder:e(p)("timeSheets.note")},null,8,["modelValue","disabled","rows","placeholder"])])])):b("",!0),n(_n,{data:D.data,errors:e(Ee),warnings:e(j),class:"mx-2"},null,8,["data","errors","warnings"]),e(we)?(r(),B("div",Zo,[_("div",{class:Te(["flex border-gray-100 bg-gray-100",{"border-b":e(M)}])},[_("div",er,[_("div",{class:"flex flex-1 cursor-pointer text-gray-500 items-center",onClick:z[10]||(z[10]=R=>M.value=!e(M))},[U(c(e(p)("timeSheets.Periods"))+" ("+c(D.data.combinedWorkPeriods.length)+") ",1),_("div",tr,[n(e(g))])])]),n(le,{text:"",size:"large",onClick:z[11]||(z[11]=R=>M.value=!e(M))},{default:a(()=>[n(be,{icon:"angle-down",class:"ml-1 transition-all text-xs",rotation:e(M)?"180":void 0},null,8,["rotation"])]),_:1})],2),zt(_("div",null,[_("div",ar,[n(e(g))]),(r(),S(ks,null,[D.data.combinedWorkPeriods.length?(r(),B(me,{key:1},[e(k).lg?(r(),S(hn,{key:0,data:D.data.combinedWorkPeriods,"key-property":"uuid"},{default:a(()=>[n(Ie,{title:e(p)("timeSheets.table.fromTo")},{default:a(({row:R})=>[U(c(Ve(R)),1)]),_:1},8,["title"]),n(Ie,{title:e(p)("timeSheets.table.assignment")},{default:a(({row:R})=>[U(c(e(x)(R.assignment)),1)]),_:1},8,["title"]),n(Ie,{title:e(p)("timeSheets.table.step")},{default:a(({row:R})=>[U(c("event"in R?R.event?.type?.name:R.eventType?.name),1)]),_:1},8,["title"]),n(Ie,{title:e(p)("timeSheets.table.workType")},{default:a(({row:R})=>[U(c(R.type?.name),1)]),_:1},8,["title"]),n(Ie,{title:e(p)("Note")},{default:a(({row:R})=>[U(c(R.note),1)]),_:1},8,["title"]),D.showIsManipulated?(r(),S(Ie,{key:0,width:"max-content"},{default:a(({row:R})=>[n(oe,{content:R.manipulatedBy?e(p)("timeSheets.manipulated.infoTextBy",{user:R.manipulatedBy.shortName||R.manipulatedBy.fullName}):e(p)("timeSheets.manipulated.infoText")},{default:a(()=>[R.manipulatedAt?(r(),S(X,{key:0,type:"warning"},{default:a(()=>[U(c(e(p)("timeSheets.manipulated.partly")),1)]),_:1})):b("",!0)]),_:2},1032,["content"])]),_:1})):b("",!0),n(Ie,{width:"max-content"},{default:a(({row:R})=>[n(Me,null,{default:a(()=>[n(le,{class:"mr-2",onClick:ze=>ue(R)},{default:a(()=>[n(_e,null,{default:a(()=>[n(e(Ya))]),_:1})]),_:2},1032,["onClick"]),n(ae,{"confirm-button-text":e(p)("actions.Delete"),"cancel-button-text":e(p)("actions.Cancel"),icon:e(Ja),"icon-color":"#626AEF",title:e(p)("confirm.delete"),width:"260px",onConfirm:ze=>K(R)},{reference:a(()=>[n(le,{type:"danger",plain:""},{default:a(()=>[n(_e,null,{default:a(()=>[n(e(Xa))]),_:1})]),_:1})]),_:2},1032,["confirm-button-text","cancel-button-text","icon","title","onConfirm"])]),_:2},1024)]),_:1})]),_:1},8,["data"])):(r(),S(Y,{key:1,class:"p-4 pt-2 pr-2"},{default:a(()=>[(r(!0),B(me,null,Ke(D.data.combinedWorkPeriods,R=>(r(),S(je,{key:R.uuid,timestamp:Ve(R),placement:"top",hollow:e(Ce)(R,"unaccountable-periods")&&!!R,type:ie(R)},{default:a(()=>[_("div",sr,[_("div",or,[e(Ce)(R,"assignment-event-work-periods")&&R?(r(),B(me,{key:0},[_("div",null,[_("span",rr,c(e(p)("assignment.name"))+":",1),U(" "+c(e(x)(R.assignment)),1)]),_("div",null,c(R.eventType?.name),1),R.type?.name?(r(),B("div",ir,c(R.type?.name),1)):b("",!0)],64)):b("",!0),e(Ce)(R,"unaccountable-periods")&&R?(r(),B(me,{key:1},[_("div",null,c(R.type?.name),1),_("div",null,c(R.eventType?.name),1)],64)):b("",!0)]),n(Me,{class:"-mt-6"},{default:a(()=>[n(le,{onClick:ze=>ue(R)},{default:a(()=>[n(_e,null,{default:a(()=>[n(e(Ya))]),_:1})]),_:2},1032,["onClick"]),n(ae,{"confirm-button-text":e(p)("actions.Delete"),"cancel-button-text":e(p)("actions.Cancel"),icon:e(Ja),"icon-color":"#626AEF",title:e(p)("confirm.delete"),width:"260px",onConfirm:ze=>K(R)},{reference:a(()=>[n(le,{type:"danger",plain:""},{default:a(()=>[n(_e,null,{default:a(()=>[n(e(Xa))]),_:1})]),_:1})]),_:2},1032,["confirm-button-text","cancel-button-text","icon","title","onConfirm"])]),_:2},1024)]),R.note?(r(),B("div",lr,[_("span",dr,c(e(p)("Note"))+":",1),U(" "+c(R.note),1)])):b("",!0)]),_:2},1032,["timestamp","hollow","type"]))),128))]),_:1}))],64)):(r(),B("div",nr,c(e(p)("timeSheets.noWorkPeriods")),1))],1024))],512),[[bs,e(M)]])])):b("",!0)]),_("div",null,[e(q)?(r(),S(nt,{key:0,"model-value":!!e(q),class:"dialog-messagebox-[500px] dialog-center","onUpdate:modelValue":te},{header:a(()=>[U(c(e(p)(e(pe)==="AssignmentEventWorkPeriod"?"timeSheets.AssignmentEventWorkPeriod":"timeSheets.UnaccountablePeriod")),1)]),footer:a(()=>[n(le,{class:"mr-2",text:"",onClick:he},{default:a(()=>[U(c(e(p)("actions.Cancel")),1)]),_:1}),n(le,{type:"primary",onClick:e(Pe)},{default:a(()=>[U(c(e(p)("timeSheets.form.enterPeriod")),1)]),_:1},8,["onClick"])]),default:a(()=>[e(pe)==="AssignmentEventWorkPeriod"&&e(Ce)(e(q),"assignment-event-work-periods")?(r(),S(e(ur),{key:0,users:[D.user],item:e(q),"limit-time-to-date":D.day,"allow-assignment-edit":"","hide-user-edit":""},null,8,["users","item","limit-time-to-date"])):e(pe)==="UnaccountablePeriod"&&e(Ce)(e(q),"unaccountable-periods")?(r(),S(e(cr),{key:1,users:[D.user],item:e(q),"limit-time-to-date":D.day,"hide-user-edit":"","enable-convert":"",onClose:z[12]||(z[12]=R=>q.value=null)},null,8,["users","item","limit-time-to-date"])):b("",!0)]),_:1},8,["model-value"])):b("",!0)])])}}}),pr={class:"bg-gray-100 p-2 mb-2 rounded shadow flex flex-col gap-1"},fr={class:"flex flex-wrap gap-2"},vr={class:"flex-1"},yr={class:"leading-loose"},hr={class:"leading-loose"},gr={class:"leading-loose"},Ar={class:"flex gap-1"},br={class:"border border-gray-200"},kr=Le({__name:"TimeSheetWeek",props:{date:{},user:{},dayData:{},targetSum:{},actions:{},isPendingCalculatedTargetWorkingTime:{type:Boolean,default:!1},workingTimeModel:{},showIsManipulated:{type:Boolean,default:!1},absenceToEditOrCreate:{}},emits:["submitAll","approveAll","declineAll","unsubmitAll","submit","approve","decline","go-to-date","update:absenceToEditOrCreate"],setup(v,{emit:T}){const t=v,P=T,{t:m}=We(),g=u(()=>t.dayData.map(M=>M.timeSheetDay)),y=u(()=>{if(!g.value.length)return 0;let M=0;for(const A of g.value)M+=A.duration??0;return M}),{getDeclinedMessage:h,getApprovedMessage:p}=Ma(),F=kt().createScope(),k=ft(),$=u({get(){return t.absenceToEditOrCreate},set(M){P("update:absenceToEditOrCreate",M)}});function f(){$.value=F.construct({companyId:k.value,startsAt:ma(t.date),user:t.user,status:"draft"})}return(M,A)=>{const Z=tt("font-awesome-icon"),L=Ht,x=lt,I=oe,ee=Lt,q=Da;return r(),B("div",null,[zt((r(),B("div",pr,[_("div",fr,[_("div",vr,[n(_a,null,{default:a(()=>[n(He,{title:M.$t("timeSheets.monthsOverview.sumActual"),class:"w-20"},{default:a(()=>[_("div",yr,c(e(Ne)(e(y))),1)]),_:1},8,["title"]),M.targetSum!==void 0?(r(),S(He,{key:0,title:M.$t("timeSheets.monthsOverview.sumTarget"),class:"w-20"},{default:a(()=>[_("div",hr,c(e(Ne)(M.targetSum)),1)]),_:1},8,["title"])):b("",!0),M.targetSum!==void 0?(r(),S(He,{key:1,title:e(m)("timeSheets.monthsOverview.difference"),class:"w-20"},{default:a(()=>[_("div",gr,c(e(Ne)(-(M.targetSum-e(y)))),1)]),_:1},8,["title"])):b("",!0)]),_:1})]),_("div",Ar,[n(I,{content:e(m)("userAbsence.create")},{default:a(()=>[n(x,{plain:"",onClick:A[0]||(A[0]=te=>f())},{default:a(()=>[n(L,null,{default:a(()=>[n(Z,{icon:["far","calendar-times"],class:"text-xs"})]),_:1})]),_:1})]),_:1},8,["content"]),n(I,{content:e(m)("timeSheets.submitAll")},{default:a(()=>[M.actions.canSubmit?(r(),S(x,{key:0,type:"primary",class:"allow-cursor",onClick:A[1]||(A[1]=()=>P("submitAll"))},{default:a(()=>[n(L,null,{default:a(()=>[n(e(Pt))]),_:1})]),_:1})):b("",!0)]),_:1},8,["content"]),M.actions.canApprove?(r(),S(I,{key:0,content:e(m)("timeSheets.approveAll")},{default:a(()=>[n(x,{type:"primary",plain:!!M.actions.timeSheetsToSubmit.length,disabled:!M.actions.timeSheetsToApprove.length,class:"allow-cursor",onClick:A[2]||(A[2]=()=>P("approveAll"))},{default:a(()=>[n(L,null,{default:a(()=>[n(e(qt))]),_:1})]),_:1},8,["plain","disabled"])]),_:1},8,["content"])):b("",!0),M.actions.canDecline?(r(),S(I,{key:1,content:e(m)("timeSheets.declineAll")},{default:a(()=>[n(x,{type:"danger",plain:!!M.actions.timeSheetsToSubmit.length||!M.actions.timeSheetsToDecline.length,disabled:!M.actions.timeSheetsToDecline.length,class:"allow-cursor",onClick:A[3]||(A[3]=()=>P("declineAll"))},{default:a(()=>[n(L,null,{default:a(()=>[n(e(jt))]),_:1})]),_:1},8,["plain","disabled"])]),_:1},8,["content"])):b("",!0)])]),_("div",null,[M.dayData.some(te=>!!te.timeSheetDay.declinedAt)?(r(),S(I,{key:0,content:e(h)(M.dayData.find(te=>!!te.timeSheetDay.declinedAt).timeSheetDay)},{default:a(()=>[n(ee,{type:"danger"},{default:a(()=>[U(c(e(m)("timeSheets.declined")),1)]),_:1})]),_:1},8,["content"])):M.dayData.every(te=>!!te.timeSheetDay.approvedAt)?(r(),S(I,{key:1,content:e(p)(M.dayData.at(-1).timeSheetDay)},{default:a(()=>[n(ee,{type:"success"},{default:a(()=>[U(c(e(m)("timeSheets.approved")),1)]),_:1})]),_:1},8,["content"])):M.dayData.every(te=>!!te.timeSheetDay.submittedAt)?(r(),S(ee,{key:2,type:"info"},{default:a(()=>[U(c(e(m)("timeSheets.submitted")),1)]),_:1})):(r(),S(ee,{key:3,type:"warning"},{default:a(()=>[U(c(e(m)("timeSheets.notSubmittedYet")),1)]),_:1}))])])),[[q,M.isPendingCalculatedTargetWorkingTime]]),_("div",br,[(r(!0),B(me,null,Ke(M.dayData,(te,pe)=>(r(),S(mr,{key:te.key,day:te.date,user:M.user,data:te,"working-time-model":M.workingTimeModel,"show-is-manipulated":M.showIsManipulated,class:Te({"border-b border-gray-200":pe<M.dayData.length-1}),"absence-to-edit-or-create":e($),onSubmit:A[4]||(A[4]=ue=>P("submit",ue)),onApprove:A[5]||(A[5]=ue=>P("approve",ue)),onDecline:A[6]||(A[6]=ue=>P("decline",ue)),onGoToDate:A[7]||(A[7]=ue=>P("go-to-date",ue)),"onUpdate:absenceToEditOrCreate":A[8]||(A[8]=ue=>P("update:absenceToEditOrCreate",ue))},null,8,["day","user","data","working-time-model","show-is-manipulated","class","absence-to-edit-or-create"]))),128))])])}}});function Sr(v){Aa(1,arguments);var T=ba(v);return T.setMinutes(59,59,999),T}function wr(v){Aa(1,arguments);var T=ba(v);return T.setMinutes(0,0,0),T}const Dr={class:"leading-4 text-sm"},Tr={class:"overflow-hidden whitespace-nowrap text-ellipsis text-xs leading-3 ml-0.5"},_r={key:0,class:"opacity-100"},Mr=Le({__name:"AssignmentEventListItem",props:{event:{},eventUsers:{default:()=>[]},openWorkPeriods:{default:()=>[]},selectedDate:{default:void 0},showNames:{type:Boolean,default:!0},showUnreadIndicator:{type:Boolean,default:!1},assignmentNameToShow:{default:Zn[0]}},emits:["click"],setup(v,{emit:T}){const t=v,P=T;let m;if(t.showUnreadIndicator){const k=u(()=>({assignmentId:t.event.assignmentId}));m=es().useHasUnreadChatMessages(k).hasUnreadMessages}const g=gn(),y=u(()=>({background:wn(t.event),color:Dn(t.event)}));function h(k){P("click",k)}function p(k){if(!k)return null;const $=t.selectedDate&&bt(k,t.selectedDate)?"HH:mm":"dd.MM.";return Ft(k,$)}const F=u(()=>t.eventUsers.map($=>$.user).filter(Re).map($=>($.shortName||$.fullName)??"").join(", "));return(k,$)=>{const f=tt("font-awesome-icon"),M=Ts,A=lt;return r(),B("div",{style:Sa(e(y)),class:"rounded px-3 py-2 border-gray-200 border flex items-center"},[_("div",{class:"flex flex-1 flex-col cursor-pointer",onClick:$[0]||($[0]=()=>h(k.event))},[_("div",Dr,[n(M,{"is-dot":"",hidden:!k.showUnreadIndicator||!e(m),class:"AssignmentEventListItem__badge"},{default:a(()=>[k.event.completedAt?(r(),S(f,{key:0,icon:"check",class:"mr-2"})):b("",!0),_("span",{class:Te({"line-through":!!k.event.completedAt})},c(e(Ns)(k.event.assignment,k.assignmentNameToShow))+" - "+c(k.event.startsAt?`${p(k.event.startsAt)}`:""),3)]),_:1},8,["hidden"])]),_("div",Tr,[n(Tn,{value:k.event},null,8,["value"])]),k.eventUsers&&k.eventUsers.length?(r(),B("div",{key:0,class:Te(["text-sm mt-1",{"line-through":!!k.event.completedAt}])},[n(f,{icon:"user",class:"opacity-80"}),U(" "+c(e(F)),1)],2)):b("",!0)]),k.openWorkPeriods?.length&&!e(g).isPaused?(r(),B("div",_r,[n(A,{onClick:$[1]||($[1]=()=>e(xs)(k.openWorkPeriods))},{default:a(()=>[n(f,{icon:"stop"})]),_:1})])):b("",!0)],4)}}});function Cr(v){const T=ts().createScope(),t=as().createScope(),{data:P,haveLoaded:m,isPending:g}=T.useFind({params:v.params,fetchParams:v.fetchParams,localOnly:v.localOnly}),y=u(()=>P.value.map($=>$.id).filter(Re)),{data:h,isPending:p}=t.useFindOnce({items:y,params:u(()=>({query:{eventId:{$in:y.value}}})),fetchParams:$=>({query:{eventId:{$in:$},$limit:-1}})}),F=u(()=>{const $={};return h.value.forEach(f=>{f.eventUuid&&($[f.eventUuid]||($[f.eventUuid]=[]),$[f.eventUuid].push(f))}),$}),k=u(()=>g.value||p.value);if("user"in v){const $=At(v.user),f=u(()=>$.value?h.value.filter(Z=>Z.userId===$.value.id):[]),M=u(()=>P.value.filter(Z=>f.value.some(L=>L.eventId===Z.id)));return{allAssignmentEvents:P,eventUsersForAllEvents:h,eventUsersForUser:f,assignmentEventsForUser:M,haveLoaded:m,isPending:k,eventUsersByEventUuid:F}}else return{allAssignmentEvents:P,eventUsersForAllEvents:h,haveLoaded:m,isPending:k,eventUsersByEventUuid:F}}const Pr={class:"flex flex-wrap gap-2"},Er={class:"flex flex-1 gap-1"},Br={class:"flex flex-wrap gap-1"},$r={key:0},Ir={class:"text-gray-500 text-xs"},Or={class:"flex flex-wrap gap-1"},Ur={key:0},Wr={class:"text-xs"},xr=_("span",{class:"mx-1"},"-",-1),Nr={key:0},Fr={key:1,class:"text-xs"},Vr={key:0,class:"text-xs"},Rr={key:0,class:"flex flex-wrap gap-2"},Hr={key:1},Lr={key:1,class:"flex"},qr={class:"flex-1 flex justify-end gap-1"},jr={class:"flex justify-end flex-wrap gap-2"},zr=Le({__name:"TimeSheetDayDetailed",props:{user:{},targetSum:{},data:{},workingTimeModel:{},absenceToEditOrCreate:{}},emits:["submit","unsubmit","approve","decline","update:absenceToEditOrCreate"],setup(v,{emit:T}){const t=v,P=T,{t:m}=We(),g=bn(),y=ya().createScope(),h=ha().createScope(),{declinedAtMessage:p,approvedAtMessage:F}=Ca(u(()=>t.data.timeSheetDay)),k=ye();dn(An,{formRef:k});const $=pt();u(()=>({start:wa(t.data.date),end:mt(t.data.date)}));const f=Ct(Vt,{interval:{seconds:5}}),M=Ct(i=>{const d=wr(i);return it(d,{year:t.data.date.getFullYear(),month:t.data.date.getMonth(),date:t.data.date.getDate()})},{interval:{minutes:5}}),A=Ct(i=>{const d=Sr(i);return it(d,{year:t.data.date.getFullYear(),month:t.data.date.getMonth(),date:t.data.date.getDate()})},{interval:{minutes:5}}),Z=g.useHasItems("assignment-event-work-types"),L=g.useHasItems("unaccountable-period-types"),x=ye(void 0);function I(i){if(i!==!0){if(!i){x.value=void 0;return}!Z&&!L||(x.value={create:{data:{start:i.start,end:i.end},type:void 0}},pe(Z?L?void 0:"work-period":"unaccountable-period"))}}function ee(i){x.value={item:i}}const q=ye(void 0);function te(i){const d=i.startsAt&&!i.isAllDay&&bt(i.startsAt,t.data.date)&&Se(t.data.date,i.startsAt)?i.startsAt:void 0,G=i.endsAt&&!i.isAllDay&&bt(i.endsAt,t.data.date)&&Se(t.data.date,i.endsAt)&&(!d||Se(d,i.endsAt))?i.endsAt:void 0;ee(y.construct({companyId:i.companyId,assignmentId:i.assignmentId,eventId:i.id,user:t.user,start:d,end:G}))}function pe(i){const d=x.value;!Z&&!L||!d||!("create"in d)||(d.create.type=i,d.create.type&&(d.create.type==="work-period"?d.item=y.construct({start:d.create.data.start,end:d.create.data.end,user:t.user,companyId:t.user.companyId,manipulatedAt:new Date,manipulatedBy:$.value}):d.create.type==="unaccountable-period"&&(d.item=h.construct({start:d.create.data.start,end:d.create.data.end,user:t.user,companyId:t.user.companyId,manipulatedAt:new Date,manipulatedBy:$.value}))))}const ue=u(()=>{const i=Wt(M.value,{minutes:-30}),d=it(t.data.date,{hours:5,minutes:0,seconds:0});return Se(i,t.data.date)?t.data.date:Se(i,d)?i:d}),ce=u(()=>{if(!t.data.combinedWorkPeriods.length)return;const i=t.data.combinedWorkPeriods.reduce((d,G)=>!d||!G.start?d:!d.start||Se(G.start,d.start)?G:d);return i.start?Wt(it(i.start,{minutes:0,seconds:0,milliseconds:0}),{hours:-1}):void 0}),J=u(()=>ce.value?Se(ce.value,t.data.date)?t.data.date:Se(ue.value,ce.value)?ue.value:ce.value:ue.value),Pe=ye(new Date(J.value));Fe(J,i=>{Se(Pe.value,i)||(Pe.value=i)});const he=u(()=>{const i=Wt(A.value,{minutes:-430}),d=mt(t.data.date),G=it(t.data.date,{hours:18,minutes:0,seconds:0});return Se(d,i)?d:Se(G,i)?i:G}),K=u(()=>{if(!t.data.combinedWorkPeriods.length)return;const i=t.data.combinedWorkPeriods.reduce((d,G)=>!d||!G.end?d:!d.end||Se(d.end,G.end)?G:d);return i.end?Wt(it(i.end,{minutes:0,seconds:0,milliseconds:0}),{hours:2}):void 0}),qe=u(()=>{if(!K.value)return he.value;const i=mt(t.data.date);return Se(i,K.value)?i:Se(K.value,he.value)?he.value:K.value}),fe=ye(new Date(qe.value));Fe(qe,i=>{Se(i,fe.value)||(fe.value=i)});const ie=(i,d)=>i.extendedProps.type===d,{asyncRevertFunction:Ve}=Rs({useNProgress:!0}),{assignmentEventsForUser:Ee}=Cr({params:u(()=>({query:{startsAt:{$lt:mt(t.data.date)},endsAt:{$gt:t.data.date},$sort:{startsAt:1},$limit:-1},debounceTime:50})),user:$});function j(i){i||="#fff";const d=new Gs(i);return d.getBrightness()>180?d.darken(20).toHexString():"transparent"}const{ref:at,options:dt}=Hs({plugins:[Vs,Fs],initialView:"timeGridDay",headerToolbar:!1,allDaySlot:u(()=>t.data.hasAbsenceOrHoliday),dayHeaders:!1,slotMinTime:u(()=>Za(Pe.value,"HH:mm:ss")),slotMaxTime:u(()=>Za(fe.value,"HH:mm:ss")),eventTimeFormat:{hour:"2-digit",minute:"2-digit",meridiem:!1},selectable:u(()=>t.data.editable&&(!!Z||!!L)),select:i=>{I({start:i.start,end:i.end})},editable:u(()=>t.data.editable),eventResizableFromStart:u(()=>t.data.editable),eventClick:({event:i})=>{ie(i,"workPeriod")?ee(i.extendedProps.workPeriod):ie(i,"unaccountablePeriod")?ee(i.extendedProps.unaccountablePeriod):ie(i,"absence")?be.value=i.extendedProps.absence:ie(i,"holiday")},eventResize:Ve(async({event:i})=>{if(!i.start||!i.end)return!1;if(ie(i,"workPeriod")){const{workPeriod:d}=i.extendedProps;d.start=i.start,d.end=i.end,d.manipulatedAt=new Date,d.manipulatedBy=$.value,await y.save(d)}else if(ie(i,"unaccountablePeriod")){const{unaccountablePeriod:d}=i.extendedProps;d.start=i.start,d.end=i.end,d.manipulatedAt=new Date,d.manipulatedBy=$.value,await h.save(d)}else return!1}),eventDrop:Ve(async({event:i})=>{if(!i.start||!i.end)return!1;if(ie(i,"workPeriod")){const{workPeriod:d}=i.extendedProps;d.start=i.start,d.end=i.end,d.manipulatedAt=new Date,d.manipulatedBy=$.value,await y.save(d)}else if(ie(i,"unaccountablePeriod")){const{unaccountablePeriod:d}=i.extendedProps;d.start=i.start,d.end=i.end,d.manipulatedAt=new Date,d.manipulatedBy=$.value,await h.save(d)}else return!1}),events:u(()=>{const i=[];return t.data.workPeriods.forEach((d,G)=>{const{start:X}=d,ae=d.end||f.value;if(!X||!ae||Se(ae,X))return;const Me=d.event?wn(d.event):"#fff";i.push({start:X,end:ae,title:z(d.assignment),backgroundColor:Me,textColor:d.event?Dn(d.event):"#000",editable:t.data.editable,borderColor:j(Me),className:"cursor-pointer overflow-hidden",extendedProps:{type:"workPeriod",workPeriod:d}})}),t.data.unaccountablePeriods.forEach((d,G)=>{const{start:X,type:ae}=d,Me=d.end||f.value;!X||!Me||Se(Me,X)||!ae||i.push({start:X,end:Me,title:ae.name,className:"cursor-pointer overflow-hidden",editable:t.data.editable,extendedProps:{type:"unaccountablePeriod",unaccountablePeriod:d}})}),t.data.userAbsences.forEach(d=>{const{id:G,startsAt:X,endsAt:ae,type:Me,user:je}=d;if(!X||!ae||Se(ae,X)||!G||!je||!Me)return;const Y=Ws(d);i.push({start:X,end:new Date(ae.getTime()+1),backgroundColor:Y,textColor:yn(d),borderColor:j(Y),allDay:!0,editable:!1,title:Me.name,extendedProps:{type:"absence",absence:d}})}),t.data.holidays.forEach(d=>{if(!d.startsAt||!d.endsAt)return;const G="#991b1b";i.push({start:d.startsAt,end:d.endsAt,backgroundColor:G,textColor:"#fff",borderColor:j(G),allDay:!0,editable:!1,title:d.name,extendedProps:{type:"holiday",holiday:d}})}),i})},{calendarDate:()=>t.data.date});function we(){!x.value||!("item"in x.value)||(Ce(x.value.item,"assignment-event-work-periods")?y.resetOrRemove(x.value.item):Ce(x.value.item,"unaccountable-periods")&&h.resetOrRemove(x.value.item),I(!1))}const{validateAsync:Ye}=Sn(k),{execute:O}=ua(async()=>{try{if(!x.value||!("item"in x.value))return;await Ye();const{item:i}=x.value;i.manipulatedAt=new Date,i.manipulatedBy=$.value,Ce(i,"assignment-event-work-periods")?await y.save(i):await h.save(i),I(!1)}catch{return}},{useNProgress:!0}),{execute:Q}=ua(async()=>{q.value&&(Ce(q.value,"assignment-event-work-periods")?await y.remove(q.value):await h.remove(q.value),I(!1),q.value=void 0)}),{errors:$e,warnings:D}=vn(u(()=>t.data)),{getAssignmentNameToShow:z}=kn(),_e=kt().createScope(),le=ft(),be=u({get(){return t.absenceToEditOrCreate},set(i){P("update:absenceToEditOrCreate",i)}});function N(){be.value=_e.construct({companyId:le.value,startsAt:t.data.date,endsAt:mt(t.data.date),userUuid:t.user.uuid,status:"draft"})}return(i,d)=>{const G=Ht,X=lt,ae=tt("font-awesome-icon"),Me=ln,je=Yt;return r(),B("div",null,[n(_a,{class:"bg-gray-100 p-2 rounded shadow mb-2 flex-col gap-y-2"},{default:a(()=>[_("div",Pr,[_("div",Er,[n(Mn,{data:i.data},null,8,["data"]),i.data.canRecompute?(r(),S(oe,{key:0,content:e(m)("timeSheets.Recompute")},{default:a(()=>[n(X,{type:"primary",onClick:i.data.recompute},{default:a(()=>[n(G,null,{default:a(()=>[n(e(ka))]),_:1})]),_:1},8,["onClick"])]),_:1},8,["content"])):b("",!0)]),_("div",Br,[!i.data.userAbsences.length&&i.data.editable?(r(),S(oe,{key:0,content:e(m)("userAbsence.create")},{default:a(()=>[n(X,{plain:"",onClick:d[0]||(d[0]=Y=>N())},{default:a(()=>[n(G,null,{default:a(()=>[n(ae,{icon:["far","calendar-times"],class:"text-xs"})]),_:1})]),_:1})]),_:1},8,["content"])):b("",!0),i.data.canSubmit?(r(),S(oe,{key:1,content:e(m)("timeSheets.Submit")},{default:a(()=>[n(X,{type:"primary",plain:i.data.canApprove,onClick:d[1]||(d[1]=()=>P("submit",i.data.timeSheetDay))},{default:a(()=>[n(G,null,{default:a(()=>[n(e(Pt))]),_:1})]),_:1},8,["plain"])]),_:1},8,["content"])):b("",!0),i.data.canApprove?(r(),S(oe,{key:2,content:i.data.timeSheetDay.approvedAt?e(F):e(m)("timeSheets.Approve")},{default:a(()=>[n(X,{type:"primary",disabled:!!i.data.timeSheetDay.approvedAt,onClick:d[2]||(d[2]=()=>P("approve",i.data.timeSheetDay))},{default:a(()=>[n(G,null,{default:a(()=>[n(e(qt))]),_:1})]),_:1},8,["disabled"])]),_:1},8,["content"])):b("",!0),i.data.canDecline?(r(),S(oe,{key:3,content:i.data.timeSheetDay.declinedAt?e(p):e(m)("timeSheets.Decline")},{default:a(()=>[n(X,{type:"danger",disabled:!!i.data.timeSheetDay.declinedAt,plain:!i.data.timeSheetDay.declinedAt&&(!!i.data.timeSheetDay.approvedAt||!!i.data.timeSheetDay.declinedAt),onClick:d[3]||(d[3]=()=>P("decline",i.data.timeSheetDay))},{default:a(()=>[n(G,null,{default:a(()=>[n(e(jt))]),_:1})]),_:1},8,["disabled","plain"])]),_:1},8,["content"])):b("",!0)])]),i.data.editable||i.data.timeSheetDay.note?(r(),B("div",$r,[_("p",Ir,c(e(m)("timeSheets.note"))+":",1),n(Qs,{modelValue:i.data.timeSheetDay.note,"onUpdate:modelValue":d[4]||(d[4]=Y=>i.data.timeSheetDay.note=Y),disabled:!i.data.editable,placeholder:e(m)("timeSheets.note")},null,8,["modelValue","disabled","placeholder"])])):b("",!0),_("div",Or,[n(Rt,{data:i.data,"working-time-model":i.workingTimeModel,onAbsenceClicked:d[5]||(d[5]=Y=>i.$emit("update:absenceToEditOrCreate",Y))},null,8,["data","working-time-model"])])]),_:1}),n(_n,{data:i.data,errors:e($e),warnings:e(D),class:Te({"mb-2":!!e($e).length||!!e(D).length})},null,8,["data","errors","warnings","class"]),e(Ee).length?(r(),B("div",Ur,[U(c(e(m)("timeSheets.scheduledEvents"))+": ",1),(r(!0),B(me,null,Ke(e(Ee),Y=>(r(),S(Mr,{key:Y.uuid,event:Y,class:"mb-1 cursor-pointer",onClick:()=>te(Y)},null,8,["event","onClick"]))),128))])):b("",!0),n(e(Ls),{ref_key:"refCalendar",ref:at,options:e(dt)},{eventContent:a(({event:Y,timeText:nt})=>[_("div",Wr,c(nt),1),ie(Y,"workPeriod")?(r(),B(me,{key:0},[_("div",null,[_("span",null,c(e(z)(Y.extendedProps.workPeriod.assignment)),1),xr,Y.extendedProps.workPeriod.event?(r(),S(Tn,{key:0,value:Y.extendedProps.workPeriod.event},null,8,["value"])):b("",!0)]),Y.extendedProps.workPeriod.type?(r(),B("div",Nr,c(Y.extendedProps.workPeriod.type.name),1)):b("",!0),Y.extendedProps.workPeriod.note?(r(),B("div",Fr,c(Y.extendedProps.workPeriod.note),1)):b("",!0)],64)):b("",!0),ie(Y,"unaccountablePeriod")?(r(),B(me,{key:1},[_("div",null,c(Y.extendedProps.unaccountablePeriod.type?.name),1),Y.extendedProps.unaccountablePeriod.eventType?(r(),B("div",Vr,c(Y.extendedProps.unaccountablePeriod.eventType.name),1)):b("",!0)],64)):ie(Y,"absence")||ie(Y,"holiday")?(r(),B(me,{key:2},[U(c(Y.title),1)],64)):b("",!0)]),_:1},8,["options"]),e(x)?(r(),S(je,{key:1,"model-value":!!e(x),class:"dialog-messagebox-[500px] dialog-center",title:"item"in e(x)?e(Ce)(e(x).item,"assignment-event-work-periods")?e(m)("assignment-event-work-periods.name"):e(m)("unaccountable-work-periods.name"):e(m)("timeSheets.createWorkTime"),"onUpdate:modelValue":I},{footer:a(()=>[!("item"in e(x))||e(x).item.id&&!i.data.editable?(r(),B(me,{key:0},["item"in e(x)?(r(),S(X,{key:0,type:"primary",onClick:d[9]||(d[9]=()=>I(!1))},{default:a(()=>[U(c(e(m)("actions.Close")),1)]),_:1})):b("",!0)],64)):(r(),B("div",Lr,["item"in e(x)&&e(x).item.id?(r(),S(X,{key:0,type:"danger",plain:"",onClick:d[10]||(d[10]=()=>q.value=e(x).item)},{default:a(()=>[n(ae,{icon:"trash-alt",class:"text-xs mr-2"}),U(" "+c(e(m)("actions.Delete")),1)]),_:1})):b("",!0),_("div",qr,["item"in e(x)?(r(),S(X,{key:0,class:"mr-2",text:"",onClick:we},{default:a(()=>[U(c(e(m)("actions.Cancel")),1)]),_:1})):b("",!0),"item"in e(x)?(r(),S(X,{key:1,type:"primary",onClick:e(O)},{default:a(()=>[U(c(e(m)("timeSheets.form.enterPeriod")),1)]),_:1},8,["onClick"])):b("",!0)])]))]),default:a(()=>["create"in e(x)&&e(x).create.type===void 0?(r(),B("div",Rr,[n(X,{type:"primary",onClick:d[6]||(d[6]=()=>pe("work-period"))},{default:a(()=>[U(c(e(m)("assignment-event-work-periods.name")),1)]),_:1}),n(X,{type:"primary",onClick:d[7]||(d[7]=()=>pe("unaccountable-period"))},{default:a(()=>[U(c(i.$t("unaccountable-work-periods.name")),1)]),_:1})])):"item"in e(x)?(r(),B("div",Hr,[i.data.timeSheetDay.approvedAt||i.data.timeSheetDay.submittedAt?(r(),S(Me,{key:0,title:i.data.timeSheetDay.approvedAt?e(m)("timeSheets.timeSheetIsAlreadyApproved"):e(m)("timeSheets.timeSheetAlreadySubmitted"),type:"info",closable:!1,class:"!mb-2"},null,8,["title"])):b("",!0),e(Ce)(e(x).item,"assignment-event-work-periods")?(r(),S(js,{key:1,item:e(x).item,"hide-user-edit":"","limit-time-to-date":i.data.date,"allow-assignment-edit":!e(x).item.id||i.data.editable,"read-only":!!e(x).item.id&&!i.data.editable},null,8,["item","limit-time-to-date","allow-assignment-edit","read-only"])):e(Ce)(e(x).item,"unaccountable-periods")?(r(),S(zs,{key:2,item:e(x).item,"hide-user-edit":"","limit-time-to-date":i.data.date,"read-only":!!e(x).item.id&&!i.data.editable,"enable-convert":"",onClose:d[8]||(d[8]=Y=>x.value=void 0)},null,8,["item","limit-time-to-date","read-only"])):b("",!0)])):b("",!0)]),_:1},8,["model-value","title"])):b("",!0),e(q)?(r(),S(je,{key:2,"model-value":!!e(q),"onUpdate:modelValue":d[12]||(d[12]=()=>q.value=void 0)},{footer:a(()=>[_("div",jr,[n(X,{text:"",onClick:d[11]||(d[11]=()=>q.value=void 0)},{default:a(()=>[U(c(e(m)("actions.Cancel")),1)]),_:1}),n(X,{type:"danger",onClick:e(Q)},{default:a(()=>[U(c(e(m)("actions.Delete")),1)]),_:1},8,["onClick"])])]),default:a(()=>[U(c(e(m)("feathersTablePagination.deleteQuestion"))+" ",1)]),_:1},8,["model-value"])):b("",!0)])}}}),nn=60*4;function Qr(v,T){const{endFallback:t=new Date,stopOnMultipleDays:P=!1}=T||{};if(!v.length)return{startsAt:null,endsAt:null,pauseDuration:null};let m=[],g=null,y=null;for(let p=0,F=v.length;p<F;p++){const k=v[p];if(!k.start)continue;const $=Vt(k.start),f=Vt(k.end||t);(!g||$.getTime()<g.getTime())&&(g=$),(!y||f.getTime()>y.getTime())&&(y=f),m.push({start:$,end:f})}if(g&&y&&g.getTime()>y.getTime())return{startsAt:g,endsAt:null,pauseDuration:0,error:"start_after_end"};if(P&&g&&y&&!bt(g,y))return{startsAt:g,endsAt:null,pauseDuration:0,error:"multiple_days"};m=on(m,{ignoreGapSmallerThan:nn});let h=0;for(let p=1;p<m.length;p++){const F=m[p-1],k=m[p],$=Math.abs(mn(F.end,k.start));$<nn||(h+=$)}return{startsAt:g,endsAt:y,pauseDuration:h}}function Gr(v){const T=ns().createScope(),t=ss().createScope(),{data:P,isPending:m}=T.useFind({params:u(()=>{const $=xt(v);return $?$.workingTimeModelId?{query:{id:$.workingTimeModelId,$limit:1},$populateParams:{name:"withWeekdays"}}:{query:{isDefault:!0,deactivatedAt:null,$limit:1},$populateParams:{name:"withWeekdays"}}:null})}),g=u(()=>m.value?void 0:P.value.at(0)??null),{data:y,isPending:h}=t.useFind({params:u(()=>g.value?.id?{query:{workingTimeModelId:g.value.id,$sort:{weekday:1},$limit:-1}}:null)}),p=u(()=>m.value||h.value?void 0:y.value),F=u(()=>{if(!p.value)return;const $={};for(const f of os)$[f]=p.value.find(M=>M.weekday===f);return $}),k=u(()=>m.value||h.value);return{workingTimeModel:g,weekdayModels:p,weekdayModelByWeekday:F,isPending:k}}const Kr=_s(()=>{const v=Js();return u(()=>v.value?.canSeeTimesheets??null)});function Nt(v,T){if(Array.isArray(v)){const t=v.map(P=>Nt(P,T));return t.length===1?t[0]:{$or:t}}return T(v)}function _t(v){const{store:T,intervalToIgnore:t=1e3}=v,P=ye([]),m=At(v.params),g=At(v.fetchParams??v.params);Fe(g,()=>{P.value=[]});const y=u(()=>{const f=xt(v.dateRange);if(!f||!g.value)return null;const M=rs(f,P.value);return M.length?{...g.value,query:{...na(sa(g.value).query??{},Nt(M,v.formatFetch??v.format))}}:null}),{data:h,fetch:p,haveLoaded:F}=T.useFeathersItems({localOnly:!0,params:u(()=>!m.value||!P.value.length?null:{...m.value,query:{...na(sa(m.value).query??{},Nt(P.value,v.format)),$limit:-1}}),fetchParams:y}),k=ye(!0),$=u(()=>{const f=xt(v.dateRange),M=k.value||!f||!m.value?void 0:{...m.value,query:{...na(sa(m.value).query??{},Nt(f,v.formatFetch??v.format))}};return M?T.findInStore(M):void 0});return Fe(y,async f=>{const M=xt(v.dateRange);if(!f||!M){k.value=!1;return}k.value=!0,await Mt();try{await p(),P.value=on([...P.value,M],{ignoreGapSmallerThan:t})}finally{await Mt(),k.value=!1}},{immediate:!0}),{data:$,dataForAllRanges:h,isPending:k,haveLoaded:F}}const Yr={class:"flex justify-between items-center flex-wrap md:flex-nowrap mb-2"},Jr={class:"hidden sm:block"},Xr={class:"block sm:hidden"},Zr={class:"ml-2"},ei={class:"flex justify-end mt-2"},ti={class:"text-gray-500 mb-1"},ai={class:"mb-2"},ni=Ta(()=>ga(()=>import("./DialogFormUserAbsence-cNNDodR0.js"),__vite__mapDeps([33,34,2,3,35,36,37,38,7,8,39,40,41,42,17,18,19,20,21,43,44,25,45,46]))),si=Le({__name:"ViewTimeSheet",props:{standalone:{type:Boolean,default:!1},hideTimeTrackingPanel:{type:Boolean,default:!1}},setup(v){const T=v,{t}=We(),P=pt(),m=ft(),g=sn(),y=is().createScope(),h=ls().createScope(),p=ds().createScope(),F=kt().createScope(),k=ya().createScope(),$=ha().createScope(),f=us().createScope(),M=va(["superadmin","admin"]),A=va(["superadmin","admin","office"]),Z=Kr(),L=cs(ms.ViewTimeSheetDays,Os),x=en({date:new Date,view:"date",userId:null}),I=en({get date(){return T.standalone?x.date:L.date},set date(o){if(T.standalone){x.date=o;return}L.date=o},get view(){return T.standalone?x.view:L.view},set view(o){if(T.standalone){x.view=o;return}L.view=o},get userId(){return T.standalone?x.userId:L.userId},set userId(o){if(T.standalone){x.userId=o;return}L.userId=o}}),ee=u({get(){return I.view==="date"?I.date:I.view==="week"?ma(I.date):pa(I.date)},set(o){I.date=o}}),q=Ct(Vt,{interval:{minutes:2}}),te=ye(void 0);function pe(o,s){if(!(o===!0||Array.isArray(o)&&!o.length)){if(!o){te.value=void 0;return}if(o){if(Array.isArray(o)){te.value={days:o,month:s};return}te.value={days:[o],month:s}}M.value&&ue()}}function ue(){if(!te.value||!xe.value){pe(!1);return}const{days:o,month:s}=te.value;Ea(o),s&&Bn(s),pe(!1)}const ce=u(()=>I.view==="month"?{start:pa(I.date),end:$s(I.date)}:I.view==="date"?{start:wa(I.date),end:mt(I.date)}:{start:ma(I.date),end:Bs(I.date)}),J=u(()=>{const o=new Date;return oa({start:ce.value.start,end:ce.value.end}).map(s=>({date:s,numberOfWeek:eo(s),isToday:fa(s),isTodayOrBefore:Se(s,o),key:Be(s),title:Xe(s,"EEEEEE, dd.")}))}),Pe=u(()=>vs(J.value,"key")),he=u({get(){return I.userId??P.value?.id??null},set(o){I.userId=o??null}}),K=Xs(he,y),qe=u(()=>M.value||A.value&&Z.value===null?{query:{$sort:{fullName:1},deactivatedAt:null}}:{query:{$sort:{fullName:1},deactivatedAt:null,$or:[{supervisorId:P.value?.id},{id:P.value?.id}]}}),{workingTimeModel:fe,weekdayModelByWeekday:ie}=Gr(K),{data:Ve,isPending:Ee}=_t({store:h,format:o=>({day:{$gteDateString:Be(o.start),$lteDateString:Be(o.end)}}),formatFetch:o=>({day:{$gte:Be(o.start),$lte:Be(o.end)}}),dateRange:ce,params:u(()=>he.value?{query:{userId:he.value,$limit:100}}:null),fetchParams:u(()=>he.value?{query:{userId:he.value,$limit:100}}:null)}),j=ye(void 0);Fe([Ee,Ve,K,J],async()=>{if(j.value=void 0,Ee.value||!K.value||!Ve.value)return;await Mt();const o=K.value,s=Ve.value;if(!o||!s)return;let l={};const w=[];J.value.forEach(C=>{const H=s.find(W=>W.day===C.key);H?l&&(l[C.key]=H):(w.push({companyId:o.companyId,day:C.key,userId:o.id,pauseDuration:0,duration:0}),l=void 0)}),w.length&&await h.create(w),l&&(j.value=l)},{immediate:!0});const{data:at,isPending:dt}=_t({store:p,format:o=>({startsAt:{$lte:o.end},endsAt:{$gte:o.start}}),dateRange:ce,params:u(()=>m.value?{query:{companyId:m.value,$limit:100}}:null)}),we=u(()=>{if(dt.value||!at.value||!J.value)return;const o={};J.value.forEach(s=>{o[s.key]=[]});for(const s of at.value){const l=s.startsAt,w=s.endsAt,C=oa({start:l,end:w});for(const H of C){const W=Be(H);o[W]&&o[W].push(s)}}return o}),{data:Ye,isPending:O}=_t({store:F,format:o=>({startsAt:{$lte:o.end},endsAt:{$gte:o.start}}),dateRange:ce,params:u(()=>he.value?{query:{userId:he.value,$limit:100}}:null)}),Q=u(()=>[...new Set(Ye.value?.map(o=>o.typeId))].filter(Re)),{isPending:$e}=f.useFindOnce({items:Q,params:u(()=>Q.value.length?{query:{id:{$in:Q.value},$limit:-1}}:null),fetchParams:o=>({query:{id:{$in:o},$limit:-1}})}),D=u(()=>{if(O.value||$e.value||!Ye.value||!J.value)return;const o={};J.value.forEach(s=>{o[s.key]=[]});for(const s of Ye.value){const l=s.startsAt,w=s.endsAt;if(!l||!w)continue;const C=oa({start:l,end:w});for(const H of C){const W=Be(H);o[W]&&o[W].push(s)}}return o}),{data:z,isPending:_e}=_t({store:k,format:o=>({start:{$gte:o.start,$ne:null}}),dateRange:ce,params:u(()=>he.value?{query:{id:{$ne:null},userId:he.value,$limit:-1}}:null)}),le=u(()=>{if(_e.value||!z.value)return;const o={};for(const s of z.value){if(!s.start)continue;const l=Be(s.start);o[l]||(o[l]=[]),o[l].push(s)}return o}),{data:be,isPending:N}=_t({store:$,format:o=>({start:{$gte:o.start,$ne:null}}),dateRange:ce,params:u(()=>he.value?{query:{id:{$ne:null},userId:he.value,$limit:-1}}:null)}),i=u(()=>{if(N.value||!be.value)return;const o={};for(const s of be.value){if(!s.start)continue;const l=Be(s.start);o[l]||(o[l]=[]),o[l].push(s)}return o}),d=u(()=>{if(!le.value||!i.value)return;const o={};for(const s of J.value){const l=le.value[s.key]??[],w=i.value[s.key]??[];o[s.key]=[...l,...w].sort((C,H)=>!C.start||!H.start?0:C.start.getTime()-H.start.getTime())}return o}),G=u(()=>{if(!d.value)return;const o={};for(const s of J.value){const l=d.value[s.key]??[];o[s.key]=Qr(l,{endFallback:q.value,stopOnMultipleDays:!0})}return o}),X=u(()=>{if(!d.value)return;const o={};for(const s of J.value){if(!d.value[s.key])return;const l=d.value[s.key];o[s.key]=l.some(w=>w.start?!bt(w.start,w.end??q.value):!1)}return o}),ae=u(()=>{if(!j.value||!D.value||!we.value||!d.value)return;const o={};for(const s of J.value){if(!j.value[s.key])return;const w=d.value[s.key];o[s.key]=!D.value[s.key]?.length&&!we.value[s.key]?.length||(w?.length??0)>0}return o}),Me=u(()=>{const o=fe.value;if(!o?.pauseRules||!Array.isArray(o.pauseRules)||o.pauseRules.length===0)return;const s=[...o.pauseRules].sort((l,w)=>(w.durationMin??0)-(l.durationMin??0));if(s.length)return s}),je=u(()=>{if(!G.value||!j.value||fe.value===void 0||!ie.value)return;const o={};for(const s of J.value){const l=G.value[s.key],w=j.value[s.key];if(!l||!w)return;const C=ie.value[s.numberOfWeek],H=(()=>{const V=(re,E,ge)=>{const ve=typeof re=="number"?it(s.date,za(re,{pick:["hours","minutes","seconds"],unitInput:"seconds"})):re;return{startsAtCorrected:ve,startsAtCorrectedType:E,startsAtCorrectedTypeLabel:(E==="computed"||E==="not set")&&!ve?"":E==="manually"?t("timeSheets.changedByWorkingTimeModel.startsAt.manual"):E==="default"?t("timeSheets.changedByWorkingTimeModel.startsAt.default"):ge&&ve?.getTime()!==ge.getTime()?t("timeSheets.changedByWorkingTimeModel.startsAt.corrected",{real:Qa(ge)}):""}};if(!C)return V(l.startsAt,"computed");if(w.startsAtManipulatedAt)return V(w.startsAt??null,"manually");if(!l.startsAt)return C.start?V(C.start,"default",l.startsAt):C.startMin?V(C.startMin,"min",l.startsAt):V(null,"not set");const de=qa(ja(l.startsAt,["hours","minutes","seconds"]),"seconds");return C.startMin&&de<C.startMin?V(C.startMin,"min",l.startsAt):C.startMax&&de>C.startMax?V(C.startMax,"max",l.startsAt):V(l.startsAt,"computed",l.startsAt)})(),W=(()=>{const V=(re,E,ge)=>{const ve=typeof re=="number"?it(s.date,za(re,{pick:["hours","minutes","seconds"],unitInput:"seconds"})):re;return{endsAtCorrected:ve,endsAtCorrectedType:E,endsAtCorrectedTypeLabel:(E==="computed"||E==="not set")&&!ve?"":E==="manually"?t("timeSheets.changedByWorkingTimeModel.endsAt.manual"):E==="default"?t("timeSheets.changedByWorkingTimeModel.endsAt.default"):ge&&ve?.getTime()!==ge.getTime()?t("timeSheets.changedByWorkingTimeModel.endsAt.corrected",{real:Qa(ge)}):""}};if(!C)return V(l.endsAt,"computed");if(w.endsAtManipulatedAt)return V(l.endsAt,"manually");if(!l.endsAt)return C.end?V(C.end,"default",l.endsAt):C.endMin?V(C.endMin,"min",l.endsAt):V(null,"not set");const de=qa(ja(l.endsAt,["hours","minutes","seconds"]),"seconds");return C.endMin&&de<C.endMin?V(C.endMin,"min",l.endsAt):C.endMax&&de>C.endMax?V(C.endMax,"max",l.endsAt):V(l.endsAt,"computed",l.endsAt)})(),se=(()=>{const V=(ve,Ue,st)=>({pauseDurationCorrected:ve,pauseDurationCorrectedType:Ue,pauseDurationCorrectedTypeLabel:Ue==="computed"||Ue==="not set"||ve===null?"":Ue==="manually"?t("timeSheets.changedByWorkingTimeModel.pauseDuration.manual"):Ue==="default"?t("timeSheets.changedByWorkingTimeModel.pauseDuration.default"):st?t("timeSheets.changedByWorkingTimeModel.pauseDuration.corrected",{real:ys(st,{hours:"always",minutes:"always"}).result}):""});if(!C)return V(l.pauseDuration,"computed");if(w.pauseDurationManipulatedAt)return V(l.pauseDuration,"manually");const de=H.startsAtCorrected||w.startsAt,re=W.endsAtCorrected||w.endsAt;if(!de||!re)return V(l.pauseDuration,"computed");const E=Me.value;if(!E)return V(l.pauseDuration,"computed");const ge=Math.max(0,Math.round((de.getTime()-re.getTime())/1e3));for(let ve=0;ve<E.length;ve++){const Ue=E[ve],{breakTimeDefault:st,durationMin:wt,breakTimeMin:ot,breakTimeMax:Dt}=Ue;if(ge<(wt??0))continue;let Tt="computed",ht=l.pauseDuration;return ht===null&&(Tt="default",ht=st??0),ot!=null&&ht<ot?V(ot,"min",l.pauseDuration):Dt!=null&&ht>Dt?V(Dt,"max",l.pauseDuration):V(ht,Tt,l.pauseDuration)}return V(l.pauseDuration,"computed")})();o[s.key]={...H,...W,...se}}return o}),Y=u(()=>fe.value?.countHolidaysAsWorkdays??!1),nt=u(()=>{if(!D.value||!we.value||!ae.value||!G.value||!je.value||!K.value||!d.value||fe.value===void 0||!ie.value)return;const o={};for(const s of J.value){const l=D.value[s.key]??[],w=we.value[s.key]??[],C=ae.value[s.key],H=G.value[s.key],W=je.value[s.key],se=d.value[s.key],{startsAt:V,endsAt:de,pauseDuration:re}=se?.length?H:{startsAt:W.startsAtCorrected,endsAt:W.endsAtCorrected,pauseDuration:W.pauseDurationCorrected},E={startsAt:V,endsAt:de,pauseDuration:re,day:s.date,userId:K.value.id,companyId:K.value.companyId},ge=ie.value[s.numberOfWeek];if(ge&&!C){const{duration:ve}=ge;if(ve){o[s.key]={...E,duration:w.length?Y.value?ve:0:l.some(Ue=>Ue.type?.countAsWorkingTime)?ve:0};continue}}o[s.key]=E}return o}),R=u(()=>{if(!j.value||!ae.value||!nt.value)return;const o={};for(const s of J.value){const l=j.value[s.key];if(l.submittedAt)continue;const w=nt.value[s.key],C=ae.value[s.key],H=C&&w.startsAt&&l.startsAt?.getTime()!==w.startsAt.getTime()?w.startsAt:void 0,W=C&&w.endsAt&&l.endsAt?.getTime()!==w.endsAt.getTime()?w.endsAt:void 0,se=C&&w.pauseDuration!=null&&l.pauseDuration!==w.pauseDuration?w.pauseDuration:void 0,V="duration"in w&&l.duration!==w.duration?w.duration:void 0;H===void 0&&W===void 0&&se===void 0&&V===void 0||(o[s.key]={startsAt:H,endsAt:W,pauseDuration:se,duration:V})}return o}),ze=u(()=>K.value?K.value.supervisorId===P.value?.id:!1),Et=u(()=>{if(!j.value)return;const o={};for(const s of J.value){const l=j.value[s.key];if(!l)return;o[s.key]=l.submittedAt?void 0:l}return o}),St=u(()=>{if(!j.value)return;const o={},s=ze.value||M.value;for(const l of J.value){const w=j.value[l.key];if(!w)return;o[l.key]=s&&w.submittedAt&&!w.declinedAt&&!w.approvedAt?w:void 0}return o}),Bt=u(()=>{if(!j.value)return;const o={},s=ze.value||M.value;for(const l of J.value){const w=j.value[l.key];if(!w)return;o[l.key]=w.submittedAt&&!w.declinedAt&&s?w:void 0}return o}),Pa=u(()=>{if(!j.value)return;const o={};for(const s of J.value){const l=j.value[s.key];if(!l)return;o[s.key]=l.submittedAt&&!l.approvedAt?l:void 0}return o}),Cn=u(()=>{if(!j.value||fe.value===void 0||!ae.value)return;const o=Me.value;if(!o)return{};const s={};for(const l of J.value){const w=j.value[l.key];if(!w)return;const{startsAt:C,endsAt:H}=w,W=w.pauseDuration??0;if(!ae.value?.[l.key]||!C||!H)continue;const se=Math.max(0,Math.round((H.getTime()-C.getTime())/1e3));let V=!1;for(const de of o){const{durationMin:re,breakTimeMin:E,breakTimeMax:ge}=de;if((se??0)<(re??0)){V=!0;continue}if(E!=null&&W<E){s[l.key]={type:"pauseTooShort",expected:E,value:W,durationMin:re??0},V=!0;break}else if(ge!=null&&W>ge){s[l.key]={type:"pauseTooLong",expected:ge,value:W,durationMin:re??0},V=!0;break}}}return s}),Pn=u(()=>{if(!j.value||ie.value===void 0||!ae.value)return;const o={};for(const s of J.value){const l=j.value[s.key],w=ae.value[s.key];if(!l||w===void 0)return;const C=ie.value[s.numberOfWeek];!w||!C?.durationMax||C.durationMax>(l.duration??0)||(o[s.key]={type:"durationTooLong",expected:C.durationMax,value:l.duration??0})}return o}),En=u(()=>{if(!R.value||!j.value)return;const o=[];for(const s of J.value){const l=j.value[s.key],w=R.value[s.key];if(!l)return;if(!w||l.submittedAt||l.declinedAt||l.approvedAt||l.startsAtManipulatedAt||l.endsAtManipulatedAt||l.pauseDurationManipulatedAt||l.durationManipulatedAt||l.manipulatedAt)continue;let C;w.startsAt&&(C=C??{key:s.key},C.startsAt=w.startsAt),w.endsAt&&(C=C??{key:s.key},C.endsAt=w.endsAt),w.pauseDuration!==void 0&&(C=C??{key:s.key},C.pauseDuration=w.pauseDuration),w.duration!==void 0&&(C=C??{key:s.key},C.duration=w.duration),C&&o.push(C)}return o});function Jt(o,s){const{timeSheetDay:l,userAbsences:w,holidays:C}=s,H=ie.value;return C.length&&!s.showStartsAtEndsAt?Y.value?H?.[o.numberOfWeek]?.duration??0:0:w.length&&!s.showStartsAtEndsAt&&H?.[o.numberOfWeek]?H[o.numberOfWeek]?.duration??0:!l?.startsAt||!l?.endsAt||l.startsAt>l.endsAt?0:Math.max(0,Math.abs(mn(l.endsAt,l.startsAt))-(l.pauseDuration??0))}const Xt=ye(!1);Fe(En,async(o,s)=>{if(!o&&s){Xt.value=!1;return}if(!(!o||!j.value||!Pe.value||!ae.value||!D.value||!we.value)){for(const l of o){const{key:w,startsAt:C,endsAt:H,pauseDuration:W,duration:se}=l,V=j.value[w];if(!V||!Pe.value[w])continue;let de=!1;if(C&&(V.startsAt=C,de=!0),H&&(V.endsAt=H,de=!0),W!==void 0&&(V.pauseDuration=W,de=!0),se!==void 0&&(V.duration=se),de){const re=Jt(Pe.value[w],{timeSheetDay:V,userAbsences:D.value[w]??[],holidays:we.value[w]??[],showStartsAtEndsAt:ae.value[w]??!1});re!==void 0&&(V.duration=re)}}s||(await Mt(),Xt.value=!0)}},{immediate:!0});const{submit:Ea,unsubmit:Ba,approve:$t,decline:$a}=to(),{submit:Bn,decline:$n}=ao(),xe=u(()=>{const o=Et.value,s=St.value,l=Bt.value,w=Pa.value;if(!o||!s||!l||!w)return;const C=Object.values(o).filter(Re),H=Object.values(s).filter(Re),W=Object.values(l).filter(Re),se=Object.values(w).filter(Re),V=C.length>0,de=H.length>0,re=W.length>0,E=se.length>0;return{submit:()=>{if(V)return Ea(C)},approve:()=>{if(de)return $t(H)},decline:ot=>{if(re)return $a(W,ot)},unsubmit:()=>{if(E)return Ba(se)},timeSheetsToSubmit:C,timeSheetsToApprove:H,timeSheetsToDecline:W,timeSheetsToUnsubmit:se,canSubmit:V,canApprove:de,canDecline:re,canUnsubmit:E}}),Zt=ye(null),Ia=ye(0);Fe(Zt,async o=>{o&&(Ia.value=Date.now(),await Mt(),o.focus())});function In(){Date.now()-Ia.value<250&&Zt.value?.focus()}const Qe=ye(void 0),ut=ye("");function Je(o,s){if(!(o===!0||Array.isArray(o)&&!o.length))if(o){if(Array.isArray(o)){Qe.value={days:o,month:s};return}Qe.value={days:[o],month:s};return}else Qe.value=void 0,ut.value=""}function Oa(){if(!Qe.value){Je(!1);return}$a(Qe.value.days,ut.value),Qe.value.month&&$n(Qe.value.month,ut.value),Je(!1)}function On(o){const s=Pe.value?.[o],l=j.value?.[o],w=we.value?.[o],C=D.value?.[o],H=ae.value?.[o],W=()=>nt.value?.[o];if(s===void 0||l===void 0||w===void 0||C===void 0||H===void 0||W()===void 0)return;l.manipulatedAt=null,l.startsAtManipulatedAt=null,l.endsAtManipulatedAt=null,l.pauseDurationManipulatedAt=null,l.durationManipulatedAt=null,l.manipulatedBy=null;const se=W();if(se)if(w.length>0||C.length>0)l.duration=se.duration??0;else{l.startsAt=se.startsAt??null,l.endsAt=se.endsAt??null,l.pauseDuration=se.pauseDuration??0;const V=Jt(s,{timeSheetDay:l,userAbsences:C,holidays:w,showStartsAtEndsAt:H});V!==void 0&&(l.duration=V)}}const ct=u(()=>{const o=Xt.value,s=j.value,l=we.value,w=D.value,C=le.value,H=i.value,W=nt.value,se=je.value,V=R.value,de=d.value,re=Et.value,E=St.value,ge=Bt.value,ve=Pa.value,Ue=Cn.value,st=Pn.value,wt=ae.value,ot=X.value,Dt=fe.value,Tt=ie.value;return!o||!s||!l||!w||!C||!H||!W||!se||!V||!de||!re||!E||!ge||!ve||Dt===void 0||Tt===void 0||!Ue||!st||!wt||!ot?void 0:J.value.map(gt=>{const{key:De}=gt,ne=s[De],It=l[De],Ot=w[De],Nn=C[De]??[],Fn=H[De]??[],Vn=W[De],Rn=se[De],xa=V[De],Na=!!re[De],Hn=!!E[De],Ln=!!ge[De],qn=!!ve[De],Fa=de[De],jn=Ue[De],zn=st[De],Va=wt[De],Qn=ot[De],Gn=Tt[gt.numberOfWeek];if(!ne||!It||!Ot)return;const Kn=It.length>0||Ot.length>0,Ra=Fa.filter(ke=>!!ke.manipulatedAt).sort((ke,Ae)=>!ke.manipulatedAt||!Ae.manipulatedAt?0:ke.manipulatedAt.getTime()-Ae.manipulatedAt.getTime()),Ha=Ra.find(ke=>!!ke.manipulatedByUuid)??Ra.at(0)??null,Yn=ne.manipulatedBy??Ha?.manipulatedBy??void 0,aa=()=>Jt(gt,{timeSheetDay:ne,userAbsences:Ot,holidays:It,showStartsAtEndsAt:Va}),Jn=!ne.submittedAt||M.value&&!ne.approvedAt;return{...gt,timeSheetDay:ne,holidays:It,userAbsences:Ot,workPeriods:Nn,unaccountablePeriods:Fn,hasAbsenceOrHoliday:Kn,manipulatedByUser:Yn,combinedWorkPeriods:Fa,lastManipulatedPeriod:Ha,prefilled:Vn,corrected:Rn,mismatch:xa,canSubmit:Na,canApprove:Hn,canDecline:Ln,canUnsubmit:qn,canRecompute:Na&&!!xa,get startsAt(){return ne.startsAt??null},set startsAt(ke){ne.startsAt=ke;const Ae=aa();Ae!==void 0&&(ne.duration=Ae)},get endsAt(){return ne.endsAt??null},set endsAt(ke){ne.endsAt=ke;const Ae=aa();Ae!==void 0&&(ne.duration=Ae)},get pauseDuration(){return ne.pauseDuration??0},set pauseDuration(ke){ne.pauseDuration=ke;const Ae=aa();Ae!==void 0&&(ne.duration=Ae)},get duration(){return ne.duration??0},set duration(ke){ne.duration=ke,ne.startsAt=null,ne.endsAt=null,ne.pauseDuration=null},manipulateByHand(ke,Ae){if(ne.manipulatedAt=new Date,ne.manipulatedBy=P.value,ke==="startsAt"){if(Ut(this.startsAt,Ae))return;ne.startsAtManipulatedAt||(ne.startsAtManipulatedAt=new Date),this.startsAt=Ae}else if(ke==="endsAt"){if(Ut(this.endsAt,Ae))return;ne.endsAtManipulatedAt||(ne.endsAtManipulatedAt=new Date),this.endsAt=Ae}else if(ke==="pauseDuration"){if(Ut(this.pauseDuration,Ae))return;ne.pauseDurationManipulatedAt||(ne.pauseDurationManipulatedAt=new Date),this.pauseDuration=Ae}else if(ke==="duration"){if(Ut(this.duration,Ae))return;ne.durationManipulatedAt||(ne.durationManipulatedAt=new Date),this.duration=Ae}},async recompute(){On(De)},editable:Jn,pauseError:jn,durationError:zn,showStartsAtEndsAt:Va,hasMultipleDays:Qn,workingTimeModelWeekday:Gn}}).filter(gt=>!!gt)}),vt=ye(void 0),yt=ye(!1),Un=ps(async()=>{if(!fe.value||!K.value||!ce.value){yt.value=!1,vt.value=void 0;return}yt.value=!0;try{const o=await fs.service("calculate-working-times").calculateWorkingDaysForDateRange({companyId:K.value.companyId,userId:K.value.id,start:ce.value.start,end:ce.value.end});vt.value=o.duration}finally{yt.value=!1}},350);Fe([fe,K,ce],(o,s,l)=>{vt.value=void 0,yt.value=!!o&&!!s&&!!l,Un()},{immediate:!0}),rn(j,o=>{if(!o||h.isSaving.value)return;const s=Object.values(o).filter(l=>!l.id||h.hasChanges(l));s.length&&h.save(s)},{debounce:450,maxWait:2e3,deep:!0});const ea=u(()=>!!fe.value?.showIsManipulated),{stringifyAndDownloadCsv:Wn}=Zs();function xn(){if(!ct.value||!K.value)return;const o=K.value,s=ct.value.map(H=>{const{timeSheetDay:W}=H,se=W.approvedAt?t("timeSheets.csv.state.approved"):W.declinedAt?t("timeSheets.csv.state.declined"):!W.id||!W.submittedAt?t("timeSheets.csv.state.draft"):W.submittedAt&&!W.approvedAt&&!W.declinedAt?t("timeSheets.csv.state.unapproved"):"";return{staffNumber:o.staffNumber??`${o.id}`,weekday:Xe(H.date,"EEEEEE"),date:Xe(H.date,"dd.MM.yyyy"),start:W.startsAt?Xe(W.startsAt,"HH:mm"):"",end:W.endsAt?Xe(W.endsAt,"HH:mm"):"",breakTime:W.pauseDuration!=null?tn(W.pauseDuration,{hours:!0,minutes:!0}):"",durationFloating:W.duration!=null?parseFloat((W.duration/60/60).toFixed(2)):"",durationTime:W.duration!=null?tn(W.duration,{hours:!0,minutes:!0}):"",note:W.note??"",declineReason:W.declinedNote??"",absence:H.holidays[0]?.name??H.userAbsences[0]?.type?.name??"",state:se,manipulated:ea.value?W.manipulatedAt?W.manipulatedBy?t("timeSheets.manipulated.fullBy",{user:W.manipulatedBy.shortName||W.manipulatedBy.fullName}):t("timeSheets.manipulated.full"):H.lastManipulatedPeriod?H.lastManipulatedPeriod.manipulatedBy?t("timeSheets.manipulated.fullBy",{user:H.lastManipulatedPeriod.manipulatedBy.shortName||H.lastManipulatedPeriod.manipulatedBy.fullName}):t("timeSheets.manipulated.full"):"":""}}),l=I.view==="month"?t("Month"):I.view==="date"?t("Day"):t("Week"),w=Xe(I.date,I.view==="month"?"MM-yy":I.view==="date"?"dd-MM-yy":`'${t("calendar.cw")}'ww-yy`),C=`Artesa_AZN_${(o.shortName||o.fullName||t("unknown")).replace(/\s/gm,"_")}_${l}_${w}_${Xe(new Date,"yyyyMMdd-HHmmss")}.csv`;Wn(s,{columns:[{key:"staffNumber",header:t("timeSheets.csv.header.staffNumber")},{key:"weekday",header:t("timeSheets.csv.header.weekday")},{key:"date",header:t("timeSheets.csv.header.date")},{key:"start",header:t("timeSheets.csv.header.start")},{key:"end",header:t("timeSheets.csv.header.end")},{key:"breakTime",header:t("timeSheets.csv.header.breakTime")},{key:"durationFloating",header:t("timeSheets.csv.header.durationFloating")},{key:"durationTime",header:t("timeSheets.csv.header.durationTime")},{key:"absence",header:t("timeSheets.csv.header.absence")},{key:"state",header:t("timeSheets.csv.header.state")},{key:"note",header:t("timeSheets.csv.header.note")},{key:"declineReason",header:t("timeSheets.csv.header.declineReason")},...ea.value?[{key:"manipulated",header:t("timeSheets.manipulated.full")}]:[]]},C)}const Oe=pn(null),ta=u({get(){return!!Oe.value},set(o){o||(Oe.value=null)}}),Ua=ye(),{height:Wa}=Ms(Ua,void 0,{box:"border-box"});return(o,s)=>{const l=Ps,w=Es,C=tt("font-awesome-icon"),H=lt,W=Qt,se=Gt,V=Kt,de=Yt,re=Da;return zt((r(),B("div",{class:"time-sheet-view",style:Sa({paddingBottom:e(Wa)?`${e(Wa)}px`:void 0})},[o.standalone?b("",!0):(r(),S(Ks,{key:0})),_("div",Yr,[n(qs,{modelValue:e(ee),"onUpdate:modelValue":s[0]||(s[0]=E=>rt(ee)?ee.value=E:null),clearable:!1,resolution:e(I).view,"class-button-today":"hidden sm:block"},null,8,["modelValue","resolution"]),_("div",Jr,[n(w,{modelValue:e(I).view,"onUpdate:modelValue":s[1]||(s[1]=E=>e(I).view=E)},{default:a(()=>[n(l,{value:"month"},{default:a(()=>[U(c(e(t)("Month")),1)]),_:1}),n(l,{value:"week"},{default:a(()=>[U(c(e(t)("Week")),1)]),_:1}),n(l,{value:"date"},{default:a(()=>[U(c(e(t)("Day")),1)]),_:1})]),_:1},8,["modelValue"])]),_("div",Xr,[n(V,{onCommand:s[2]||(s[2]=E=>e(I).view=E)},{dropdown:a(()=>[n(se,null,{default:a(()=>[n(W,{disabled:e(I).view==="month",command:"month"},{default:a(()=>[n(C,{icon:"calendar-alt",class:"mr-2 text-xs"}),U(" "+c(e(t)("Month")),1)]),_:1},8,["disabled"]),n(W,{disabled:e(I).view==="week",command:"week"},{default:a(()=>[n(C,{icon:"calendar-week",class:"mr-2 text-xs"}),U(" "+c(e(t)("Week")),1)]),_:1},8,["disabled"]),n(W,{disabled:e(I).view==="date",command:"date"},{default:a(()=>[n(C,{icon:"calendar-day",class:"mr-2 text-xs"}),U(" "+c(e(t)("Day")),1)]),_:1},8,["disabled"])]),_:1})]),default:a(()=>[n(H,{type:"primary"},{default:a(()=>[n(C,{icon:e(I).view==="month"?"calendar-alt":e(I).view==="week"?"calendar-week":"calendar-day"},null,8,["icon"]),_("span",Zr,c(e(I).view==="month"?e(t)("Month"):e(I).view==="week"?e(t)("Week"):e(t)("Day")),1)]),_:1})]),_:1})]),!o.standalone&&(e(A)&&e(Z)===null||e(Z)==="supervisor")?(r(),S(Ys,{key:0,"model-value":e(K)??null,"show-name":e(g).md,size:"medium",params:e(qe),"onUpdate:modelValue":s[3]||(s[3]=E=>K.value=E)},null,8,["model-value","show-name","params"])):b("",!0)]),e(ct)&&e(K)&&e(xe)&&e(fe)!==void 0&&e(ie)!==void 0?(r(),B(me,{key:1},[e(I).view==="month"?(r(),S(So,{key:0,"absence-to-edit-or-create":e(Oe),"onUpdate:absenceToEditOrCreate":s[4]||(s[4]=E=>rt(Oe)?Oe.value=E:null),user:e(K),month:e(ee),"day-data":e(ct),"target-sum":e(vt),actions:e(xe),"working-time-model":e(fe),"is-pending-calculated-target-working-time":e(yt),onSubmitAll:s[5]||(s[5]=({timeSheetMonth:E})=>pe(e(xe)?.timeSheetsToSubmit??[],E)),onApproveAll:s[6]||(s[6]=()=>e(xe)?.approve()),onDeclineAll:s[7]||(s[7]=({timeSheetMonth:E})=>Je(e(xe)?.timeSheetsToDecline??[],E)),onUnsubmitAll:s[8]||(s[8]=()=>e(xe)?.unsubmit()),onSubmit:s[9]||(s[9]=E=>pe(E)),onApprove:s[10]||(s[10]=E=>e($t)(E)),onDecline:s[11]||(s[11]=E=>Je(E)),onGoToDate:s[12]||(s[12]=E=>(ee.value=E,e(I).view="date"))},null,8,["absence-to-edit-or-create","user","month","day-data","target-sum","actions","working-time-model","is-pending-calculated-target-working-time"])):e(I).view==="week"?(r(),S(kr,{key:1,"absence-to-edit-or-create":e(Oe),"onUpdate:absenceToEditOrCreate":s[13]||(s[13]=E=>rt(Oe)?Oe.value=E:null),user:e(K),date:e(ee),"day-data":e(ct),"target-sum":e(vt),actions:e(xe),"working-time-model":e(fe),"is-pending-calculated-target-working-time":e(yt),"show-is-manipulated":e(ea),onSubmitAll:s[14]||(s[14]=()=>pe(e(xe)?.timeSheetsToSubmit??[])),onApproveAll:s[15]||(s[15]=()=>e(xe)?.approve()),onDeclineAll:s[16]||(s[16]=()=>Je(e(xe)?.timeSheetsToDecline??[])),onUnsubmitAll:s[17]||(s[17]=()=>e(xe)?.unsubmit()),onSubmit:s[18]||(s[18]=E=>pe(E)),onApprove:s[19]||(s[19]=E=>e($t)(E)),onDecline:s[20]||(s[20]=E=>Je(E)),onGoToDate:s[21]||(s[21]=E=>(ee.value=E,e(I).view="date"))},null,8,["absence-to-edit-or-create","user","date","day-data","target-sum","actions","working-time-model","is-pending-calculated-target-working-time","show-is-manipulated"])):e(I).view==="date"?(r(),S(zr,{key:2,"absence-to-edit-or-create":e(Oe),"onUpdate:absenceToEditOrCreate":s[22]||(s[22]=E=>rt(Oe)?Oe.value=E:null),user:e(K),data:e(ct)[0],"target-sum":e(vt),"working-time-model":e(fe),onSubmit:s[23]||(s[23]=E=>pe(E)),onUnsubmit:s[24]||(s[24]=E=>e(Ba)(E)),onApprove:s[25]||(s[25]=E=>e($t)(E)),onDecline:s[26]||(s[26]=E=>Je(E))},null,8,["absence-to-edit-or-create","user","data","target-sum","working-time-model"])):b("",!0)],64)):b("",!0),_("div",ei,[n(H,{onClick:xn},{default:a(()=>[n(C,{icon:"download",class:"mr-2"}),U(" "+c(e(t)("timeSheets.csvExport")),1)]),_:1})]),!o.hideTimeTrackingPanel&&e(K)&&e(K)?.uuid===e(P)?.uuid?(r(),B("div",{key:2,ref_key:"containerTimeTracking",ref:Ua,class:"fixed bottom-0 left-[--artesa-sidebar-width] right-0 bg-white p-2 z-10"},[n(fi,{"hide-time-sheet-button":!0})],512)):b("",!0),e(Qe)?(r(),S(de,{key:3,"model-value":!!e(Qe),width:"95%",class:"max-w-lg",title:e(t)("timeSheets.confirmDecline.dialogTitle"),"onUpdate:modelValue":Je},{footer:a(()=>[n(H,{class:"mr-2",text:"",onClick:s[29]||(s[29]=()=>Je(!1))},{default:a(()=>[U(c(e(t)("actions.Cancel")),1)]),_:1}),e(Qe)?(r(),S(H,{key:0,type:"danger",disabled:!e(ut),onClick:Oa},{default:a(()=>[U(c(e(t)("actions.Decline")),1)]),_:1},8,["disabled"])):b("",!0)]),default:a(()=>[_("div",ti,c(e(t)("timeSheets.confirmDecline.dialogQuestion")),1),n(e(un),{ref_key:"refDeclineInput",ref:Zt,modelValue:e(ut),"onUpdate:modelValue":s[27]||(s[27]=E=>rt(ut)?ut.value=E:null),onBlur:In,onKeydown:s[28]||(s[28]=Cs(ca(()=>Oa(),["prevent"]),["enter"]))},null,8,["modelValue"])]),_:1},8,["model-value","title"])):b("",!0),e(te)?(r(),S(de,{key:4,"model-value":!!e(te),width:"95%",class:"max-w-lg",title:e(t)("timeSheets.confirmSubmit.dialogTitle"),"onUpdate:modelValue":pe},{footer:a(()=>[n(H,{class:"mr-2",text:"",onClick:s[30]||(s[30]=()=>pe(!1))},{default:a(()=>[U(c(e(t)("actions.Cancel")),1)]),_:1}),e(te)?(r(),S(H,{key:0,type:"primary",icon:e(Pt),onClick:ue},{default:a(()=>[U(c(e(t)("timeSheets.Submit")),1)]),_:1},8,["icon"])):b("",!0)]),default:a(()=>[_("div",ai,c(e(t)("timeSheets.confirmSubmit.dialogQuestion")),1),_("div",null,c(e(t)("timeSheets.confirmSubmit.dialogExplanation")),1)]),_:1},8,["model-value","title"])):b("",!0),e(Oe)?(r(),S(e(ni),{key:5,modelValue:e(ta),"onUpdate:modelValue":s[31]||(s[31]=E=>rt(ta)?ta.value=E:null),absence:e(Oe),draftable:"","fix-user":""},null,8,["modelValue","absence"])):b("",!0)],4)),[[re,!e(ct),void 0,{fullscreen:!0,lock:!0}]])}}}),oi={class:"flex rounded-full border border-gray-300 h-[58px]"},ri={key:0,class:"text-xs text-gray-500 truncate"},ii={key:1,class:"text-xs text-gray-500 truncate"},li={key:2,class:"text-sm truncate"},di={class:"ml-1"},ui={key:3,class:"text-sm truncate"},ci={key:4,class:"text-sm truncate"},mi={class:"min-h-[85dvh]"},pi={class:"dialog-footer"},fi=Le({__name:"TimeTrackingPanel",props:{modelValue:{type:Boolean,default:!1},eventTypeId:{default:void 0},hideTimeSheetButton:{type:Boolean,default:!1}},setup(v){const{t:T}=We(),t=gn(),P=hs().createScope(),m=ft(),g=pn(!1),{data:y}=P.useFind({params:u(()=>m.value?{query:{companyId:m.value,deactivatedAt:null,$limit:100,$sort:{order:1}}}:null)});return(h,p)=>{const F=tt("font-awesome-icon"),k=lt,$=cn,f=Qt,M=Gt,A=Kt,Z=Yt;return r(),B("div",oi,[h.hideTimeSheetButton?b("",!0):(r(),S(oe,{key:0,content:e(T)("settings.tab.timeSheets")},{default:a(()=>[n(k,{size:"large",circle:"",class:"ml-2 my-2",onClick:p[0]||(p[0]=L=>g.value=!0)},{default:a(()=>[n(F,{icon:"business-time"})]),_:1})]),_:1},8,["content"])),_("div",{class:Te(["flex-1 w-0 flex flex-col justify-center",[h.hideTimeSheetButton?"ml-5":"ml-2"]])},[e(t).firstStartOfToday?(r(),B("div",ri,c(e(T)("tracking.time.startedTodayAt",{time:e(Ft)(e(t).firstStartOfToday,"HH:mm")})),1)):(r(),B("div",ii,c(e(T)("tracking.time.notCheckedInToday")),1)),e(t).isActiveWork?(r(),B("div",li,[n(F,{icon:"play",class:"text-xs animate-blink-50 animation-duration-2000 mr-2"}),e(t).activeUnaccountablePeriodForUser?(r(),B(me,{key:0},[_("span",null,c(e(t).activeUnaccountablePeriodForUser.type?.name),1),_("span",di,c(e(T)("since"))+" "+c(e(t).activeUnaccountableSince),1)],64)):(r(),B(me,{key:1},[U(c(e(t).activeWorkPeriods.length)+" "+c(e(T)("assignment.name",e(t).activeWorkPeriods.length))+" "+c(e(T)("since"))+" "+c(e(t).activeWorkSince),1)],64))])):e(t).isPaused?(r(),B("div",ui,[n(F,{icon:"pause",class:"text-xs animate-blink-50 animation-duration-2000 mr-2"}),U(" "+c(e(t).pausedWorkPeriods.length)+" "+c(e(T)("assignment.name",e(t).pausedWorkPeriods.length))+" "+c(e(T)("tracking.time.inPauseSince",{since:e(t).inPauseSince})),1)])):!e(t).hasWorkPeriods&&e(t).firstStartOfToday?(r(),B("div",ci,c(e(T)("tracking.time.notCheckedInSince",{since:e(t).lastWorkSince})),1)):b("",!0)],2),e(t).isPaused?(r(),S($,{key:1,class:"mr-2 my-2"},{default:a(()=>[n(k,{type:"primary",size:"large",circle:"",onClick:p[1]||(p[1]=L=>e(t).resumeWorkPeriods())},{default:a(()=>[n(F,{icon:"play"})]),_:1}),n(k,{type:"primary",size:"large",circle:"",onClick:p[2]||(p[2]=L=>e(t).stopWorkPeriods())},{default:a(()=>[n(F,{icon:"stop"})]),_:1})]),_:1})):!e(t).isActiveWork&&e(y).length>1?(r(),S(A,{key:2,trigger:"click",placement:"top-end",onCommand:p[3]||(p[3]=L=>e(t).startUnaccountablePeriod(L,{eventTypeId:h.eventTypeId}))},{dropdown:a(()=>[n(M,null,{default:a(()=>[(r(!0),B(me,null,Ke(e(y),L=>(r(),S(f,{key:L.uuid,command:L},{default:a(()=>[U(c(L.name),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:a(()=>[n(k,{type:"primary",size:"large",circle:"",class:"mr-2 my-2"},{default:a(()=>[n(F,{icon:"play"})]),_:1})]),_:1})):!e(t).isActiveWork&&e(y).length===1?(r(),S(k,{key:3,type:"primary",size:"large",circle:"",class:"mr-2 my-2",onClick:p[4]||(p[4]=L=>e(t).startUnaccountablePeriod(e(y).at(0),{eventTypeId:h.eventTypeId}))},{default:a(()=>[n(F,{icon:"play"})]),_:1})):e(t).isActiveWork?(r(),S($,{key:4,class:"mr-2 my-2"},{default:a(()=>[e(t).hasActiveWorkPeriod?(r(),S(k,{key:0,type:"default",size:"large",circle:"",onClick:p[5]||(p[5]=()=>e(t).pauseWorkPeriods())},{default:a(()=>[n(F,{icon:"pause"})]),_:1})):b("",!0),e(t).isActiveWork?(r(),S(k,{key:1,type:"primary",size:"large",circle:"",onClick:p[6]||(p[6]=()=>e(t).stopAll())},{default:a(()=>[n(F,{icon:"stop"})]),_:1})):b("",!0)]),_:1})):b("",!0),!h.hideTimeSheetButton&&e(g)?(r(),S(Z,{key:5,modelValue:e(g),"onUpdate:modelValue":p[8]||(p[8]=L=>rt(g)?g.value=L:null),width:"98%","align-center":"","append-to-body":""},{footer:a(()=>[_("div",pi,[n(k,{type:"primary",onClick:p[7]||(p[7]=L=>g.value=!1)},{default:a(()=>[U(c(e(T)("actions.Close")),1)]),_:1})])]),default:a(()=>[_("div",mi,[n(si,{standalone:"","hide-time-tracking-panel":""})])]),_:1},8,["modelValue"])):b("",!0)])}}});export{fi as _,Mr as a,si as b,Cr as u};
