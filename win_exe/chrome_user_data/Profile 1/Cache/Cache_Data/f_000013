import{a as Q,r as j,fj as ze,Z as T,Y as It,o as r,e as f,f as l,g as m,aD as De,eo as xt,c as e,fk as Pt,ek as Tt,$ as he,fl as Ut,w as et,V as fe,b as de,h as s,aC as S,e6 as Te,aj as ne,j as V,l as me,ep as Ue,eq as je,i as x,t as u,er as Oe,u as ie,eh as Se,ei as $e,fm as tt,e0 as be,fa as nt,ev as jt,e5 as L,f1 as Ot,X as He,aP as Bt,aU as Ft,aO as Rt,fn as Nt,k as J,fo as Gt,fp as Mt,e$ as qt,e_ as zt,e1 as Ve,e2 as Ee,m as at,eA as Ht,aS as Wt,f4 as Kt,fh as st,fq as ot,f3 as lt,fr as rt,fs as dt,ec as Lt,a3 as Yt,ai as Qt,aE as Zt,s as Xt,eZ as Jt,W as en,eM as tn}from"./vendor-CJXdOFCa.js";import{_ as nn,D as We}from"./DropdownAssignmentEventGroupType.vue_vue_type_script_setup_true_lang-CSQmcDIy.js";import{u as it}from"./useCompanySettingValue-DJ6odCGL.js";import{O as ut,a6 as an,a7 as sn,a8 as on,P as mt,a9 as ln,aa as rn,a3 as dn,C as un,a as Be,ab as Ce,Z as mn,w as cn,e as Fe,N as ct,G as pn,h as vn,ac as Ke,l as Re,W as fn,V as yn,Q as gn}from"./index-M8nwXBBi.js";import{c as hn,u as bn,r as ye,a as Ie,b as ge}from"./assignment-events.helpers-DEIAJbEv.js";import{_ as pt}from"./DropdownAssignmentEventType.vue_vue_type_script_setup_true_lang-BMxji8cl.js";import{u as wn}from"./hasItemsForCompany.store-D65GIO8M.js";import{_ as kn,u as _n,a as An}from"./AddressMap.vue_vue_type_script_setup_true_lang-DupxI1iS.js";import{_ as vt}from"./InputGoogleAutocomplete.vue_vue_type_script_setup_true_lang-L1WIzGgK.js";import{_ as xe,s as Le}from"./ArtesaTimeInput.vue_vue_type_style_index_0_lang-CQRpcmmu.js";import{a as Ye}from"./index-WYyZsZxJ.js";import{_ as Ae}from"./ArtesaDatePicker.vue_vue_type_style_index_0_lang-CcrFwhau.js";import{A as ve}from"./ArtesaTooltip-CzaCLuSr.js";import{_ as Dn}from"./ElTextareaAutosize.vue_vue_type_script_setup_true_lang-D7GYU17H.js";import{_ as Vn}from"./AssignmentEventName.vue_vue_type_script_setup_true_lang-BrVc5Ffk.js";import{u as En,_ as Qe}from"./ChangeEventUsers.vue_vue_type_script_setup_true_lang-DgRvO8Or.js";import{_ as Sn}from"./PopperFeathersItems.vue_vue_type_script_setup_true_lang-hljKYvsA.js";import{u as $n,a as Cn}from"./gang-capabilities.store-Q4J3ULDu.js";import{a as In}from"./MakeSortable.vue_vue_type_script_setup_true_lang-DJUGCLh6.js";import{u as ft}from"./useContainerQuery-odtNFs_8.js";import{a as xn}from"./index-CgnmzLwJ.js";import{_ as Pn}from"./SelectProject.vue_vue_type_script_setup_true_lang-acfywV1j.js";import{_ as Tn}from"./SelectUser.vue_vue_type_script_setup_true_lang-81euLzTY.js";import{_ as Un}from"./SelectAssignmentType.vue_vue_type_script_setup_true_lang-DsFYchPC.js";import{_ as Ze}from"./AssignmentStatusTag.vue_vue_type_script_setup_true_lang-CH4KFZTO.js";import{_ as jn}from"./FeathersTablePagination.vue_vue_type_style_index_0_lang-DDfA-nHC.js";import{_ as pe}from"./GridTableColumn.vue_vue_type_script_setup_true_lang-BayDfMSt.js";import{_ as On}from"./AddressForm.vue_vue_type_script_setup_true_lang-DzNRvAmP.js";const Bn=Q({__name:"StickyContent",props:{tag:{type:String,default:"div"},top:{type:Number,default:0},bottom:{type:Number,default:0}},setup(c){const i=c,o=j(),n=j(),{y:C,bottom:a,height:b}=ze(o,{windowResize:!0,windowScroll:!0}),{height:A}=ze(n,{windowResize:!0,windowScroll:!0}),E=T(()=>{const w=C.value;if(w-i.top>0)return 0;let P=-w+i.top;return A.value+i.top+i.bottom>a.value&&(P=b.value-A.value-i.bottom-i.top),P<0?0:P});It(E,()=>{k.value.transform=`translateY(${E.value}px)`},{debounce:10,maxWait:20});const k=j({transform:"translateY(0px)"});return(w,P)=>(r(),f(Tt(c.tag),Pt({ref_key:"container",ref:o},w.$attrs),{default:l(()=>[m("div",{ref_key:"child",ref:n,class:"transition-transform",style:xt(e(k))},[De(w.$slots,"default")],4)]),_:3},16))}});function Fn(c){return ut().createScope().construct({companyId:c.companyId,typeId:c.groupTypeId,order:c.order})}async function Rn(c){const i=an().createScope(),o=sn().createScope(),n=on().createScope(),C=mt().createScope(),{assignment:a,user:b,standardProcess:A}=c,[E]=it("addressId"),[k,w,P]=await Promise.all([i.find({query:{companyId:a.companyId,standardProcessId:A.id,$limit:100,$sort:{order:1,id:1}}}).then(y=>y.data),o.find({query:{companyId:a.companyId,standardProcessId:A.id,$limit:100,$sort:{order:1,id:1}},$populateParams:{name:"withTypes"}}).then(y=>y.data),n.find({query:{companyId:a.companyId,standardProcessId:A.id,$limit:500}}).then(y=>y.data)]),_=await Promise.all(k.map(async y=>{const v=Fn(y);return v.assignment=a,v.order=(v.order??0)+c.startOrder,await he(),{group:v,groupSetting:y}}));return{events:await Promise.all(w.map(y=>{const v=hn(y);v.order=(v.order??0)+c.startOrder;const O=y.groupId&&_.find(p=>p.groupSetting.uuid===y.groupUuid);O&&(v.group=O.group),v.assignment=a,v.manPower=y.workDays*y.workingTimePerDay*y.employeeCount,y.isOutward?(v.durationDriveFromStart=null,v.durationDriveReturnTo=null,v.addressDestination=a.addressProperty,v.addressStartFromId=E.value,v.addressReturnToId=E.value):(v.durationDriveFromStart=0,v.durationDriveReturnTo=0);const U=P.filter(p=>p.eventUuid===y.uuid);for(const p of U)C.construct({name:p.name,order:p.order,event:v,assignment:v.assignment,company:v.company,createdBy:b});return v})),groups:_.map(y=>y.group),eventSettings:w,groupSettings:k}}const Nn=Q({__name:"DropdownAssignmentEventStandardProcess",props:{type:{type:String,default:void 0},size:Ut,disabled:{type:Boolean,default:!1},companyId:{type:Number,required:!0},loading:{type:Boolean,default:!1}},emits:["changed"],setup(c,{emit:i}){const o=c,n=i,C=ln().createScope(),a=wn().useHasItems("assignment-event-standard-processes"),b=T(()=>({query:{companyId:o.companyId,$sort:{order:1},$limit:100}})),{data:A,fetch:E}=C.useFind({params:b,localOnly:!0});function k(){E(),P.value=!1}const w=j(!1),P=j(!0);return et(()=>w.value&&P.value,()=>{k()}),fe(b,()=>{if(!w.value){P.value=!0;return}k()}),(_,$)=>{const y=de("font-awesome-icon"),v=me,O=Oe,U=Ue,p=je;return e(a)?(r(),f(p,{key:0,onCommand:$[0]||($[0]=N=>n("changed",N)),onVisibleChange:$[1]||($[1]=N=>w.value=N)},{dropdown:l(()=>[s(U,null,{default:l(()=>[(r(!0),S(ne,null,Te(e(A),N=>(r(),f(O,{key:N.uuid,command:N},{default:l(()=>[x(u(N.name),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:l(()=>[s(v,{size:c.size,disabled:c.disabled,loading:c.loading,type:c.type},{default:l(()=>[De(_.$slots,"default",{},()=>[s(y,{icon:"plus"})])]),_:3},8,["size","disabled","loading","type"])]),_:3})):V("",!0)}}}),Gn={class:"@container"},Mn={key:0,class:"flex justify-between"},qn={class:"font-bold"},zn={class:"ml-1"},Hn={key:1,class:"px-2 pb-2"},Wn={class:"flex mt-2"},Kn={class:"px-3 pt-2 pb-3 border-gray-300 border-t-2"},Ln={class:"px-2 pb-1 text-sm"},Yn=Q({__name:"EditAssignmentEventGroup",props:{assignment:{type:Object,required:!0},group:{type:[Object],required:!0},events:{type:Array,required:!0},expandByDefault:{type:Boolean,default:!1},hideNotes:{type:Boolean,default:!1}},emits:["add-event","remove-group"],setup(c,{emit:i}){const{t:o}=ie(),n=c,C=T(()=>({query:{defaultGroupTypeId:{$in:[null,n.group.typeId]}}})),a=i,b=j(!n.expandByDefault),A=j(!b.value);function E(){b.value=!b.value,!A.value&&!b.value&&(A.value=!0)}const k=T(()=>n.events.length?nt(n.events,"order")?.order||0:n.group.order||0);function w($){a("add-event",$,{group:n.group,order:k.value+.5})}const P=j(!1);async function _(){if(n.group)try{const $=n.group?.type?.name?`"${n.group.type?.name}"`:"";await tt.confirm(n.events.length?o("assignmentEventGroup.form.doYouWantToDeleteTheGroupAndEvents",{name:$}):o("assignmentEventGroup.form.doYouWantToDeleteTheGroup",{name:$}),"",{confirmButtonText:o("actions.Delete"),cancelButtonText:o("actions.Cancel"),type:"warning",confirmButtonClass:"el-button--danger"}),a("remove-group",n.group,n.events)}catch{}}return($,y)=>{const v=de("font-awesome-icon"),O=me,U=be;return Se((r(),S("div",Gn,[c.group?(r(),S("div",Mn,[s(O,{class:"flex-1 flex !justify-start !pl-2 pr-4 py-3 text-left drag-handle",text:"",onClick:E},{default:l(()=>[s(v,{icon:"angle-right",rotation:e(b)?void 0:"90",class:"mr-2 transition-all","fixed-width":""},null,8,["rotation"]),m("span",qn,[c.group?(r(),S(ne,{key:0},[x(u(c.group.type&&c.group.type.name),1)],64)):V("",!0)]),m("span",zn,"("+u(c.events.length)+")",1)]),_:1}),s(O,{text:"",class:"px-4 py-2.5",onClick:_},{default:l(()=>[s(v,{icon:"times"})]),_:1})])):V("",!0),e(A)?Se((r(),S("div",Hn,[De($.$slots,"default"),m("div",Wn,[s(pt,{trigger:"click",type:"primary",params:e(C),"company-id":c.assignment.companyId,"onUpdate:modelValue":w},{default:l(()=>[x(u(e(o)("assignmentEvent.name",1))+" ",1),s(v,{icon:"plus",class:"ml-1 text-xs"})]),_:1},8,["params","company-id"])])],512)),[[$e,!e(b)]]):V("",!0),Se(m("div",Kn,[m("div",Ln,u(e(o)("assignmentEventGroup.form.annotationsForGroup",{name:c.group.type?.name}))+": ",1),s(U,{modelValue:c.group.note,"onUpdate:modelValue":y[0]||(y[0]=p=>c.group.note=p),rows:c.group.note?2:1,type:"textarea",placeholder:e(o)("assignmentEventGroup.form.annotationPlaceholder")},null,8,["modelValue","rows","placeholder"])],512),[[$e,!e(b)&&!c.hideNotes]])],512)),[[$e,!e(P)]])}}}),Qn={class:"flex flex-wrap items-center gap-2"},Zn={class:"group relative p-1"},Xn=["onClick"],Jn=["onClick"],ea={class:"text-sm leading-tight"},ta={class:"text-xs text-gray-500 leading-tight truncate"},na=Q({__name:"ChangeGangEvent",props:{event:{type:Object,required:!0},local:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},emits:["added","removed"],setup(c,{emit:i}){const o=c,n=i,C=j(),{t:a}=ie(),b=rn().createScope(),A=dn().createScope(),{data:E,markForRemove:k}=A.useFeathersItems({params:T(()=>({query:{eventUuid:o.event.uuid,$sort:{order:1}}})),fetchParams:T(()=>o.event.id?{query:{eventId:o.event.id,$sort:{order:1},$limit:-1}}:null),localOnly:o.local}),{usersByGangUuid:w}=$n(),P=T(()=>E.value.map(p=>p.gang).filter(un)),_=T(()=>P.value.map(p=>p.id)),$=T(()=>({query:{id:{$nin:_.value},deactivatedAt:null,$limit:20,$sort:{order:1}}})),y=T(()=>({query:{deactivatedAt:null,$limit:20,$sort:{order:1}}})),v=T(()=>nt(E.value,"order")?.order??0);async function O(p){A.construct({companyId:p.companyId,gang:p,event:o.event,order:v.value+1}),await he(),n("added",{gang:p,gangEvents:E.value,users:w.value[p.uuid]??[]})}async function U(p){k(p),await he(),n("removed",{gangEvent:p,gangEvents:E.value,users:w.value[p.gangUuid]??[]})}return(p,N)=>{const ee=de("font-awesome-icon"),ae=me;return r(),S("div",Qn,[(r(!0),S(ne,null,Te(e(E),H=>(r(),f(ve,{key:H.uuid,disabled:!e(w)[H.gangUuid]?.length,content:(e(w)[H.gangUuid]??[]).map(te=>te.shortName||te.fullName).join(", ")},{default:l(()=>[m("div",Zn,[c.readonly?V("",!0):(r(),S("div",{key:0,class:"hidden group-hover:flex absolute w-4 h-4 bg-red-700 rounded-full -right-1.5 -top-1.5 items-center justify-center cursor-pointer text-white",onClick:()=>!c.readonly&&U(H)},[s(e(jt),{class:"w-3 h-3"})],8,Xn)),x(" "+u(H.gang?.name),1)])]),_:2},1032,["disabled","content"]))),128)),s(Sn,{ref_key:"refPopper",ref:C,store:e(b),params:e($),"fetch-params":e(y),readonly:c.readonly,"search-field":"name","use-search":"","prepend-search":"","append-search":"","use-search-on-server":"","hide-on-select":"","onUpdate:modelValue":O},{default:l(({show:H})=>[e(E).length?V("",!0):(r(),S("span",{key:0,class:"mr-1 text-gray-500 cursor-pointer",onClick:()=>H()},u(e(a)("gang-events.add")),9,Jn)),s(ae,{circle:"",type:"primary",class:"!w-[30px] !h-[30px] my-1 mr-1",onClick:()=>H()},{default:l(()=>[s(ee,{icon:"users",class:"ml-0.5 w-4 h-4"})]),_:2},1032,["onClick"])]),item:l(({item:H})=>[m("div",ea,u(H.name),1),m("div",ta,u((e(w)[H.uuid]??[]).map(te=>te.shortName||te.fullName).join(", ")),1)]),_:1},8,["store","params","fetch-params","readonly"])])}}}),aa=Q({__name:"AssignmentEventStatusTag",props:{value:{type:Object,required:!0},readOnly:{type:Boolean,default:!1}},setup(c){const{t:i}=ie(),o=c,n=Be(),C=j(!1),a=T(()=>o.value.completedAt?i("assignmentEventStatus.done"):o.value.confirmedAt?i("assignmentEventStatus.planned"):i("assignmentEventStatus.draft")),b=T(()=>o.value.completedAt?"success":o.value.confirmedAt?"info":"warning"),A=T(()=>{if(o.value.completedAt)return i("assignmentEventStatus.tooltip.completedAt",{date:Ce(o.value.completedAt??new Date)});if(o.value.startsAt){const w=mn(o.value.startsAt,o.value.endsAt,{isAllDay:o.value.isAllDay});return i("assignmentEventStatus.tooltip.startsAt",{date:w})}else return o.value.confirmedAt?i("assignmentEventStatus.tooltip.confirmedAt",{date:Ce(o.value.confirmedAt??new Date)}):o.value.createdAt?i("assignmentEventStatus.tooltip.createdAt",{date:Ce(o.value.createdAt)}):""}),E=T(()=>!A.value);function k(w){w==="new"?(o.value.confirmedAt=null,o.value.confirmedById=null,o.value.completedAt=null,o.value.completedById=null):w==="confirmed"?(o.value.confirmedAt||(o.value.confirmedAt=new Date,o.value.confirmedById=n.value?.id??null),o.value.completedAt=null,o.value.completedById=null):w==="completed"&&(o.value.confirmedAt||(o.value.confirmedAt=new Date,o.value.confirmedById=n.value?.id??null),o.value.completedAt||(o.value.completedAt=new Date,o.value.completedById=n.value?.id??null))}return(w,P)=>{const _=de("font-awesome-icon"),$=Ot,y=ve,v=Oe,O=Ue,U=je;return r(),f(U,{trigger:"click",disabled:c.readOnly,onCommand:k,onVisibleChange:P[0]||(P[0]=p=>C.value=p)},{dropdown:l(()=>[c.readOnly?V("",!0):(r(),f(O,{key:0},{default:l(()=>[s(v,{disabled:e(a)==="Entwurf",command:"new"},{default:l(()=>[x(u(w.$t("timeSheets.draft")),1)]),_:1},8,["disabled"]),s(v,{disabled:e(a)==="geplant",command:"confirmed"},{default:l(()=>[x(u(w.$t("assignmentEventStatus.planned")),1)]),_:1},8,["disabled"]),s(v,{disabled:e(a)==="fertig",command:"completed"},{default:l(()=>[x(u(w.$t("assignmentEventStatus.done")),1)]),_:1},8,["disabled"])]),_:1}))]),default:l(()=>[m("div",null,[s(y,{effect:"dark",disabled:e(E)||e(C),content:e(A),placement:"top"},{default:l(()=>[s($,{type:e(b),size:"default",effect:"dark",class:L([c.readOnly?"cursor-auto":"cursor-pointer"])},{default:l(()=>[x(u(e(a))+" ",1),c.readOnly?V("",!0):(r(),f(_,{key:0,icon:"angle-down",class:"text-xs"}))]),_:1},8,["type","class"])]),_:1},8,["disabled","content"])])]),_:1},8,["disabled"])}}}),Xe=(c,i)=>T(()=>{const o=He(c);if(!o)return"";const n=He(i?.dateToCompare)||new Date,{showAlwaysTime:C=!1}=i||{};let a="";return Bt(o,n)?a="HH:mm":Ft(o,n)?a=C?"dd.MM. HH:mm":"dd.MM.":a=C?"dd.MM.yy HH:mm":"dd.MM.yy",Rt(o,a)});async function Je(c,i){return(await cn.service("maps/durations").find({query:{origin:c,destination:i}}))?.duration||0}const sa={class:"flex items-center bg-white mb-1 pr-2 rounded outline outline-2 outline-gray-100"},oa={class:"flex mb-1 items-stretch"},la={class:"flex-1 flex outline outline-2 outline-gray-100"},ra={class:"flex flex-col items-center bg-white rounded px-1 pb-1"},da={class:"text-gray-400 text-xs"},ia={class:"flex flex-col items-center ml-1 bg-white rounded px-1 pb-1"},ua={class:"text-gray-400 text-xs"},ma={class:"flex flex-col items-center ml-1 bg-white rounded px-1 pb-1"},ca={class:"text-gray-400 text-xs"},pa={key:0,class:"flex flex-col items-center ml-1 bg-white rounded pb-1"},va={class:"text-gray-400 text-xs px-1"},fa={key:0},ya={class:"text-gray-500 text-sm"},ga={class:"bg-white rounded p-2 mb-1 outline outline-2 outline-gray-100"},ha={key:0,class:"flex justify-between items-center mb-2"},ba={class:"flex items-center"},wa={class:"text-gray-500"},ka={key:1,class:"flex items-center mb-2"},_a={class:"flex-1"},Aa={key:0},Da={class:"font-semibold"},Va={class:"flex items-center"},Ea={class:"flex items-center"},Sa={class:"flex-1"},$a={class:"flex items-center mb-2"},Ca={class:"flex items-center"},Ia={key:2,class:"flex items-center mt-2"},xa={class:"flex items-center"},Pa={key:0},Ta={class:"font-semibold"},Ua={class:"text-gray-500 text-sm"},ja={class:"bg-white rounded p-2 mb-1 outline outline-2 outline-gray-100"},Oa={class:"flex items-center bg-white rounded p-2 mb-1 outline outline-2 outline-gray-100"},Ba={class:"text-gray-500 mr-1 text-sm"},Fa={class:"flex-1"},Ra={class:"flex"},Na={class:"text-gray-500"},Ga={key:0,class:"flex text-right"},Ma={class:"w-20 text-right mr-1"},qa={class:"text-gray-500"},za={key:1,class:"flex"},Ha={class:"w-20 text-right mr-1"},Wa={class:"text-gray-500"},Ka={class:"flex gap-1"},La={class:"w-0 flex-1 flex flex-col"},Ya={class:"text-gray-500 text-sm"},Qa={class:"flex-1 bg-white rounded p-2 mb-1 outline outline-2 outline-gray-100"},Za={class:"w-0 flex-1 flex flex-col"},Xa={class:"text-gray-500 text-sm"},Ja={class:"flex-1 bg-white rounded p-2 mb-1 outline outline-2 outline-gray-100"},es={class:"text-xs text-gray-500 italic"},ts={class:"text-sm"},ns={class:"bg-white rounded mb-1 outline outline-2 outline-gray-100"},as={class:"text-sm"},ss={class:"flex justify-center"},os={class:"flex justify-between mt-2"},ls=m("div",null,null,-1),rs={key:1,class:"flex-1 flex items-center justify-center text-gray-500"},ds={class:"flex justify-end"},Pe=Q({__name:"AssignmentEventForm",props:{event:{},tasks:{},size:{default:void 0},draggable:{type:Boolean,default:!1},short:{type:Boolean,default:!1},expandable:{type:Boolean,default:!1},expandByDefault:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},emits:["click-title","remove","remove-task"],setup(c,{expose:i,emit:o}){const n=c,C=Fe(),{t:a}=ie(),b=Cn(),A=j(n.short&&!n.expandByDefault);fe(()=>n.expandable,t=>{t||(A.value=!0)});const E=o,k=Nt(),w=T({get(){return parseFloat((n.event.manPower/3600).toFixed(2))},set(t){const d=t*3600;if(d===n.event.manPower)return;n.event.manPower=d;let h;!N.value||!se.value?h=1:h=Math.ceil(d/N.value/se.value),v.value=Math.max(h,1)}}),P=T(()=>{const d=(n.event.manPowerDrive||0)/3600;return parseFloat(d.toFixed(2))}),_=T(()=>{const d=((n.event.manPower||0)+(n.event.manPowerDrive||0))/3600;return parseFloat(d.toFixed(2))});async function $(t){if(!U.value){n.event.startsAt=t;return}if(!(!n.event.startsAt&&!t)){if(!t){n.event.startsAt=null,n.event.endsAt=null,n.event.days=null;return}await ye(n.event,{direction:"forward",date:t,mutateEvent:!0})}}async function y(t){if(U.value){n.event.endsAt=t;return}if(!(!n.event.endsAt&&!t)){if(!t){n.event.startsAt=null,n.event.endsAt=null,n.event.days=null;return}await ye(n.event,{direction:"backward",date:t,mutateEvent:!0})}}const v=T({get(){return n.event.workDays},async set(t){if(t!==n.event.workDays&&(n.event.workDays=t,Ie(n.event),ge(n.event),v.value<=1&&(le.value=null),n.event.startsAt&&n.event.endsAt)){const{startsAt:d,endsAt:h}=n.event;await ye(n.event,{direction:p.value,date:p.value==="forward"?d:h,mutateEvent:!0})}}});T(()=>{if(n.event.startsAt)return Wt(n.event.startsAt)});const O=T({get(){return n.event.isAllDay},async set(t){if(n.event.isAllDay=t,t)n.event.startsAt&&(n.event.startsAt=Le(n.event.startsAt,{hours:0,minutes:0,seconds:0})),n.event.endsAt&&(n.event.endsAt=Le(n.event.endsAt,{hours:23,minutes:59,seconds:59}));else{if(n.event.startsAt&&n.event.startsAtDefaultTime){const ce=n.event.startsAtDefaultTime.split(":");if([2,3].includes(ce.length)){const re=parseInt(ce[0]),G=parseInt(ce[1]);(re>=0||re<=23||G>=0||G<=59)&&(re.toString().padStart(2,"0"),G.toString().padStart(2,"0"),n.event.startsAt.setHours(re,G))}}const{startsAt:d,endsAt:h}=n.event;!O.value&&(p.value==="forward"&&d||p.value==="backward"&&h)&&await ye(n.event,{direction:p.value,date:p.value==="forward"?d:h,mutateEvent:!0})}}}),U=T({get(){return n.event.dateAnchor!=="endsAt"},set(t){n.event.dateAnchor=t?"startsAt":"endsAt"}}),p=T(()=>U.value?"forward":"backward"),N=T({get(){return n.event.workingTimePerDay},async set(t){if(t===n.event.workingTimePerDay)return;n.event.workingTimePerDay=t,Ie(n.event);const{startsAt:d,endsAt:h}=n.event;!O.value&&(p.value==="forward"&&d||p.value==="backward"&&h)&&await ye(n.event,{direction:p.value,date:p.value==="forward"?d:h,mutateEvent:!0})}}),ee=T({get(){return n.event.durationDriveFromStart},set(t){t!==n.event.durationDriveFromStart&&(n.event.durationDriveFromStart=t,ge(n.event))}}),ae=T({get(){return n.event.durationDriveReturnTo},set(t){t!==n.event.durationDriveReturnTo&&(n.event.durationDriveReturnTo=t,ge(n.event))}}),H=Xe(()=>n.event.isOutward&&n.event.startsAt&&n.event.durationDriveFromStart?Ye(n.event.startsAt,-n.event.durationDriveFromStart):null,{dateToCompare:()=>n.event.startsAt}),te=Xe(()=>n.event.isOutward&&n.event.endsAt&&n.event.durationDriveReturnTo?Ye(n.event.endsAt,n.event.durationDriveReturnTo):null,{dateToCompare:()=>n.event.endsAt}),se=T({get(){return n.event.plannedEmployeeCount},set(t){t!==n.event.plannedEmployeeCount&&(n.event.plannedEmployeeCount=t,Ie(n.event),ge(n.event))}}),[K]=it("addressId"),W=j(!1),R=j(null),X=j(null),g=T({get(){return!!n.event.isOutward},async set(t){t!==n.event.isOutward&&(n.event.isOutward=t,t||(le.value=null),t&&(n.event.addressStartFromId||(n.event.addressStartFromId=K.value),n.event.addressReturnToId||(n.event.addressReturnToId=K.value),n.event.addressDestinationId||(n.event.addressDestination=n.event.assignment?.addressProperty||null),n.event.durationDriveFromStart||(ee.value=1*60*60),n.event.durationDriveReturnTo||(ae.value=1*60*60),await Promise.all([oe(),ue()])),ge(n.event))}});async function I({id:t,idKey:d}){t!=="new"?n.event[d]=t:(X.value=d,W.value=!0)}const Y=T(()=>X.value&&{addressStartFromId:"addressStartFrom",addressDestinationId:"addressDestination",addressReturnToId:"addressReturnTo"}[X.value]||null),M=ct().createScope();fe(W,t=>{if(t&&!X.value){W.value=!1;return}if(t){R.value=M.construct({});return}R.value=null,X.value=null});const B=j(!1),F=j(!1),q=T(()=>!!n.event.addressStartFrom?.latitude&&!!n.event.addressStartFrom?.longitude&&!!n.event.addressDestination?.latitude&&!!n.event.addressDestination?.longitude);async function oe(){if(F.value)return;const t=n.event.addressStartFrom,d=n.event.addressDestination;if(!(!t?.latitude||!t.longitude||!d?.latitude||!d.longitude)){F.value=!0;try{const h=await Je({latitude:t.latitude,longitude:t.longitude},{latitude:d.latitude,longitude:d.longitude});ee.value=h}finally{F.value=!1}}}const z=T(()=>!!n.event.addressReturnTo?.latitude&&!!n.event.addressReturnTo?.longitude&&!!n.event.addressDestination?.latitude&&!!n.event.addressDestination?.longitude);async function ue(){if(B.value)return;const t=n.event.addressDestination,d=n.event.addressReturnTo;if(!(!t?.latitude||!t.longitude||!d?.latitude||!d.longitude)){B.value=!0;try{const h=await Je({latitude:t.latitude,longitude:t.longitude},{latitude:d.latitude,longitude:d.longitude});ae.value=h}finally{B.value=!1}}}const le=T({get(){return n.event.bookingDoneAt?"bookingDone":n.event.isOvernightNeeded===!1?"notNecessary":n.event.isOvernightNeeded===!0?"necessary":"automatically"},set(t){n.event.bookingDoneAt=t==="bookingDone"?new Date:null,t?t==="notNecessary"?n.event.isOvernightNeeded=!1:t==="necessary"?n.event.isOvernightNeeded=!0:t==="automatically"&&(n.event.isOvernightNeeded=null):n.event.isOvernightNeeded=!1}});fe(W,t=>{if(t&&!X.value){W.value=!1;return}if(t){R.value=M.construct({});return}R.value=null,X.value=null});function gt(){R.value&&!R.value.id&&(M.resetOrRemove(R.value),R.value=null),W.value=!1}async function ht(){if(!R.value||!X.value){W.value=!1;return}await M.save(R.value),n.event[Y.value]=R.value,n.event[X.value]=R.value.id,W.value=!1}function Ne(){A.value=!A.value}const bt=bn();function Ge(t){return bt(n.event,t,{showNotification:!0})}const Me=Be(),wt=mt().createScope();async function kt(){if(!n.event.company||!Me.value||!n.event.assignment)return;const t=wt.construct({order:n.tasks.length+1});t.event=n.event,t.assignment=n.event.assignment,t.company=n.event.company,t.createdBy=Me.value,await he(),k.value.at(-1)?.focus()}const{addUsers:_t,removeUsers:At}=En({event:()=>n.event,localOnly:!0});return i({toggleCollapse:Ne}),(t,d)=>{const h=de("font-awesome-icon"),ce=be,re=Gt,G=me,qe=Mt,Z=Oe,we=Ue,ke=je,_e=qt,Dt=zt,Vt=me,Et=vt,St=Ve,$t=Ee,Ct=at;return r(),S("div",null,[m("div",sa,[m("div",{class:L(["flex items-center py-2 pl-2 overflow-hidden",{"drag-handle cursor-pointer select-none":t.draggable,"flex-1":e(A)&&!t.event.name}]),onClick:d[0]||(d[0]=D=>E("click-title"))},[t.event.type&&t.event.type.icon?(r(),f(h,{key:0,icon:t.event.type.icon,"fixed-width":"",class:"mr-2"},null,8,["icon"])):V("",!0),s(Vn,{value:t.event,"line-through-on-completed":"","transparent-for-draft":"","hide-custom-name":"",class:"font-bold overflow-hidden text-ellipsis"},null,8,["value"])],2),e(A)&&t.event.name?(r(),f(ce,{key:0,modelValue:t.event.name,"onUpdate:modelValue":d[1]||(d[1]=D=>t.event.name=D),size:"small",placeholder:t.$t("Description"),readonly:t.readonly,disabled:t.readonly,class:"flex-1 inline-edit ml-2"},null,8,["modelValue","placeholder","readonly","disabled"])):e(A)?V("",!0):(r(),f(Dn,{key:1,modelValue:t.event.name,"onUpdate:modelValue":d[2]||(d[2]=D=>t.event.name=D),class:"flex-1 inline-edit ml-2",size:"small",placeholder:t.$t("Description"),readonly:t.readonly,disabled:t.readonly},null,8,["modelValue","placeholder","readonly","disabled"])),e(A)&&e(C).sm?(r(),S(ne,{key:2},[e(U)?(r(),f(Ae,{key:0,"model-value":t.event.startsAt,"date-disabled":!e(U),"time-disabled":!e(U),"show-time":!t.event.isAllDay&&!!t.event.startsAt,size:t.size,"show-default-time":!t.event.isAllDay&&!t.event.startsAt,"default-time":t.event.startsAtDefaultTime,readonly:t.readonly,disabled:t.readonly,class:"my-1 ml-1","onUpdate:modelValue":$,"onUpdate:defaultTime":d[3]||(d[3]=D=>t.event.startsAtDefaultTime=D)},null,8,["model-value","date-disabled","time-disabled","show-time","size","show-default-time","default-time","readonly","disabled"])):(r(),f(Ae,{key:1,"model-value":t.event.endsAt,"date-disabled":e(U),"time-disabled":e(U),"show-time":!t.event.isAllDay,size:t.size,readonly:t.readonly,disabled:t.readonly,class:"my-1 ml-1","onUpdate:modelValue":y},null,8,["model-value","date-disabled","time-disabled","show-time","size","readonly","disabled"]))],64)):V("",!0),s(aa,{value:t.event,"read-only":t.readonly,class:"ml-2"},null,8,["value","read-only"])]),m("div",oa,[m("div",la,[m("div",ra,[s(re,{modelValue:e(se),"onUpdate:modelValue":d[4]||(d[4]=D=>J(se)?se.value=D:null),min:0,style:{width:"40px"},"value-on-clear":0,controls:!1,readonly:t.readonly,disabled:t.readonly,class:"inline-edit"},null,8,["modelValue","readonly","disabled"]),m("div",da,[s(h,{icon:e(se)<=0?"user-slash":e(se)===1?"user":"users",class:"text-xs"},null,8,["icon"])])]),m("div",ia,[s(re,{modelValue:e(v),"onUpdate:modelValue":d[5]||(d[5]=D=>J(v)?v.value=D:null),min:1,style:{width:"38px"},"value-on-clear":1,controls:!1,readonly:t.readonly,disabled:t.readonly,class:"inline-edit"},null,8,["modelValue","readonly","disabled"]),m("div",ua,u(e(a)("Day",e(v))),1)]),m("div",ma,[s(xe,{modelValue:e(N),"onUpdate:modelValue":d[6]||(d[6]=D=>J(N)?N.value=D:null),"value-type":"number",readonly:t.readonly,disabled:t.readonly,class:"inline-edit !w-12"},null,8,["modelValue","readonly","disabled"]),m("div",ca,u(e(a)("assignmentEvent.workingTimePerDay",e(v))),1)]),!e(A)||e(C).sm?(r(),S("div",pa,[s(re,{modelValue:e(w),"onUpdate:modelValue":d[7]||(d[7]=D=>J(w)?w.value=D:null),precision:2,step:1*(t.event.plannedEmployeeCount||1),min:0,"value-on-clear":0,controls:!1,style:{width:"70px"},readonly:t.readonly,disabled:t.readonly,class:"inline-edit"},null,8,["modelValue","step","readonly","disabled"]),m("div",va,u(e(a)("assignmentEvent.effort")),1)])):V("",!0)]),!e(A)&&e(C).sm?(r(),S("div",fa,[s(ve,{content:e(g)?e(a)("assignmentEvent.drive.deactivateDrive"):e(a)("assignmentEvent.drive.activateDrive"),placement:"bottom-end"},{default:l(()=>[s(G,{type:e(g)?"primary":"default",disabled:t.readonly,onClick:d[8]||(d[8]=()=>!t.readonly&&(g.value=!e(g)))},{default:l(()=>[s(h,{icon:"truck","fixed-width":"",class:"text-xs"})]),_:1},8,["type","disabled"])]),_:1},8,["content"])])):e(A)?(r(),f(Qe,{key:1,event:t.event,readonly:t.readonly,class:"flex-1 bg-white rounded ml-1 p-1",onAddUser:d[9]||(d[9]=({eventUsers:D})=>Ge(D.length))},null,8,["event","readonly"])):V("",!0)]),e(A)?V("",!0):(r(),S(ne,{key:0},[m("div",ya,u(e(a)("assignmentEvent.Appointment"))+":",1),m("div",ga,[e(C).xs?V("",!0):(r(),S("div",ha,[m("div",ba,[m("span",wa,u(e(a)("assignmentEvent.time")),1),s(qe,{"model-value":!e(O),disabled:t.readonly,class:"ml-2 mr-1",size:"small","onUpdate:modelValue":d[10]||(d[10]=D=>O.value=!D)},null,8,["model-value","disabled"])]),m("div",null,[s(ve,{content:e(g)?e(a)("assignmentEvent.drive.deactivateDrive"):e(a)("assignmentEvent.drive.activateDrive"),placement:"bottom-end"},{default:l(()=>[s(G,{type:e(g)?"primary":"default",disabled:t.readonly,onClick:d[11]||(d[11]=()=>!t.readonly&&(g.value=!e(g)))},{default:l(()=>[s(h,{icon:"truck","fixed-width":"",class:"text-xs"})]),_:1},8,["type","disabled"])]),_:1},8,["content"])])])),t.event.isOutward?(r(),S("div",ka,[s(h,{icon:"truck",class:"mr-2 text-gray-500 text-xs"}),m("div",_a,[t.event.isOutward&&t.event.durationDriveFromStart&&t.event.startsAt&&!t.event.isAllDay?(r(),S("div",Aa,[m("span",Da,u(e(a)("assignmentEvent.drive.Departure"))+":",1),x(" "+u(e(H)),1)])):V("",!0),m("div",Va,[m("div",null,[s(xe,{modelValue:e(ee),"onUpdate:modelValue":d[12]||(d[12]=D=>J(ee)?ee.value=D:null),readonly:t.readonly,disabled:t.readonly,"value-type":"number"},null,8,["modelValue","readonly","disabled"]),e(q)?(r(),f(G,{key:0,size:"default",disabled:t.readonly,class:"ml-0.5",onClick:d[13]||(d[13]=D=>!t.readonly&&oe())},{default:l(()=>[s(h,{icon:"sync-alt","fixed-width":"",spin:e(F),class:"text-xs"},null,8,["spin"])]),_:1},8,["disabled"])):V("",!0)]),s(ke,{disabled:t.readonly,class:"ml-2",onCommand:I},{dropdown:l(()=>[s(we,null,{default:l(()=>[s(Z,{command:{id:e(K),idKey:"addressStartFromId"}},{default:l(()=>[s(h,{icon:"home",class:"mr-2 text-xs"}),x(" "+u(e(a)("assignmentEvent.drive.company")),1)]),_:1},8,["command"]),t.event.assignment&&t.event.assignment.addressPropertyId?(r(),f(Z,{key:0,command:{id:t.event.assignment.addressPropertyId,idKey:"addressStartFromId"}},{default:l(()=>[s(h,{icon:"map-marker-alt",class:"mr-2 text-xs"}),x(" "+u(e(a)("assignmentEvent.drive.constructionSite")),1)]),_:1},8,["command"])):V("",!0),s(Z,{command:{id:"new",idKey:"addressStartFromId"}},{default:l(()=>[s(h,{icon:"globe-europe",class:"mr-2 text-xs"}),x(" "+u(e(a)("New")),1)]),_:1})]),_:1})]),default:l(()=>[s(G,{text:""},{default:l(()=>[t.event.addressStartFromId===e(K)?(r(),f(h,{key:0,icon:"home","fixed-width":"",class:"text-xs"})):t.event.assignment?.addressPropertyUuid&&t.event.addressStartFromUuid===t.event.assignment.addressPropertyUuid?(r(),f(h,{key:1,icon:"map-marker-alt","fixed-width":"",class:"text-xs"})):t.event.addressStartFromUuid?(r(),f(h,{key:2,icon:"globe-europe","fixed-width":"",class:"text-xs"})):(r(),f(h,{key:3,icon:"question","fixed-width":""}))]),_:1})]),_:1},8,["disabled"]),s(h,{icon:"arrow-right",class:"mx-1 text-xs"}),s(ke,{disabled:t.readonly,onCommand:I},{dropdown:l(()=>[s(we,null,{default:l(()=>[s(Z,{command:{id:e(K),idKey:"addressDestinationId"}},{default:l(()=>[s(h,{icon:"home",class:"mr-2 text-xs"}),x(" "+u(e(a)("assignmentEvent.drive.company")),1)]),_:1},8,["command"]),t.event.assignment&&t.event.assignment.addressPropertyId?(r(),f(Z,{key:0,command:{id:t.event.assignment.addressPropertyId,idKey:"addressDestinationId"}},{default:l(()=>[s(h,{icon:"map-marker-alt",class:"mr-2"}),x(" "+u(e(a)("assignmentEvent.drive.constructionSite")),1)]),_:1},8,["command"])):V("",!0),s(Z,{command:{id:"new",idKey:"addressDestinationId"}},{default:l(()=>[s(h,{icon:"globe-europe",class:"mr-2 text-xs"}),x(" "+u(e(a)("New")),1)]),_:1})]),_:1})]),default:l(()=>[s(G,{text:""},{default:l(()=>[t.event.addressDestinationId===e(K)?(r(),f(h,{key:0,icon:"home","fixed-width":"",class:"text-xs"})):t.event.assignment?.addressPropertyUuid&&t.event.addressDestinationUuid===t.event.assignment.addressPropertyUuid?(r(),f(h,{key:1,icon:"map-marker-alt","fixed-width":"",class:"text-xs"})):t.event.addressDestinationUuid?(r(),f(h,{key:2,icon:"globe-europe","fixed-width":"",class:"text-xs"})):(r(),f(h,{key:3,icon:"question","fixed-width":"",class:"text-xs"}))]),_:1})]),_:1},8,["disabled"])])])])):V("",!0),m("div",Ea,[m("div",null,[t.event.isOutward?(r(),f(h,{key:0,icon:"hammer",class:"mr-2 text-gray-500 text-xs"})):V("",!0)]),m("div",Sa,[m("div",$a,[s(Ae,{"model-value":t.event.startsAt,"date-disabled":!e(U),"time-disabled":!e(U),"show-time":!t.event.isAllDay&&!!t.event.startsAt,size:t.size,"show-default-time":!t.event.isAllDay&&!t.event.startsAt,"default-time":t.event.startsAtDefaultTime,readonly:t.readonly,"onUpdate:modelValue":$,"onUpdate:defaultTime":d[14]||(d[14]=D=>t.event.startsAtDefaultTime=D)},null,8,["model-value","date-disabled","time-disabled","show-time","size","show-default-time","default-time","readonly"]),s(ve,{content:e(a)("assignmentEvent.schedulingForward"),disabled:e(U),placement:"top"},{default:l(()=>[s(G,{type:e(U)?"primary":void 0,text:!e(U),disabled:t.readonly,class:"ml-1",onClick:d[15]||(d[15]=()=>!t.readonly&&(U.value=!0))},{default:l(()=>[s(h,{icon:"link",class:"text-xs"})]),_:1},8,["type","text","disabled"])]),_:1},8,["content","disabled"]),e(C).sm?(r(),S(ne,{key:0},[s(qe,{"model-value":!e(O),class:"ml-2 mr-1",size:"small",disabled:t.readonly,"onUpdate:modelValue":d[16]||(d[16]=D=>O.value=!D)},null,8,["model-value","disabled"]),x(" "+u(e(a)("assignmentEvent.time")),1)],64)):V("",!0)]),m("div",Ca,[s(Ae,{"model-value":t.event.endsAt,"date-disabled":e(U),"time-disabled":e(U),"show-time":!t.event.isAllDay,size:t.size,disabled:t.readonly,"onUpdate:modelValue":y},null,8,["model-value","date-disabled","time-disabled","show-time","size","disabled"]),s(ve,{content:e(a)("assignmentEvent.schedulingBackward"),disabled:!e(U),placement:"bottom"},{default:l(()=>[s(G,{type:e(U)?void 0:"primary",text:e(U),disabled:t.readonly,class:"ml-1",onClick:d[17]||(d[17]=()=>!t.readonly&&(U.value=!1))},{default:l(()=>[s(h,{icon:"link",class:"text-xs"})]),_:1},8,["type","text","disabled"])]),_:1},8,["content","disabled"])])])]),t.event.isOutward?(r(),S("div",Ia,[s(h,{icon:"truck",class:"mr-2 text-xs text-gray-500",flip:"horizontal"}),m("div",null,[m("div",xa,[m("div",null,[s(xe,{modelValue:e(ae),"onUpdate:modelValue":d[18]||(d[18]=D=>J(ae)?ae.value=D:null),disabled:t.readonly,"value-type":"number"},null,8,["modelValue","disabled"]),e(z)?(r(),f(G,{key:0,size:"default",class:"ml-0.5",disabled:t.readonly,onClick:ue},{default:l(()=>[s(h,{icon:"sync-alt","fixed-width":"",spin:e(B),class:"text-xs"},null,8,["spin"])]),_:1},8,["disabled"])):V("",!0)]),s(ke,{disabled:t.readonly,class:"ml-2",onCommand:I},{dropdown:l(()=>[s(we,null,{default:l(()=>[s(Z,{command:{id:e(K),idKey:"addressDestinationId"}},{default:l(()=>[s(h,{icon:"home",class:"mr-2 text-xs"}),x(" "+u(e(a)("assignmentEvent.drive.company")),1)]),_:1},8,["command"]),t.event.assignment&&t.event.assignment.addressPropertyId?(r(),f(Z,{key:0,command:{id:t.event.assignment.addressPropertyId,idKey:"addressDestinationId"}},{default:l(()=>[s(h,{icon:"map-marker-alt",class:"mr-2 text-xs"}),x(" "+u(e(a)("assignmentEvent.drive.constructionSite")),1)]),_:1},8,["command"])):V("",!0),s(Z,{command:{id:"new",idKey:"addressDestinationId"}},{default:l(()=>[s(h,{icon:"globe-europe",class:"mr-2 text-xs"}),x(" "+u(e(a)("New")),1)]),_:1})]),_:1})]),default:l(()=>[s(G,{text:""},{default:l(()=>[t.event.addressDestinationId===e(K)?(r(),f(h,{key:0,icon:"home","fixed-width":"",class:"text-xs"})):t.event.assignment?.addressPropertyUuid&&t.event.addressDestinationUuid===t.event.assignment.addressPropertyUuid?(r(),f(h,{key:1,icon:"map-marker-alt","fixed-width":"",class:"text-xs"})):t.event.addressDestinationUuid?(r(),f(h,{key:2,icon:"globe-europe","fixed-width":"",class:"text-xs"})):(r(),f(h,{key:3,icon:"question","fixed-width":""}))]),_:1})]),_:1},8,["disabled"]),s(h,{icon:"arrow-right",class:"mx-1 text-xs"}),s(ke,{disabled:t.readonly,onCommand:I},{dropdown:l(()=>[s(we,null,{default:l(()=>[s(Z,{command:{id:e(K),idKey:"addressReturnToId"}},{default:l(()=>[s(h,{icon:"home",class:"mr-2 text-xs"}),x(" "+u(e(a)("assignmentEvent.drive.company")),1)]),_:1},8,["command"]),t.event.assignment&&t.event.assignment.addressPropertyId?(r(),f(Z,{key:0,command:{id:t.event.assignment.addressPropertyId,idKey:"addressReturnToId"}},{default:l(()=>[s(h,{icon:"map-marker-alt",class:"mr-2 text-xs"}),x(" "+u(e(a)("assignmentEvent.drive.constructionSite")),1)]),_:1},8,["command"])):V("",!0),s(Z,{command:{id:"new",idKey:"addressReturnToId"}},{default:l(()=>[s(h,{icon:"globe-europe",class:"mr-2 text-xs"}),x(" "+u(e(a)("New")),1)]),_:1})]),_:1})]),default:l(()=>[s(G,{text:""},{default:l(()=>[t.event.addressReturnToId===e(K)?(r(),f(h,{key:0,icon:"home","fixed-width":"",class:"text-xs"})):t.event.assignment?.addressPropertyUuid&&t.event.addressReturnToUuid===t.event.assignment.addressPropertyUuid?(r(),f(h,{key:1,icon:"map-marker-alt","fixed-width":"",class:"text-xs"})):t.event.addressReturnToUuid?(r(),f(h,{key:2,icon:"globe-europe","fixed-width":"",class:"text-xs"})):(r(),f(h,{key:3,icon:"question","fixed-width":"",class:"text-xs"}))]),_:1})]),_:1},8,["disabled"])]),t.event.isOutward&&t.event.durationDriveReturnTo&&t.event.endsAt&&!t.event.isAllDay?(r(),S("div",Pa,[m("span",Ta,u(e(a)("assignmentEvent.drive.Arrival"))+":",1),x(" "+u(e(te)),1)])):V("",!0)])])):V("",!0)]),t.event.isOutward&&t.event.workDays>1?(r(),S(ne,{key:0},[m("div",Ua,u(e(a)("assignmentEvent.drive.Accommodation"))+":",1),m("div",ja,[s(Dt,{modelValue:e(le),"onUpdate:modelValue":d[19]||(d[19]=D=>J(le)?le.value=D:null),size:"default",placeholder:t.$t("assignmentEvent.accommodationRequired"),disabled:t.readonly,clearable:""},{default:l(()=>[s(_e,{value:"automatically",label:e(a)("assignmentEvent.drive.needAccommodation.automatic")},null,8,["label"]),s(_e,{value:"necessary",label:e(a)("assignmentEvent.drive.needAccommodation.necessary")},null,8,["label"]),s(_e,{value:"notNecessary",label:e(a)("assignmentEvent.drive.needAccommodation.notNecessary")},null,8,["label"]),s(_e,{value:"bookingDone",label:e(a)("assignmentEvent.drive.needAccommodation.bookingDone")},null,8,["label"])]),_:1},8,["modelValue","placeholder","disabled"])])],64)):V("",!0),m("div",Oa,[m("div",Ba,u(e(a)("assignmentEvent.effort"))+":",1),m("div",Fa,[m("div",Ra,[m("div",{class:L(["text-right mr-1",{"w-20":t.event.isOutward}])},u(e(w)),3),m("span",Na,u(e(a)("hoursShort"))+" "+u(e(a)("assignmentEvent.work")),1)]),t.event.isOutward?(r(),S("div",Ga,[m("div",Ma,"+ "+u(e(P)),1),m("span",qa,u(e(a)("hoursShort"))+" "+u(e(a)("assignmentEvent.driveWork")),1)])):V("",!0),t.event.isOutward?(r(),S("div",za,[m("div",Ha,u(e(_)),1),m("span",Wa,u(e(a)("hoursShort"))+" "+u(e(a)("overall")),1)])):V("",!0)])]),m("div",Ka,[m("div",La,[m("div",Ya,u(e(a)("user.name",2))+":",1),m("div",Qa,[s(Qe,{event:t.event,readonly:t.readonly,onAddUser:d[20]||(d[20]=({eventUsers:D})=>Ge(D.length))},null,8,["event","readonly"]),e(b).hasGangs?(r(),f(na,{key:0,event:t.event,readonly:t.readonly,local:"",onAdded:d[21]||(d[21]=({users:D})=>e(_t)(D)),onRemoved:d[22]||(d[22]=({users:D})=>e(At)(D))},null,8,["event","readonly"])):V("",!0)])]),m("div",Za,[m("div",Xa,u(e(a)("assignmentEvent.requiredDocumentation"))+":",1),m("div",Ja,[s(re,{modelValue:t.event.minUploadCount,"onUpdate:modelValue":d[23]||(d[23]=D=>t.event.minUploadCount=D),min:0,"value-on-clear":0,disabled:t.readonly,style:{width:"40px"},class:"inline-edit",controls:!1},null,8,["modelValue","disabled"]),m("div",es,u(e(a)("assignmentEvent.photosNeedToBeDone"))+". ",1)])])]),m("div",ts,u(e(a)("assignmentEvent.annotations"))+":",1),m("div",ns,[s(ce,{modelValue:t.event.note,"onUpdate:modelValue":d[24]||(d[24]=D=>t.event.note=D),rows:t.event.note?2:1,disabled:t.readonly,type:"textarea",placeholder:"Anmerkungen",class:"inline-edit"},null,8,["modelValue","rows","disabled"])]),m("div",as,u(e(a)("assignmentEvent.task",t.tasks.length))+":",1),(r(!0),S(ne,null,Te(t.tasks,D=>(r(),S("div",{key:D.uuid,class:"bg-white rounded mb-1 outline outline-2 outline-gray-100 p-2"},[s(kn,{ref_for:!0,ref:e(k).set,task:D,onRemove:Fs=>t.$emit("remove-task",D)},null,8,["task","onRemove"])]))),128)),m("div",ss,[s(Vt,{text:"",icon:e(Ht),onClick:kt},{default:l(()=>[x(u(e(a)("assignmentEvent.addTask")),1)]),_:1},8,["icon"])]),m("div",os,[ls,t.showDelete&&!t.readonly?(r(),f(G,{key:0,type:"danger",plain:"",onClick:d[25]||(d[25]=D=>E("remove"))},{default:l(()=>[s(h,{icon:"trash-alt",class:"mr-2 text-xs"}),x(" "+u(e(a)("actions.Delete")),1)]),_:1})):V("",!0)])],64)),t.short&&t.expandable?(r(),S("div",rs,[s(G,{text:"",class:"!text-sm !font-normal",onClick:d[26]||(d[26]=()=>t.expandable&&Ne())},{default:l(()=>[x(u(e(A)?e(a)("showMore"):e(a)("showLess"))+" ",1),s(h,{icon:"angle-down",class:"ml-1 transition-all text-xs",rotation:e(A)?void 0:"180"},null,8,["rotation"])]),_:1})])):V("",!0),e(W)?(r(),f(Ct,{key:2,modelValue:e(W),"onUpdate:modelValue":d[28]||(d[28]=D=>J(W)?W.value=D:null),"append-to-body":""},{header:l(()=>[m("span",null,u(e(a)("addresses.create",1)),1)]),default:l(()=>[s($t,null,{default:l(()=>[s(St,{label:`${e(a)("addresses.form.googleMaps")}:`},{default:l(()=>[s(Et,{modelValue:e(R),"onUpdate:modelValue":d[27]||(d[27]=D=>J(R)?R.value=D:null),placeholder:e(a)("addresses.form.googleMapsPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),m("div",ds,[s(G,{class:"mr-2",onClick:gt},{default:l(()=>[x(u(e(a)("actions.Cancel")),1)]),_:1}),s(G,{type:"primary",disabled:!e(R)||!e(R).googlePlaceId,onClick:ht},{default:l(()=>[x(u(e(a)("actions.Ok")),1)]),_:1},8,["disabled"])])]),_:1},8,["modelValue"])):V("",!0)])}}}),is={class:"flex justify-between mb-3 gap-2"},us={class:"flex gap-2"},ms={key:0,class:"flex gap-2 px-1"},cs={class:"flex-1"},ps={key:1,class:"text-center"},vs={key:1,class:"bg-gray-100 rounded text-center p-2 drop-shadow text-sm text-slate-600"},vo=Q({__name:"EditAssignmentEvents",props:{assignment:{},events:{},eventGroups:{},tasksByEventUuid:{},hideStatus:{type:Boolean,default:!1},hideManPower:{type:Boolean,default:!1},hideCheckbox:{type:Boolean,default:!1},expandByDefault:{type:Boolean,default:!1},hideNewIndicator:{type:Boolean,default:!1},hideNotes:{type:Boolean,default:!1},hideExpandRow:{type:Boolean,default:!1},debug:{type:Boolean,default:!1},skipStyleRows:{type:Boolean,default:!1}},emits:["remove-event","remove-group","remove-task"],setup(c,{emit:i}){const{t:o}=ie(),n=c,C=i,a=pn().createScope(),b=ut().createScope(),A=vn(),E=Be(),k=j(!1),w=j(null),P=j({}),_=j(null),$=j(null),y=j(),{cq:v}=ft(y),O=T(()=>v.value["3xl"]);et(()=>!O.value&&_.value,()=>{_.value=null});const{maxOrder:U,recalculateOrder:p,groupsAndEventsToShow:N}=_n({events:T(()=>n.events),groups:T(()=>n.eventGroups)});async function ee(g,I){if(!g)return;const Y=a.construct({companyId:g.companyId,assignment:n.assignment,typeId:g.id,order:U.value+.5,plannedEmployeeCount:g.defaultEmployeeCount,workDays:g.defaultWorkDays,workingTimePerDay:g.defaultWorkingTimePerDay,isOutward:g.defaultIsOutward,durationDriveFromStart:g.defaultIsOutward?g.defaultDurationDrive:0,durationDriveReturnTo:g.defaultIsOutward?g.defaultDurationDrive:0,dateAnchor:g.defaultDateAnchor,manPower:g.defaultManPower,isAllDay:g.defaultIsAllDay,startsAtDefaultTime:g.defaultStartsAtTime,minUploadCount:g.defaultMinUploadCount,...I});return _.value=Y,await p(),Y}function ae(g){return b.construct({companyId:g.companyId,assignment:n.assignment,typeId:g.id,order:U.value+1})}function H({dragged:g,to:I}){if(g.classList.contains("is-group")&&I.classList.contains("is-group"))return!1}async function te(g,I,Y){const{moved:M,added:B}=g;if(M){const F=In(I,M.oldIndex,M.newIndex),q=[];F.forEach(z=>{Ke(z,"assignment-events")?q.push(z):z.isGroup?q.push(z.element.group,...z.element.events):q.push(z.element)});const oe=Kt(q,"order")?.order||1;q.forEach((z,ue)=>{z.order=oe+ue})}else if(B){const F=Ke(B.element,"assignment-events")?B.element:B.element.element,q=B.newIndex;if(Y.group){const oe=[...I];oe.splice(q,0,F);const z=q>0?oe[q-1]?.order||0:Y?.group?.order||0;F.order=z+.5,F.group=Y?.group||null,await p()}else{const oe=[...I];let z;if(q>0){const ue=oe[q-1];if(ue.isGroup){const le=ue.element;z=le.events.length>0?le.events.at(-1)?.order||0:le.group.order||0}else z=ue.element.order||0}else z=0;F.order=z+.5,F.group=null,await p()}}}async function se(g,I){_.value&&I.includes(_.value)&&(_.value=null),C("remove-group",g,I),await p()}async function K(g){try{await tt.confirm(o("assignmentEvent.deleteConfirmMessage",{eventType:g.type?.name}),"",{confirmButtonText:o("actions.Delete"),cancelButtonText:o("actions.Cancel"),type:"warning",confirmButtonClass:"el-button--danger"}),g===_.value&&(_.value=null),C("remove-event",g),await p()}catch{}}function W(g){O.value?_.value=g:P.value[g.uuid]?.toggleCollapse()}const R=j(!1);async function X(g){if(E.value){R.value=!0;try{return await Rn({assignment:n.assignment,startOrder:U.value,user:E.value,standardProcess:g})}finally{R.value=!1}}}return(g,I)=>{const Y=de("font-awesome-icon");return r(),S("div",{ref_key:"refContainer",ref:y},[m("div",is,[m("div",null,[s(pt,{"company-id":e(A),type:"primary",trigger:"click","onUpdate:modelValue":ee},{default:l(()=>[x(u(g.$t("assignmentEvent.name"))+" ",1),s(Y,{icon:"plus",class:"ml-1 text-xs"})]),_:1},8,["company-id"])]),m("div",us,[s(Nn,{"company-id":e(A),disabled:e(R),loading:e(R),type:"primary",onChanged:I[0]||(I[0]=M=>X(M))},{default:l(()=>[x(u(e(o)("assignment-event-standard-processes.name"))+" ",1),s(Y,{icon:"plus",class:"ml-1 text-xs"})]),_:1},8,["company-id","disabled","loading"]),s(nn,{"company-id":e(A),trigger:"click",type:"default","onUpdate:modelValue":ae},{default:l(()=>[x(u(g.$t("Group"))+" ",1),s(Y,{icon:"plus",class:"ml-1 text-xs"})]),_:1},8,["company-id"])])]),g.events.length||g.eventGroups.length?(r(),S("div",ms,[m("div",cs,[s(e(We),{modelValue:e(N),"onUpdate:modelValue":I[6]||(I[6]=M=>J(N)?N.value=M:null),handle:".drag-handle",group:"events","item-key":"uuid",move:H,onChange:I[7]||(I[7]=M=>te(M,e(N),{group:null})),onStart:I[8]||(I[8]=()=>k.value=!0),onEnd:I[9]||(I[9]=()=>k.value=!1)},{item:l(({element:{isGroup:M,element:B}})=>[M?(r(),f(Yn,{key:0,assignment:g.assignment,group:B.group,events:B.events,"expand-by-default":"",class:"mb-2 bg-gray-200 rounded border-gray-300 border-l-4 is-group",onAddEvent:ee,onRemoveGroup:se,onMouseenter:()=>w.value=B.group.uuid,onMouseleave:I[4]||(I[4]=()=>w.value=null)},{default:l(()=>[s(e(We),{"model-value":B.events,handle:".drag-handle",group:"events","item-key":"uuid",class:L(["grid grid-cols-1 @4xl:grid-cols-2 @6xl:grid-cols-3 gap-2 is-group",{"min-h-[100px]":e(k)&&e(w)===B.group.uuid}]),onChange:F=>te(F,B.events,{group:B.group}),onStart:I[2]||(I[2]=()=>k.value=!0),onEnd:I[3]||(I[3]=()=>k.value=!1)},{item:l(({element:F})=>[s(Pe,{ref:q=>e(P)[F.uuid]=q,event:F,tasks:g.tasksByEventUuid[F.uuid]??[],class:L(["p-2 bg-gray-100 rounded-md drop-shadow hover:drop-shadow-lg transition-all",{"ring ring-primary":F===e(_)}]),draggable:"",short:"","expand-by-default":g.expandByDefault,expandable:!e(O),"show-delete":"",onClickTitle:()=>W(F),onRemove:()=>K(F),onRemoveTask:I[1]||(I[1]=q=>g.$emit("remove-task",q))},null,8,["event","tasks","class","expand-by-default","expandable","onClickTitle","onRemove"])]),_:2},1032,["model-value","class","onChange"])]),_:2},1032,["assignment","group","events","onMouseenter"])):(r(),f(Pe,{key:1,event:B,tasks:g.tasksByEventUuid[B.uuid]??[],class:L(["mb-2 p-2 bg-gray-100 rounded-md drop-shadow hover:drop-shadow-lg",{"ring ring-primary":B===e(_)}]),draggable:"",short:"","drag-handle":"drag-handle-first","expand-by-default":g.expandByDefault,expandable:!e(O),"show-delete":"",onClickTitle:()=>W(B),onRemove:()=>K(B),onRemoveTask:I[5]||(I[5]=F=>g.$emit("remove-task",F))},null,8,["event","tasks","class","expand-by-default","expandable","onClickTitle","onRemove"]))]),_:1},8,["modelValue"])]),e(O)?(r(),f(Bn,{key:0,class:"bg-gray-100 p-2 flex-1 overflow-hidden drop-shadow rounded-md",top:10,bottom:10},{default:l(()=>[e(_)?(r(),f(Pe,{key:0,ref_key:"activeEventForm",ref:$,event:e(_),tasks:g.tasksByEventUuid[e(_).uuid]??[],class:"max-h-screen overflow-y-auto transition-all duration-75","show-delete":"",onRemove:I[10]||(I[10]=()=>K(e(_))),onRemoveTask:I[11]||(I[11]=M=>g.$emit("remove-task",M))},null,8,["event","tasks"])):(r(),S("div",ps,[s(Y,{icon:"arrow-left",class:"mr-2"}),x(" "+u(g.$t("assignmentEvent.clickToEditMessage"))+". ",1)]))]),_:1})):V("",!0)])):(r(),S("div",vs,u(g.$t("assignmentEvent.createdStepsYouCanEditHere")),1))],512)}}});function fs(c,i){st(2,arguments);var o=ot(i);return xn(c,o*12)}function yt(c,i){st(2,arguments);var o=ot(i);return fs(c,-o)}const ys={key:0},fo=Q({__name:"FormConstructionManager",props:{modelValue:{default:null},modelModifiers:{}},emits:["update:modelValue"],setup(c){const i=lt(c,"modelValue"),{t:o}=ie(),n=Fe(),C=Re().createScope(),a=j(yt(new Date,2));function b(E,k){E?C.service.find({query:{"constructionManager.name":{$iLike:`%${E}%`},createdAt:{$gt:a.value},$sort:{createdAt:-1},$limit:1e3,$select:["id","constructionManager"]}}).then(w=>{const P=Array.isArray(w)?w:w.data,_=rt(P,($,y)=>$&&y&&$.constructionManager.name===y.constructionManager.name);k(_)}):k([])}function A(E){i.value||(i.value={name:"",tel:"",mail:""}),i.value.name=E.constructionManager.name,i.value.tel=E.constructionManager.tel,i.value.mail=E.constructionManager.mail}return(E,k)=>{const w=dt,P=Ve,_=be,$=Ee;return i.value?(r(),f($,{key:0,model:i.value,"label-position":e(n).md?"left":"top","label-width":"70px"},{default:l(()=>[s(P,{label:`${e(o)("customer.property.fullName")}:`},{default:l(()=>[s(w,{modelValue:i.value.name,"onUpdate:modelValue":k[0]||(k[0]=y=>i.value.name=y),"fetch-suggestions":b,class:"el-input",placeholder:e(o)("customer.form.fullNamePlaceholder"),clearable:"",onSelect:A},{default:l(({item:y})=>[y.constructionManager.name?(r(),S("span",ys,u(y.constructionManager.name),1)):V("",!0)]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),s(P,{label:`${e(o)("customer.property.telephone")}:`},{default:l(()=>[s(_,{modelValue:i.value.tel,"onUpdate:modelValue":k[1]||(k[1]=y=>i.value.tel=y),clearable:"",placeholder:e(o)("customer.property.telephone")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(P,{label:`${e(o)("customer.property.email")}:`},{default:l(()=>[s(_,{modelValue:i.value.mail,"onUpdate:modelValue":k[2]||(k[2]=y=>i.value.mail=y),clearable:"",placeholder:e(o)("customer.property.email")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","label-position"])):V("",!0)}}}),gs={key:0},yo=Q({__name:"FormArchitect",props:{modelValue:{default:null},modelModifiers:{}},emits:["update:modelValue"],setup(c){const i=lt(c,"modelValue"),{t:o}=ie(),n=Fe(),C=Re().createScope(),a=j(yt(new Date,2));function b(E,k){E?C.service.find({query:{"architect.name":{$iLike:`%${E}%`},createdAt:{$gt:a.value},$sort:{createdAt:-1},$limit:1e3,$select:["id","architect"]}}).then(w=>{const P=Array.isArray(w)?w:w.data,_=rt(P,($,y)=>$&&y&&$.architect.name===y.architect.name);k(_)}):k([])}function A(E){i.value||(i.value={name:"",tel:"",mail:""}),i.value.name=E.architect.name,i.value.tel=E.architect.tel,i.value.mail=E.architect.mail}return(E,k)=>{const w=dt,P=Ve,_=be,$=Ee;return i.value?(r(),f($,{key:0,model:i.value,"label-position":e(n).md?"left":"top","label-width":"70px"},{default:l(()=>[s(P,{label:`${e(o)("customer.property.fullName")}:`},{default:l(()=>[s(w,{modelValue:i.value.name,"onUpdate:modelValue":k[0]||(k[0]=y=>i.value.name=y),"fetch-suggestions":b,class:"el-input",placeholder:e(o)("customer.form.fullNamePlaceholder"),clearable:"",onSelect:A},{default:l(({item:y})=>[y.architect.name?(r(),S("span",gs,u(y.architect.name),1)):V("",!0)]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),s(P,{label:`${e(o)("customer.property.telephone")}:`},{default:l(()=>[s(_,{modelValue:i.value.tel,"onUpdate:modelValue":k[1]||(k[1]=y=>i.value.tel=y),clearable:"",placeholder:e(o)("customer.property.telephone")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(P,{label:`${e(o)("customer.property.email")}:`},{default:l(()=>[s(_,{modelValue:i.value.mail,"onUpdate:modelValue":k[2]||(k[2]=y=>i.value.mail=y),clearable:"",placeholder:e(o)("customer.property.email")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","label-position"])):V("",!0)}}}),hs={};function bs(c,i){const o=de("font-awesome-icon");return r(),f(o,{icon:"minus",class:"text-gray-300"})}const ws=Lt(hs,[["render",bs]]),ks=Q({name:"UseContainerQuery",props:{as:{type:String,default:"div"}},setup(c,{slots:i}){const o=j(),n=Yt(ft(o));return()=>{if(i.default)return Qt(c.as,{ref:o},i.default(n))}}}),_s={class:"dialog-title"},As={key:0},Ds={key:1},Vs={class:"flex justify-end gap-2"},Es=Q({__name:"DialogProjectView",props:{project:{type:Object,required:!0},currentAssignment:{type:Object,default:void 0}},setup(c){const i=c,{t:o}=ie(),n=Zt(),C=Re().createScope(),a=fn().createScope();fe(()=>i.project,(_,$)=>{a.resetOrRemove($)});const b=j(!1),A=j(!1);function E(){b.value=!0,A.value=!0}function k(){A.value=!1}fe(A,(_,$)=>{!_&&$&&a.hasChanges(i.project)&&a.reset(i.project)});const w=T(()=>({query:{$sort:{createdAt:-1},projectId:i.project.id},debounceTime:350,paginate:!0,$populateParams:{name:"withCustomer"}}));async function P(_){await n.push({params:{assignmentId:_.id}}),await he(),window.location.reload()}return(_,$)=>{const y=de("font-awesome-icon"),v=me,O=me,U=at;return r(),S(ne,null,[De(_.$slots,"default",{open:E,close:k}),e(b)?(r(),f(U,{key:0,modelValue:e(A),"onUpdate:modelValue":$[2]||($[2]=p=>J(A)?A.value=p:null),class:"dialog-messagebox-[1000px]"},{header:l(()=>[m("div",_s,[m("div",null,[m("span",null,u(e(o)("project.name"))+" "+u(c.project.projectNumber),1)])])]),footer:l(()=>[m("div",Vs,[s(O,{text:"",onClick:$[0]||($[0]=p=>(e(a).hasChanges(c.project)&&e(a).reset(c.project),k()))},{default:l(()=>[x(u(e(a).hasChanges(c.project)?e(o)("actions.Cancel"):e(o)("actions.Close")),1)]),_:1}),e(a).hasChanges(c.project)?(r(),f(O,{key:0,type:"primary",onClick:$[1]||($[1]=p=>e(a).save(c.project).then(()=>k()))},{default:l(()=>[x(u(e(o)("actions.Save")),1)]),_:1})):V("",!0)])]),default:l(()=>[m("div",null,[s(jn,{store:e(C),params:e(w),"read-only":"","show-total":""},{default:l(()=>[s(pe,{width:"50px"},{default:l(({row:p})=>[p.id!==c.currentAssignment?.id?(r(),f(v,{key:0,size:"default",type:"info",plain:"",onClick:N=>P(p)},{default:l(()=>[s(y,{icon:"info"})]),_:2},1032,["onClick"])):V("",!0)]),_:1}),s(pe,{title:e(o)("project.property.number"),width:"120px"},{default:l(({row:p})=>[x(u(p.project?.projectNumber??""),1)]),_:1},8,["title"]),s(pe,{title:e(o)("assignment.name"),width:"130px",class:"!leading-tight"},{default:l(({row:p})=>[m("div",null,[p.number?(r(),S("p",As)):V("",!0),p.name?(r(),S("p",Ds)):V("",!0)]),x(" "+u(p.number),1)]),_:1},8,["title"]),s(pe,{title:e(o)("assignment.property.name")},{default:l(({row:p})=>[x(u(p.name),1)]),_:1},8,["title"]),s(pe,{title:e(o)("customer.name")},{default:l(({row:p})=>[x(u(p.customer&&(p.customer.fullName||p.customer.companyName)),1)]),_:1},8,["title"]),s(pe,{title:e(o)("commonProperty.createdAt"),width:"128px"},{default:l(({row:p})=>[x(u(p.createdAt&&e(yn)(p.createdAt,"dd.MM.yy HH:mm")),1)]),_:1},8,["title"])]),_:1},8,["store","params"])])]),_:1},8,["modelValue"])):V("",!0)],64)}}}),Ss=["onClick"],$s={key:1,class:"flex w-full"},Cs={key:0,class:"flex-1"},Is={key:0,class:"leading-tight"},xs={key:0,class:"leading-tight"},Ps={key:0,class:"leading-tight"},Ts={key:0,class:"leading-tight"},Us={key:0},js={key:0},go=Q({__name:"FormProject",props:{modelValue:{},readOnly:{type:Boolean,default:!1},showChangeProjectName:{type:Boolean,default:!1}},setup(c){const i=c,{t:o}=ie(),n=Xt(void 0);function C(){i.modelValue.project&&!i.modelValue.project.projectNumber&&(i.modelValue.project=null),n.value=void 0}return(a,b)=>{const A=ws,E=be,k=de("font-awesome-icon"),w=me,P=Jt,_=Ve,$=Ee;return r(),f(e(ks),null,{default:l(({cq:y})=>[s($,{model:a.modelValue,"label-position":y.xs?"left":"top","label-width":"120px",class:L([a.readOnly&&"[&_.el-form-item--default_.el-form-item\\_\\_label]:h-auto [&_.el-form-item--default_.el-form-item\\_\\_label]:leading-[inherit]"])},{default:l(()=>[s(_,{label:e(o)("project.property.number")+":",class:L({"text-only":a.readOnly})},{default:l(()=>[a.readOnly?(r(),S(ne,{key:0},[a.modelValue.project?(r(),f(Es,{key:0,project:a.modelValue.project,"current-assignment":a.modelValue},{default:l(({open:v})=>[m("a",{class:"url",onClick:v},u(a.modelValue.project.projectNumber),9,Ss)]),_:1},8,["project","current-assignment"])):(r(),f(A,{key:1}))],64)):(r(),S("div",$s,[!e(n)&&a.showChangeProjectName&&a.modelValue.project?(r(),S("div",Cs,u(a.modelValue.project?.projectNumber),1)):e(n)==="changeName"&&a.modelValue.project?(r(),f(E,{key:1,modelValue:a.modelValue.project.projectNumber,"onUpdate:modelValue":b[0]||(b[0]=v=>a.modelValue.project.projectNumber=v),class:"[&_.el-input\\_\\_wrapper]:!rounded-r-none"},null,8,["modelValue"])):e(n)==="changeProject"||!a.modelValue.project||!a.showChangeProjectName?(r(),f(Pn,{key:2,modelValue:a.modelValue.project,"onUpdate:modelValue":b[1]||(b[1]=v=>a.modelValue.project=v),clearable:"",class:L(["w-full",{"[&_.el-select\\_\\_wrapper]:!rounded-r-none":e(n)==="changeProject"}]),"allow-create":""},null,8,["modelValue","class"])):V("",!0),!e(n)&&a.showChangeProjectName&&a.modelValue.project?(r(),f(P,{key:3},{default:l(()=>[s(w,{onClick:b[2]||(b[2]=v=>n.value="changeName")},{default:l(()=>[s(k,{icon:"pencil-alt",class:"text-xs"})]),_:1}),s(w,{onClick:b[3]||(b[3]=v=>n.value="changeProject")},{default:l(()=>[s(k,{icon:"exchange-alt",class:"text-xs"})]),_:1}),s(w,{onClick:b[4]||(b[4]=()=>a.modelValue.project=null)},{default:l(()=>[s(k,{icon:"times",class:"text-xs"})]),_:1})]),_:1})):a.showChangeProjectName&&a.modelValue.project?(r(),f(w,{key:4,type:"primary",class:"!rounded-l-none",onClick:C},{default:l(()=>[s(k,{icon:"check"})]),_:1})):V("",!0)]))]),_:1},8,["label","class"]),s(_,{class:L({"text-only":a.readOnly}),prop:a.readOnly?void 0:"number",label:e(o)("assignment.property.number")+":"},{default:l(()=>[a.readOnly?(r(),S("span",Is,u(a.modelValue.number),1)):(r(),f(E,{key:1,modelValue:a.modelValue.number,"onUpdate:modelValue":b[5]||(b[5]=v=>a.modelValue.number=v),type:"text",placeholder:e(o)("assignment.property.number"),required:""},{append:l(()=>[s(k,{icon:"arrows-alt-h"}),x(" "+u((a.modelValue.number&&a.modelValue.number.length)??0),1)]),_:1},8,["modelValue","placeholder"]))]),_:1},8,["class","prop","label"]),s(_,{label:e(o)("assignment.property.name")+":",class:L({"text-only":a.readOnly}),prop:a.readOnly?void 0:"name"},{default:l(()=>[a.readOnly?(r(),S("span",xs,u(a.modelValue.name),1)):(r(),f(E,{key:1,modelValue:a.modelValue.name,"onUpdate:modelValue":b[6]||(b[6]=v=>a.modelValue.name=v),placeholder:e(o)("assignment.property.name"),required:""},null,8,["modelValue","placeholder"]))]),_:1},8,["label","class","prop"]),s(_,{label:e(o)("assignment-types.name")+":",class:L({"text-only":a.readOnly})},{default:l(()=>[a.readOnly?(r(),S("div",Ps,u(a.modelValue.type?.name),1)):(r(),f(Un,{key:1,modelValue:a.modelValue.type,"onUpdate:modelValue":b[7]||(b[7]=v=>a.modelValue.type=v),placeholder:e(o)("assignment-types.name"),class:"w-full"},null,8,["modelValue","placeholder"]))]),_:1},8,["label","class"]),s(_,{label:e(o)("assignment.relation.serviceWorker")+":",class:L({"text-only":a.readOnly})},{default:l(()=>[a.readOnly?(r(),S("div",Ts,[a.modelValue.serviceWorker?(r(),S("span",Us,u(a.modelValue.serviceWorker.fullName),1)):(r(),f(A,{key:1}))])):a.readOnly?V("",!0):(r(),f(Tn,{key:1,modelValue:a.modelValue.serviceWorker,"onUpdate:modelValue":b[8]||(b[8]=v=>a.modelValue.serviceWorker=v),clearable:"",placeholder:a.$t("assignment.relation.serviceWorker"),class:"w-full"},null,8,["modelValue","placeholder"]))]),_:1},8,["label","class"]),s(_,{label:e(o)("assignmentStatusTypes.name")+":",class:L({"text-only":a.readOnly})},{default:l(()=>[a.readOnly?(r(),S("div",js,[a.modelValue.status?(r(),f(Ze,{key:0,modelValue:a.modelValue.status,"onUpdate:modelValue":b[9]||(b[9]=v=>a.modelValue.status=v)},null,8,["modelValue"])):(r(),f(A,{key:1}))])):(r(),f(Ze,{key:1,modelValue:a.modelValue.status,"onUpdate:modelValue":b[10]||(b[10]=v=>a.modelValue.status=v),editable:""},null,8,["modelValue"]))]),_:1},8,["label","class"])]),_:2},1032,["model","label-position","class"])]),_:1})}}});function Os(c){const i=ct().createScope(),o=en(c.assignment);return T({get(){return!!o.value?.addressPropertyUuid&&o.value.addressPropertyUuid===o.value?.customer?.addressUuid},set(C){o.value?.customer?.address&&(C?(o.value.addressProperty&&i.resetOrRemove(o.value.addressProperty),o.value.addressProperty=o.value.customer.address):o.value.addressProperty=i.construct(gn(o.value.customer.address,["id","uuid","createdAt","updatedAt","deletedAt"])))}})}const Bs={class:"grid gap-2"},ho=Q({__name:"AddressPropertyForm",props:{assignment:{},clickable:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},setup(c){const i=c,o=Os({assignment:()=>i.assignment});return(n,C)=>{const a=tn;return r(),S("div",Bs,[m("div",null,[s(a,{"model-value":e(o),"onUpdate:modelValue":C[0]||(C[0]=b=>o.value=!!b)},{default:l(()=>[x(u(n.$t("forms.assignment.propertyAddressIsSameAsCustomerAddress")),1)]),_:1},8,["model-value"]),s(vt,{modelValue:n.assignment.addressProperty,"onUpdate:modelValue":C[1]||(C[1]=b=>n.assignment.addressProperty=b),disabled:e(o),placeholder:n.$t("createAssignment.GoogleMapsProperty")},null,8,["modelValue","disabled","placeholder"])]),s(An,{address:n.assignment.addressProperty,class:"mt-2 w-full !h-80",clickable:n.clickable,draggable:n.draggable,readonly:n.readonly||e(o)},null,8,["address","clickable","draggable","readonly"]),!n.assignment.addressProperty?.googleString&&n.assignment.addressProperty?.latitude?(r(),f(On,{key:0,modelValue:n.assignment.addressProperty,"onUpdate:modelValue":C[2]||(C[2]=b=>n.assignment.addressProperty=b),class:"mt-2"},null,8,["modelValue"])):V("",!0)])}}});export{go as _,ho as a,vo as b,fo as c,yo as d,aa as e,Pe as f};
