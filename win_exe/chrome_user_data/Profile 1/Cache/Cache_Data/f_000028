const __vite__fileDeps=["assets/StandardProcessesSettings-DDC352r-.js","assets/GridTableColumn.vue_vue_type_script_setup_true_lang-BayDfMSt.js","assets/index-M8nwXBBi.js","assets/vendor-CJXdOFCa.js","assets/vendor-jIhZnUxc.css","assets/index-Cpd7lwzu.css","assets/GridTableColumn-BGrcamLo.css","assets/DropdownAssignmentEventGroupType.vue_vue_type_script_setup_true_lang-CSQmcDIy.js","assets/hasItemsForCompany.store-D65GIO8M.js","assets/MakeSortable.vue_vue_type_script_setup_true_lang-DJUGCLh6.js","assets/ArtesaTimeInput.vue_vue_type_style_index_0_lang-CQRpcmmu.js","assets/index-BCyjfQC_.js","assets/ArtesaTimeInput-CqnzHY5J.css","assets/DropdownAssignmentEventType.vue_vue_type_script_setup_true_lang-BMxji8cl.js","assets/FeathersTablePagination.vue_vue_type_style_index_0_lang-DDfA-nHC.js","assets/index-DX0mSCHG.js","assets/usePagination-Cs_oXynH.js","assets/FeathersTablePagination-BvXyPM5N.css","assets/StandardProcessesSettings-BZn1TpBB.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{a as G,u as ee,Z as S,b as te,o as d,aC as E,g as _,h as t,f as a,c as e,k as J,t as C,e as M,j as N,i as L,fo as We,eM as be,l as Q,f2 as Ce,f3 as ke,e6 as Z,aj as z,b1 as Mt,r as R,s as X,eh as Y,ei as ae,eE as Pt,$ as De,e0 as oe,gk as Se,fe as Ee,ff as Me,eJ as Ft,aF as qt,e_ as he,f1 as nt,e$ as we,w as Ge,e1 as $e,e2 as xe,V as ve,fc as ot,d_ as Le,fl as Ot,aE as Nt,fd as lt,aB as Ve,D as Rt,ev as jt,eZ as Bt,e5 as ge,fm as st,f0 as Wt,aR as Gt,m as Lt,eo as Ht,ah as Ue,d$ as rt,aD as _e,a3 as He,gl as it,fp as ut,ex as zt,X as dt,el as Kt,eW as Jt,eV as Yt,N as ct,eT as Xt,eR as Zt,gm as Qt,gn as ea,fk as Be,go as ta,fg as aa}from"./vendor-CJXdOFCa.js";import{b1 as mt,D as Pe,_ as na,E as oa,a0 as la,X as sa,e as ze,N as ra,b0 as Ke,b2 as pt,ag as Ze,b3 as ia,b4 as ua,b5 as da,b6 as ca,b7 as Fe,t as Je,b8 as ma,C as ft,b9 as yt,ba as vt,aa as pa,y as gt,H as fa,z as ya,bb as qe,f as va,bc as Qe,bd as ga,aO as _t,aN as _a,aS as ba,aD as bt,be as ha,aI as wa,bf as Va,as as ka,bg as Sa,T as ht,w as Ye,bh as $a,ab as xa}from"./index-M8nwXBBi.js";import{A as me}from"./ArtesaTooltip-CzaCLuSr.js";import{_ as ne,f as Ia}from"./ArtesaTimeInput.vue_vue_type_style_index_0_lang-CQRpcmmu.js";import{_ as se}from"./FeathersTablePagination.vue_vue_type_style_index_0_lang-DDfA-nHC.js";import{_ as j,a as wt}from"./GridTableColumn.vue_vue_type_script_setup_true_lang-BayDfMSt.js";import{k as Aa}from"./floating-vue-FD3sxU32.js";import{_ as Vt}from"./FeathersSelectAutocomplete.vue_vue_type_style_index_0_lang-D553730i.js";import{p as Ie}from"./MakeSortable.vue_vue_type_script_setup_true_lang-DJUGCLh6.js";import{u as de,_ as ce}from"./SelectDeactivatedFilter.vue_vue_type_script_setup_true_lang-XWUsvxZh.js";import{_ as Ca}from"./InputGoogleAutocomplete.vue_vue_type_script_setup_true_lang-L1WIzGgK.js";import{_ as Ta}from"./AddressForm.vue_vue_type_script_setup_true_lang-DzNRvAmP.js";import{u as kt,_ as et,f as Re}from"./formatRelativeTime-BOQkbZmf.js";import{_ as St}from"./SelectRole.vue_vue_type_script_setup_true_lang-ERmElk75.js";import{u as Ua}from"./useIsUserOfRole-BciEmr9Y.js";import{_ as $t}from"./ArtesaProfilePicture.vue_vue_type_script_setup_true_lang-CvX_tVhj.js";import{_ as Da}from"./PopperFeathersItems.vue_vue_type_script_setup_true_lang-hljKYvsA.js";import{i as Ea}from"./index-BVk_Mu3e.js";import{t as Ma}from"./index-CsgZOv_I.js";import{u as Pa,F as Fa}from"./useFullcalendar-CGsOBmOU.js";import{_ as qa,a as Oa}from"./ArtesaTimePickerForCalendar.vue_vue_type_style_index_0_lang-BBYnsASy.js";import{v as Na}from"./validateFormAsync-7W-wrk_Q.js";import{_ as Te,a as Ra}from"./InputWrapperGroup.vue_vue_type_script_setup_true_lang-rA6cWmcO.js";import{v as je}from"./index-CAbXtJ5f.js";import{u as ja}from"./useIsViewDisabledByCompanyId-Vo_qqhQq.js";const Ba={class:"flex flex-wrap mb-1 gap-0.5 items-center"},Wa={class:"flex flex-col items-center bg-white rounded px-2 py-0.5"},Ga={class:"text-gray-400 text-xs relative"},La={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},Ha={class:"text-gray-400 text-xs"},za={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},Ka={class:"text-gray-400 text-xs"},Ja={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},Ya={class:"flex items-center"},Xa={class:"text-gray-400 text-xs"},Za={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},Qa={class:"text-gray-400 text-xs"},en={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},tn={class:"flex items-center"},an={class:"text-gray-400 text-xs"},nn={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},on={class:"text-gray-400 text-xs"},ln={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},sn={class:"text-gray-400 text-xs"},rn={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},un={class:"text-gray-400 text-xs"},dn=G({__name:"AssignmentEventTypeForm",props:{eventType:{type:Object,required:!0}},setup(i){const h=i,{t:n}=ee(),s=S({get(){return h.eventType.defaultEmployeeCount},set(g){h.eventType.defaultEmployeeCount=g,v()}}),l=S({get(){return h.eventType.defaultWorkDays??0},async set(g){h.eventType.defaultWorkDays=g,v()}}),u=S({get(){return h.eventType.defaultWorkingTimePerDay??0},set(g){h.eventType.defaultWorkingTimePerDay=g,v()}}),o=S({get(){return h.eventType.defaultManPower??0},set(g){h.eventType.defaultManPower=g,y()}}),r=S({get(){return(h.eventType.defaultManPower??0)/3600},set(g){o.value=g*3600}}),b=S({get(){return h.eventType.defaultDateAnchor!=="endsAt"},set(g){const f=g?"startsAt":"endsAt";h.eventType.defaultDateAnchor=f}});function v(){const g=(l.value||1)*(u.value||0)*(s.value||0);h.eventType.defaultManPower=g}function y(){if(!u.value||!s.value){l.value=1;return}const g=Math.ceil((o.value||0)/u.value/s.value);l.value=Math.max(g,1)}return(g,f)=>{const w=We,A=te("font-awesome-icon"),k=me,c=be,m=Q;return d(),E("div",null,[_("div",Ba,[t(k,{content:e(n)("assignment-event-types.form.employeeCountDescription")},{default:a(()=>[_("div",Wa,[t(w,{modelValue:e(s),"onUpdate:modelValue":f[0]||(f[0]=V=>J(s)?s.value=V:null),min:0,style:{width:"40px"},"value-on-clear":0,controls:!1,class:"inline-edit"},null,8,["modelValue"]),_("div",Ga,[t(A,{icon:e(s)<=0?"user-slash":e(s)===1?"user":"users"},null,8,["icon"])])])]),_:1},8,["content"]),t(k,{content:e(n)("assignment-event-types.form.workDaysDescription",{days:e(l)},e(l))},{default:a(()=>[_("div",La,[t(w,{modelValue:e(l),"onUpdate:modelValue":f[1]||(f[1]=V=>J(l)?l.value=V:null),min:1,style:{width:"38px"},"value-on-clear":1,controls:!1,class:"inline-edit"},null,8,["modelValue"]),_("div",Ha,C(e(n)("Day",e(l))),1)])]),_:1},8,["content"]),t(k,{content:e(n)("assignment-event-types.form.workingTimePerDayDescription",e(l))},{default:a(()=>[_("div",za,[t(ne,{modelValue:e(u),"onUpdate:modelValue":f[2]||(f[2]=V=>J(u)?u.value=V:null),"value-type":"number",class:"inline-edit !w-12"},null,8,["modelValue"]),_("div",Ka,C(e(n)("assignment-event-types.form.workingTimePerDay",e(l))),1)])]),_:1},8,["content"]),t(k,{content:e(n)(i.eventType.defaultIsAllDay?"assignment-event-types.form.isAllDayTrueDescription":"assignment-event-types.form.isAllDayFalseDescription")},{default:a(()=>[_("div",Ja,[_("div",Ya,[t(c,{"model-value":!i.eventType.defaultIsAllDay,"onUpdate:modelValue":f[3]||(f[3]=V=>i.eventType.defaultIsAllDay=!V)},null,8,["model-value"]),i.eventType.defaultIsAllDay?N("",!0):(d(),M(ne,{key:0,modelValue:i.eventType.defaultStartsAtTime,"onUpdate:modelValue":f[4]||(f[4]=V=>i.eventType.defaultStartsAtTime=V),"value-type":"time",class:"ml-1"},null,8,["modelValue"]))]),_("div",Xa,C(i.eventType.defaultIsAllDay?e(n)("assignment-event-types.form.time"):e(n)("assignment-event-types.form.defaultTime")),1)])]),_:1},8,["content"]),t(k,{content:e(n)("assignment-event-types.form.manPowerDescription")},{default:a(()=>[_("div",Za,[t(w,{modelValue:e(r),"onUpdate:modelValue":f[5]||(f[5]=V=>J(r)?r.value=V:null),precision:2,step:1*(i.eventType.defaultEmployeeCount||1),min:0,"value-on-clear":0,controls:!1,style:{width:"70px"},class:"inline-edit"},null,8,["modelValue","step"]),_("div",Qa,C(e(n)("assignment-event-types.form.effort")),1)])]),_:1},8,["content"]),t(k,{content:e(n)(i.eventType.defaultIsOutward?"assignment-event-types.form.isOutwardTrueDescription":"assignment-event-types.form.isOutwardFalseDescription")},{default:a(()=>[_("div",en,[_("div",tn,[t(c,{"model-value":!!i.eventType.defaultIsOutward,"onUpdate:modelValue":f[6]||(f[6]=V=>i.eventType.defaultIsOutward=!!V)},null,8,["model-value"]),i.eventType.defaultIsOutward?(d(),M(ne,{key:0,modelValue:i.eventType.defaultDurationDrive,"onUpdate:modelValue":f[7]||(f[7]=V=>i.eventType.defaultDurationDrive=V),"value-type":"number",class:"ml-1"},null,8,["modelValue"])):N("",!0)]),_("div",an,[t(A,{icon:"truck"})])])]),_:1},8,["content"]),t(k,{content:e(n)("assignment-event-types.form.minUploadCountDescription",{count:i.eventType.defaultMinUploadCount},i.eventType.defaultMinUploadCount??0)},{default:a(()=>[_("div",nn,[t(w,{modelValue:i.eventType.defaultMinUploadCount,"onUpdate:modelValue":f[8]||(f[8]=V=>i.eventType.defaultMinUploadCount=V),min:0,"value-on-clear":0,controls:!1,style:{width:"70px"},class:"inline-edit"},null,8,["modelValue"]),_("div",on,C(e(n)("assignment-event-types.form.requiredDocumentation")),1)])]),_:1},8,["content"]),t(k,{content:e(n)(e(b)?"assignment-event-types.form.isSchedulingForwardDescription":"assignment-event-types.form.isSchedulingBackwardsDescription")},{default:a(()=>[_("div",ln,[t(m,{size:"small",class:"my-1",onClick:f[9]||(f[9]=V=>b.value=!e(b))},{default:a(()=>[L(C(e(b)?g.$t("Forwards"):g.$t("Backwards")),1)]),_:1}),_("div",sn,C(e(n)("assignment-event-types.form.scheduling")),1)])]),_:1},8,["content"]),t(k,{content:e(n)("assignment-event-types.form.hideInfoInDoingDescription")},{default:a(()=>[_("div",rn,[t(c,{"model-value":!i.eventType.hideInfoInDoing,"onUpdate:modelValue":f[10]||(f[10]=V=>i.eventType.hideInfoInDoing=!V)},null,8,["model-value"]),_("div",un,C(e(n)("assignment-event-types.form.showInfoInDoing")),1)])]),_:1},8,["content"])])])}}}),cn={key:1,class:"font-normal"},mn={class:"p-3"},pn={class:"grid grid-cols-5 max-h-64 overflow-y-auto"},fn=["onClick"],xt=G({__name:"SelectFontAwesomeIcon",props:Ce({disabled:{type:Boolean,default:!1}},{modelValue:{default:null},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const h=ke(i,"modelValue"),n=S(()=>{const l=Mt?.definitions?.fas;return l?Object.keys(l):[]});function s(){h.value=null}return(l,u)=>{const o=te("font-awesome-icon"),r=Q;return d(),M(e(Aa),{disabled:l.disabled},{default:a(()=>[t(r,{class:"!w-[47px]"},{default:a(()=>[h.value?(d(),M(o,{key:0,icon:h.value,class:"text-xs","fixed-width":""},null,8,["icon"])):(d(),E("span",cn,C(l.$t("Icon")),1))]),_:1})]),popper:a(()=>[_("div",mn,[t(r,{text:"",disabled:!h.value,class:"w-full mb-1",onClick:s},{default:a(()=>[L(C(l.$t("actions.reset")),1)]),_:1},8,["disabled"]),_("div",pn,[(d(!0),E(z,null,Z(e(n),b=>(d(),E("div",{key:b,class:"px-3 py-2 cursor-pointer hover:bg-slate-100 rounded",onClick:()=>h.value=b},[t(o,{icon:b,"fixed-width":"",class:"text-sm"},null,8,["icon"])],8,fn))),128))])])]),_:1},8,["disabled"])}}}),yn=G({__name:"SelectAssignmentEventGroupType",props:Ce({clearable:{type:Boolean,default:!1},params:{type:Object,default:void 0},fetchParams:{type:Object,default:void 0}},{modelValue:{default:null},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const h=i,n=ke(i,"modelValue"),s=mt().createScope(),l=S(()=>({...h.params,query:{$sort:{order:1},...h.params?.query}})),u=S(()=>{if(h.fetchParams===null)return null;const o=h.fetchParams??h.params;return{...o,query:{$sort:{order:1},...o?.query}}});return(o,r)=>(d(),M(Vt,{"model-value":n.value,store:e(s),limit:100,clearable:i.clearable,"label-field":"name",placeholder:o.$t("group"),"disable-autocomplete":"",params:e(l),"fetch-params":e(u),"onUpdate:modelValue":r[0]||(r[0]=b=>n.value=b)},null,8,["model-value","store","clearable","placeholder","params","fetch-params"]))}}),vn=qt(()=>na(()=>import("./StandardProcessesSettings-DDC352r-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))),gn=G({__name:"SettingsAssignmentEvents",props:{companyId:{type:Number,required:!0}},setup(i,{expose:h}){const n=i,s=R(["standard-processes"]),l=X(),u=X(),o=X(),r=mt().createScope(),b=Pe().createScope(),v=de(),y=de(),g=S(()=>!!l.value?.hasChanges||!!u.value?.hasChanges||!!o.value?.hasChanges);function f(){l.value?.reset(),u.value?.reset(),o.value?.reset()}async function w(){await l.value?.save(),await De(),await u.value?.save(),await De(),await o.value?.save()}const A=S(()=>({query:{companyId:n.companyId,$sort:{order:1}}})),k=S(()=>({query:{companyId:n.companyId,$sort:{order:1}}}));return h({cancel:f,save:w,hasChanges:g}),(c,m)=>{const V=oe,T=Se,q=te("font-awesome-icon"),B=Q,$=me,p=Ee,U=Me,P=Ft;return d(),E("div",null,[t(U,{modelValue:e(s),"onUpdate:modelValue":m[6]||(m[6]=x=>J(s)?s.value=x:null)},{default:a(()=>[t(p,{title:c.$t("assignmentEvent.settings.assignmentEvents"),name:"event-types"},{default:a(()=>[m._lazyshow1||e(s).includes("event-types")?(m._lazyshow1=!0,d(),E(z,null,[Y(_("div",null,[t(se,{ref_key:"refTableEventTypes",ref:u,store:e(b),params:e(k),sortable:"",collapsable:"","hide-delete-button":"","active-status-filter":e(v),"create-data":({items:x})=>({companyId:i.companyId,order:x.length+1}),onSorted:m[1]||(m[1]=({items:x})=>x.forEach((F,I)=>F.order=I+1)),onDeleted:m[2]||(m[2]=({items:x})=>x.forEach((F,I)=>F.order=I+1))},{topLeft:a(()=>[t(ce,{modelValue:e(v),"onUpdate:modelValue":m[0]||(m[0]=x=>J(v)?v.value=x:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),"expanded-row":a(({row:x})=>[t(dn,{"event-type":x},null,8,["event-type"])]),default:a(()=>[t(j,{title:c.$t("assignmentEvent.name"),width:"minmax(200px, 1fr)"},{default:a(({row:x})=>[t(V,{modelValue:x.name,"onUpdate:modelValue":F=>x.name=F,placeholder:c.$t("assignmentEvent.settings.new")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["title"]),t(j,{title:c.$t("ShortName"),width:"95px"},{default:a(({row:x})=>[t(V,{modelValue:x.shortName,"onUpdate:modelValue":F=>x.shortName=F},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(j,{label:c.$t("Icon"),width:"min-content"},{default:a(({row:x})=>[t(xt,{modelValue:x.icon,"onUpdate:modelValue":F=>x.icon=F},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),t(j,{title:"Gruppe",width:"170px"},{default:a(({row:x})=>[t(yn,{modelValue:x.defaultGroupType,"onUpdate:modelValue":F=>x.defaultGroupType=F,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(j,{width:"min-content"},{default:a(({row:x})=>[t(T,{modelValue:x.color,"onUpdate:modelValue":F=>x.color=F,predefine:e(Ie)},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:1}),t(j,{width:"min-content"},{default:a(({row:x})=>[t($,{content:x.deactivatedAt?c.$t("actions.Activate"):c.$t("actions.Deactivate")},{default:a(()=>[t(B,{onClick:()=>x.deactivatedAt=x.deactivatedAt?null:new Date},{default:a(()=>[t(q,{icon:x.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","active-status-filter","create-data"])],512),[[ae,e(s).includes("event-types")]])],64)):N("v-show-if",!0)]),_:1},8,["title"]),t(p,{title:c.$t("assignmentEvent.settings.assignmentEventGroups"),name:"group-types"},{default:a(()=>[m._lazyshow2||e(s).includes("group-types")?(m._lazyshow2=!0,d(),E(z,null,[Y(_("div",null,[t(se,{ref_key:"refTableGroupTypes",ref:l,store:e(r),params:e(A),"company-id":i.companyId,"hide-delete-button":"","active-status-filter":e(y),"create-data":({items:x})=>({companyId:i.companyId,order:x.length+1}),sortable:"",onSorted:m[4]||(m[4]=({items:x})=>x.forEach((F,I)=>F.order=I+1)),onDeleted:m[5]||(m[5]=({items:x})=>x.forEach((F,I)=>F.order=I+1))},{topLeft:a(()=>[t(ce,{modelValue:e(y),"onUpdate:modelValue":m[3]||(m[3]=x=>J(y)?y.value=x:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),default:a(()=>[t(j,{title:c.$t("Group"),width:"minmax(200px, 1fr)"},{default:a(({row:x})=>[t(V,{modelValue:x.name,"onUpdate:modelValue":F=>x.name=F,placeholder:c.$t("NewGroup")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["title"]),t(j,{width:"min-content"},{default:a(({row:x})=>[t($,{content:x.deactivatedAt?c.$t("actions.Activate"):c.$t("actions.Deactivate")},{default:a(()=>[t(B,{onClick:()=>x.deactivatedAt=x.deactivatedAt?null:new Date},{default:a(()=>[t(q,{icon:x.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","company-id","active-status-filter","create-data"])],512),[[ae,e(s).includes("group-types")]])],64)):N("v-show-if",!0)]),_:1},8,["title"]),t(p,{title:c.$t("assignmentEvent.settings.assignmentEventStandardProcesses"),name:"standard-processes"},{default:a(()=>[m._lazyshow3||e(s).includes("standard-processes")?(m._lazyshow3=!0,d(),E(z,null,[Y(_("div",null,[(d(),M(Pt,null,{fallback:a(()=>[Y(_("div",{class:"flex"},null,512),[[P,!0]])]),default:a(()=>[t(e(vn),{ref_key:"refStandardProcesses",ref:o,"company-id":i.companyId},null,8,["company-id"])]),_:1}))],512),[[ae,e(s).includes("standard-processes")]])],64)):N("v-show-if",!0)]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}}),_n=G({__name:"SettingsAssignmentStatusTypes",props:{companyId:{}},setup(i,{expose:h}){const n=oa().createScope(),s=R(),l=de();function u(){return s.value?.reset()}function o(){return s.value?.save()}const r=S(()=>!!s.value?.hasChanges),{t:b}=ee(),v=S(()=>[{value:"new",label:b("assignmentStatusTypes.new")},{value:"inProgress",label:b("assignmentStatusTypes.inProgress")},{value:"done",label:b("assignmentStatusTypes.done")},{value:"cancelled",label:b("assignmentStatusTypes.cancelled")}]);function y(g){switch(g){case"new":return"warning";case"inProgress":return"info";case"done":return"success";case"cancelled":return"danger"}}return h({cancel:u,save:o,hasChanges:r}),(g,f)=>{const w=oe,A=nt,k=we,c=he,m=te("font-awesome-icon"),V=Q;return d(),E("div",null,[t(se,{ref_key:"refTable",ref:s,store:e(n),"company-id":g.companyId,"create-data":({items:T})=>({companyId:g.companyId,order:T.length+1}),params:{query:{$sort:{order:1}}},"active-status-filter":e(l),collapsable:"","hide-delete-button":"",sortable:"",onSorted:f[1]||(f[1]=({items:T})=>T.forEach((q,B)=>q.order=B+1)),onDeleted:f[2]||(f[2]=({items:T})=>T.forEach((q,B)=>q.order=B+1))},{topLeft:a(()=>[t(ce,{modelValue:e(l),"onUpdate:modelValue":f[0]||(f[0]=T=>J(l)?l.value=T:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),"expanded-row":a(({row:T})=>[t(w,{modelValue:T.description,"onUpdate:modelValue":q=>T.description=q,type:"textarea",placeholder:g.$t("Description")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),default:a(()=>[t(j,{title:g.$t("name"),width:"minmax(200px, 1fr)"},{default:a(({row:T})=>[t(w,{modelValue:T.name,"onUpdate:modelValue":q=>T.name=q},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(j,{title:g.$t("Category"),width:"minmax(200px, 300px)"},{default:a(({row:T})=>[t(c,{"model-value":T.category??void 0,"fit-input-width":"",class:"w-full","onUpdate:modelValue":q=>T.category=q},{default:a(()=>[(d(!0),E(z,null,Z(e(v),q=>(d(),M(k,{key:q.value,label:q.label,value:q.value},{default:a(()=>[t(A,{effect:"light",type:y(q.value)},{default:a(()=>[L(C(q.label),1)]),_:2},1032,["type"])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue"])]),_:1},8,["title"]),t(j,{width:"min-content"},{default:a(({row:T})=>[t(me,{content:T.deactivatedAt?e(b)("actions.Activate"):e(b)("actions.Deactivate")},{default:a(()=>[t(V,{onClick:()=>T.deactivatedAt=T.deactivatedAt?null:new Date},{default:a(()=>[t(m,{icon:T.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","company-id","create-data","active-status-filter"])])}}}),bn=G({__name:"SettingsAssignmentTagTypes",props:{companyId:{}},setup(i,{expose:h}){const n=i,s=la().createScope(),l=R(),u=de(),o=S(()=>({query:{companyId:n.companyId,$sort:{order:1}}}));function r(){return l.value?.reset()}function b(){return l.value?.save()}const v=S(()=>!!l.value?.hasChanges);return h({cancel:r,save:b,hasChanges:v}),(y,g)=>{const f=oe,w=Se,A=te("font-awesome-icon"),k=Q,c=me;return d(),E("div",null,[t(se,{ref_key:"refTable",ref:l,store:e(s),"company-id":y.companyId,"create-data":({items:m})=>({companyId:y.companyId,order:m.length+1}),sortable:"",params:e(o),"hide-delete-button":"","active-status-filter":e(u),onSorted:g[1]||(g[1]=({items:m})=>m.forEach((V,T)=>V.order=T+1)),onDeleted:g[2]||(g[2]=({items:m})=>m.forEach((V,T)=>V.order=T+1))},{topLeft:a(()=>[t(ce,{modelValue:e(u),"onUpdate:modelValue":g[0]||(g[0]=m=>J(u)?u.value=m:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),default:a(()=>[t(j,{title:y.$t("name"),width:"1fr"},{default:a(({row:m})=>[t(f,{modelValue:m.name,"onUpdate:modelValue":V=>m.name=V},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(j,{width:"min-content"},{default:a(({row:m})=>[t(w,{modelValue:m.color,"onUpdate:modelValue":V=>m.color=V,predefine:e(Ie)},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:1}),t(j,{width:"min-content"},{default:a(({row:m})=>[t(c,{content:m.deactivatedAt?y.$t("actions.Activate"):y.$t("actions.Deactivate")},{default:a(()=>[t(k,{onClick:()=>m.deactivatedAt=m.deactivatedAt?null:new Date},{default:a(()=>[t(A,{icon:m.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","company-id","create-data","params","active-status-filter"])])}}}),hn=G({__name:"SettingsAssignmentTypes",props:{companyId:{}},setup(i,{expose:h}){const n=i,s=sa().createScope(),l=R(),u=de(),o=S(()=>({query:{companyId:n.companyId,$sort:{order:1}}}));function r(){return l.value?.reset()}function b(){return l.value?.save()}const v=S(()=>l.value?.hasChanges);return h({cancel:r,save:b,hasChanges:v}),(y,g)=>{const f=oe,w=Se,A=te("font-awesome-icon"),k=Q,c=me;return d(),E("div",null,[t(se,{ref_key:"refTable",ref:l,store:e(s),params:e(o),sortable:"","hide-delete-button":"","active-status-filter":e(u),"create-data":({items:m})=>({companyId:y.companyId,order:m.length+1}),onSorted:g[1]||(g[1]=({items:m})=>m.forEach((V,T)=>V.order=T+1)),onDeleted:g[2]||(g[2]=({items:m})=>m.forEach((V,T)=>V.order=T+1))},{topLeft:a(()=>[t(ce,{modelValue:e(u),"onUpdate:modelValue":g[0]||(g[0]=m=>J(u)?u.value=m:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),default:a(()=>[t(j,{title:y.$t("name"),width:"1fr"},{default:a(({row:m})=>[t(f,{modelValue:m.name,"onUpdate:modelValue":V=>m.name=V},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(j,{width:"min-content"},{default:a(({row:m})=>[t(w,{modelValue:m.color,"onUpdate:modelValue":V=>m.color=V,predefine:e(Ie)},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:1}),t(j,{width:"min-content"},{default:a(({row:m})=>[t(c,{content:m.deactivatedAt?y.$t("actions.Activate"):y.$t("actions.Deactivate")},{default:a(()=>[t(k,{onClick:()=>m.deactivatedAt=m.deactivatedAt?null:new Date},{default:a(()=>[t(A,{icon:m.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","active-status-filter","create-data"])])}}}),wn={class:"space-y-2"},Vn={key:0},kn=G({__name:"SettingsCompany",props:{companyId:{}},setup(i,{expose:h}){const n=i,s=ze(),{t:l}=ee(),u=ra().createScope(),o=Ke().createScope(),{data:r}=o.useGet({id:()=>n.companyId,lazy:!0}),b=S(()=>r.value?.address),v=S(()=>!r.value||r.value.address?!1:!r.value.addressId);Ge(v,()=>{r.value?.address&&(r.value.address=u.construct({companyId:n.companyId}))});const y=S(()=>{const w={number:l("assignment.property.number"),name:l("assignment.property.name"),addressProperty:l("assignment.relation.addressProperty"),customer:l("assignment.relation.customer")};return Object.entries(w).map(([A,k])=>({label:k,value:A}))}),g=S(()=>u.hasChanges(b.value)||o.hasChanges(r.value));async function f(){await u.save(b.value),await o.save(r.value)}return h({save:f,hasChanges:g}),(w,A)=>{const k=Ca,c=$e,m=xe,V=we,T=he;return d(),E("div",wn,[e(b)?(d(),E("div",Vn,[_("h4",null,C(e(l)("addresses.name"))+": ",1),t(m,{"label-position":e(s).sm?"left":"top"},{default:a(()=>[t(c,{label:w.$t("companyAddress")},{default:a(()=>[e(b)?(d(),M(k,{key:0,modelValue:e(b),"onUpdate:modelValue":A[0]||(A[0]=q=>J(b)?b.value=q:null),placeholder:w.$t("address")},null,8,["modelValue","placeholder"])):N("",!0)]),_:1},8,["label"])]),_:1},8,["label-position"]),t(Ta,{modelValue:e(b),"onUpdate:modelValue":A[1]||(A[1]=q=>J(b)?b.value=q:null),disabled:""},null,8,["modelValue"])])):N("",!0),_("div",null,[_("h4",null,C(e(l)("settings.company-settings.assignmentNameToShow"))+": ",1),e(r)?(d(),M(T,{key:0,modelValue:e(r).assignmentNameToShow,"onUpdate:modelValue":A[2]||(A[2]=q=>e(r).assignmentNameToShow=q)},{default:a(()=>[(d(!0),E(z,null,Z(e(y),q=>(d(),M(V,{key:q.value,label:q.label,value:q.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):N("",!0)])])}}}),Sn=G({__name:"ArtesaElInputJson",props:{modelValue:{type:[Object,Array,String,Number],default:null}},emits:["update:modelValue"],setup(i,{emit:h}){const n=i,s=h,l=R(JSON.stringify(n.modelValue)),u=R(!1),o=R(!1);let r;ve(o,g=>{g||(r=Date.now())}),ve(()=>n.modelValue,g=>{l.value=JSON.stringify(g)});function b(){o.value||Date.now()-r<150||(o.value=!0)}async function v(){if(o.value){try{const g=JSON.parse(l.value);s("update:modelValue",g)}catch(g){console.error(g);return}o.value=!1}}function y(){o.value?v():b()}return(g,f)=>{const w=te("font-awesome-icon"),A=Q,k=oe;return d(),M(k,{modelValue:e(l),"onUpdate:modelValue":f[0]||(f[0]=c=>J(l)?l.value=c:null),disabled:!e(o),onKeyup:Le(y,["enter"]),onClick:b,onMouseover:f[1]||(f[1]=()=>u.value=!0),onMouseleave:f[2]||(f[2]=()=>u.value=!1)},ot({_:2},[e(u)?{name:"append",fn:a(()=>[t(A,{onClick:y},{default:a(()=>[t(w,{icon:e(o)?"check":"edit",class:"text-xs"},null,8,["icon"])]),_:1})]),key:"0"}:void 0]),1032,["modelValue","disabled"])}}}),$n=G({__name:"SettingsCustomViewsData",props:{companyId:{},customView:{}},setup(i,{expose:h}){const n=i,s=pt().createScope(),l=R(),u=S(()=>({query:{viewUuid:n.customView.uuid}})),o=S(()=>({query:{viewId:n.customView.id}}));async function r(){await l.value?.save()}function b(){l.value?.reset()}return h({cancel:b,save:r,hasChanges:S(()=>l.value?.hasChanges)}),(v,y)=>{const g=oe,f=j;return d(),M(se,{ref_key:"refTable",ref:l,store:e(s),params:e(u),"fetch-params":e(o),"company-id":v.companyId,"create-data":()=>({view:v.customView,companyId:v.companyId})},{default:a(()=>[t(f,{title:v.$t("service")},{default:a(({row:w})=>[t(g,{modelValue:w.servicePath,"onUpdate:modelValue":A=>w.servicePath=A},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(f,{title:v.$t("Key")},{default:a(({row:w})=>[t(g,{modelValue:w.routeKey,"onUpdate:modelValue":A=>w.routeKey=A},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(f,{title:v.$t("data")},{default:a(({row:w})=>[t(Sn,{modelValue:w.data,"onUpdate:modelValue":A=>w.data=A},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"])]),_:1},8,["store","params","fetch-params","company-id","create-data"])}}}),It=G({__name:"FeathersMNSelect",props:{junctionStore:{},relationStore:{},singleObject:{},labelField:{},companyId:{},data:{default:void 0},placeholder:{default:void 0},collapseTags:{type:Boolean,default:!1},relationSecondaryKey:{},singleObjectSecondaryKey:{},localOnly:{type:Boolean,default:!1}},setup(i,{expose:h}){const n=i,s=S(()=>n.labelField),l=Ze(n.junctionStore),u=Ze(n.relationStore),o=ia(()=>({companyId:n.companyId,singleObjectUuid:n.singleObject.uuid,singleObjectId:n.singleObject.id})),{data:r,hasChanges:b,save:v,cancel:y}=l.useFeathersItems({params:S(()=>({query:{companyId:o.value.companyId,[`${n.singleObjectSecondaryKey}Uuid`]:o.value.singleObjectUuid}})),fetchParams:S(()=>({query:{companyId:o.value.companyId,[`${n.singleObjectSecondaryKey}Id`]:o.value.singleObjectId}})),limit:1e3,localOnly:()=>n.localOnly}),g=S(()=>r.value.map(k=>k[`${n.relationSecondaryKey}Id`])),{data:f}=u.useFindOnce({params:S(()=>({query:{uuid:{$in:r.value.map(k=>k[`${n.relationSecondaryKey}Uuid`])}}})),items:g,fetchParams:k=>({query:{id:{$in:k},$limit:-1}})});function w(k){l.construct({companyId:n.companyId,[n.singleObjectSecondaryKey]:n.singleObject,[n.relationSecondaryKey]:k})}function A(k){const c=r.value.find(m=>m[`${n.relationSecondaryKey}Uuid`]===k.uuid);c&&l.markForRemove(c)}return h({hasChanges:b,save:v,cancel:y}),(k,c)=>(d(),M(Vt,{"model-value":e(f),store:e(u),"label-field":e(s),placeholder:k.placeholder,"collapse-tags":k.collapseTags,params:{query:{companyId:k.companyId}},"fetch-params":{query:{companyId:k.companyId}},multi:!0,onAdded:w,onRemoved:A},null,8,["model-value","store","label-field","placeholder","collapse-tags","params","fetch-params"]))}}),At=G({__name:"SelectView",props:{modelValue:{type:String,default:void 0},disabled:{type:Boolean,default:!1},size:Ot,placeholder:{type:String,default:null},filterable:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},filterView:{type:Function,default:void 0}},emits:["update:modelValue"],setup(i,{emit:h}){const n=i,s=h,l=Nt(),u=R("");function o(v){u.value=v}const r=S(()=>lt(ua.map(v=>{let y=v;try{y=l.resolve({name:v})?.meta?.name||v}catch{}return{value:v,label:y}}),"label")),b=S(()=>{const v=[];return r.value.forEach(y=>{n.filterView&&!n.filterView(y.value)||u.value&&!y.label.toLowerCase().includes(u.value.toLowerCase())||v.push(y)}),v});return(v,y)=>{const g=we,f=he;return d(),M(f,{"model-value":i.modelValue,clearable:i.clearable,disabled:i.disabled,size:i.size,placeholder:i.placeholder??v.$t("selectView"),filterable:i.filterable,"filter-method":o,"onUpdate:modelValue":y[0]||(y[0]=w=>s("update:modelValue",w))},{default:a(()=>[(d(!0),E(z,null,Z(e(b),w=>(d(),M(g,{key:w.value,value:w.value,innerHTML:w.label},null,8,["value","innerHTML"]))),128))]),_:1},8,["model-value","clearable","disabled","size","placeholder","filterable"])}}}),xn={class:"p-3 w-full"},In=G({__name:"SettingsCustomViews",props:{companyId:{}},setup(i,{expose:h}){const n=i,s=da().createScope(),l=ca().createScope(),u=pt().createScope(),o=Fe().createScope(),{hasChanges:r,save:b,reset:v}=l.useFeathersItems({params:S(()=>({query:{companyId:n.companyId}})),localOnly:!0,limit:-1}),{hasChanges:y,save:g,reset:f}=u.useFeathersItems({params:S(()=>({query:{companyId:n.companyId}})),localOnly:!0,limit:-1}),w=R(),{can:A}=Ve();function k(){v(),w.value?.reset(),f()}async function c(){await b(),await w.value?.save(),await g()}const m=S(()=>w.value?.hasChanges||r.value||y.value),V=S(()=>({query:{companyId:n.companyId,$sort:{order:1}}}));return h({cancel:k,save:c,hasChanges:m}),(T,q)=>{const B=$e,$=xe,p=j,U=oe;return d(),E("div",null,[t(se,{ref_key:"refTable",ref:w,store:e(s),params:e(V),sortable:"","company-id":T.companyId,collapsable:"",onSorted:q[0]||(q[0]=({items:P})=>P.forEach((x,F)=>x.order=F+1)),onDeleted:q[1]||(q[1]=({items:P})=>P.forEach((x,F)=>x.order=F+1))},{"expanded-row":a(({row:P})=>[_("div",xn,[t($,null,{default:a(()=>[t(B,{label:T.$t("roles.name")+":"},{default:a(()=>[t(It,{"single-object":P,"company-id":T.companyId,"junction-store":e(l),"relation-store":e(o),placeholder:T.$t("roles.name"),"label-field":"name","relation-secondary-key":"role","single-object-secondary-key":"view",class:"w-96"},null,8,["single-object","company-id","junction-store","relation-store","placeholder"])]),_:2},1032,["label"])]),_:2},1024),t($n,{"custom-view":P,"company-id":T.companyId},null,8,["custom-view","company-id"])])]),default:a(()=>[t(p,{width:"300px"},{default:a(({row:P})=>[t(At,{modelValue:P.name,"onUpdate:modelValue":x=>P.name=x,class:"w-full",disabled:!e(A)("update",P)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),t(p,{width:"minmax(200px, 1fr)"},{default:a(({row:P})=>[t(U,{modelValue:P.text,"onUpdate:modelValue":x=>P.text=x,disabled:!e(A)("update",P),placeholder:T.$t("name")},null,8,["modelValue","onUpdate:modelValue","disabled","placeholder"])]),_:1}),t(p,{label:T.$t("Icon"),width:"min-content"},{default:a(({row:P})=>[t(xt,{modelValue:P.icon,"onUpdate:modelValue":x=>P.icon=x,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["store","params","company-id"])])}}}),An={key:0},Cn=G({__name:"EditUsersTable",props:{params:{type:Object,default:void 0},companyId:{type:Number,default:null},hideBottomButtons:{type:Boolean,default:!1}},setup(i,{expose:h}){const n=i,s=R(),l=R(),u=R(),o=Je().createScope(),{t:r}=ee(),b=ma().createScope(),{save:v,reset:y,hasChanges:g}=b.useFeathersItems({params:S(()=>({query:{}})),limit:-1,localOnly:!0}),{save:f,cancel:w,hasChanges:A}=kt({companyId:()=>n.companyId,local:!0}),k=de(),c=Rt({role:null,fullName:""}),m=S(()=>{const $={...n.params,query:{...n.params?.query,$sort:{createdAt:1,...n.params?.query?.$sort}}},{role:p}=c;return p?.id&&($.query.roleId=p.id),c?.fullName&&($.query.fullName={$regex:new RegExp(`^.*(${c.fullName}).*$`,"gim")}),n.companyId&&($.query.companyId=n.companyId),$}),V=S(()=>{const $={...n.params,query:{...n.params?.query}},{role:p}=c;return p?.id&&($.query.roleId=p.id),c?.fullName&&($.query.fullName={$iLike:`%${c.fullName}%`}),n.companyId&&($.query.companyId=n.companyId),$});function T(){w(),y(),s.value?.reset()}async function q(){await s.value?.save(),await De(),await Promise.all([f(),v()])}const B=S(()=>!!s.value?.hasChanges||A.value||g.value);return h({cancel:T,save:q,hasChanges:B}),($,p)=>{const U=j,P=te("font-awesome-icon"),x=oe,F=Q;return d(),M(se,{ref_key:"refTable",ref:s,store:e(o),params:e(m),"fetch-params":e(V),"create-data":()=>({companyId:i.companyId,createdAt:new Date}),"hide-delete-button":"","active-status-filter":e(k),onCloseCreateDialog:p[4]||(p[4]=()=>e(l)?.cancel()),onCloseEditDialog:p[5]||(p[5]=()=>e(u)?.cancel())},{topLeft:a(()=>[t(x,{modelValue:e(c).fullName,"onUpdate:modelValue":p[0]||(p[0]=I=>e(c).fullName=I),placeholder:"Name",clearable:"",style:{width:"170px"},onKeyup:p[1]||(p[1]=Le(()=>e(c).fullName="",["esc"]))},{prefix:a(()=>[t(P,{icon:"search"})]),_:1},8,["modelValue"]),t(St,{modelValue:e(c).role,"onUpdate:modelValue":p[2]||(p[2]=I=>e(c).role=I),clearable:"","company-id":i.companyId,style:{width:"170px"}},null,8,["modelValue","company-id"]),t(ce,{modelValue:e(k),"onUpdate:modelValue":p[3]||(p[3]=I=>J(k)?k.value=I:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),createForm:a(({item:I})=>[t(et,{ref_key:"refCreateForm",ref:l,"model-value":I,"hide-bottom-buttons":""},null,8,["model-value"])]),editForm:a(({item:I})=>[t(et,{ref_key:"refEditForm",ref:u,"model-value":I,"hide-bottom-buttons":""},null,8,["model-value"])]),editDialogButtons:a(({item:I})=>[I?(d(),E("div",An,[t(F,{type:I.deactivatedAt?"default":"danger",plain:"",onClick:H=>I.deactivatedAt=I.deactivatedAt?null:new Date},{default:a(()=>[L(C(I.deactivatedAt?e(r)("actions.Activate"):e(r)("actions.Deactivate")),1)]),_:2},1032,["type","onClick"])])):N("",!0)]),default:a(()=>[t(U,{title:$.$t("Employee"),width:"minmax(max-content, auto)"},{default:a(({row:I})=>[L(C(I.fullName),1)]),_:1},8,["title"]),t(U,{title:$.$t("Email"),width:"minmax(max-content, auto)"},{default:a(({row:I})=>[L(C(I.email),1)]),_:1},8,["title"]),t(U,{title:$.$t("workType"),width:"minmax(max-content, auto)"},{default:a(({row:I})=>[L(C(I.role?.name),1)]),_:1},8,["title"])]),_:1},8,["store","params","fetch-params","create-data","active-status-filter"])}}}),Tn=G({__name:"SettingsEditUsers",props:{companyId:{}},setup(i,{expose:h}){const n=Ua("superadmin"),s=S(()=>!!l.value?.hasChanges),l=R();function u(){return l.value?.cancel()}function o(){return l.value?.save()}return h({cancel:u,save:o,hasChanges:s}),(r,b)=>(d(),E("div",null,[t(Cn,{ref_key:"refTable",ref:l,"company-id":r.companyId,"hide-bottom-buttons":"","edit-dialog-hide-delete-button":!e(n)},null,8,["company-id","edit-dialog-hide-delete-button"])]))}}),Un={class:"flex flex-wrap items-center"},Dn=["onClick"],En=G({__name:"PopperSelectUser",props:{value:{type:Array,default:()=>[]},readonly:{type:Boolean,default:!1},params:{type:Object,default:void 0},fetchParams:{type:Object,default:void 0}},emits:["add-user","remove-user"],setup(i,{emit:h}){const n=R(),s=i,l=h,u=Je().createScope();function o(g){return g===null?null:{...s.params,query:{id:{$nin:s.value.map(f=>f.id).filter(ft)},deactivatedAt:null,$limit:20,...s.params?.query,$sort:{fullName:1,...s.params?.query?.$sort}}}}const r=S(()=>o(s.params)),b=S(()=>{const g=s.fetchParams!==void 0?s.fetchParams:s.params;return o(g)});function v(g){l("add-user",{user:g})}function y(g){l("remove-user",{user:g,index:s.value.indexOf(g)})}return(g,f)=>{const w=te("font-awesome-icon"),A=Q;return d(),E("div",null,[_("div",Un,[(d(!0),E(z,null,Z(i.value,k=>(d(),M($t,{key:k.uuid,user:k,size:"small",class:"group relative !overflow-visible my-1 mr-1"},{default:a(()=>[i.readonly?N("",!0):(d(),E("div",{key:0,class:"hidden group-hover:flex absolute w-4 h-4 bg-red-700 rounded-full -right-1.5 -top-1.5 items-center justify-center cursor-pointer text-white",onClick:()=>!i.readonly&&y(k)},[t(e(jt),{class:"w-3 h-3"})],8,Dn))]),_:2},1032,["user"]))),128)),i.readonly?N("",!0):(d(),M(Da,{key:0,ref_key:"refPopper",ref:n,store:e(u),params:e(r)??void 0,"fetch-params":e(b)??void 0,readonly:i.readonly,"search-field":"fullName","use-search":"","prepend-search":"","append-search":"","use-search-on-server":"","onUpdate:modelValue":v},{item:a(({item:k})=>[L(C(k.fullName),1)]),default:a(()=>[t(A,{circle:"",type:"primary",class:"!w-[30px] !h-[30px] my-1 mr-1"},{default:a(()=>[t(w,{icon:"user-plus",class:"ml-0.5 w-4 h-4"})]),_:1})]),_:1},8,["store","params","fetch-params","readonly"]))])])}}}),Mn={class:"@container w-full"},Pn={class:"font-bold text-gray-500"},Fn={class:"mt-4 mb-2 font-bold text-gray-600 flex"},qn={class:"flex-1"},On={key:0},Nn={class:"grid grid-cols-1 @md:grid-cols-2 @xl:grid-cols-3 @2xl:grid-cols-4 border-t border-l border-gray-200 ml-2"},Rn=["onClick"],jn={class:"mr-auto @3xl:mr-0"},Bn=G({__name:"GangForm",props:{gang:{type:Object,required:!0}},setup(i){const{t:h}=ee(),n=i,s=yt().createScope(),l=vt().createScope(),u=Pe().createScope(),{can:o}=Ve(),{data:r,markForRemove:b}=s.useFeathersItems({params:S(()=>({query:{companyUuid:n.gang.companyUuid,gangUuid:n.gang.uuid,$sort:{order:1}}})),localOnly:!0,limit:1e3}),v=S(()=>{const $={users:[],gangUsers:[]};return r.value.forEach(p=>{p.user&&($.users.push(p.user),$.gangUsers.push(p))}),$});function y($){s.construct({companyUuid:n.gang.companyUuid,gang:n.gang,user:$,order:r.value.length+1})}function g($){b($)}const{data:f,markForRemove:w}=l.useFeathersItems({params:S(()=>({query:{gangUuid:n.gang.uuid}})),fetchParams:S(()=>({query:{gangId:n.gang.id}})),localOnly:!0,limit:1e3}),{data:A}=u.useFind({params:S(()=>({query:{companyId:n.gang.companyId,deactivatedAt:null,$limit:1e3,$sort:{order:1}}}))}),k=S(()=>{const $={};for(const p of f.value){const U=p.gangUuid;$[U]||($[U]={});const P=p.eventTypeUuid;$[U][P]=p}return $}),c=S(()=>{const $=k.value[n.gang.uuid];return Object.values($||{}).length===A.value.length}),m=S(()=>{const $=k.value[n.gang.uuid];return!!Object.values($||{}).length});function V({eventType:$}){return k.value[n.gang.uuid]?.[$.uuid]}function T({eventType:$}){const p=V({eventType:$});q({eventType:$,isActive:!p})}function q({eventType:$,isActive:p}){const U=V({eventType:$});U&&p||!U&&!p||(p?l.construct({companyId:n.gang.companyId,eventType:$,gang:n.gang}):U&&w(U))}function B($){A.value.forEach(p=>{q({eventType:p,isActive:$})})}return($,p)=>{const U=te("font-awesome-icon"),P=Q,x=Bt,F=be;return d(),E("div",Mn,[_("div",Pn,C(e(h)("user.name"))+":",1),t(En,{value:e(v).users,class:"ml-2",onAddUser:p[0]||(p[0]=({user:I})=>y(I)),onRemoveUser:p[1]||(p[1]=({index:I})=>g(e(v).gangUsers[I]))},null,8,["value"]),_("div",Fn,[_("div",qn,C(e(h)("gang-capabilities.name",2))+":",1),e(o)("update",e(l).servicePath)?(d(),E("div",On,[t(x,null,{default:a(()=>[t(P,{disabled:!e(m),size:"small",onClick:p[2]||(p[2]=()=>B(!1))},{default:a(()=>[t(U,{icon:"times"})]),_:1},8,["disabled"]),t(P,{disabled:e(c),size:"small",onClick:p[3]||(p[3]=()=>B(!0))},{default:a(()=>[t(U,{icon:"check"})]),_:1},8,["disabled"])]),_:1})])):N("",!0)]),_("div",Nn,[(d(!0),E(z,null,Z(e(A),I=>(d(),E("div",{key:I.uuid,class:ge(["flex-1 flex items-center flex-row border-r border-b border-gray-200 py-1 px-3",[e(k)[i.gang.uuid]?.[I.uuid]?"bg-primary/10 text-gray-800":"bg-white text-gray-500"]])},[_("div",{class:"flex-1 flex text-sm w-full overflow-hidden text-ellipsis whitespace-nowrap cursor-pointer",onClick:()=>T({eventType:I})},C(I.name),9,Rn),_("div",jn,[t(F,{disabled:!e(o)("update",e(l).servicePath),"model-value":!!e(k)[i.gang.uuid]?.[I.uuid],"onUpdate:modelValue":H=>q({eventType:I,isActive:!!H})},null,8,["disabled","model-value","onUpdate:modelValue"])])],2))),128))])])}}}),Wn=G({__name:"SettingsGangs",props:{companyId:{type:Number,required:!0}},setup(i,{expose:h}){const n=i,{t:s}=ee(),l=X(),u=pa().createScope(),o=yt().createScope(),r=vt().createScope(),{data:b,hasChanges:v,reset:y,save:g,markForRemove:f}=o.useFeathersItems({params:S(()=>({query:{companyId:n.companyId,$sort:{order:1}}})),fetchParams:S(()=>({query:{companyId:n.companyId,$sort:{order:1}}})),limit:1e3}),{data:w,hasChanges:A,reset:k,save:c,markForRemove:m}=r.useFeathersItems({params:S(()=>({query:{companyId:n.companyId}})),fetchParams:S(()=>({query:{companyId:n.companyId}})),limit:1e3}),V=S(()=>l.value?.hasChanges||v.value||A.value);function T({item:$,items:p}){const U=b.value.filter(x=>x.gangUuid===$.uuid),P=w.value.filter(x=>x.gangUuid===$.uuid);U.forEach(x=>f(x)),P.forEach(x=>m(x)),p.forEach((x,F)=>{x.order!==F+1&&(x.order=F+1)})}function q(){l.value?.reset(),y(),k()}async function B(){await l.value?.save({saveNew:!0,saveChanged:!0,saveRemoved:!1}),await Promise.all([g(),c()]),await l.value?.save({saveNew:!1,saveChanged:!1,saveRemoved:!0})}return h({hasChanges:V,cancel:q,save:B}),($,p)=>{const U=oe,P=j;return d(),E("div",null,[t(se,{ref_key:"tableRef",ref:l,store:e(u),params:{query:{companyId:i.companyId,$sort:{order:1}}},sortable:!0,collapsable:"","create-data":({items:x})=>({companyId:i.companyId,order:x.length+1}),onSorted:p[0]||(p[0]=({items:x})=>{x.forEach((F,I)=>F.order=I+1)}),onDeleted:p[1]||(p[1]=({item:x,items:F})=>T({item:x,items:F}))},{"expanded-row":a(({row:x})=>[t(Bn,{gang:x},null,8,["gang"])]),default:a(()=>[t(P,{title:e(s)("gangs.property.name"),width:"minmax(200px, 1fr)"},{default:a(({row:x})=>[t(U,{modelValue:x.name,"onUpdate:modelValue":F=>x.name=F},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"])]),_:1},8,["store","params","create-data"])])}}}),Gn={class:"flex justify-between mt-6"},Ln=G({__name:"FormHoliday",props:{modelValue:{type:Object,required:!0}},emits:["deleted","saved","created","canceled"],setup(i,{expose:h,emit:n}){const{can:s}=Ve(),{t:l}=ee(),u=i,o=gt().createScope(),r=R(),b=n,v=S(()=>u.modelValue),y=l("userAbsence.form.error.required")??"d",g={name:[{required:!0,message:y}],startsAt:[{type:"date",required:!0,message:y},{validator:(V,T,q)=>{if(T>(v.value.endsAt??0)){const B=l("userAbsence.form.error.startsAtBeforeEndsAt")??"d";q(new Error(B))}else q()}}]},f=S({set:V=>{if(!V){v.value.startsAt=null,v.value.endsAt=null;return}const[T,q]=V;v.value.startsAt=new Date(T),v.value.endsAt=Gt(new Date(q))},get:()=>v.value.startsAt&&v.value.endsAt?[v.value.startsAt,v.value.endsAt]:void 0}),w=R(!1),A=R(!1);function k(){o.resetOrRemove(v.value),b("canceled",v.value)}async function c(){w.value=!0;try{await st.confirm(l("holidays.form.doYouWantToDelete"),l("holidays.form.delete"),{confirmButtonText:l("actions.Delete"),cancelButtonText:l("actions.Cancel"),type:"warning",confirmButtonClass:"el-button--danger"}),await o.remove(v.value),b("deleted",v.value)}finally{w.value=!1}}async function m(){A.value=!0;try{await Na(r);const V=!v.value.id;await o.save(v.value),V&&b("created",v.value),b("saved",v.value)}finally{A.value=!1}}return h({cancel:k,remove:c,save:m}),(V,T)=>{const q=oe,B=$e,$=Wt,p=te("font-awesome-icon"),U=Q,P=xe;return d(),M(P,{ref_key:"refForm",ref:r,model:e(v),rules:g,"label-width":"80px","hide-required-asterisk":""},{default:a(()=>[t(B,{prop:"name",label:e(l)("holidays.name")},{default:a(()=>[t(q,{modelValue:e(v).name,"onUpdate:modelValue":T[0]||(T[0]=x=>e(v).name=x),placeholder:e(l)("holidays.name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(B,{prop:"startsAt",label:e(l)("Date")},{default:a(()=>[t($,{modelValue:e(f),"onUpdate:modelValue":T[1]||(T[1]=x=>J(f)?f.value=x:null),type:"daterange","unlink-panels":"",format:"DD.MM.YY"},null,8,["modelValue"])]),_:1},8,["label"]),_("div",Gn,[_("div",null,[e(v).id&&e(s)("delete",e(v))?(d(),M(U,{key:0,loading:e(w),plain:"",type:"danger",class:"mr-2",onClick:c},{default:a(()=>[t(p,{icon:"trash-alt",class:"mr-2"}),L(" "+C(e(l)("actions.Delete")),1)]),_:1},8,["loading"])):N("",!0)]),_("div",null,[t(U,{text:"",class:"mr-2",onClick:k},{default:a(()=>[L(C(e(l)("actions.Cancel")),1)]),_:1}),t(U,{type:"primary",onClick:m},{default:a(()=>[L(C(e(l)("actions.Save")),1)]),_:1})])])]),_:1},8,["model"])}}}),Hn=G({__name:"DialogFormHoliday",props:{modelValue:{type:Object,required:!0},visible:{type:Boolean,default:!1}},emits:["update:visible","canceled","deleted","saved","created"],setup(i,{emit:h}){const n=h,{t:s}=ee(),l=X();return(u,o)=>{const r=Lt;return d(),M(r,{"model-value":i.visible,title:e(s)("holidays.form.create"),class:"dialog-form-holiday","onUpdate:modelValue":o[4]||(o[4]=b=>n("update:visible",b)),onClose:o[5]||(o[5]=()=>e(l)?.cancel())},{default:a(()=>[t(Ln,{ref_key:"refFormHoliday",ref:l,"model-value":i.modelValue,onCanceled:o[0]||(o[0]=b=>{n("canceled",b),n("update:visible",!1)}),onDeleted:o[1]||(o[1]=b=>{n("deleted",b),n("update:visible",!1)}),onSaved:o[2]||(o[2]=b=>{n("saved",b),n("update:visible",!1)}),onCreated:o[3]||(o[3]=b=>n("created",b))},null,8,["model-value"])]),_:1},8,["model-value","title"])}}}),zn={class:"flex items-center justify-between mb-4"},Kn={class:"flex items-center"},Jn={class:"hidden sm:block text-lg mr-2 font-bold"},Yn={class:"fc-event-inner"},Xn={class:"fc-event-title"},Zn=G({__name:"SettingsHolidays",props:{companyId:{}},setup(i,{expose:h}){const n=i,{t:s}=ee(),l=R(null),u=gt().createScope(),o=R(null),r=R(new Date),{data:b}=u.useFind({params:S(()=>!l.value||!n.companyId?null:{query:{startsAt:{$lt:l.value.endsAt},endsAt:{$gte:l.value.startsAt},companyId:n.companyId,$limit:-1}}),fetchParams:S(()=>!l.value||!n.companyId?null:{query:{startsAt:{$lt:l.value.endsAt},endsAt:{$gte:l.value.startsAt},companyId:n.companyId,$limit:-1}}),reevaluateAfter:["created","removed"]});function v(k,c){o.value=u.construct({companyId:n.companyId,startsAt:k,endsAt:c})}const y=S(()=>b.value.map(k=>({id:k.uuid,title:k.name??"",start:k.startsAt,end:k.endsAt&&Oa(k.endsAt,{seconds:1}),extendedProps:{holiday:k},allDay:!0,backgroundColor:fa,textColor:ya,borderColor:"transparent",className:"cursor-pointer"}))),{ref:g,options:f,rerender:w}=Pa({plugins:[Ea,Ma],initialView:"dayGridMonth",headerToolbar:!1,selectable:!0,select:k=>{v(k.start,new Date(k.end.getTime()-1))},selectMirror:!0,eventClick:({event:k})=>{const{holiday:c}=k.extendedProps;o.value=c},views:{dayGridMonth:{dayMaxEventRows:6}},events:y},{dateRange:l,calendarDate:r});function A(k){Ue({title:s("holidays.dialog.success"),message:s("holidays.dialog.message",[k.name]),type:"info"})}return h({rerender:w}),(k,c)=>{const m=te("font-awesome-icon"),V=Q;return d(),E("div",null,[_("div",zn,[_("div",Kn,[_("div",Jn,C(e(s)("holidays.name",2)),1),t(qa,{modelValue:e(r),"onUpdate:modelValue":c[0]||(c[0]=T=>J(r)?r.value=T:null),size:"default","class-button-today":"hidden md:block",resolution:"month","picker-width":"95px"},null,8,["modelValue"])]),t(V,{type:"primary",onClick:c[1]||(c[1]=()=>v())},{default:a(()=>[t(m,{icon:"plus",class:"mr-2"}),L(" "+C(e(s)("holidays.form.create")),1)]),_:1})]),t(e(Fa),{ref_key:"calendarRef",ref:g,options:e(f),class:"absences-calendar"},{eventContent:a(({event:T})=>[_("div",{class:"fc-event-container rounded-sm",style:Ht(T.extendedProps.style)},[_("div",Yn,[_("div",Xn,C(T.title),1)])],4)]),_:1},8,["options"]),e(o)?(d(),M(Hn,{key:0,"model-value":e(o),visible:!!e(o),"onUpdate:visible":c[2]||(c[2]=()=>o.value=null),onCreated:A},null,8,["model-value","visible"])):N("",!0)])}}}),Qn={key:0},eo={key:0},to=G({__name:"SettingsManufacturing",props:{companyId:{}},setup(i,{expose:h}){const n=i,s=Ke().createScope(),{data:l}=s.useGet({id:S(()=>n.companyId),lazy:!0});async function u(){await s.save(l.value)}function o(){s.reset(l.value)}const r=S(()=>s.hasChanges(l.value));return h({save:u,cancel:o,hasChanges:r}),(b,v)=>{const y=rt,g=We,f=$e,w=xe,A=oe;return d(),E("div",null,[t(w,null,{default:a(()=>[e(l)?(d(),E("div",Qn,[t(y,{type:"info",description:b.$t("manufacturing.timeoutDescription"),"show-icon":""},null,8,["description"]),t(f,{label:b.$t("manufacturing.timeoutManufacturing"),class:"mt-2"},{default:a(()=>[t(g,{modelValue:e(l).manufacturingTimeout,"onUpdate:modelValue":v[0]||(v[0]=k=>e(l).manufacturingTimeout=k),min:0,step:5},null,8,["modelValue"])]),_:1},8,["label"])])):N("",!0)]),_:1}),e(l)?(d(),E("div",eo,[t(y,{type:"info",description:b.$t("manufacturing.noteDescription"),"show-icon":""},null,8,["description"]),t(A,{modelValue:e(l).manufacturingMessage,"onUpdate:modelValue":v[1]||(v[1]=k=>e(l).manufacturingMessage=k),autosize:{minRows:4,maxRows:8},type:"textarea",class:"mt-2"},null,8,["modelValue"])])):N("",!0)])}}}),ao=G({__name:"SelectRoleType",props:Ce({role:{default:void 0}},{modelValue:{default:void 0},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const h=i,n=ke(i,"modelValue"),s=Fe(),{t:l}=ee(),u=S(()=>{const b={superadmin:l("roles.admin"),admin:l("roles.admin"),office:l("roles.office"),craft:l("roles.craft"),spectator:l("roles.spectator")};return Object.entries(b).map(([v,y])=>({value:v,label:y}))}),{can:o}=Ve(),r=S(()=>h.role?u.value.filter(({value:b})=>{if(!h.role)return!1;const v=s.scopelessConstruct({type:b,name:h.role.name,companyId:h.role.companyId},{dontAddToStore:!0});return o("create",v)}):u.value);return(b,v)=>{const y=we,g=he;return d(),M(g,{modelValue:n.value,"onUpdate:modelValue":v[0]||(v[0]=f=>n.value=f)},{default:a(()=>[(d(!0),E(z,null,Z(e(r),f=>(d(),M(y,{key:f.value,value:f.value,label:f.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])}}}),no=G({__name:"DeclarativeWatch",props:{getter:{type:Function}},emits:["watch"],setup(i,{emit:h}){const n=i,s=h,l=S(()=>n.getter);return ve(()=>l.value(),(u,o)=>{s("watch",u,o)}),(u,o)=>_e(u.$slots,"default")}}),oo={class:"flex flex-col"},lo={class:"text-gray-500 font-bold"},so={class:"text-gray-500 font-bold"},ro={class:"text-gray-500 font-bold"},io={key:1,class:"text-sm text-slate-400 italic"},uo=G({__name:"SettingsRoles",props:{companyId:{}},setup(i,{expose:h}){const n=i,s=Fe().createScope(),{can:l}=Ve(),{t:u}=ee(),o=R(),r=de(),b=S(()=>({query:{companyId:n.companyId,$sort:{order:1}}})),v=S(()=>({query:{companyId:n.companyId,$sort:{order:1}}}));function y(A){(A.type==="admin"||A.type==="superadmin")&&(A.canSeeAbsences=null,A.canSeeTimesheets=null,A.cannotDeleteAssignments=!1),A.type==="office"&&(A.canSeeAbsences="supervisor",A.canSeeTimesheets="supervisor"),(A.type==="craft"||A.type==="spectator")&&(A.canSeeAbsences="own",A.canSeeTimesheets="own",A.cannotDeleteAssignments=!0)}const g=S(()=>!!o.value?.hasChanges);function f(){return o.value?.reset()}function w(){return o.value?.save()}return h({cancel:f,save:w,hasChanges:g}),(A,k)=>{const c=oe,m=te("font-awesome-icon"),V=Q,T=me,q=be,B=we,$=he;return d(),E("div",null,[t(se,{ref_key:"refTable",ref:o,store:e(s),params:e(b),"fetch-params":e(v),sortable:"","hide-delete-button":"",collapsable:"","active-status-filter":e(r),"create-data":({items:p})=>({companyId:A.companyId,order:p.length+1}),onSorted:k[1]||(k[1]=({items:p})=>p.forEach((U,P)=>U.order=P+1)),onDeleted:k[2]||(k[2]=({items:p})=>p.forEach((U,P)=>U.order=P+1))},{topLeft:a(()=>[t(ce,{modelValue:e(r),"onUpdate:modelValue":k[0]||(k[0]=p=>J(r)?r.value=p:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),"expanded-row":a(({row:p})=>[_("div",oo,[t(no,{getter:()=>p.type,onWatch:U=>y(p)},null,8,["getter","onWatch"]),p.type!=="admin"&&p.type!=="superadmin"?(d(),E(z,{key:0},[_("div",lo,C(e(u)("role.permissions"))+":",1),t(q,{modelValue:p.canJustSeeOwnEvents,"onUpdate:modelValue":U=>p.canJustSeeOwnEvents=U,class:"ml-2"},{default:a(()=>[L(C(e(u)("role.canOnlySeeOwnEvents")),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),_("div",so,C(e(u)("role.canSeeAbsences.title"))+":",1),t($,{"model-value":p.canSeeAbsences===null?"null":p.canSeeAbsences,"onUpdate:modelValue":U=>p.canSeeAbsences=U==="null"?null:U},{default:a(()=>[t(B,{value:"null",label:e(u)("role.canSeeAbsences.all")},null,8,["label"]),t(B,{value:"own",label:e(u)("role.canSeeAbsences.own")},null,8,["label"]),t(B,{value:"supervisor",label:e(u)("role.canSeeAbsences.supervisor")},null,8,["label"])]),_:2},1032,["model-value","onUpdate:modelValue"]),_("div",ro,C(e(u)("role.canSeeTimesheets.title"))+":",1),t($,{"model-value":p.canSeeTimesheets===null?"null":p.canSeeTimesheets,"onUpdate:modelValue":U=>p.canSeeTimesheets=U==="null"?null:U},{default:a(()=>[t(B,{value:"null",label:e(u)("role.canSeeTimesheets.all")},null,8,["label"]),t(B,{value:"own",label:e(u)("role.canSeeTimesheets.own")},null,8,["label"]),t(B,{value:"supervisor",label:e(u)("role.canSeeTimesheets.supervisor")},null,8,["label"])]),_:2},1032,["model-value","onUpdate:modelValue"]),t(q,{"model-value":!p.cannotDeleteAssignments,"onUpdate:modelValue":U=>p.cannotDeleteAssignments=!U},{default:a(()=>[L(C(e(u)("role.canDeleteAssignment")),1)]),_:2},1032,["model-value","onUpdate:modelValue"])],64)):(d(),E("div",io,C(e(u)("role.nothingToChange")),1))])]),default:a(()=>[t(j,{title:A.$t("name"),width:"minmax(200px, 1fr)"},{default:a(({row:p})=>[t(c,{modelValue:p.name,"onUpdate:modelValue":U=>p.name=U,disabled:!e(l)("update",p),placeholder:A.$t("roles.properties.name")},null,8,["modelValue","onUpdate:modelValue","disabled","placeholder"])]),_:1},8,["title"]),t(j,{title:A.$t("roles.properties.type"),width:"150px"},{default:a(({row:p})=>[t(ao,{modelValue:p.type,"onUpdate:modelValue":U=>p.type=U,role:p},null,8,["modelValue","onUpdate:modelValue","role"])]),_:1},8,["title"]),t(j,{width:"min-content"},{default:a(({row:p})=>[t(T,{content:p.deactivatedAt?e(u)("actions.Activate"):e(u)("actions.Deactivate")},{default:a(()=>[t(V,{onClick:()=>p.deactivatedAt=p.deactivatedAt?null:new Date},{default:a(()=>[t(m,{icon:p.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","fetch-params","active-status-filter","create-data"])])}}}),co={class:"mb-2"},mo={class:"font-bold"},po=["innerHTML"],fo={key:0},yo={class:"font-bold"},vo={class:"font-bold"},go=G({__name:"SettingsSuperAdmin",props:{companyId:{}},setup(i,{expose:h}){const n=i,s=qe().createScope(),{getRouteViewName:l}=va(),u=Ke().createScope(),{data:o}=u.useGet({id:S(()=>n.companyId),lazy:!0}),{data:r}=s.useGet({id:S(()=>n.companyId),lazy:!0}),b=s.useHasChanges(()=>r.value),v=He(new Map),y=it(async()=>{if(!r.value?.stripeCustomer)return null;const $=v.get(r.value.stripeCustomer);if($)return $;const p=await Qe.service("stripe/customers").get(r.value.stripeCustomer,{});return v.set(r.value.stripeCustomer,p),p},null),g=S({get(){return y.value},set($){r.value&&($?r.value.stripeCustomer=$.id:r.value.stripeCustomer=null)}}),f=X([]),w=S(()=>f.value.map($=>({value:$,label:$.name}))),A=X(!1),k=async $=>{A.value=!0;try{if($!==""){const p=await Qe.service("stripe/customers").search({query:{query:`name~"${$}"`},$limit:5,paginate:!1});f.value=p}else f.value=[]}finally{A.value=!1}},c=S(()=>u.hasChanges(o.value)||b.value);function m($){o.value&&(o.value.disabledViews=[...o.value.disabledViews??[],$])}function V($){o.value&&(o.value.disabledViews=(o.value.disabledViews??[]).filter(p=>p!==$))}function T($){return o.value?!(o.value.disabledViews??[]).includes($):!1}function q(){u.reset(o.value),s.reset(r.value)}async function B(){await Promise.all([u.save(o.value),s.save(r.value)])}return h({hasChanges:c,save:B,cancel:q}),($,p)=>{const U=te("font-awesome-icon"),P=Q,x=ut,F=zt;return d(),E("div",null,[_("div",co,[_("div",mo,C($.$t("settings.hideViews"))+":",1),t(At,{"filter-view":T,clearable:"",filterable:"","onUpdate:modelValue":m}),(d(!0),E(z,null,Z(e(o)?.disabledViews??[],I=>(d(),E("div",{key:I,class:"flex items-center"},[_("div",{innerHTML:e(l)(I)},null,8,po),t(P,{text:"",onClick:()=>V(I)},{default:a(()=>[t(U,{icon:"times"})]),_:2},1032,["onClick"])]))),128))]),e(o)?(d(),E("div",fo,[_("div",yo,C($.$t("settings.activateRfidLogin"))+":",1),t(x,{"model-value":!!e(o).RFIDEnabled,"onUpdate:modelValue":p[0]||(p[0]=I=>e(o).RFIDEnabled=!!I)},null,8,["model-value"])])):N("",!0),_("div",null,[_("div",vo,"Stripe "+C($.$t("customer.name"))+":",1),t(F,{modelValue:e(g),"onUpdate:modelValue":p[1]||(p[1]=I=>J(g)?g.value=I:null),filterable:"",remote:"",clearable:"","value-key":"name","remote-method":k,options:e(w),loading:e(A)},null,8,["modelValue","options","loading"])])])}}});function _o(){const{dayJsLocale:i}=ga();return i}function Ct(){const i=_o();return S(()=>{const{weekStart:h}=i.value;return h===void 0||h<0||h>6?0:h})}function bo(){const i=Ct();return S(()=>[...Array(7).keys()].map((n,s)=>{const l=s+i.value;return l>6?l-7:l}))}function ho(i,h){const n=Ct();return S(()=>lt(dt(i),(l,u)=>{const o=h(l,u);return o<n.value?o+7:o}))}const wo={class:"border border-gray-300 mb-2"},Vo=_("th",{class:"border-gray-300 border-r border-r-gray-400 bg-gray-100",rowspan:"2"},null,-1),ko={class:"text-center p-2 pb-1 border-gray-300 border-r border-r-gray-400 bg-gray-100 !font-normal",colspan:"3",rowspan:"2"},So={class:"text-center px-2 py-1 bg-gray-100 border-gray-300 border-r-gray-400 border-r !font-normal",colspan:"4"},$o={class:"px-2 py-1 bg-gray-100 w-24",rowspan:"3"},xo=["innerHTML"],Io={class:"text-center px-2 border-gray-300 border-r border-t bg-gray-100",colspan:"2"},Ao={class:"text-center px-2 border-gray-300 border-t border-r-gray-400 border-r bg-gray-100",colspan:"2"},Co={class:"text-center px-2 pb-1 border-gray-300 border-r border-r-gray-400 border-b bg-gray-100"},To={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-y bg-gray-100"},Uo={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-y border-r bg-gray-100"},Do={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-y border-r border-r-gray-400 bg-gray-100"},Eo={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-b bg-gray-100 !font-normal"},Mo={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-b border-r bg-gray-100 !font-normal"},Po={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-b bg-gray-100 !font-normal"},Fo={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-b border-r-gray-400 border-r bg-gray-100 !font-normal"},qo={class:"px-2 py-1 border-gray-200 border-r border-r-gray-400"},Oo={class:"px-2 py-1 border-gray-200"},No={class:"px-2 py-1 border-gray-200 border-r"},Ro={class:"px-2 py-1 border-gray-200 border-r border-r-gray-400"},jo={class:"px-2 py-1"},Bo={class:"px-2 py-1 border-gray-200 border-r"},Wo={class:"px-2 py-1"},Go={class:"px-2 py-1 border-r-gray-400 border-r"},Lo={class:"px-2 py-1 flex justify-center"},Ho={colspan:"3",class:"border-gray-300 border-t text-right text-sm text-gray-500 py-1 bg-gray-100"},zo={class:"leading-normal text-center px-2 py-1 text-gray-500 text-sm border-gray-300 border-t border-r-gray-400 border-r bg-gray-100"},Ko=_("td",{colspan:"5",class:"border-gray-300 border-t bg-gray-100"},null,-1),Jo={class:"flex items-center mb-2"},Yo={class:"mr-2 text-gray-500"},Xo={class:"flex items-center mb-2"},Zo={class:"mr-2 text-gray-500"},Qo={class:"flex items-center mb-2"},el={class:"mr-2 text-gray-500"},tl={class:"flex mb-1"},al={class:"text-gray-500"},nl=G({__name:"WorkingTimeModelForm",props:{model:{type:Object,required:!0}},setup(i){const h=i,n=_t().createScope(),{t:s}=ee(),{data:l}=n.useFeathersItems({localOnly:!0,params:S(()=>({query:{workingTimeModelUuid:h.model.uuid,$limit:-1}}))}),u=bo(),o=S(()=>u.value.map(f=>{const w=l.value?.find(A=>A.weekday===f);return{weekday:f,get isActive(){return w?.isActive??!1},set isActive(A){w?w.isActive=A:n.construct({companyId:h.model.companyId,weekday:f,isActive:A,workingTimeModel:h.model})},model:w}})),r=S(()=>{const g=[];for(const f of o.value)f.isActive&&f.model&&g.push(f.model);return g}),b=S(()=>{let g=0;return r.value.forEach(f=>{g+=f.duration??0}),g});function v(){h.model.pauseRules||=[],h.model.pauseRules.push({breakTimeDefault:null,durationMin:null,breakTimeMin:null,breakTimeMax:null})}function y(g){h.model.pauseRules.splice(g,1)}return(g,f)=>{const w=be,A=te("font-awesome-icon"),k=Q;return d(),E("div",null,[_("table",wo,[_("thead",null,[_("tr",null,[Vo,_("th",ko,C(e(s)("working-time-model-weekdays.default")),1),_("th",So,C(e(s)("working-time-model-weekdays.adjustment")),1),_("th",$o,[_("div",{class:"w-20 text-center break-normal",innerHTML:e(s)("working-time-model-weekdays.property.durationMax")},null,8,xo)])]),_("tr",null,[_("th",Io,C(e(s)("working-time-model-weekdays.property.start")),1),_("th",Ao,C(e(s)("working-time-model-weekdays.property.end")),1)]),_("tr",null,[_("th",Co,C(e(s)("Day")),1),_("th",To,C(e(s)("working-time-model-weekdays.property.start")),1),_("th",Uo,C(e(s)("working-time-model-weekdays.property.end")),1),_("th",Do,C(e(s)("working-time-model-weekdays.property.duration")),1),_("th",Eo,C(e(s)("working-time-model-weekdays.minShort")),1),_("th",Mo,C(e(s)("working-time-model-weekdays.maxShort")),1),_("th",Po,C(e(s)("working-time-model-weekdays.minShort")),1),_("th",Fo,C(e(s)("working-time-model-weekdays.maxShort")),1)])]),(d(!0),E(z,null,Z(e(o),c=>(d(),E("tr",{key:c.weekday},[_("td",qo,[t(w,{modelValue:c.isActive,"onUpdate:modelValue":m=>c.isActive=m},{default:a(()=>[L(C(e(s)("weekday."+c.weekday)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_("td",Oo,[c.model&&c.isActive?(d(),M(ne,{key:0,modelValue:c.model.start,"onUpdate:modelValue":m=>c.model.start=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),_("td",No,[c.model&&c.isActive?(d(),M(ne,{key:0,modelValue:c.model.end,"onUpdate:modelValue":m=>c.model.end=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),_("td",Ro,[c.model&&c.isActive?(d(),M(ne,{key:0,modelValue:c.model.duration,"onUpdate:modelValue":m=>c.model.duration=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),_("td",jo,[c.model&&c.isActive?(d(),M(ne,{key:0,modelValue:c.model.startMin,"onUpdate:modelValue":m=>c.model.startMin=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),_("td",Bo,[c.model&&c.isActive?(d(),M(ne,{key:0,modelValue:c.model.startMax,"onUpdate:modelValue":m=>c.model.startMax=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),_("td",Wo,[c.model&&c.isActive?(d(),M(ne,{key:0,modelValue:c.model.endMin,"onUpdate:modelValue":m=>c.model.endMin=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),_("td",Go,[c.model&&c.isActive?(d(),M(ne,{key:0,modelValue:c.model.endMax,"onUpdate:modelValue":m=>c.model.endMax=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),_("td",Lo,[c.model&&c.isActive?(d(),M(ne,{key:0,modelValue:c.model.durationMax,"onUpdate:modelValue":m=>c.model.durationMax=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)])]))),128)),_("tr",null,[_("td",Ho,C(e(r).length)+" "+C(e(s)("Day",e(r).length))+": ",1),_("td",zo,C(e(Ia)(e(b)))+C(e(s)("hoursUnit")),1),Ko])]),_("div",Jo,[_("div",Yo,C(e(s)("working-time-models.carryOverMonthMaximum"))+":",1),t(ne,{modelValue:i.model.carryOverMonthMaximum,"onUpdate:modelValue":f[0]||(f[0]=c=>i.model.carryOverMonthMaximum=c),"value-type":"hours","clear-null":"",placeholder:"00:00",style:{width:"70px !important"}},null,8,["modelValue"])]),_("div",Xo,[_("div",Zo,C(e(s)("working-time-models.countHolidaysAsWorkdays"))+":",1),t(w,{modelValue:i.model.countHolidaysAsWorkdays,"onUpdate:modelValue":f[1]||(f[1]=c=>i.model.countHolidaysAsWorkdays=c)},null,8,["modelValue"])]),_("div",Qo,[_("div",el,C(e(s)("working-time-models.showIsManipulated")),1),t(w,{modelValue:i.model.showIsManipulated,"onUpdate:modelValue":f[2]||(f[2]=c=>i.model.showIsManipulated=c)},null,8,["modelValue"])]),_("div",tl,[_("div",al,C(e(s)("working-time-models.pauseRules"))+":",1),t(k,{size:"small",class:"ml-2",onClick:v},{default:a(()=>[t(A,{icon:"plus"})]),_:1})]),(d(!0),E(z,null,Z(i.model.pauseRules??[],(c,m)=>(d(),M(Ra,{class:"items-center"},{default:a(()=>[t(Te,{title:e(s)("working-time-models.property.pauseRule.durationMin")},{default:a(()=>[t(ne,{modelValue:c.durationMin,"onUpdate:modelValue":V=>c.durationMin=V,"value-type":"number",clearable:"","clear-null":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["title"]),t(Te,{title:e(s)("working-time-models.property.pauseRule.breakTimeDefault")},{default:a(()=>[t(ne,{modelValue:c.breakTimeDefault,"onUpdate:modelValue":V=>c.breakTimeDefault=V,"value-type":"number",clearable:"","clear-null":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["title"]),t(Te,{title:e(s)("working-time-models.property.pauseRule.breakTimeMin")},{default:a(()=>[t(ne,{modelValue:c.breakTimeMin,"onUpdate:modelValue":V=>c.breakTimeMin=V,"value-type":"number",clearable:"","clear-null":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["title"]),t(Te,{title:e(s)("working-time-models.property.pauseRule.breakTimeMax")},{default:a(()=>[t(ne,{modelValue:c.breakTimeMax,"onUpdate:modelValue":V=>c.breakTimeMax=V,"value-type":"number",clearable:"","clear-null":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["title"]),t(k,{onClick:()=>y(m)},{default:a(()=>[t(A,{icon:"times"})]),_:2},1032,["onClick"])]),_:2},1024))),256))])}}}),ol={class:"overflow-x-auto w-0 flex-1"},ll=G({__name:"SettingsTimeSheets",props:{companyId:{type:Number,required:!0}},setup(i,{expose:h}){const n=i,{t:s}=ee(),l=_a().createScope(),u=_t().createScope(),o="working-time-models",r=X([o]),b=X(),v=de(),y=S(()=>b.value?.items??[]),g=S(()=>[...b.value?.collapsed.values()??[]].every(U=>!U)),{data:f,markForRemove:w,save:A,reset:k,hasChanges:c}=u.useFeathersItems({params:S(()=>({query:{companyId:n.companyId,$limit:500}}))}),m=S(()=>b.value?.hasChanges||c.value);function V(){b.value?.reset(),k()}async function T(){await b.value?.save({saveNew:!0,saveChanged:!0,saveRemoved:!1}),await A(),await b.value?.save({saveNew:!1,saveChanged:!1,saveRemoved:!0})}function q(U){const P=f.value.filter(x=>x.workingTimeModelUuid===U.uuid);w(P)}function B(U,P){P&&y.value.forEach(x=>x.isDefault=!1),U.isDefault=P}function $(){y.value.length&&(y.value[0].isDefault=!0)}function p(U,P){P.forEach((x,F)=>x.order=F+1),q(U),U.isDefault&&$()}return h({hasChanges:m,cancel:V,save:T}),(U,P)=>{const x=oe,F=be,I=te("font-awesome-icon"),H=Q,re=me,fe=Ee,ie=Me;return d(),E("div",null,[t(ie,{modelValue:e(r),"onUpdate:modelValue":P[3]||(P[3]=K=>J(r)?r.value=K:null)},{default:a(()=>[t(fe,{title:U.$t("working-time-models.name",2),name:o},{default:a(()=>[t(se,{ref_key:"tableRef",ref:b,store:e(l),params:{query:{companyId:i.companyId,$sort:{order:1}}},sortable:e(g),collapsable:"","create-data":({items:K})=>({companyId:i.companyId,order:K.length+1,isDefault:!K.length||!K.some(le=>!le.deactivatedAt&&le.isDefault)}),"active-status-filter":e(v),"hide-delete-button":"","disable-pagination":"","before-save":K=>(K.pauseRules??[]).sort((le,pe)=>(le.durationMin??0)-(pe.durationMin??0)),onSorted:P[1]||(P[1]=({items:K})=>K.forEach((le,pe)=>le.order=pe+1)),onDeleted:P[2]||(P[2]=({item:K,items:le})=>p(K,le))},{topLeft:a(()=>[t(ce,{modelValue:e(v),"onUpdate:modelValue":P[0]||(P[0]=K=>J(v)?v.value=K:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),"expanded-row":a(({row:K})=>[_("div",ol,[t(nl,{model:K},null,8,["model"])])]),default:a(()=>[t(j,{title:e(s)("working-time-models.property.name")},{default:a(({row:K})=>[t(x,{modelValue:K.name,"onUpdate:modelValue":le=>K.name=le,placeholder:e(s)("working-time-models.name")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["title"]),t(j,{title:e(s)("working-time-models.property.isDefault"),width:"max-content"},{default:a(({row:K})=>[t(F,{"model-value":K.isDefault,"onUpdate:modelValue":le=>B(K,!!le)},null,8,["model-value","onUpdate:modelValue"])]),_:1},8,["title"]),t(j,{width:"max-content"},{default:a(({row:K})=>[t(re,{content:K.deactivatedAt?e(s)("actions.Activate"):e(s)("actions.Deactivate")},{default:a(()=>[t(H,{onClick:()=>K.deactivatedAt=K.deactivatedAt?null:new Date},{default:a(()=>[t(I,{icon:K.deactivatedAt?"fa-eye":"fa-eye-slash","fixed-width":"",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","sortable","create-data","active-status-filter","before-save"])]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}}),sl={class:"text-xs text-gray-500 leading-tight"},rl={class:"text-xs text-gray-500 leading-tight"},il={class:"text-xs text-gray-500 leading-tight"},tt=G({__name:"FormUserAbsenceType",props:{modelValue:{default:null},modelModifiers:{}},emits:["update:modelValue"],setup(i,{expose:h}){const n=ke(i,"modelValue"),s=R();function l(...o){return s.value?.validate(...o)}function u(...o){return s.value?.clearValidate(...o)}return h({validate:l,clearValidate:u}),(o,r)=>{const b=oe,v=$e,y=Se,g=ut,f=xe;return n.value?(d(),M(f,{key:0,ref_key:"refForm",ref:s,"label-width":"110px",model:n.value},{default:a(()=>[t(v,{label:o.$t("name",1),prop:"name"},{default:a(()=>[t(b,{modelValue:n.value.name,"onUpdate:modelValue":r[0]||(r[0]=w=>n.value.name=w),placeholder:o.$t("userAbsence.form.type.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(v,{label:o.$t("color",1),prop:"color"},{default:a(()=>[t(y,{modelValue:n.value.color,"onUpdate:modelValue":r[1]||(r[1]=w=>n.value.color=w),size:"default",predefine:e(Ie)},null,8,["modelValue","predefine"])]),_:1},8,["label"]),t(v,{label:o.$t("userAbsence.form.type.needApproval")},{default:a(()=>[_("div",null,[t(g,{modelValue:n.value.needApproval,"onUpdate:modelValue":r[2]||(r[2]=w=>n.value.needApproval=w)},null,8,["modelValue"]),_("div",sl,C(o.$t("userAbsence.form.type.needApprovalExplanation")),1)])]),_:1},8,["label"]),t(v,{label:o.$t("userAbsence.form.type.needCompensation")},{default:a(()=>[_("div",null,[t(g,{modelValue:n.value.needCompensation,"onUpdate:modelValue":r[3]||(r[3]=w=>n.value.needCompensation=w)},null,8,["modelValue"]),_("div",rl,C(o.$t("userAbsence.form.type.needCompensationExplanation")),1)])]),_:1},8,["label"]),t(v,{label:o.$t("userAbsence.form.type.countAsWorkingTime")},{default:a(()=>[_("div",null,[t(g,{modelValue:n.value.countAsWorkingTime,"onUpdate:modelValue":r[4]||(r[4]=w=>n.value.countAsWorkingTime=w)},null,8,["modelValue"]),_("div",il,C(o.$t("userAbsence.form.type.countAsWorkingTimeExplanation")),1)])]),_:1},8,["label"])]),_:1},8,["model"])):N("",!0)}}}),ul=G({__name:"SettingsUserAbsenceTypes",props:{companyId:{}},setup(i,{expose:h}){const n=i,s=R(),l=de(),u=ba().createScope(),{t:o}=ee(),r=S(()=>({query:{companyId:n.companyId,$sort:{order:1}}})),b=S(()=>s.value?.hasChanges);function v(){return s.value?.reset()}function y(){return s.value?.save()}return h({cancel:v,save:y,hasChanges:b}),(g,f)=>{const w=Se,A=te("font-awesome-icon"),k=Q,c=me;return d(),E("div",null,[t(se,{ref_key:"refTable",ref:s,store:e(u),"hide-delete-button":"",sortable:"",params:e(r),"active-status-filter":e(l),"create-data":({items:m})=>({companyId:n.companyId,order:m.length+1}),onSorted:f[1]||(f[1]=({items:m})=>m.forEach((V,T)=>V.order=T+1)),onDeleted:f[2]||(f[2]=({items:m})=>m.forEach((V,T)=>V.order=T+1))},{topLeft:a(()=>[t(ce,{modelValue:e(l),"onUpdate:modelValue":f[0]||(f[0]=m=>J(l)?l.value=m:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),createForm:a(m=>[t(tt,{ref:"createForm","model-value":m?.item},null,8,["model-value"])]),editForm:a(m=>[t(tt,{ref:"editForm","model-value":m?.item},null,8,["model-value"])]),default:a(()=>[t(j,{title:g.$t("name",1),width:"1fr"},{default:a(({row:m})=>[L(C(m.name),1)]),_:1},8,["title"]),t(j,{title:g.$t("userAbsence.form.type.needApproval"),width:"max-content"},{default:a(({row:m})=>[L(C(m.needApproval?g.$t("Yes"):g.$t("No")),1)]),_:1},8,["title"]),t(j,{title:g.$t("userAbsence.form.type.needCompensation"),width:"max-content"},{default:a(({row:m})=>[L(C(m.needCompensation?g.$t("Yes"):g.$t("No")),1)]),_:1},8,["title"]),t(j,{width:"min-content"},{default:a(({row:m})=>[t(w,{modelValue:m.color,"onUpdate:modelValue":V=>m.color=V,disable:"",predefine:e(Ie)},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:1}),t(j,{width:"min-content"},{default:a(({row:m})=>[t(c,{content:m.deactivatedAt?e(o)("actions.Activate"):e(o)("actions.Deactivate")},{default:a(()=>[t(k,{onClick:()=>m.deactivatedAt=m.deactivatedAt?null:new Date},{default:a(()=>[t(A,{icon:m.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","active-status-filter","create-data"])])}}}),dl={class:"font-bold mb-3"},cl={class:"text-gray-400 ml-2"},ml={class:"font-bold my-3"},pl={class:"flex items-center gap-2 mb-2"},fl={class:"overflow-auto max-h-screen"},yl={key:0,class:"relative h-1"},vl={class:"sticky z-30 border border-gray-200 bg-white text-center top-0 left-0"},gl={class:"max-w-[110px] overflow-hidden overflow-ellipsis"},_l={class:"p-2 overflow-hidden text-ellipsis"},bl={key:0,class:"border border-gray-200"},hl=["colspan"],wl={class:"flex items-center w-36"},Vl={class:"line-clamp-2 w-0 flex-1"},kl={class:"flex items-center justify-center min-w-[80px]"},Sl=G({__name:"SettingsUserCapabilities",props:{companyId:{}},setup(i,{expose:h}){const n=i,{t:s}=ee(),l=ze(),u=X(""),o=X(null),r=Pe().createScope(),b=Je().createScope(),{data:v,haveLoaded:y}=r.useFind({params:S(()=>({query:{companyId:n.companyId,deactivatedAt:null,$sort:{order:1},$limit:1e3}}))}),g=S(()=>v.value.filter(I=>!!I.id)),f=S(()=>v.value.length!==g.value.length);function w(I,H){I.manPowerOfferPerDay=Math.round(H*60*60)}const{data:A,haveLoaded:k}=b.useFind({params:S(()=>({query:{companyId:n.companyId,deactivatedAt:null,$sort:{fullName:1},$limit:1e3}}))}),c=S(()=>A.value.filter(I=>!!I.id)),m=S(()=>A.value.length!==c.value.length),V=S(()=>{let I=c.value;return o.value&&(I=I.filter(H=>H.roleUuid===o.value?.uuid)),u.value&&(I=I.filter(H=>H.fullName.toLowerCase().includes(u.value.toLowerCase()))),I}),{cancel:T,hasChanges:q,save:B,setCapability:$,capabilityByUserIdByEventTypeId:p}=kt({companyId:()=>n.companyId,hideTempEventTypes:!0,hideTempUsers:!0}),U=S(()=>k.value&&y.value),P=X(null),x=X(null);function F(I,H,re){re?(P.value=H,x.value=I):(P.value=null,x.value=null)}return h({save:B,cancel:T,hasChanges:q}),(I,H)=>{const re=rt,fe=We,ie=$e,K=xe,le=te("font-awesome-icon"),pe=oe,Ae=me,ye=be;return d(),E("div",null,[e(f)||e(m)?(d(),M(re,{key:0,type:"warning",title:e(s)("settings.user-capabilities.hasNewEventTypesOrUsers.title"),description:e(s)("settings.user-capabilities.hasNewEventTypesOrUsers.description"),closable:!1,class:"!mb-3"},null,8,["title","description"])):N("",!0),_("div",dl,C(I.$t("capabilities.standardPersonnelHoursPerWorkAreaPerDay")),1),t(K,{"label-width":"180px","label-position":e(l).md?"left":"top"},{default:a(()=>[(d(!0),E(z,null,Z(e(g),O=>(d(),M(ie,{key:O.uuid,label:`${O.name}:`},{default:a(()=>[t(fe,{"model-value":(O.manPowerOfferPerDay||0)/(60*60),"show-man-hours":"",min:0,precision:2,step:8,style:{width:"140px"},"onUpdate:modelValue":D=>D!==void 0&&w(O,D)},null,8,["model-value","onUpdate:modelValue"]),_("span",cl,C(I.$t("capabilities.personnelHours")),1)]),_:2},1032,["label"]))),128))]),_:1},8,["label-position"]),_("div",ml,C(I.$t("capabilities.employeeSkills")),1),_("div",pl,[t(le,{icon:"search",class:"ml-2 text-gray-500"}),t(pe,{modelValue:e(u),"onUpdate:modelValue":H[0]||(H[0]=O=>J(u)?u.value=O:null),clearable:"",placeholder:e(s)("user.name",1),style:{width:"170px"}},null,8,["modelValue","placeholder"]),t(St,{modelValue:e(o),"onUpdate:modelValue":H[1]||(H[1]=O=>J(o)?o.value=O:null),clearable:""},null,8,["modelValue"])]),_("div",fl,[e(U)?(d(),E("table",yl,[_("tr",null,[_("th",vl,C(e(s)("user.name")),1),(d(!0),E(z,null,Z(e(g),O=>Y((d(),E("th",{key:O.uuid,class:ge(["sticky top-0 z-10 border border-gray-200 text-center",[e(x)===O?"bg-gray-100":"bg-white"]])},[_("div",gl,[t(Ae,{content:O.name,placement:"top"},{default:a(()=>[_("div",_l,C((O.shortName||O.name)??""),1)]),_:2},1032,["content"])])],2)),[[e(je),D=>F(O,null,D)]])),128))]),e(V).length===0?(d(),E("tr",bl,[_("td",{colspan:e(g).length+1},C(I.$t("capabilities.noEmployeesFound")),9,hl)])):(d(!0),E(z,{key:1},Z(e(V),O=>(d(),E("tr",{key:O.uuid},[Y((d(),E("th",{class:ge(["z-20 border border-gray-200 p-1 font-normal sticky left-0",[e(P)===O?"bg-gray-100":"bg-white"]])},[_("div",wl,[t($t,{user:O,size:"mini",class:"m-0.5 mr-2"},null,8,["user"]),_("div",Vl,C(O.fullName),1)])],2)),[[e(je),D=>F(null,O,D)]]),(d(!0),E(z,null,Z(e(g),D=>Y((d(),E("td",{key:D.uuid,class:ge(["border border-gray-200",{"bg-gray-100":D===e(x)||e(P)===O}])},[_("div",kl,[t(ye,{"model-value":!!e(p)[O.uuid]?.[D.uuid],"onUpdate:modelValue":W=>e($)({eventType:D,user:O,isActive:!!W})},null,8,["model-value","onUpdate:modelValue"])])],2)),[[e(je),W=>F(D,O,W)]])),128))]))),128))])):N("",!0)])])}}}),$l={key:0,class:"flex mt-2"},xl=G({__name:"SettingsWorkPeriodsPerEventType",props:{companyId:{type:Number,required:!0},eventType:{type:Object,required:!0}},emits:["has-changes"],setup(i,{expose:h,emit:n}){const s=i,l=bt().createScope(),u=n,{t:o}=ee(),{can:r}=Ve(),b=R(),v=R(""),y=de(),g=S(()=>({query:{companyId:s.companyId,eventTypeUuid:s.eventType.uuid,$sort:{order:1}}})),f=S(()=>({query:{companyId:s.companyId,eventTypeId:s.eventType.id,$sort:{order:1}}}));function w(){return b.value?.reset()}async function A(){return await b.value?.save()}return ve(()=>b.value?.hasChanges,k=>{k!=null&&u("has-changes",k)}),h({cancel:w,save:A}),(k,c)=>{const m=oe,V=te("font-awesome-icon"),T=Q,q=me,B=Q;return d(),E("div",null,[t(se,{ref_key:"refTable",ref:b,store:e(l),params:e(g),"fetch-params":e(f),"hide-edit-button":"","hide-create-button":"","hide-limit-select":"","disable-pagination":"","hide-delete-button":"",sortable:"","create-data":({items:$})=>({companyId:s.companyId,eventType:i.eventType,name:e(v),order:$.length+1}),"active-status-filter":e(y),onCreated:c[1]||(c[1]=()=>v.value=""),onSorted:c[2]||(c[2]=({items:$})=>$.forEach((p,U)=>p.order=U+1)),onDeleted:c[3]||(c[3]=({items:$})=>$.forEach((p,U)=>p.order=U+1))},{topLeft:a(()=>[t(ce,{modelValue:e(y),"onUpdate:modelValue":c[0]||(c[0]=$=>J(y)?y.value=$:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),default:a(()=>[t(j,{title:e(o)("Label")},{default:a(({row:$})=>[t(m,{modelValue:$.name,"onUpdate:modelValue":p=>$.name=p,disabled:!e(r)("update","assignment-event-work-types")},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1},8,["title"]),t(j,{width:"max-content"},{default:a(({row:$})=>[t(q,{content:$.deactivatedAt?e(o)("actions.Activate"):e(o)("actions.Deactivate")},{default:a(()=>[t(T,{onClick:()=>$.deactivatedAt=$.deactivatedAt?null:new Date},{default:a(()=>[t(V,{icon:$.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","fetch-params","create-data","active-status-filter"]),e(r)("create","assignment-event-work-types")?(d(),E("div",$l,[t(m,{modelValue:e(v),"onUpdate:modelValue":c[5]||(c[5]=$=>J(v)?v.value=$:null),class:"flex-1",placeholder:k.$t("timeSheets.newWorkTime"),onKeydown:c[6]||(c[6]=Le(Kt(()=>e(b)?.newItem(),["stop"]),["enter"]))},ot({_:2},[e(v)?{name:"append",fn:a(()=>[t(B,{type:"primary",onClick:c[4]||(c[4]=()=>e(b)?.newItem())},{default:a(()=>[t(V,{icon:"plus"})]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder"])])):N("",!0)])}}});function Tt(i,h,n){const s=[];h=e(h);const l=(Array.isArray(h)?h:[h]).filter(ft);if(!l?.length)return s;const u=[].map(o=>e(o));for(let o=0;o<l.length;o++){let r=l[o];if(Array.isArray(r)){if(r.length!==1)continue;[r]=r}if(!r||u.includes(r)){u.includes(r);continue}i in r&&typeof r[i]=="function"&&s.push(r)}return s}async function Il(i,h){const n=Tt("save",i);return await Promise.all(n.map(async s=>await s.save()))}function Al(i,h){Tt("cancel",i).forEach(s=>s.cancel())}const Cl={class:"border border-gray-300 mb-4"},Tl={class:"text-center p-2 pb-1 border-b bg-gray-100"},Ul={class:"text-center p-2 pb-1 border-b bg-gray-100"},Dl={class:"text-center p-2 pb-1 border-b bg-gray-100"},El={class:"text-center p-2 pb-1 border-b bg-gray-100"},Ml={class:"text-center p-2 pb-1 border-b bg-gray-100"},Pl={class:"p-2 border-b"},Fl={class:"p-2 border-b"},ql={class:"p-2 text-gray-500 border-b"},Ol={class:"p-2 border-b"},Nl={class:"p-2 border-b"},Rl=G({__name:"SettingsWorkPeriods",props:{companyId:{type:Number,required:!0}},setup(i,{expose:h}){const{t:n}=ee(),s=i,l=R(["work-periods"]),u=R([]),o=X(),r=de(),b=Pe().createScope(),v=ha().createScope(),y=wa().createScope();bt().createScope().useFeathersItems({params:S(()=>({query:{companyId:s.companyId,$limit:1e3}}))});const{data:f}=b.useFind({params:S(()=>({query:{companyId:s.companyId,deactivatedAt:null,$sort:{order:1},$limit:100}}))}),{data:w,hasChanges:A,save:k,cancel:c}=v.useFeathersItems({params:S(()=>({query:{companyId:s.companyId,$limit:1e3}}))}),m=Va();function V(F){const I=(F.start||0)+(F.duration||0)+(F.pause||0);return F.end=I,I}const T=S(()=>m.map(F=>{const I=w.value.find(H=>H.weekday===F);return{workingTime:I,weekday:F,get isActive(){return!!I?.isActive},set isActive(H){I?I.isActive=H:v.construct({companyId:s.companyId,weekday:F,isActive:H})},get start(){return I?.start??0},set start(H){I?I.start=H:v.construct({companyId:s.companyId,weekday:F,isActive:!0,start:H}),I&&V(I)},get duration(){return I?.duration??0},set duration(H){I?I.duration=H:v.construct({companyId:s.companyId,weekday:F,isActive:!0,duration:H}),I&&V(I)},get pause(){return I?.pause??0},set pause(H){I?I.pause=H:v.construct({companyId:s.companyId,weekday:F,isActive:!0,pause:H}),I&&V(I)}}})),q=ho(T,F=>F.weekday),B=R({}),$=R(void 0);ve(f,F=>{(!$.value||$.value==="0")&&F.length&&($.value=`eventType-${F[0].uuid}`)},{immediate:!0});function p(F,I){B.value[F.uuid]=I}const U=S(()=>Object.values(B.value).some(F=>F===!0)||A.value||o.value?.hasChanges);async function P(){await Promise.all([k(),Il(u),o.value?.save()])}function x(){Al(u),c(),o.value?.reset()}return h({save:P,cancel:x,hasChanges:U}),(F,I)=>{const H=be,re=Ee,fe=oe,ie=j,K=te("font-awesome-icon"),le=Q,pe=me,Ae=Yt,ye=Jt,O=Me;return d(),E("div",null,[t(O,{modelValue:e(l),"onUpdate:modelValue":I[4]||(I[4]=D=>J(l)?l.value=D:null)},{default:a(()=>[t(re,{title:e(n)("working-times.name",2),name:"working-times"},{default:a(()=>[_("table",Cl,[_("tr",null,[_("th",Tl,C(e(n)("working-times.name")),1),_("th",Ul,C(e(n)("working-times.property.start")),1),_("th",Dl,C(e(n)("working-times.property.duration")),1),_("th",El,C(e(n)("working-times.property.pause")),1),_("th",Ml,C(e(n)("working-times.property.end")),1)]),(d(!0),E(z,null,Z(e(q),D=>(d(),E("tr",{key:D.weekday},[_("td",Pl,[t(H,{modelValue:D.isActive,"onUpdate:modelValue":W=>D.isActive=W,label:e(n)(`weekday.${D.weekday}`),class:"w-32"},null,8,["modelValue","onUpdate:modelValue","label"])]),_("td",Fl,[D.isActive?(d(),M(ne,{key:0,modelValue:D.start,"onUpdate:modelValue":W=>D.start=W,"value-type":"number",disabled:!D.workingTime?.isActive},null,8,["modelValue","onUpdate:modelValue","disabled"])):N("",!0)]),_("td",ql,[D.isActive?(d(),M(ne,{key:0,modelValue:D.duration,"onUpdate:modelValue":W=>D.duration=W,"value-type":"number",disabled:!D.workingTime?.isActive},null,8,["modelValue","onUpdate:modelValue","disabled"])):N("",!0)]),_("td",Ol,[D.isActive?(d(),M(ne,{key:0,modelValue:D.pause,"onUpdate:modelValue":W=>D.pause=W,"value-type":"number",disabled:!D.workingTime?.isActive},null,8,["modelValue","onUpdate:modelValue","disabled"])):N("",!0)]),_("td",Nl,[D.isActive?(d(),M(ne,{key:0,"model-value":D.workingTime?.end,disabled:"","value-type":"number"},null,8,["model-value"])):N("",!0)])]))),128))])]),_:1},8,["title"]),t(re,{title:e(n)("unaccountable-work-periods.name",2),name:"unaccountable-periods"},{default:a(()=>[t(se,{ref_key:"refUnaccountable",ref:o,store:e(y),params:{query:{companyId:i.companyId,$sort:{order:1}}},sortable:"","create-data":({items:D})=>({companyId:i.companyId,order:D.length+1}),"active-status-filter":e(r),"hide-delete-button":"",onSorted:I[1]||(I[1]=({items:D})=>D.forEach((W,ue)=>W.order=ue+1)),onDeleted:I[2]||(I[2]=({items:D})=>D.forEach((W,ue)=>W.order=ue+1))},{topLeft:a(()=>[t(ce,{modelValue:e(r),"onUpdate:modelValue":I[0]||(I[0]=D=>J(r)?r.value=D:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),default:a(()=>[t(ie,null,{default:a(({row:D})=>[t(fe,{modelValue:D.name,"onUpdate:modelValue":W=>D.name=W,placeholder:"Name"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(ie,{width:"min-content"},{default:a(({row:D})=>[t(pe,{content:D.deactivatedAt?e(n)("actions.Activate"):e(n)("actions.Deactivate")},{default:a(()=>[t(le,{onClick:()=>D.deactivatedAt=D.deactivatedAt?null:new Date},{default:a(()=>[t(K,{icon:D.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","create-data","active-status-filter"])]),_:1},8,["title"]),t(re,{title:e(n)("assignment-event-work-periods.name",2),name:"work-periods"},{default:a(()=>[t(ye,{modelValue:e($),"onUpdate:modelValue":I[3]||(I[3]=D=>J($)?$.value=D:null),type:"card"},{default:a(()=>[(d(!0),E(z,null,Z(e(f),D=>(d(),M(Ae,{key:D.uuid,name:`eventType-${D.uuid}`,label:D.name,lazy:""},{default:a(()=>[t(xl,{ref_for:!0,ref_key:"refsSettingsPerEventType",ref:u,"company-id":i.companyId,"event-type":D,onHasChanges:W=>p(D,W)},null,8,["company-id","event-type","onHasChanges"])]),_:2},1032,["name","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}}),jl=G({__name:"SettingsUploadCategories",props:{companyId:{}},setup(i,{expose:h}){const n=i,{t:s}=ee(),l=de(),u=S(()=>({query:{companyId:n.companyId,$sort:{order:1}}})),o=S(()=>({query:{companyId:n.companyId,$sort:{order:1}}})),r=ka().createScope(),b=Sa().createScope(),v=Fe().createScope(),{save:y,reset:g,hasChanges:f}=b.useFeathersItems({params:S(()=>({query:{companyId:n.companyId,$limit:-1}}))}),w=R();function A(){w.value?.reset(),g()}async function k(){await Promise.all([w.value?.save({saveNew:!0,saveChanged:!0,saveRemoved:!1}),y({saveChanged:!0,saveRemoved:!0,saveNew:!1})]),await De(),await Promise.all([w.value?.save({saveRemoved:!0,saveChanged:!1,saveNew:!1}),y({saveNew:!0,saveChanged:!1,saveRemoved:!1})])}const c=S(()=>!!w.value?.hasChanges||!!f.value);return h({cancel:A,save:k,hasChanges:c}),(m,V)=>{const T=Se,q=oe,B=te("font-awesome-icon"),$=Q,p=me;return d(),E("div",null,[_("h4",null,C(e(s)("uploadCategories.name",2)),1),t(se,{ref_key:"refTable",ref:w,store:e(r),params:e(u),"fetch-params":e(o),sortable:"","hide-delete-button":"","active-status-filter":e(l),"create-data":({items:U})=>({companyId:m.companyId,order:U.length+1}),onSorted:V[1]||(V[1]=({items:U})=>U.forEach((P,x)=>P.order=x+1)),onDeleted:V[2]||(V[2]=({items:U})=>U.forEach((P,x)=>P.order=x+1))},{topLeft:a(()=>[t(ce,{modelValue:e(l),"onUpdate:modelValue":V[0]||(V[0]=U=>J(l)?l.value=U:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),default:a(()=>[t(j,{title:e(s)("color"),width:"max-content"},{default:a(({row:U})=>[t(T,{modelValue:U.color,"onUpdate:modelValue":P=>U.color=P,predefine:e(Ie)},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:1},8,["title"]),t(j,{title:e(s)("name"),width:"minmax(200px,1fr)"},{default:a(({row:U})=>[t(q,{modelValue:U.name,"onUpdate:modelValue":P=>U.name=P},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(j,{title:e(s)("roles.name",2),width:"200px"},{default:a(({row:U})=>[t(It,{"junction-store":e(b),"relation-store":e(v),"single-object":U,"label-field":"name","company-id":U.companyId,"single-object-secondary-key":"category","relation-secondary-key":"role","local-only":""},null,8,["junction-store","relation-store","single-object","company-id"])]),_:1},8,["title"]),t(j,{width:"min-content"},{default:a(({row:U})=>[t(p,{content:U.deactivatedAt?e(s)("actions.Activate"):e(s)("actions.Deactivate")},{default:a(()=>[t($,{onClick:()=>U.deactivatedAt=U.deactivatedAt?null:new Date},{default:a(()=>[t(B,{icon:U.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","fetch-params","active-status-filter","create-data"])])}}}),Bl=G({__name:"SelectStripeInvoiceStatusFilter",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const h=ke(i,"modelValue"),{t:n}=ee(),s=S(()=>[{value:"draft",label:n("stripe.status.draft")},{value:"open",label:n("stripe.status.open")},{value:"paid",label:n("stripe.status.paid")},{value:"uncollectible",label:n("stripe.status.uncollectible")},{value:"void",label:n("stripe.status.void")}]);return(l,u)=>{const o=we,r=he;return d(),M(r,{modelValue:h.value,"onUpdate:modelValue":u[0]||(u[0]=b=>h.value=b),clearable:"",placeholder:e(n)("stripe.status.name")},{default:a(()=>[(d(!0),E(z,null,Z(e(s),b=>(d(),M(o,{key:b.value,label:b.label,value:b.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])}}});function at(i,h,n){const s=S({get(){return i.value},set(l){h(l),i.value=l,n?.(l)}});return s.bypass=l=>{i.value=l},s}const Wl={class:"flex gap-2"},Gl={class:"min-w-44"},Ll={class:"flex gap-2"},Hl={class:"flex justify-end mt-2"},zl=G({__name:"StripeInvoices",props:{companyId:{},subscriptionId:{}},setup(i){const h=i,{locale:n}=ee(),l=qe().createScope().useGet({id:S(()=>h.companyId)}),u=S(()=>l.data.value?.stripeCustomer??null),o=He([]),r=X(null),b=X(!0),v=X(!0),y=at(X(null),()=>f(),()=>k()),g=at(X(null),()=>f(),()=>k());function f(){b.value=!0,v.value=!0,r.value=null,o.splice(0,o.length)}const{execute:w,isLoading:A}=ht(async()=>{if(!b.value||!u.value)return;let V=`customer:'${u.value}' AND subscription:'${h.subscriptionId}'`;y.value&&(V+=` AND status:'${y.value}'`),g.value&&(V+=` AND number:'${g.value}'`);const T=await Ye.service("stripe/invoices").search({paginate:!0,query:{page:r.value??void 0,limit:5,query:V,expand:["data.subscription"]}});b.value=T.has_more,r.value=T.next_page,o.push(...T.data),v.value=!1},{useNProgress:!0}),k=ct(w,1e3,{leading:!0});ve(u,(V,T)=>{V&&V!==T&&(y.bypass(null),g.bypass(null),f(),k())},{immediate:!0});function c(V){return V.status==="open"&&V.due_date&&new Date(V.due_date*1e3)<new Date}function m(V){if(c(V))return"danger";if(V.status!=="open"){if(V.status==="paid")return"success";if(V.status==="draft")return"info";if(V.status==="uncollectible"||V.status==="void")return"danger"}}return(V,T)=>{const q=oe,B=nt,$=Q;return d(),E("div",null,[_("div",Wl,[_("div",Gl,[t(Bl,{modelValue:e(y),"onUpdate:modelValue":T[0]||(T[0]=p=>J(y)?y.value=p:null)},null,8,["modelValue"])]),_("div",null,[t(q,{modelValue:e(g),"onUpdate:modelValue":T[1]||(T[1]=p=>J(g)?g.value=p:null),clearable:"",placeholder:V.$t("stripe.number")},null,8,["modelValue","placeholder"])])]),t(wt,{data:e(o),"key-property":"id"},{default:a(()=>[t(j,{title:V.$t("stripe.amount")},{default:a(({row:p})=>[L(C((p.total/100).toLocaleString(e(n),{style:"currency",currency:p.currency}))+" ",1),t(B,{class:"ml-2",type:m(p)},{default:a(()=>[L(C(V.$t(c(p)?"stripe.status.overdue":`stripe.status.${p.status}`)),1)]),_:2},1032,["type"])]),_:1},8,["title"]),t(j,{title:V.$t("stripe.number")},{default:a(({row:p})=>[L(C(p.number),1)]),_:1},8,["title"]),t(j,{title:V.$t("stripe.due_date")},{default:a(({row:p})=>[p.due_date?(d(),E(z,{key:0},[L(C(e($a)(new Date(p.due_date*1e3))),1)],64)):N("",!0)]),_:1},8,["title"]),t(j,{title:V.$t("stripe.created")},{default:a(({row:p})=>[L(C(e(xa)(new Date(p.created*1e3))),1)]),_:1},8,["title"]),t(j,{width:"max-content"},{default:a(({row:p})=>[_("div",Ll,[_("div",null,[p.invoice_pdf?(d(),M($,{key:0,tag:"a",target:"_blank",rel:"noopener noreferrer",href:p.invoice_pdf},{default:a(()=>[L(C(V.$t("stripe.pdf")),1)]),_:2},1032,["href"])):N("",!0)]),_("div",null,[p.hosted_invoice_url?(d(),M($,{key:0,tag:"a",target:"_blank",rel:"noopener noreferrer",href:p.hosted_invoice_url},{default:a(()=>[L(C(V.$t("stripe.webInvoice")),1)]),_:2},1032,["href"])):N("",!0)])])]),_:1})]),_:1},8,["data"]),_("div",Hl,[e(b)&&!e(v)?(d(),M($,{key:0,disabled:e(A),onClick:T[2]||(T[2]=p=>e(k)())},{default:a(()=>[L(C(V.$t("stripe.loadMore")),1)]),_:1},8,["disabled"])):N("",!0)])])}}});function Kl(i){const h=X(!1);return Ge(()=>dt(i),()=>{h.value||(h.value=!0)},{immediate:!0}),h}function Jl(){const{locale:i}=ee();return S(()=>new Intl.ListFormat(i.value))}const Yl={key:0},Xl=G({__name:"StripeSubscription",props:{subscription:{},expanded:{type:Boolean},companyId:{}},setup(i){const h=i,{locale:n}=ee(),s=Kl(()=>h.expanded),l=it(async o=>{const r=h.subscription.id,b=[];let v=!0;for(o(()=>v=!1);v;){const y=await Ye.service("stripe/subscription-items").find({paginate:!0,query:{subscription:r,expand:["data.plan.product"]}});b.push(...y.data),v=y.has_more}return b},null),u=Jl();return(o,r)=>{const b=Xt,v=Zt,y=Qt,g=ea,f=Ee;return d(),M(f,{key:o.subscription.id,name:o.subscription.id},{title:a(()=>[t(v,{loading:e(l)===null},{template:a(()=>[t(b,{variant:"p",style:{width:"50%"}})]),default:a(()=>[typeof o.subscription.customer!="string"&&"name"in o.subscription.customer?(d(),E(z,{key:0},[L(C(o.subscription.customer.name)+" -  ",1),(d(!0),E(z,null,Z(e(l),w=>(d(),E("span",{key:w.id},[typeof w.plan.product=="object"&&w.plan.product&&"name"in w.plan.product?(d(),E(z,{key:0},[L(C(w.plan.product.name)+"  ",1)],64)):N("",!0)]))),128))],64)):N("",!0)]),_:1},8,["loading"])]),default:a(()=>[t(g,null,{default:a(()=>[t(y,{label:o.$t("stripe.subscriptions.startedAt")},{default:a(()=>[L(C(e(Re)(new Date(o.subscription.start_date*1e3))),1)]),_:1},8,["label"]),t(y,{label:o.$t("stripe.subscriptions.currentPeriod")},{default:a(()=>[L(C(e(Re)(new Date(o.subscription.current_period_start*1e3)))+" - "+C(e(Re)(new Date(o.subscription.current_period_end*1e3))),1)]),_:1},8,["label"]),h.subscription.payment_settings?.payment_method_types?(d(),M(y,{key:0,label:o.$t("stripe.subscriptions.payment_method",h.subscription.payment_settings.payment_method_types.length)},{default:a(()=>[L(C(e(u).format(h.subscription.payment_settings.payment_method_types.map(w=>o.$t(`stripe.subscriptions.payment_method_types.${w}`)))),1)]),_:1},8,["label"])):N("",!0)]),_:1}),t(wt,{data:e(l)??[],"key-property":"id"},{default:a(()=>[t(j,{title:o.$t("stripe.subscriptions.product")},{default:a(({row:w})=>[w.plan.product&&typeof w.plan.product=="object"&&"name"in w.plan.product?(d(),E(z,{key:0},[L(C(w.plan.product.name),1)],64)):N("",!0)]),_:1},8,["title"]),t(j,{title:o.$t("stripe.subscriptions.quantity"),width:"max-content"},{default:a(({row:w})=>[L(C(w.quantity),1)]),_:1},8,["title"]),t(j,{title:o.$t("stripe.subscriptions.price"),width:"max-content"},{default:a(({row:w})=>[L(C(((w.price.unit_amount??0)/100).toLocaleString(e(n),{style:"currency",currency:w.price.currency}))+" ",1),w.price.recurring?(d(),E(z,{key:0},[L(" / "+C(o.$t(`stripe.interval.${w.price.recurring.interval}`)),1)],64)):N("",!0)]),_:1},8,["title"])]),_:1},8,["data"]),e(s)?(d(),E("div",Yl,[t(zl,{"company-id":o.companyId,"subscription-id":o.subscription.id},null,8,["company-id","subscription-id"])])):N("",!0)]),_:1},8,["name"])}}}),Zl=G({__name:"SettingsStripeSubscriptions",props:{companyId:{}},setup(i,{expose:h}){const n=i,l=qe().createScope().useGet({id:S(()=>n.companyId)}),u=S(()=>l.data.value?.stripeCustomer??null),o=X(null),r=X(!0),b=X(!0),v=He([]),y=X([]);function g(){r.value=!0,b.value=!0,o.value=null}const{execute:f}=ht(async()=>{if(!r.value||!u.value)return;const A=await Ye.service("stripe/subscriptions").find({paginate:!0,query:{limit:5,customer:u.value,expand:["data.customer"]}});if(r.value=A.has_more,o.value=A.data.at(-1)?.id??null,v.push(...A.data),b.value){const k=v.at(0)?.id;k&&(y.value=[k])}b.value=!1},{useNProgress:!0}),w=ct(f,1e3,{leading:!0});return ve(u,(A,k)=>{A&&A!==k&&(v.splice(0,v.length),y.value=[],g(),w())},{immediate:!0}),h({activeSubscriptions:y}),(A,k)=>{const c=Me;return d(),M(c,{modelValue:e(y),"onUpdate:modelValue":k[0]||(k[0]=m=>J(y)?y.value=m:null)},{default:a(()=>[(d(!0),E(z,null,Z(e(v),m=>(d(),M(Xl,{key:m.id,subscription:m,"company-id":A.companyId,expanded:e(y).includes(m.id)},null,8,["subscription","company-id","expanded"]))),128))]),_:1},8,["modelValue"])}}}),Ut=G({__name:"SettingPaneItem",props:{item:{type:Object,required:!0},isActive:{type:Boolean,default:!1}},setup(i){return(h,n)=>(d(),E("li",{class:ge(["px-3 py-1.5 mb-1 rounded transition-all duration-150 ease-in-out w-44 truncate",[i.isActive?"bg-white shadow-sm":"cursor-pointer text-gray-600 hover:text-black hover:bg-white/70",i.item.hasChanges?"border-l-4 border-l-red-700":"pl-4"]])},[_e(h.$slots,"default",{item:i.item},()=>[L(C(i.item.title),1)])],2))}}),Ql={class:"w-44 cursor-pointer"},es={class:"flex-1 font-bold text-gray-500"},ts=G({__name:"SettingPaneGroup",props:{modelValue:{type:String,default:void 0},group:{type:Object,required:!0}},emits:["click-item"],setup(i,{emit:h}){const n=R(!0),s=h;return(l,u)=>{const o=te("font-awesome-icon");return d(),E("li",Ql,[_("div",{class:"flex items-center my-1.5",onClick:u[0]||(u[0]=()=>n.value=!e(n))},[_("div",es,[_e(l.$slots,"group",{item:i.group},()=>[L(C(i.group.title),1)])]),t(o,{icon:"angle-down",class:ge(["text-xs text-gray-400 p-2 transition-all ease-in-out duration-200",{"rotate-180":e(n)}])},null,8,["class"])]),_("ul",{class:ge(["transition-all ease-in-out duration-250 overflow-hidden",{"max-h-0":!e(n),"max-h-96":e(n)}])},[(d(!0),E(z,null,Z(i.group.items,r=>(d(),M(Ut,{key:r.value,item:r,"is-active":r.value===i.modelValue,onClick:b=>s("click-item",r.value)},{default:a(b=>[_e(l.$slots,"default",Be({ref_for:!0},b))]),_:2},1032,["item","is-active","onClick"]))),128))],2)])}}}),as={key:0},ns=G({__name:"SettingsPanes",props:{modelValue:{type:String,default:void 0},items:{type:Array,required:!0},isDropdown:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(i,{emit:h}){const n=i,s=h,l=S(()=>{for(const r of n.items){if(o(r))return r;if(r.items.length>0)return r.items[0]}});n.modelValue||l.value&&s("update:modelValue",l.value.value);function u(r){return"items"in r}function o(r){return!u(r)}return(r,b)=>{const v=we,y=ta,g=he;return i.isDropdown?(d(),M(g,{key:1,"model-value":i.modelValue,style:{width:"100%"},"onUpdate:modelValue":b[1]||(b[1]=f=>s("update:modelValue",f))},{default:a(()=>[(d(!0),E(z,null,Z(i.items,f=>(d(),E(z,{key:f.value},[u(f)?(d(),M(y,{key:0,label:f.title},{default:a(()=>[(d(!0),E(z,null,Z(f.items,w=>(d(),M(v,{key:w.value,label:w.title,value:w.value},null,8,["label","value"]))),128))]),_:2},1032,["label"])):(d(),M(v,{key:1,label:f.title,value:f.value},null,8,["label","value"]))],64))),128))]),_:1},8,["model-value"])):(d(),E("ul",as,[(d(!0),E(z,null,Z(i.items,f=>(d(),E(z,{key:f.value},[u(f)?(d(),M(ts,{key:0,"model-value":i.modelValue,group:f,onClickItem:b[0]||(b[0]=w=>s("update:modelValue",w))},{group:a(()=>[_e(r.$slots,"group",{item:f})]),default:a(w=>[_e(r.$slots,"default",Be({ref_for:!0},w))]),_:2},1032,["model-value","group"])):(d(),M(Ut,{key:1,item:f,"is-active":i.modelValue===f.value,onClick:w=>s("update:modelValue",f.value)},{default:a(w=>[_e(r.$slots,"default",Be({ref_for:!0},w))]),_:2},1032,["item","is-active","onClick"]))],64))),128))]))}}}),os=()=>Ve(),ls={class:"flex flex-col lg:flex-row gap-2"},ss={class:"flex-1 overflow-hidden bg-white rounded p-4 shadow"},rs={key:18,class:"flex mt-4 justify-end gap-2"},Es=G({__name:"ArtesaSettings",props:Ce({companyId:{}},{modelValue:{default:"users"},modelModifiers:{}}),emits:Ce(["canceled","saved"],["update:modelValue"]),setup(i,{emit:h}){const n=i,s=ke(i,"modelValue"),l=h,{t:u}=ee(),o=qe().createScope(),r=S(()=>({users:{title:u("settings.groups.users-group"),name:"users-group"},assignment:{title:u("settings.groups.assignment-group"),name:"assignment-group"},timeTracking:{title:u("settings.groups.timeTracking-group"),name:"timeTracking-group"},stripe:{title:u("settings.groups.stripe"),name:"stripe"},misc:{title:u("settings.groups.misc-group"),name:"misc-group"}})),b=ja(()=>n.companyId),v=o.useGet({id:S(()=>n.companyId)}),y=S(()=>{function O(W){return w("view",W)&&!b(W)}function D(W,ue,Oe,Xe,Dt,Et){const Ne=O(Oe)&&(Et??!0);return{title:ue,name:W,isActive:Ne,group:Dt,shown:Ne&&f.value.includes(W),show:Ne&&s.value===W,ref:Xe,hasChanges:!!Xe.value?.hasChanges}}return{users:D("users",u("settings.tab.users"),"ViewSettings.Users",$,r.value.users),roles:D("roles",u("settings.tab.roles"),"ViewSettings.Roles",q,r.value.users),capabilities:D("capabilities",u("user-capabilities.name",2),"ViewSettings.Capabilities",U,r.value.users),gangs:D("gangs",u("settings.tab.gangs"),"ViewSettings.Gangs",P,r.value.users),assignmentTypes:D("assignment-types",u("settings.tab.assignmentTypes"),"ViewSettings.AssignmentTypes",c,r.value.assignment),assignmentTagTypes:D("assignment-tag-types",u("settings.tab.assignmentCategories"),"ViewSettings.AssignmentTagTypes",k,r.value.assignment),assignmentEvents:D("assignment-events",u("settings.tab.assignmentEvents"),"ViewSettings.AssignmentEventTypes",A,r.value.assignment),assignmentStatusTypes:D("assignment-status-types",u("assignmentStatusTypes.tab"),"ViewSettings.AssignmentStatusTypes",re,r.value.assignment),workPeriods:D("work-periods",u("settings.tab.workPeriods"),"ViewSettings.AssignmentEventWorkPeriods",p,r.value.timeTracking),userAbsenceTypes:D("user-absence-types",u("userAbsence.absence",2),"ViewSettings.UserAbsenceTypes",B,r.value.timeTracking),timeSheets:D("time-sheets",u("settings.tab.timeSheets"),"ViewSettings.TimeSheets",I,r.value.timeTracking),uploadCategories:D("upload-categories",u("settings.tab.uploadCategories"),"ViewSettings.UploadCategories",H,r.value.misc),manufacturing:D("manufacturing",u("settings.tab.manufacturing"),"ViewSettings.Manufacturing",T,r.value.misc),customViews:D("custom-views",u("settings.tab.customViews"),"ViewSettings.CustomViews",V,r.value.misc),holidays:D("holidays",u("holidays.name",2),"ViewSettings.Holidays",x,r.value.misc),company:D("company",u("settings.tab.company"),"ViewSettings.Company",m,r.value.misc),stripeSubscriptions:D("stripeSubscriptions",u("settings.tab.stripeSubscriptions"),"ViewSettings.StripeSubscriptions",fe,r.value.stripe,!!(v.data.value?.stripeCustomer??!1)),superadmin:D("superadmin","SuperAdmin","ViewSettings.SuperAdmin",F,r.value.misc)}}),g=S(()=>{const O=[];for(const D in y.value){const W=y.value[D];if(!W.isActive)continue;const ue=O.find(Oe=>Oe.value===W.group.name);ue?ue.items.push({title:W.title,value:W.name,hasChanges:W.hasChanges}):O.push({title:W.group.title,value:W.group.name,items:[{title:W.title,value:W.name,hasChanges:W.hasChanges}]})}return O}),f=R([]),{can:w}=os(),A=R(),k=R(),c=R(),m=R(),V=R(),T=R(),q=R(),B=R(),$=R(),p=R(),U=R(),P=R(),x=R(),F=R(),I=R(),H=R(),re=R(),fe=R(),ie={refAssignmentEventTypes:A,refAssignmentTagTypes:k,refAssignmentTypes:c,refCompany:m,refCustomViews:V,refManufacturing:T,refRoles:q,refUserAbsenceTypes:B,refUsers:$,refWorkPeriods:p,refCapabilities:U,refGangs:P,refHolidays:x,refSuperAdmin:F,refTimeSheets:I,refAssignmentStatusTypes:re,refUploadCategories:H,refStripeSubscriptions:fe};ve(s,O=>{O&&!f.value.includes(O)&&f.value.push(O)},{immediate:!0});const K=ze();Ge(()=>s.value==="holidays",()=>{x.value?.rerender()});function le(){for(const O in ie){const D=ie[O];D.value&&"cancel"in D.value&&typeof D.value.cancel=="function"&&D.value.cancel()}Ue({title:u("settings.events.canceled"),type:"info"}),l("canceled")}const pe=R(!1);async function Ae(){const O=[];pe.value=!0;for(const D in ie){const W=ie[D];W.value&&"save"in W.value&&typeof W.value.save=="function"&&O.push(W.value.save())}try{await Promise.all(O),Ue({title:u("settings.events.saved"),type:"success"}),l("saved")}catch{Ue({title:u("settings.events.notSaved"),message:u("settings.events.notSavedMessage"),type:"error"})}finally{pe.value=!1}}aa(async()=>ye.value?!!await st.confirm(u("discardReminder"),u("warning"),{confirmButtonText:u("Yes"),cancelButtonText:u("actions.Cancel"),type:"warning",confirmButtonClass:"el-button--warning"}).then(()=>Promise.resolve(!0)).catch(()=>Promise.resolve(!1)):!0);const ye=S(()=>{for(const O in ie)if(ie[O].value?.hasChanges)return!0;return!1});return(O,D)=>{const W=Q;return d(),E("div",ls,[_("div",null,[t(ns,{modelValue:s.value,"onUpdate:modelValue":D[0]||(D[0]=ue=>s.value=ue),items:e(g),"is-dropdown":e(K).maxLg},{default:a(({item:ue})=>[L(C(ue.title),1)]),_:1},8,["modelValue","items","is-dropdown"])]),_("div",ss,[e(y).users.shown?Y((d(),M(Tn,{key:0,ref_key:"refUsers",ref:$,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).users.show]]):N("",!0),e(y).roles.shown?Y((d(),M(uo,{key:1,ref_key:"refRoles",ref:q,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).roles.show]]):N("",!0),e(y).capabilities.shown?Y((d(),M(Sl,{key:2,ref_key:"refCapabilities",ref:U,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).capabilities.show]]):N("",!0),e(y).gangs.shown?Y((d(),M(Wn,{key:3,ref_key:"refGangs",ref:P,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).gangs.show]]):N("",!0),e(y).assignmentTypes.shown?Y((d(),M(hn,{key:4,ref_key:"refAssignmentTypes",ref:c,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).assignmentTypes.show]]):N("",!0),e(y).assignmentTagTypes.shown?Y((d(),M(bn,{key:5,ref_key:"refAssignmentTagTypes",ref:k,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).assignmentTagTypes.show]]):N("",!0),e(y).assignmentEvents.shown?Y((d(),M(gn,{key:6,ref_key:"refAssignmentEventTypes",ref:A,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).assignmentEvents.show]]):N("",!0),e(y).assignmentStatusTypes.shown?Y((d(),M(_n,{key:7,ref_key:"refAssignmentStatusTypes",ref:re,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).assignmentStatusTypes.show]]):N("",!0),e(y).workPeriods.shown?Y((d(),M(Rl,{key:8,ref_key:"refWorkPeriods",ref:p,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).workPeriods.show]]):N("",!0),e(y).userAbsenceTypes.shown?Y((d(),M(ul,{key:9,ref_key:"refUserAbsenceTypes",ref:B,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).userAbsenceTypes.show]]):N("",!0),e(y).timeSheets.shown?Y((d(),M(ll,{key:10,ref_key:"refTimeSheets",ref:I,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).timeSheets.show]]):N("",!0),e(y).holidays.shown?Y((d(),M(Zn,{key:11,ref_key:"refHolidays",ref:x,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).holidays.show]]):N("",!0),e(y).customViews.shown?Y((d(),M(In,{key:12,ref_key:"refCustomViews",ref:V,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).customViews.show]]):N("",!0),e(y).manufacturing.shown?Y((d(),M(to,{key:13,ref_key:"refManufacturing",ref:T,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).manufacturing.show]]):N("",!0),e(y).company.shown?Y((d(),M(kn,{key:14,ref_key:"refCompany",ref:m,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).company.show]]):N("",!0),e(y).uploadCategories.shown?Y((d(),M(jl,{key:15,ref_key:"refUploadCategories",ref:H,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).uploadCategories.show]]):N("",!0),e(y).stripeSubscriptions.shown?Y((d(),M(Zl,{key:16,ref_key:"refStripeSubscriptions",ref:fe,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).stripeSubscriptions.show]]):N("",!0),e(y).superadmin.shown?Y((d(),M(go,{key:17,ref_key:"refSuperAdmin",ref:F,"company-id":O.companyId},null,8,["company-id"])),[[ae,e(y).superadmin.show]]):N("",!0),e(ye)?(d(),E("div",rs,[t(W,{text:!e(ye),plain:"",type:e(ye)?"warning":void 0,onClick:le},{default:a(()=>[L(C(O.$t("actions.Cancel")),1)]),_:1},8,["text","type"]),t(W,{loading:e(pe),type:"primary",onClick:Ae},{default:a(()=>[L(C(O.$t("actions.Save")),1)]),_:1},8,["loading"])])):N("",!0)])])}}});export{Es as _};
