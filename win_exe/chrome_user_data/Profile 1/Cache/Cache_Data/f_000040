const __vite__fileDeps=["assets/ViewUserAbsenceNorms-Ca8uce6X.js","assets/ViewUserAbsenceNorms.vue_vue_type_script_setup_true_lang-BGxrj7i1.js","assets/GridTableColumn.vue_vue_type_script_setup_true_lang-BayDfMSt.js","assets/index-M8nwXBBi.js","assets/vendor-CJXdOFCa.js","assets/vendor-jIhZnUxc.css","assets/index-Cpd7lwzu.css","assets/GridTableColumn-BGrcamLo.css","assets/SelectUser.vue_vue_type_script_setup_true_lang-81euLzTY.js","assets/FeathersSelectAutocomplete.vue_vue_type_style_index_0_lang-D553730i.js","assets/addLiteralPercentage-DRqvLqOk.js","assets/index-C4Rzlq_k.js","assets/FeathersSelectAutocomplete-DijEPAxR.css","assets/SelectAbsenceType.vue_vue_type_script_setup_true_lang-q5Oe291l.js","assets/AbsenceTypeTag.vue_vue_type_script_setup_true_lang-T5-HFkFp.js","assets/useIsUserOfRole-BciEmr9Y.js","assets/useRole-B2COsB3X.js","assets/usePagination-Cs_oXynH.js","assets/useCalculatedAbsenceNorms-Dp-lEbch.js","assets/ViewUserAbsenceAnnualPlanning-Bc3zDZJa.js","assets/ArtesaTimePickerForCalendar.vue_vue_type_style_index_0_lang-BBYnsASy.js","assets/index-zBlMUfmj.js","assets/index-B3z-Az2g.js","assets/index-CgnmzLwJ.js","assets/ArtesaTimePickerForCalendar-D-cEYG_s.css","assets/index-CsgZOv_I.js","assets/useFullcalendar-CGsOBmOU.js","assets/PopperSelectUserSingle.vue_vue_type_script_setup_true_lang-mBOovX6F.js","assets/ArtesaProfilePicture.vue_vue_type_script_setup_true_lang-CvX_tVhj.js","assets/ArtesaTooltip-CzaCLuSr.js","assets/index.browser-DP16PUbO.js","assets/ArtesaTooltip-DtacCa5U.css","assets/PopperFeathersItems.vue_vue_type_script_setup_true_lang-hljKYvsA.js","assets/floating-vue-FD3sxU32.js","assets/users.helpers-iK3u8JSc.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{a as Fe,w as it,h as Re,x as Ue,y as dt,s as ut,v as pe,H as ct,z as mt,A as ft,B as pt,C as vt,_ as xe}from"./index-M8nwXBBi.js";import{a9 as Ne,Z as O,s as I,r as de,V as Y,a as ee,u as Oe,aB as yt,dZ as gt,b as ue,o as $,aC as J,g as T,h as o,c as r,k,e as F,j as R,f as m,i as H,t as C,eo as bt,_ as Ie,l as He,eM as ht,er as _t,ep as At,eq as wt,eZ as $t,$ as Dt,e6 as xt,aj as It,e_ as Ct,e$ as kt,D as St,f0 as Vt,az as Et,eV as Tt,eW as Ft,aF as Ce}from"./vendor-CJXdOFCa.js";import{_ as Rt}from"./ViewTitle.vue_vue_type_script_setup_true_lang-jbaBK0gh.js";import{i as Ut}from"./index-BVk_Mu3e.js";import{c as Me,D as Nt,m as ke,g as ie,y as g,S as Ot,V as Ht,C as ve,f as qe,s as Mt,a as qt,N as Pt,b as zt,i as Gt,d as Lt,B as Pe,e as Bt,h as Se,j as Wt,_ as ze,E as jt,k as Yt,l as Zt,n as fe,o as Kt,p as Ve,q as Qt,r as oe,t as Xt}from"./index-CsgZOv_I.js";import{u as Jt,F as es}from"./useFullcalendar-CGsOBmOU.js";import{_ as ts}from"./ArtesaTimePickerForCalendar.vue_vue_type_style_index_0_lang-BBYnsASy.js";import{_ as Ge}from"./SelectAssignmentEventType.vue_vue_type_script_setup_true_lang-D-40_Wby.js";import{_ as Le,a as ss,b as as}from"./DialogFormUserAbsence.vue_vue_type_script_setup_true_lang-Cj_606mD.js";import{_ as Be}from"./SelectAbsenceType.vue_vue_type_script_setup_true_lang-q5Oe291l.js";import{u as We}from"./user-capabilities.store-CT1KSZFU.js";import{g as ns,a as ls}from"./user-absences.helpers-C55N6n0p.js";import{g as Ee}from"./users.helpers-iK3u8JSc.js";import{u as rs}from"./useRole-B2COsB3X.js";import{u as je}from"./useIsUserOfRole-BciEmr9Y.js";import{T as os}from"./index-C4Rzlq_k.js";import{_ as is}from"./SelectUser.vue_vue_type_script_setup_true_lang-81euLzTY.js";import{_ as ds}from"./FeathersTablePagination.vue_vue_type_style_index_0_lang-DDfA-nHC.js";import{_ as L}from"./GridTableColumn.vue_vue_type_script_setup_true_lang-BayDfMSt.js";import{_ as us}from"./AbsenceTypeTag.vue_vue_type_script_setup_true_lang-T5-HFkFp.js";import"./index-zBlMUfmj.js";import"./index-B3z-Az2g.js";import"./index-CgnmzLwJ.js";import"./FeathersSelectAutocomplete.vue_vue_type_style_index_0_lang-D553730i.js";import"./addLiteralPercentage-DRqvLqOk.js";import"./colorHelpers-D-IKRuV7.js";import"./index-DX0mSCHG.js";import"./MakeSortable.vue_vue_type_script_setup_true_lang-DJUGCLh6.js";import"./usePagination-Cs_oXynH.js";class cs extends Pe{constructor(){super(...arguments),this.state={textId:ie()}}render(){let{theme:e,dateEnv:s,options:a,viewApi:d}=this.context,{cellId:u,dayDate:f,todayRange:i}=this.props,{textId:c}=this.state,v=Bt(f,i),b=a.listDayFormat?s.format(f,a.listDayFormat):"",h=a.listDaySideFormat?s.format(f,a.listDaySideFormat):"",D=Object.assign({date:s.toDate(f),view:d,textId:c,text:b,sideText:h,navLinkAttrs:Se(this.context,f),sideNavLinkAttrs:Se(this.context,f,"day",!1)},v);return g(ve,{elTag:"tr",elClasses:["fc-list-day",...Wt(v,e)],elAttrs:{"data-date":qe(f)},renderProps:D,generatorName:"dayHeaderContent",customGenerator:a.dayHeaderContent,defaultGenerator:ms,classNameGenerator:a.dayHeaderClassNames,didMount:a.dayHeaderDidMount,willUnmount:a.dayHeaderWillUnmount},S=>g("th",{scope:"colgroup",colSpan:3,id:u,"aria-labelledby":c},g(S,{elTag:"div",elClasses:["fc-list-day-cushion",e.getClass("tableCellShaded")]})))}}function ms(l){return g(ze,null,l.text&&g("a",Object.assign({id:l.textId,className:"fc-list-day-text"},l.navLinkAttrs),l.text),l.sideText&&g("a",Object.assign({"aria-hidden":!0,className:"fc-list-day-side-text"},l.sideNavLinkAttrs),l.sideText))}const fs=Me({hour:"numeric",minute:"2-digit",meridiem:"short"});class ps extends Pe{render(){let{props:e,context:s}=this,{options:a}=s,{seg:d,timeHeaderId:u,eventHeaderId:f,dateHeaderId:i}=e,c=a.eventTimeFormat||fs;return g(jt,Object.assign({},e,{elTag:"tr",elClasses:["fc-list-event",d.eventRange.def.url&&"fc-event-forced-url"],defaultGenerator:()=>vs(d,s),seg:d,timeText:"",disableDragging:!0,disableResizing:!0}),(v,b)=>g(ze,null,ys(d,c,s,u,i),g("td",{"aria-hidden":!0,className:"fc-list-event-graphic"},g("span",{className:"fc-list-event-dot",style:{borderColor:b.borderColor||b.backgroundColor}})),g(v,{elTag:"td",elClasses:["fc-list-event-title"],elAttrs:{headers:`${f} ${i}`}})))}}function vs(l,e){let s=Yt(l,e);return g("a",Object.assign({},s),l.eventRange.def.title)}function ys(l,e,s,a,d){let{options:u}=s;if(u.displayEventTime!==!1){let f=l.eventRange.def,i=l.eventRange.instance,c=!1,v;if(f.allDay?c=!0:Zt(l.eventRange.range)?l.isStart?v=fe(l,e,s,null,null,i.range.start,l.end):l.isEnd?v=fe(l,e,s,null,null,l.start,i.range.end):c=!0:v=fe(l,e,s),c){let b={text:s.options.allDayText,view:s.viewApi};return g(ve,{elTag:"td",elClasses:["fc-list-event-time"],elAttrs:{headers:`${a} ${d}`},renderProps:b,generatorName:"allDayContent",customGenerator:u.allDayContent,defaultGenerator:gs,classNameGenerator:u.allDayClassNames,didMount:u.allDayDidMount,willUnmount:u.allDayWillUnmount})}return g("td",{className:"fc-list-event-time"},v)}return null}function gs(l){return l.text}class bs extends Nt{constructor(){super(...arguments),this.computeDateVars=ke(_s),this.eventStoreToSegs=ke(this._eventStoreToSegs),this.state={timeHeaderId:ie(),eventHeaderId:ie(),dateHeaderIdRoot:ie()},this.setRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e}):this.context.unregisterInteractiveComponent(this)}}render(){let{props:e,context:s}=this,{dayDates:a,dayRanges:d}=this.computeDateVars(e.dateProfile),u=this.eventStoreToSegs(e.eventStore,e.eventUiBases,d);return g(Ht,{elRef:this.setRootEl,elClasses:["fc-list",s.theme.getClass("table"),s.options.stickyHeaderDates!==!1?"fc-list-sticky":""],viewSpec:s.viewSpec},g(Ot,{liquid:!e.isHeightAuto,overflowX:e.isHeightAuto?"visible":"hidden",overflowY:e.isHeightAuto?"visible":"auto"},u.length>0?this.renderSegList(u,a):this.renderEmptyMessage()))}renderEmptyMessage(){let{options:e,viewApi:s}=this.context,a={text:e.noEventsText,view:s};return g(ve,{elTag:"div",elClasses:["fc-list-empty"],renderProps:a,generatorName:"noEventsContent",customGenerator:e.noEventsContent,defaultGenerator:hs,classNameGenerator:e.noEventsClassNames,didMount:e.noEventsDidMount,willUnmount:e.noEventsWillUnmount},d=>g(d,{elTag:"div",elClasses:["fc-list-empty-cushion"]}))}renderSegList(e,s){let{theme:a,options:d}=this.context,{timeHeaderId:u,eventHeaderId:f,dateHeaderIdRoot:i}=this.state,c=As(e);return g(Pt,{unit:"day"},(v,b)=>{let h=[];for(let D=0;D<c.length;D+=1){let S=c[D];if(S){let w=qe(s[D]),M=i+"-"+w;h.push(g(cs,{key:w,cellId:M,dayDate:s[D],todayRange:b})),S=Mt(S,d.eventOrder);for(let P of S)h.push(g(ps,Object.assign({key:w+":"+P.eventRange.instance.instanceId,seg:P,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,timeHeaderId:u,eventHeaderId:f,dateHeaderId:M},qt(P,b,v))))}}return g("table",{className:"fc-list-table "+a.getClass("table")},g("thead",null,g("tr",null,g("th",{scope:"col",id:u},d.timeHint),g("th",{scope:"col","aria-hidden":!0}),g("th",{scope:"col",id:f},d.eventHint))),g("tbody",null,h))})}_eventStoreToSegs(e,s,a){return this.eventRangesToSegs(zt(e,s,this.props.dateProfile.activeRange,this.context.options.nextDayThreshold).fg,a)}eventRangesToSegs(e,s){let a=[];for(let d of e)a.push(...this.eventRangeToSegs(d,s));return a}eventRangeToSegs(e,s){let{dateEnv:a}=this.context,{nextDayThreshold:d}=this.context.options,u=e.range,f=e.def.allDay,i,c,v,b=[];for(i=0;i<s.length;i+=1)if(c=Gt(u,s[i]),c&&(v={component:this,eventRange:e,start:c.start,end:c.end,isStart:e.isStart&&c.start.valueOf()===u.start.valueOf(),isEnd:e.isEnd&&c.end.valueOf()===u.end.valueOf(),dayIndex:i},b.push(v),!v.isEnd&&!f&&i+1<s.length&&u.end<a.add(s[i+1].start,d))){v.end=u.end,v.isEnd=!0;break}return b}}function hs(l){return l.text}function _s(l){let e=Kt(l.renderRange.start),s=l.renderRange.end,a=[],d=[];for(;e<s;)a.push(e),d.push({start:e,end:Ve(e,1)}),e=Ve(e,1);return{dayDates:a,dayRanges:d}}function As(l){let e=[],s,a;for(s=0;s<l.length;s+=1)a=l[s],(e[a.dayIndex]||(e[a.dayIndex]=[])).push(a);return e}var ws=':root{--fc-list-event-dot-width:10px;--fc-list-event-hover-bg-color:#f5f5f5}.fc-theme-standard .fc-list{border:1px solid var(--fc-border-color)}.fc .fc-list-empty{align-items:center;background-color:var(--fc-neutral-bg-color);display:flex;height:100%;justify-content:center}.fc .fc-list-empty-cushion{margin:5em 0}.fc .fc-list-table{border-style:hidden;width:100%}.fc .fc-list-table tr>*{border-left:0;border-right:0}.fc .fc-list-sticky .fc-list-day>*{background:var(--fc-page-bg-color);position:sticky;top:0}.fc .fc-list-table thead{left:-10000px;position:absolute}.fc .fc-list-table tbody>tr:first-child th{border-top:0}.fc .fc-list-table th{padding:0}.fc .fc-list-day-cushion,.fc .fc-list-table td{padding:8px 14px}.fc .fc-list-day-cushion:after{clear:both;content:"";display:table}.fc-theme-standard .fc-list-day-cushion{background-color:var(--fc-neutral-bg-color)}.fc-direction-ltr .fc-list-day-text,.fc-direction-rtl .fc-list-day-side-text{float:left}.fc-direction-ltr .fc-list-day-side-text,.fc-direction-rtl .fc-list-day-text{float:right}.fc-direction-ltr .fc-list-table .fc-list-event-graphic{padding-right:0}.fc-direction-rtl .fc-list-table .fc-list-event-graphic{padding-left:0}.fc .fc-list-event.fc-event-forced-url{cursor:pointer}.fc .fc-list-event:hover td{background-color:var(--fc-list-event-hover-bg-color)}.fc .fc-list-event-graphic,.fc .fc-list-event-time{white-space:nowrap;width:1px}.fc .fc-list-event-dot{border:calc(var(--fc-list-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-list-event-dot-width)/2);box-sizing:content-box;display:inline-block;height:0;width:0}.fc .fc-list-event-title a{color:inherit;text-decoration:none}.fc .fc-list-event.fc-event-forced-url:hover a{text-decoration:underline}';Lt(ws);const $s={listDayFormat:Te,listDaySideFormat:Te,noEventsClassNames:oe,noEventsContent:oe,noEventsDidMount:oe,noEventsWillUnmount:oe};function Te(l){return l===!1?null:Me(l)}var Ds=Qt({name:"@fullcalendar/list",optionRefiners:$s,views:{list:{component:bs,buttonTextKey:"list",listDayFormat:{month:"long",day:"numeric",year:"numeric"}},listDay:{type:"list",duration:{days:1},listDayFormat:{weekday:"long"}},listWeek:{type:"list",duration:{weeks:1},listDayFormat:{weekday:"long"},listDaySideFormat:{month:"long",day:"numeric",year:"numeric"}},listMonth:{type:"list",duration:{month:1},listDaySideFormat:{weekday:"long"}},listYear:{type:"list",duration:{year:1},listDaySideFormat:{weekday:"long"}}}});const xs=Ne(()=>{const l=rs();return O(()=>l.value?.canSeeAbsences??null)});function Is(l){const e=I(!1);return[e,a=>O(()=>(e.value||(e.value=!0),a()))]}const Cs=Ne(()=>{const l=Fe(),e=de([]),[s,a]=Is();return Y([()=>l.value?.id,s],async([u,f])=>{if(!u){e.value=[];return}if(!f)return;const i=await it.service("users").find({query:{supervisorId:u,$limit:-1,$select:["id"]}}),c=Array.isArray(i)?i:i.data;e.value=c.map(v=>v.id)}),a(()=>e.value)}),ks={class:"flex flex-wrap gap-2 mb-2"},Ss=T("div",{class:"flex-grow"},null,-1),Vs={class:"fc-event-inner"},Es={class:"fc-event-title"},Ts=ee({__name:"AbsenceCalendar",props:{forceRerender:{type:Boolean,default:!1}},emits:["update:force-rerender"],setup(l,{emit:e}){const s=l,a=e,d=Fe(),u=Re(),{t:f}=Oe(),{can:i}=yt(),c=xs(),v=I(!0),b=I(!0),h=I(!0),D=I(c.value===null||c.value==="supervisor");Y(c,n=>{D.value=n===null||n==="supervisor"});const S=I(new Date),w=I(null),M=I(null),P=We(),y=Ue().createScope(),_=dt().createScope(),B=Cs(),{users:te}=P.useUsersForAssignmentEventTypes({eventTypeIds:O(()=>M.value?.id?[M.value.id]:[])});Y(()=>s.forceRerender,async n=>{n&&(await Dt(),ye(),a("update:force-rerender",!1))},{immediate:!0});const se=async n=>{try{Ie.start();const t=y.findInStore({query:{uuid:n.event.id}}).at(0);t&&(t.startsAt=n.event.start,t.endsAt=n.event.end?new Date(n.event.end?.getTime()-1):n.event.start,await y.save(t))}catch(t){console.error(t)}finally{Ie.done()}},U=de(null),p=ut(pe.ViewUserAbsences,n=>({view:n.literal(["dayGridMonth","dayGridWeek","listWeek"],{default:"dayGridMonth",restore:!0})})),x=O({get(){return p.view},set(n){p.view=n}}),{ref:Ze,options:Ke,render:ye}=Jt({plugins:[Ut,Xt,Ds],headerToolbar:!1,selectable:!0,select:n=>{ge(n.start,new Date(n.end.getTime()-1))},selectMirror:!0,eventResize:se,eventDrop:se,eventClick:n=>{const{absence:t}=n.event.extendedProps;st(t)},views:{dayGridMonth:{dayMaxEventRows:10}},events:O(()=>{if(tt.value||Je.value||!U.value)return[];const n=[];return et.value.forEach((t,V)=>{const{id:N,uuid:q,startsAt:z,endsAt:ne,type:j,status:G,userId:A,user:le,compensationDeclinedAt:at,declinedAt:nt}=t;if(!z||!ne||!N||!le||!j)return;const re=A===d.value?.id,be=re||t.compensatedById===d.value?.id,lt={draft:"💭",approved:"✅",idle:"🆕",declined:"❌"},me=[];re||(me.push("absence-event-entry-compensation-request"),at&&me.push("absence-event-entry-compensation-declined"));let E=new os(ns(t));const K=E.getBrightness();K>70&&K<127?E=E.darken(10):K<180&&K>127&&(E=E.lighten(10));const he=K/255*2-1,_e=E.isLight()?E.darken(5+he*5):E.lighten(5+Math.abs(5*he)),Q={},Ae=x.value==="listWeek",we=ls(t);Ae||(Q["text-shadow"]=`1px 1px 2px ${we==="#000000"?"#FFFFFF":"#000000"}55`);const rt={status:G,absence:t,style:Q,isParticipating:be};(nt||["draft","idle"].includes(G))&&(Q.opacity=.5),Ae||(re?Q.background=E.toHexString():Q.background=`repeating-linear-gradient( -45deg, ${E}, ${E} 15px, ${_e} 15px, ${_e} 30px) !important`);let X="";if(!le||!j)X="";else if(t.compensatedById===d.value?.id)X=`❗️ ${f("userAbsence.calendar.compensationFor")}: ${Ee(le)??""}`;else if(re){const ot=lt[G]||"";let De="";t.status!=="approved"&&(De=`${f(`userAbsence.calendar.${G}`)}:`),X=`${ot} ${De} ${j.name}`}else X=`${Ee(le)}: ${j.name}`;let $e="transparent";be&&($e=E.isLight()?E.darken(40).toHexString():E.lighten(40).toHexString()),n.push({id:q,start:z,end:new Date(ne.getTime()+1),backgroundColor:"transparent",textColor:we,title:X,allDay:!0,classNames:[`absence-event-entry-${G}`,"cursor-pointer",...me],editable:i("update",t,"startsAt"),extendedProps:rt,eventInteractive:!0,borderColor:$e})}),Xe.value.forEach(t=>{!t.startsAt||!t.endsAt||n.push({id:t.uuid,start:t.startsAt,end:new Date(t.endsAt.getTime()+1),extendedProps:{holiday:t},backgroundColor:ct,textColor:mt,borderColor:"transparent",allDay:!0,editable:!1,title:t.name})}),n})},{dateRange:U,calendarDate:S,currentView:x}),Qe=O(()=>x.value==="dayGridMonth"?"month":x.value==="listWeek"||x.value==="dayGridWeek"?"week":"month"),{data:Xe,isPending:Je}=_.useFind({params:O(()=>{if(!U.value)return null;const{startsAt:n,endsAt:t}=U.value;return!u.value||!n||!t?null:{query:{companyId:u.value,startsAt:{$lt:t},endsAt:{$gt:n},$limit:-1}}})}),ae=je(["office","admin","superadmin"]),{data:et,isPending:tt}=y.useFind({params:O(()=>{if(!U.value)return null;const n=d.value?.id;if(!n)return null;const t={query:{startsAt:{$lt:U.value.endsAt},endsAt:{$gte:U.value.startsAt},companyId:u.value,...w.value?{typeId:w.value.id}:{},$limit:-1,$sort:{startsAt:1}}};let V;if(D.value&&M.value){const N=te.value.map(q=>q.id);V||(V=N)}return D.value&&c.value==="supervisor"&&(V?V=V.filter(N=>B.value.includes(N)&&N!==n):V=B.value),v.value&&(t.query.$or??=[],t.query.$or.push({userId:n})),D.value&&c.value!=="own"&&(t.query.$or??=[],V?t.query.$or.push({userId:{$in:V},...ae.value?{status:{$ne:"draft"}}:{status:"approved"}}):ae.value&&t.query.$or.push({userId:{$ne:n},...ae.value?{status:{$ne:"draft"}}:{status:"approved"}})),b.value&&(t.query.$or??=[],t.query.$or.push({compensatedById:n,status:{$in:["approved","idle"]}})),h.value&&(t.query.$or??=[],t.query.$or.push({needApprovalById:n,status:{$ne:"draft"}})),t.query.$or?.length?t:null}),fetchParams:O(()=>{if(!U.value)return null;const n={query:{startsAt:{$lt:U.value.endsAt},endsAt:{$gte:U.value.startsAt},companyId:u.value,$limit:-1}};return c.value==="supervisor"?(n.query.status={$ne:"draft"},n.query.$or=[{"$user.supervisorId$":d.value?.id},{userId:d.value?.id}]):c.value==="own"&&(n.query.userId=d.value?.id),n}),reevaluateAfter:["created","removed"]}),Z=I(null),W=I(!1),ce=I(!1);Y(W,n=>{n||(Z.value=null)});function ge(n,t){d.value?.id&&(Z.value=y.construct({companyId:u.value,startsAt:n,endsAt:t,user:d.value,status:"draft"}),W.value=!0,ae.value&&(ce.value=!0))}function st(n){Z.value=n,W.value=!0,ce.value=!1}return gt(()=>{setTimeout(()=>{ye()},700)}),(n,t)=>{const V=ue("font-awesome-icon"),N=He,q=ht,z=_t,ne=At,j=wt,G=$t;return $(),J("div",null,[T("div",ks,[o(ts,{modelValue:r(S),"onUpdate:modelValue":t[0]||(t[0]=A=>k(S)?S.value=A:null),"picker-width":"100px","class-button-today":"hidden md:block",resolution:r(Qe)},null,8,["modelValue","resolution"]),r(c)!=="own"?($(),F(Be,{key:0,modelValue:r(w),"onUpdate:modelValue":t[1]||(t[1]=A=>k(w)?w.value=A:null),clearable:"",class:"max-w-[200px]"},null,8,["modelValue"])):R("",!0),r(c)!=="own"?($(),F(Ge,{key:1,modelValue:r(M),"onUpdate:modelValue":t[2]||(t[2]=A=>k(M)?M.value=A:null),style:{width:"170px"},clearable:""},null,8,["modelValue"])):R("",!0),o(j,{"hide-on-click":!1},{dropdown:m(()=>[o(ne,null,{default:m(()=>[o(z,null,{default:m(()=>[o(q,{modelValue:r(v),"onUpdate:modelValue":t[3]||(t[3]=A=>k(v)?v.value=A:null)},{default:m(()=>[H(C(n.$t("userAbsence.my.absences")),1)]),_:1},8,["modelValue"])]),_:1}),o(z,null,{default:m(()=>[o(q,{modelValue:r(b),"onUpdate:modelValue":t[4]||(t[4]=A=>k(b)?b.value=A:null)},{default:m(()=>[H(C(n.$t("userAbsence.my.compensations")),1)]),_:1},8,["modelValue"])]),_:1}),o(z,null,{default:m(()=>[o(q,{modelValue:r(h),"onUpdate:modelValue":t[5]||(t[5]=A=>k(h)?h.value=A:null)},{default:m(()=>[H(C(n.$t("userAbsence.my.myApprovals")),1)]),_:1},8,["modelValue"])]),_:1}),r(c)===null||r(c)==="supervisor"?($(),F(z,{key:0},{default:m(()=>[o(q,{modelValue:r(D),"onUpdate:modelValue":t[6]||(t[6]=A=>k(D)?D.value=A:null)},{default:m(()=>[H(C(n.$t("userAbsence.my.others")),1)]),_:1},8,["modelValue"])]),_:1})):R("",!0)]),_:1})]),default:m(()=>[o(N,{size:"default",plain:"",type:"primary"},{default:m(()=>[o(V,{icon:"filter"})]),_:1})]),_:1}),Ss,T("div",null,[o(G,null,{default:m(()=>[o(N,{size:"default",type:r(x)==="dayGridMonth"?"primary":void 0,disabled:r(x)==="dayGridMonth",onClick:t[7]||(t[7]=()=>x.value="dayGridMonth")},{default:m(()=>[o(V,{icon:"calendar-alt"})]),_:1},8,["type","disabled"]),o(N,{size:"default",type:r(x)==="dayGridWeek"?"primary":void 0,disabled:r(x)==="dayGridWeek",onClick:t[8]||(t[8]=()=>x.value="dayGridWeek")},{default:m(()=>[o(V,{icon:"calendar-week"})]),_:1},8,["type","disabled"]),o(N,{size:"default",type:r(x)==="listWeek"?"primary":void 0,disabled:r(x)==="listWeek",onClick:t[9]||(t[9]=()=>x.value="listWeek")},{default:m(()=>[o(V,{icon:"clipboard-list"})]),_:1},8,["type","disabled"])]),_:1})]),n.$can("create","user-absences")?($(),F(N,{key:2,type:"primary",size:"default",class:"hidden lg:flex",onClick:t[10]||(t[10]=()=>ge())},{default:m(()=>[H(C(r(f)("userAbsence.absence"))+" ",1),o(V,{icon:"plus",class:"ml-2 text-sm"})]),_:1})):R("",!0)]),o(r(es),{ref_key:"calendarRef",ref:Ze,options:r(Ke),class:"h-full absences-calendar"},{eventContent:m(({event:A})=>[T("div",{class:"fc-event-container rounded-sm",style:bt(A.extendedProps.style)},[T("div",Vs,[T("div",Es,C(A.title),1)])],4)]),_:1},8,["options"]),r(Z)?($(),F(Le,{key:0,modelValue:r(W),"onUpdate:modelValue":t[11]||(t[11]=A=>k(W)?W.value=A:null),absence:r(Z),draftable:"","multi-users":r(ce)},null,8,["modelValue","absence","multi-users"])):R("",!0)])}}}),Ye=ee({__name:"AbsenceStatusIcon",props:{value:{}},setup(l){return(e,s)=>{const a=ue("font-awesome-icon");return e.value?($(),F(a,{key:0,"fixed-width":"",icon:e.value==="approved"?"check":e.value==="declined"?"times":"hourglass-half"},null,8,["icon"])):R("",!0)}}}),Fs=ee({__name:"SelectUserAbsenceStatus",props:{modelValue:{},size:{default:void 0}},emits:["update:modelValue"],setup(l,{emit:e}){const s=l,a=e,{t:d}=Oe(),u=["approved","declined","idle"],f=O({set:i=>{i&&!u.includes(i)||a("update:modelValue",i||null)},get:()=>s.modelValue?d(`userAbsence.controlling.columns.status.${s.modelValue}`):null});return(i,c)=>{const v=kt,b=Ct;return $(),F(b,{modelValue:r(f),"onUpdate:modelValue":c[0]||(c[0]=h=>k(f)?f.value=h:null),placeholder:i.$t("userAbsence.controlling.columns.status.column"),size:i.size,clearable:""},{default:m(()=>[($(),J(It,null,xt(u,h=>o(v,{key:h,value:h},{default:m(()=>[o(Ye,{value:h,class:"text-xs mr-1"},null,8,["value"]),o(ss,{value:h},null,8,["value"])]),_:2},1032,["value"])),64))]),_:1},8,["modelValue","placeholder","size"])}}}),Rs={class:"flex flex-col md:flex-row-reverse mb-2"},Us={key:0,class:"flex justify-end items-start"},Ns={class:"flex-1 grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-2"},Os={class:"flex"},Hs=ee({__name:"ViewAbsenceControlling",setup(l){const e=Re(),s=I(null),a=I(null),d=I(null),u=I(null),f=I(new Date),i=I("$gte");function c(){i.value=i.value==="$gte"?"$lte":"$gte"}const v=Ue().createScope(),b=We(),{users:h}=b.useUsersForAssignmentEventTypes({eventTypeIds:O(()=>u.value?.id?[u.value.id]:[])}),D=O(()=>{const y={query:{companyId:e.value,status:s.value?s.value:{$in:["idle","declined","approved"]},...a.value&&{typeId:a.value.id},$sort:{startsAt:1}},[pt]:!0};if(u.value){const _=h.value.filter(vt).map(B=>B.id);y.query.userId={$in:_}}return d.value?.length&&(y.query.userId={$in:d.value.map(_=>_.id)}),f.value&&(i.value==="$gte"?(y.query.endsAt={$gt:f.value},y.query.$sort={startsAt:1}):(y.query.startsAt={$lte:f.value},y.query.$sort={startsAt:-1})),y}),S=y=>ft(y,"dd.MM.yy"),w=St({showEditDialog:!1,itemToEdit:null});Y(()=>w.showEditDialog,y=>{y||(w.itemToEdit=null)});function M(y){w.itemToEdit=y,w.showEditDialog=!0}function P(){M(v.construct({companyId:e.value,status:"idle"}))}return(y,_)=>{const B=ue("font-awesome-icon"),te=He,se=ue("FontAwesomeIcon"),U=Vt;return $(),J("div",null,[T("div",Rs,[y.$can("create","user-absences")?($(),J("div",Us,[o(te,{type:"primary",plain:"",class:"ml-3 mb-3 add",onClick:_[0]||(_[0]=()=>P())},{default:m(()=>[H(C(y.$t("userAbsence.absence"))+" ",1),o(B,{icon:"plus",class:"ml-2 text-sm"})]),_:1})])):R("",!0),T("div",Ns,[o(is,{modelValue:r(d),"onUpdate:modelValue":_[1]||(_[1]=p=>k(d)?d.value=p:null),multi:!0,"collapse-tags":"",clearable:"",size:"default",placeholder:y.$t("userAbsence.form.absence.user")},null,8,["modelValue","placeholder"]),o(Be,{modelValue:r(a),"onUpdate:modelValue":_[2]||(_[2]=p=>k(a)?a.value=p:null),clearable:""},null,8,["modelValue"]),o(Fs,{modelValue:r(s),"onUpdate:modelValue":_[3]||(_[3]=p=>k(s)?s.value=p:null)},null,8,["modelValue"]),o(Ge,{modelValue:r(u),"onUpdate:modelValue":_[4]||(_[4]=p=>k(u)?u.value=p:null),clearable:""},null,8,["modelValue"]),T("div",Os,[o(te,{class:"!rounded-r-none !border-r-0",onClick:c},{default:m(()=>[o(se,{class:"mr-2 text-sm",icon:r(i)==="$gte"?["fas","redo-alt"]:["fas","undo-alt"]},null,8,["icon"]),H(" "+C(r(i)==="$gte"?y.$t("after"):y.$t("before")),1)]),_:1}),o(U,{modelValue:r(f),"onUpdate:modelValue":_[5]||(_[5]=p=>k(f)?f.value=p:null),type:"date",format:"DD.MM.YYYY",clearable:!1,style:{width:"105px"},class:"[&_.el-input\\_\\_wrapper]:rounded-l-none"},null,8,["modelValue"])])])]),o(ds,{store:r(v),params:r(D),"hide-delete-button":"","hide-create-button":"","hide-edit-footer":""},{editForm:m(p=>[o(as,{absence:p?.item,"user-editable":"",onSave:x=>p.approve(),onDelete:x=>p.close(),onCancel:x=>p.discardItem()},null,8,["absence","onSave","onDelete","onCancel"])]),default:m(()=>[o(L,{title:y.$t("userAbsence.controlling.columns.user"),width:"minmax(200px, 1fr)"},{default:m(({row:p})=>[H(C(p.user&&p.user.fullName),1)]),_:1},8,["title"]),o(L,{title:y.$t("userAbsence.controlling.columns.requestedAt"),width:"110px"},{default:m(({row:p})=>[H(C(p.requestedAt&&S(p.requestedAt)),1)]),_:1},8,["title"]),o(L,{title:y.$t("userAbsence.controlling.columns.startsAt"),width:"92px"},{default:m(({row:p})=>[H(C(p.startsAt&&S(p.startsAt)),1)]),_:1},8,["title"]),o(L,{title:y.$t("userAbsence.controlling.columns.endsAt"),width:"92px"},{default:m(({row:p})=>[H(C(p.endsAt&&S(p.endsAt)),1)]),_:1},8,["title"]),o(L,{title:y.$t("Workday",2),width:"max-content"},{default:m(({row:p})=>[H(C(p.workDays),1)]),_:1},8,["title"]),o(L,{title:y.$t("userAbsence.controlling.columns.type"),width:"110px"},{default:m(({row:p})=>[p.type?($(),F(us,{key:0,"absence-type":p.type},null,8,["absence-type"])):R("",!0)]),_:1},8,["title"]),o(L,{title:y.$t("userAbsence.controlling.columns.status.column"),width:"max-content"},{default:m(({row:p})=>[o(Ye,{value:p.status,class:"text-xs"},null,8,["value"])]),_:1},8,["title"])]),_:1},8,["store","params"]),r(w).itemToEdit?($(),F(Le,{key:0,modelValue:r(w).showEditDialog,"onUpdate:modelValue":_[6]||(_[6]=p=>r(w).showEditDialog=p),absence:r(w).itemToEdit},null,8,["modelValue","absence"])):R("",!0)])}}}),pa=ee({__name:"ViewUserAbsences",setup(l){const e=Ce(()=>xe(()=>import("./ViewUserAbsenceNorms-Ca8uce6X.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))),s=Ce(()=>xe(()=>import("./ViewUserAbsenceAnnualPlanning-Bc3zDZJa.js"),__vite__mapDeps([19,3,4,5,6,20,21,22,23,24,25,26,27,28,29,30,31,11,32,33,10,17,34,14,15,16,18]))),a=de("calendar"),d=je(["craft","spectator"]),u=Et(a,200),f=de(!1);return Y(()=>a.value,i=>{i==="calendar"&&(f.value=!0)}),(i,c)=>{const v=Tt,b=Ft;return $(),J("div",null,[o(Rt),o(b,{modelValue:r(a),"onUpdate:modelValue":c[1]||(c[1]=h=>k(a)?a.value=h:null)},{default:m(()=>[i.$can("view",r(pe).ViewUserAbsences)?($(),F(v,{key:0,lazy:"",name:"calendar"},{label:m(()=>[T("span",null,C(i.$t("calendar.calendar")),1)]),default:m(()=>[o(Ts,{forceRerender:r(f),"onUpdate:forceRerender":c[0]||(c[0]=h=>k(f)?f.value=h:null)},null,8,["forceRerender"])]),_:1})):R("",!0),i.$can("view",r(pe)["ViewUserAbsences.Table"])?($(),F(v,{key:1,lazy:"",name:"table"},{label:m(()=>[T("span",null,C(i.$t("Table")),1)]),default:m(()=>[o(Hs)]),_:1})):R("",!0),o(v,{lazy:"",name:"annualPlanning"},{label:m(()=>[T("span",null,C(i.$t("userAbsence.annualPlanning")),1)]),default:m(()=>[r(u)==="annualPlanning"?($(),F(r(s),{key:0,"tab-is-active":r(a)==="annualPlanning"},null,8,["tab-is-active"])):R("",!0)]),_:1}),r(d)?R("",!0):($(),F(v,{key:2,lazy:"",name:"norms"},{label:m(()=>[T("span",null,C(i.$t("userAbsence.norms")),1)]),default:m(()=>[o(r(e),{"tab-is-active":r(a)==="norms"},null,8,["tab-is-active"])]),_:1}))]),_:1},8,["modelValue"])])}}});export{pa as default};
