import{a as se,o as n,az as r,aA as ye,aB as O,e2 as X,e as V,f as x,eC as Ee,b as me,h as y,g as c,t as v,j as p,c as a,u as fe,Y as C,ah as ne,i as H,s as we,eS as Ne,e1 as ce,fZ as Pe,fr as De,l as _e,f_ as Ge,f$ as We,fs as Oe,g0 as je,eM as ve,aI as $e,U as be,g1 as Re,a0 as Qe,a3 as Ze,W as G,r as Le,ft as Ke,fO as Xe,ez as Ae,eA as Ye,_ as Je,f0 as et,eT as tt,af as Ve}from"./vendor-DP6O45ke.js";import{_ as st}from"./GridTable.vue_vue_type_style_index_0_lang-D3VXJpla.js";import{a8 as pe,ar as at,d as nt,D as ue,as as xe,at as ot,au as rt,z as ke,K as ge,R as Se,av as Fe,b as it,aw as lt,ax as dt,n as ct,ay as ut,az as mt,aA as pt,aB as ft,aC as gt,aD as vt,aE as ht,aF as yt,aG as kt,A as $t,M as It,aH as wt,ai as _t,S as bt,a as Tt,k as xt,aI as St}from"./index-Dsay-W0g.js";import{a as Ct,_ as Pt}from"./ArtesaProfilePicture.vue_vue_type_script_setup_true_lang-NQqm-LCY.js";import{u as ze}from"./upload.store-CU1g3nY9.js";import{e as Dt}from"./assignment-events.helpers-CWYDlrj6.js";import{a as Lt,u as At,_ as Vt}from"./AddressMap.vue_vue_type_script_setup_true_lang-CdLWc4NG.js";import{_ as Ft}from"./AssignmentEventName.vue_vue_type_script_setup_true_lang-DS0TEwVk.js";import{g as Ut,_ as qt}from"./ButtonAddressNavigation.vue_vue_type_script_setup_true_lang-ZW4GNuo6.js";import{u as Et}from"./timeTracking.store-Bco63arA.js";import{u as zt}from"./useIsUserOfRole-CsP1Paeq.js";import{u as Bt}from"./useServiceEventListener-DCg5b4lA.js";const Ht=["href","target"],Mt=se({inheritAttrs:!1,__name:"ConditionalLink",props:{href:{},target:{default:void 0},fallbackTag:{default:void 0},class:{default:void 0},style:{default:void 0}},setup(t){const l=t;return(i,m)=>l.href?(n(),r("a",{key:0,href:l.href,target:l.target,class:O(i.$attrs.class),style:X(i.$attrs.style)},[ye(i.$slots,"default")],14,Ht)):l.fallbackTag?(n(),V(Ee(l.fallbackTag),{key:1,class:O(i.$attrs.class),style:X(i.$attrs.style)},{default:x(()=>[ye(i.$slots,"default")]),_:3},8,["class","style"])):ye(i.$slots,"default",{key:2})}}),Nt={class:"leading-6"},Gt={key:0,class:"mb-2"},Wt={key:0,class:"mb-2"},Ot={key:0,class:"flex gap-2 items-center"},jt={class:"flex-1"},Rt={key:1,class:"flex gap-2 items-center"},Qt={class:"flex-1 leading-tight"},Zt={key:1,class:"flex gap-2 items-center"},Kt={class:"leading-tight"},Xt={key:0,class:"mr-0.5"},Yt={key:1},Jt={key:0,class:"mr-0.5"},es={key:1},ts={class:"mb-2"},ss={key:0,class:"flex items-center gap-2"},as=["href"],ns={key:1,class:"flex items-center gap-2"},os=["href"],rs={key:2,class:"flex items-center gap-2"},is={class:"flex-1"},ls={key:1,class:"mb-2 flex items-center gap-2"},ds=["href"],cs=se({__name:"InfoCustomer",props:{modelValue:{type:Object,default:null}},setup(t){return(l,i)=>{const m=me("font-awesome-icon");return n(),r("div",Nt,[t.modelValue?(n(),r("div",Gt,[t.modelValue.companyName||t.modelValue.fullName?(n(),r("div",Wt,[t.modelValue.companyName?(n(),r("div",Ot,[y(m,{icon:"building","fixed-width":"",class:"flex-none text-slate-500 text-xs"}),c("div",jt,v(t.modelValue.companyName),1)])):p("",!0),t.modelValue.fullName?(n(),r("div",Rt,[y(m,{icon:"user","fixed-width":"",class:"flex-none text-slate-500 text-xs"}),c("div",Qt,v(t.modelValue.fullName),1)])):p("",!0)])):p("",!0),t.modelValue.address?.street||t.modelValue.address?.houseNumber||t.modelValue.address?.zip||t.modelValue.address?.city?(n(),r("div",Zt,[y(m,{icon:"map-marker-alt","fixed-width":"",class:"flex-none text-slate-500 text-xs"}),y(Mt,{href:a(Ut)(t.modelValue.address),target:"_blank",class:"url"},{default:x(()=>[c("div",Kt,[t.modelValue.address.street?(n(),r("span",Xt,v(t.modelValue.address.street),1)):p("",!0),t.modelValue.address.houseNumber?(n(),r("span",Yt,v(t.modelValue.address.houseNumber),1)):p("",!0),c("div",null,[t.modelValue.address.zip?(n(),r("span",Jt,v(t.modelValue.address.zip),1)):p("",!0),t.modelValue.address.city?(n(),r("span",es,v(t.modelValue.address.city),1)):p("",!0)])])]),_:1},8,["href"])])):p("",!0)])):p("",!0),c("div",ts,[t.modelValue?.telephone?(n(),r("div",ss,[y(m,{icon:"phone","fixed-width":"",class:"text-slate-500 text-xs flex-none"}),c("a",{href:`tel:${t.modelValue.telephone}`,target:"_blank",class:"url"},v(t.modelValue.telephone),9,as)])):p("",!0),t.modelValue?.mobile?(n(),r("div",ns,[y(m,{icon:"mobile-alt","fixed-width":"",class:"text-slate-500 text-xs flex-none"}),c("a",{href:`tel:${t.modelValue.mobile}`,target:"_blank",class:"url"},v(t.modelValue.mobile),9,os)])):p("",!0),t.modelValue?.fax?(n(),r("div",rs,[y(m,{icon:"fax","fixed-width":"",class:"text-slate-500 text-xs flex-none"}),c("div",is,v(t.modelValue.fax),1)])):p("",!0)]),t.modelValue?.email?(n(),r("div",ls,[y(m,{icon:"at","fixed-width":"",class:"text-slate-500 text-xs flex-none"}),c("a",{href:`mailto:${t.modelValue.email}`,target:"_blank",class:"url"},v(t.modelValue.email),9,ds)])):p("",!0)])}}}),us={key:0,class:"grid grid-cols-1 gap-3"},ms={key:1,class:"flex items-center"},ps={class:"flex-1 leading-tight"},fs={key:0,class:"mr-0.5"},gs={key:1},vs={key:0,class:"mr-0.5"},hs={key:1},ys={key:2},ks={class:"font-bold"},$s={key:0},Is={key:1},ws=["href"],_s={key:2},bs=["href"],Ts={key:3},xs={class:"font-bold"},Ss={key:0},Cs={key:1},Ps=["href"],Ds={key:2},Ls=["href"],As=se({__name:"CardBuildingProject",props:{assignment:{type:Object,required:!0}},setup(t){const l=t,{t:i}=fe(),m=C(()=>{if(!l.assignment.constructionManager)return!1;const{constructionManager:u}=l.assignment;return u.name&&u.name!=""||u.tel&&u.tel!=""||u.mail&&u.mail!=""}),k=C(()=>{if(!l.assignment.architect)return!1;const{architect:u}=l.assignment;return u.name&&u.name!=""||u.tel&&u.tel!=""||u.mail&&u.mail!=""});return(u,I)=>{const F=me("font-awesome-icon");return t.assignment?(n(),r("div",us,[t.assignment.addressProperty?(n(),V(Lt,{key:0,address:t.assignment.addressProperty,class:"w-full !h-80",readonly:""},null,8,["address"])):p("",!0),t.assignment.addressProperty?.street||t.assignment.addressProperty?.houseNumber||t.assignment.addressProperty?.zip||t.assignment.addressProperty?.city||t.assignment.addressProperty?.latitude&&t.assignment.addressProperty?.longitude?(n(),r("div",ms,[y(F,{icon:"map-marker-alt","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),c("div",ps,[t.assignment.addressProperty.street||t.assignment.addressProperty.houseNumber||t.assignment.addressProperty.zip||t.assignment.addressProperty.city?(n(),r(ne,{key:0},[t.assignment.addressProperty.street?(n(),r("span",fs,v(t.assignment.addressProperty.street),1)):p("",!0),t.assignment.addressProperty.houseNumber?(n(),r("span",gs,v(t.assignment.addressProperty.houseNumber),1)):p("",!0),c("div",null,[t.assignment.addressProperty.zip?(n(),r("span",vs,v(t.assignment.addressProperty.zip),1)):p("",!0),t.assignment.addressProperty.city?(n(),r("span",hs,v(t.assignment.addressProperty.city),1)):p("",!0)])],64)):t.assignment.addressProperty.latitude&&t.assignment.addressProperty.longitude?(n(),r(ne,{key:1},[H(v(t.assignment.addressProperty.latitude)+", "+v(t.assignment.addressProperty.longitude),1)],64)):p("",!0)]),y(qt,{address:t.assignment.addressProperty},null,8,["address"])])):p("",!0),t.assignment.constructionManager&&a(m)?(n(),r("div",ys,[c("div",ks,v(u.$t("assignment.property.constructionManager"))+":",1),t.assignment.constructionManager.name?(n(),r("div",$s,[y(F,{icon:"user","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),H(" "+v(t.assignment.constructionManager.name),1)])):p("",!0),t.assignment.constructionManager.tel?(n(),r("div",Is,[y(F,{icon:"phone","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),c("a",{href:`tel:${t.assignment.constructionManager.tel}`,target:"_blank",class:"url"},v(t.assignment.constructionManager.tel),9,ws)])):p("",!0),t.assignment.constructionManager.mail?(n(),r("div",_s,[y(F,{icon:"at","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),c("a",{href:`mailto:${t.assignment.constructionManager.mail}`,target:"_blank",class:"url"},v(t.assignment.constructionManager.mail),9,bs)])):p("",!0)])):p("",!0),t.assignment.architect&&a(k)?(n(),r("div",Ts,[c("div",xs,v(a(i)("cardBuildProject.architect"))+":",1),t.assignment.architect.name?(n(),r("div",Ss,[y(F,{icon:"user","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),H(" "+v(t.assignment.architect.name),1)])):p("",!0),t.assignment.architect.tel?(n(),r("div",Cs,[y(F,{icon:"phone","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),c("a",{href:`tel:${t.assignment.architect.tel}`,target:"_blank",class:"url"},v(t.assignment.architect.tel),9,Ps)])):p("",!0),t.assignment.architect.mail?(n(),r("div",Ds,[y(F,{icon:"at","fixed-width":"",class:"mr-2 text-gray-500 text-xs"}),c("a",{href:`mailto:${t.assignment.architect.mail}`,target:"_blank",class:"url"},v(t.assignment.architect.mail),9,Ls)])):p("",!0)])):p("",!0)])):p("",!0)}}}),Vs={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Fs=c("path",{fill:"currentColor",d:"m14 2l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm4 18V9h-5V4H6v16zm-5-10v2h-2v5a2 2 0 0 1-2 2a2 2 0 0 1-2-2a2 2 0 0 1 2-2c.4 0 .7.1 1 .3V10z"},null,-1),Us=[Fs];function qs(t,l){return n(),r("svg",Vs,Us)}const Es={name:"mdi-file-music-outline",render:qs},zs={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Bs=c("path",{fill:"currentColor",d:"m14 2l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm4 18V9h-5V4H6v16zm-1-7v6H7l5-5l2 2m-4-5.5A1.5 1.5 0 0 1 8.5 12A1.5 1.5 0 0 1 7 10.5A1.5 1.5 0 0 1 8.5 9a1.5 1.5 0 0 1 1.5 1.5"},null,-1),Hs=[Bs];function Ms(t,l){return n(),r("svg",zs,Hs)}const Ns={name:"mdi-file-image-outline",render:Ms},Gs={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ws=c("path",{fill:"currentColor",d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-9.5 8.5c0 .8-.7 1.5-1.5 1.5H7v2H5.5V9H8c.8 0 1.5.7 1.5 1.5zm5 2c0 .8-.7 1.5-1.5 1.5h-2.5V9H13c.8 0 1.5.7 1.5 1.5zm4-3H17v1h1.5V13H17v2h-1.5V9h3zm-6.5 0h1v3h-1zm-5 0h1v1H7z"},null,-1),Os=[Ws];function js(t,l){return n(),r("svg",Gs,Os)}const Rs={name:"mdi-file-pdf-box",render:js},Qs={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Zs=c("path",{fill:"currentColor",d:"M21.17 3.25q.33 0 .59.25q.24.24.24.58v15.84q0 .34-.24.58q-.26.25-.59.25H7.83q-.33 0-.59-.25q-.24-.24-.24-.58V17H2.83q-.33 0-.59-.24Q2 16.5 2 16.17V7.83q0-.33.24-.59Q2.5 7 2.83 7H7V4.08q0-.34.24-.58q.26-.25.59-.25m-.8 8.09l1.2 3.94H9.6l1.31-6.56H9.53l-.78 3.88l-1.11-3.75H6.5l-1.19 3.77l-.78-3.9H3.09l1.31 6.56h1.37m14.98 4.22V17H8.25v2.5m12.5-3.75v-3.12H12v3.12m8.75-4.37V8.25H12v3.13M20.75 7V4.5H8.25V7Z"},null,-1),Ks=[Zs];function Xs(t,l){return n(),r("svg",Qs,Ks)}const Ys={name:"mdi-microsoft-word",render:Xs},Js={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ea=c("path",{fill:"currentColor",d:"M21.17 3.25q.33 0 .59.25q.24.24.24.58v15.84q0 .34-.24.58q-.26.25-.59.25H7.83q-.33 0-.59-.25q-.24-.24-.24-.58V17H2.83q-.33 0-.59-.24Q2 16.5 2 16.17V7.83q0-.33.24-.59Q2.5 7 2.83 7H7V4.08q0-.34.24-.58q.26-.25.59-.25M7 13.06l1.18 2.22h1.79L8 12.06l1.93-3.17H8.22L7.13 10.9l-.04.06l-.03.07q-.26-.53-.56-1.07q-.25-.53-.53-1.07H4.16l1.89 3.19L4 15.28h1.78m8.1 4.22V17H8.25v2.5m5.63-3.75v-3.12H12v3.12m1.88-4.37V8.25H12v3.13M13.88 7V4.5H8.25V7m12.5 12.5V17h-5.62v2.5m5.62-3.75v-3.12h-5.62v3.12m5.62-4.37V8.25h-5.62v3.13M20.75 7V4.5h-5.62V7Z"},null,-1),ta=[ea];function sa(t,l){return n(),r("svg",Js,ta)}const aa={name:"mdi-microsoft-excel",render:sa},na={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},oa=c("path",{fill:"currentColor",d:"M13.25 3.25q1.21 0 2.33.31q1.12.32 2.09.89q.97.55 1.77 1.36q.79.8 1.36 1.77q.58.97.89 2.09T22 12t-.31 2.33t-.89 2.09q-.57.97-1.36 1.77q-.8.81-1.77 1.36q-.97.58-2.09.89t-2.33.31q-1.07 0-2.1-.25q-1.03-.26-1.95-.74q-.92-.49-1.7-1.18q-.81-.7-1.43-1.58H2.83q-.33 0-.59-.24Q2 16.5 2 16.17V7.83q0-.33.24-.58Q2.5 7 2.83 7h3.24q.62-.88 1.43-1.58q.78-.7 1.7-1.18q.93-.48 1.95-.74q1.03-.25 2.1-.25m.63 1.28v6.84h6.84q-.12-1.37-.69-2.56T18.55 6.7q-.91-.91-2.12-1.48q-1.2-.57-2.55-.69M9.5 10.84q0-.57-.2-.97q-.19-.41-.52-.66q-.33-.26-.78-.37q-.45-.12-1-.12H4.37v6.55h1.54V13h1.03q.48 0 .93-.16q.46-.14.82-.41q.36-.26.58-.67q.23-.4.23-.92m3.75 8.66q.98 0 1.89-.24q.9-.26 1.71-.68q.81-.45 1.48-1.08q.67-.61 1.17-1.37q.5-.77.83-1.66q.31-.89.39-1.85h-8.08V4.53q-1.45.12-2.73.76T7.67 7h3.5q.33 0 .59.25q.24.25.24.58v8.34q0 .33-.24.59q-.26.24-.59.24h-3.5q.53.6 1.17 1.06q.66.44 1.35.78q.72.33 1.49.49q.77.17 1.57.17M6.85 10q.47 0 .76.19q.28.19.28.7q0 .22-.1.36t-.26.25q-.16.07-.35.1q-.18.04-.38.04h-.89V10z"},null,-1),ra=[oa];function ia(t,l){return n(),r("svg",na,ra)}const la={name:"mdi-microsoft-powerpoint",render:ia},da={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ca=c("path",{fill:"currentColor",d:"m14 2l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm4 18V9h-5V4H6v16zm-2-2l-2.5-1.7V18H8v-5h5.5v1.7L16 13z"},null,-1),ua=[ca];function ma(t,l){return n(),r("svg",da,ua)}const pa={name:"mdi-file-video-outline",render:ma},fa={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ga=c("path",{fill:"currentColor",d:"m12.89 3l1.96.4L11.11 21l-1.96-.4zm6.7 9L16 8.41V5.58L22.42 12L16 18.41v-2.83zM1.58 12L8 5.58v2.83L4.41 12L8 15.58v2.83z"},null,-1),va=[ga];function ha(t,l){return n(),r("svg",fa,va)}const ya={name:"mdi-xml",render:ha},ka={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},$a=c("path",{fill:"currentColor",d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zm-8-1l2-4H9v-5h6v5l-2 4z"},null,-1),Ia=[$a];function wa(t,l){return n(),r("svg",ka,Ia)}const _a={name:"mdi-file-delimited-outline",render:wa},ba={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ta=c("path",{fill:"currentColor",d:"M12 17v-2h2v2zm2-4v-2h-2v2zm0-4V7h-2v2zm-4 2h2V9h-2zm0 4h2v-2h-2zM21 5v14c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2m-2 0h-7v2h-2V5H5v14h14z"},null,-1),xa=[Ta];function Sa(t,l){return n(),r("svg",ba,xa)}const Ca={name:"mdi-zip-box-outline",render:Sa},Pa={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Da=c("path",{fill:"currentColor",d:"M15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9zm4 16H5V5h9v5h5m-2 4H7v-2h10m-3 5H7v-2h7"},null,-1),La=[Da];function Aa(t,l){return n(),r("svg",Pa,La)}const Va={name:"mdi-note-text-outline",render:Aa},Fa={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ua=c("path",{fill:"currentColor",d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zm4 18H6V4h7v5h5z"},null,-1),qa=[Ua];function Ea(t,l){return n(),r("svg",Fa,qa)}const za={name:"mdi-file-outline",render:Ea},Te=se({__name:"FileIcon",props:{upload:{type:Object,required:!0}},setup(t){const l=t,i={audio:Es,video:pa,image:Ns,pdf:Rs,word:Ys,powerpoint:la,excel:aa,xml:ya,csv:_a,zip:Ca,text:Va,unknown:za},m=C(()=>l.upload.mimeType?l.upload.mimeType.startsWith("audio/")?"audio":l.upload.mimeType.startsWith("video/")?"video":l.upload.mimeType.startsWith("image/")?"image":l.upload.mimeType.startsWith("application/pdf")?"pdf":["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(l.upload.mimeType)?"word":["application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"].includes(l.upload.mimeType)?"powerpoint":["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.upload.mimeType)?"excel":l.upload.originalName.endsWith(".xml")?"xml":l.upload.originalName.endsWith(".csv")?"csv":["application/zip","application/x-compressed","application/x-zip-compressed","multipart/x-zip","application/x-7z-compressed","application/x-bzip","application/x-bzip2","application/x-gzip"].includes(l.upload.mimeType)?"zip":l.upload.mimeType.startsWith("text/")?"text":"unknown":"unknown"),k=C(()=>i[m.value]);return(u,I)=>(n(),V(Ee(a(k))))}}),Ba=se({inheritAttrs:!1,__name:"RenderPreview",props:{upload:{},fileIconClass:{}},setup(t){const l=t,i=C(()=>l.upload.mimeType.startsWith("image/"));return(m,k)=>a(i)?(n(),V(Ct,{key:0,upload:m.upload,"show-pointer":"",fit:"cover",lazy:!0,loading:"lazy",class:O(m.$attrs.class),style:X(m.$attrs.style)},{error:x(()=>[c("div",{class:O(m.$attrs.class),style:X(m.$attrs.style)},[y(Te,{upload:m.upload,class:O(m.fileIconClass)},null,8,["upload","class"])],6)]),_:1},8,["upload","class","style"])):(n(),r("div",{key:1,class:O(m.$attrs.class),style:X(m.$attrs.style)},[y(Te,{upload:m.upload,class:O(m.fileIconClass)},null,8,["upload","class"])],6))}}),Ue=se({__name:"GetUploadFromFileNode",props:{node:{}},setup(t){const l=t,i=pe().createScope(),m=C(()=>i.localFind(l.node.uploadId));return(k,u)=>a(m)?ye(k.$slots,"default",{key:0,upload:a(m)}):p("",!0)}}),Ha={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ma=c("path",{fill:"currentColor",d:"M10 4H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-8z"},null,-1),Na=[Ma];function Ga(t,l){return n(),r("svg",Ha,Na)}const qe={name:"mdi-folder",render:Ga},Wa={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Oa=c("path",{fill:"currentColor",d:"M9 16v-6H5l7-7l7 7h-4v6zm-4 4v-2h14v2z"},null,-1),ja=[Oa];function Ra(t,l){return n(),r("svg",Wa,ja)}const he={name:"mdi-upload",render:Ra},Qa={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Za=c("path",{fill:"currentColor",d:"M5.5 7A1.5 1.5 0 0 1 4 5.5A1.5 1.5 0 0 1 5.5 4A1.5 1.5 0 0 1 7 5.5A1.5 1.5 0 0 1 5.5 7m15.91 4.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.11 0-2 .89-2 2v7c0 .55.22 1.05.59 1.41l8.99 9c.37.36.87.59 1.42.59s1.05-.23 1.41-.59l7-7c.37-.36.59-.86.59-1.41c0-.56-.23-1.06-.59-1.42"},null,-1),Ka=[Za];function Xa(t,l){return n(),r("svg",Qa,Ka)}const Ya={name:"mdi-tag",render:Xa},Ja={class:"flex justify-between mb-3"},en={class:"flex-1 flex gap-2"},tn=["onClick","onDragover","onDrop"],sn={class:"!hidden md:!flex gap-2"},an={class:"el-dropdown-menu min-w-44"},nn=["title","draggable","onClick","onContextmenu","onDragstart"],on={class:"flex flex-col gap-0.5 align-middle items-center border-2 rounded border-transparent w-full"},rn={class:"w-full text-center flex justify-center items-center gap-1 text-sm tracking-[-0.035em]"},ln={class:"truncate"},dn=["onDragover","onDrop"],cn={class:"w-full aspect-[4/3] bg-white group-hover:shadow transition flex items-center justify-center rounded"},un={class:"relative size-2/5"},mn={class:"flex gap-0.5 items-center justify-center w-full px-1 text-sm tracking-[-0.035em]"},pn={class:"truncate"},fn={class:"font-extralight text-slate-500"},gn={class:"flex flex-col gap-0.5 align-middle items-center h-full w-full border-2 rounded border-transparent"},vn={class:"w-full aspect-[4/3] bg-white group-hover:shadow transition flex items-center justify-center rounded"},hn={class:"truncate w-full text-center px-1 text-sm tracking-[-0.035em]"},yn={key:1},kn=["draggable","onClick","onDragstart","onDragover","onDrop"],$n=["draggable","onClick","onDragstart","onDragover","onDrop"],In={key:0,class:"font-extralight text-slate-500"},wn=["draggable","onClick","onDragstart","onDragover","onDrop"],_n=["draggable","onClick","onDragstart","onDragover","onDrop"],bn=["draggable","onClick","onDragstart","onDragover","onDrop"],Tn={class:"el-dropdown-menu min-w-44"},xn=["onClick"],Sn={class:"el-dropdown-menu__item"},Cn={class:"el-dropdown-menu min-w-44"},Pn=["onClick"],Dn=["onClick"],Ln=["onClick"],An={key:1,class:"el-dropdown-menu__item"},Vn={key:2,class:"el-dropdown-menu__item"},Fn=se({__name:"AssignmentFileGrid",props:{assignmentId:{},fileTreeLoader:{},readonly:{type:Boolean,default:!1}},setup(t){const l=t,i=we("grid"),m=we(null),{t:k}=fe(),u=C(()=>l.fileTreeLoader.selectionId.value?l.fileTreeLoader.findNodeInTreeData(l.fileTreeLoader.selectionId.value,"childrenGrid"):void 0),I=C(()=>u.value?.node?u.value.node.childrenGrid.filter(s=>s.type!=="placeholder"&&s.type!=="file-type"):[]),F=C(()=>l.fileTreeLoader.selectionId.value?l.fileTreeLoader.findNodeInTreeData(l.fileTreeLoader.selectionId.value,"childrenGrid")?.path?.at(-2):void 0),S=pe().createScope();function W(s){if((s.type==="assignment-event"||s.type==="assignment-group"||s.type==="root"||s.type==="upload-category"||s.type==="upload-category-root"||s.type==="all-files-root")&&(l.fileTreeLoader.selectionId.value=s.id),s.type==="file"){const f=u.value?.node.uploads.filter(xe)??[];s.upload&&ot(s.upload,f)}}function Q(s,f){const{upload:E}=s;E&&(f?(E.categoryId=f,E.associatedParentId=l.assignmentId,E.associatedParentServicePath="stairs"):E.category=null,Pe())}const b=new Map;function R(s,f){const E=b.get(s.id);E&&(f.preventDefault(),Pe(),E.show())}function h(s,f){f?b.set(s,f):b.delete(s)}const w=C(()=>u.value?.node.childrenGrid.some(s=>s.type==="placeholder"&&s.case==="empty")??!1);async function $(){if(!u.value)return;const s=await rt({multiple:!0});s&&l.fileTreeLoader.uploadFile(u.value.node,s)}function A(s){s.upload&&oe(s.upload)}function D(s){s.upload&&ie(s.upload)}async function oe(s){const f=await De.prompt(k("files.renameDialog.description",{filename:s.originalName}),k("files.renameDialog.title"),{confirmButtonText:k("files.renameDialog.ok"),cancelButtonText:k("actions.Cancel"),inputValue:s.originalName});f.action==="confirm"&&(s.originalName=f.value)}async function ie(s){await De.confirm(k("files.deleteDialog.description",{filename:s.originalName}),k("files.deleteDialog.title"))==="confirm"&&S.markForRemove(s)}const Y=at(),[U,K]=Ne(),q=nt();return(s,f)=>{const E=_e,J=Ge,d=We,g=me("font-awesome-icon"),z=Oe,j=je;return n(),r("div",{class:"w-full p-1 border-2 rounded border-transparent selection-target",onDragover:f[19]||(f[19]=e=>a(u)?.node&&!s.readonly&&s.fileTreeLoader.onDragOver(a(u).node)(e)),onDrop:f[20]||(f[20]=e=>a(u)?.node&&!s.readonly&&s.fileTreeLoader.onDrop(a(u).node)(e)),onDragleave:f[21]||(f[21]=e=>!s.readonly&&s.fileTreeLoader.onDragLeave(e))},[c("div",Ja,[c("div",en,[a(F)?(n(),V(E,{key:0,onClick:f[0]||(f[0]=e=>W(a(F)))},{default:x(()=>[H("..")]),_:1})):p("",!0),a(u)?.path&&a(u).path.length>1?(n(),V(d,{key:1,separator:"/",class:"flex-1 w-0 overflow-x-auto flex whitespace-nowrap [&_.el-breadcrumb\\_\\_separator]:!mx-1"},{default:x(()=>[(n(!0),r(ne,null,ce(a(u).path.slice(0,-1),e=>(n(),V(J,{key:e.id},{default:x(()=>[c("a",{class:"border-2 rounded border-transparent",onClick:o=>W(e),onDragover:o=>!s.readonly&&s.fileTreeLoader.onDragOver(e)(o),onDrop:o=>!s.readonly&&s.fileTreeLoader.onDrop(e)(o),onDragleave:f[1]||(f[1]=o=>!s.readonly&&s.fileTreeLoader.onDragLeave(o))},v(e.label),41,tn)]),_:2},1024))),128)),y(J,{class:"border-2 rounded border-transparent",onDragover:f[2]||(f[2]=e=>a(u)?.node&&!s.readonly&&s.fileTreeLoader.onDragOver(a(u).node)(e)),onDrop:f[3]||(f[3]=e=>a(u)?.node&&!s.readonly&&s.fileTreeLoader.onDrop(a(u).node)(e)),onDragleave:f[4]||(f[4]=e=>!s.readonly&&s.fileTreeLoader.onDragLeave(e))},{default:x(()=>[H(v(a(u)?.node.label),1)]),_:1})]),_:1})):p("",!0)]),c("div",sn,[s.readonly?p("",!0):(n(),V(E,{key:0,plain:"",type:"primary",onClick:f[5]||(f[5]=e=>$())},{default:x(()=>[y(a(he))]),_:1})),y(z,null,{default:x(()=>[y(E,{plain:"",type:a(i)==="grid"?"primary":"default",onClick:f[6]||(f[6]=e=>i.value="grid")},{default:x(()=>[y(g,{icon:"grip-horizontal",class:"text-xs"})]),_:1},8,["type"]),y(E,{plain:"",type:a(i)==="list"?"primary":"default",onClick:f[7]||(f[7]=e=>i.value="list")},{default:x(()=>[y(g,{icon:"list",class:"text-xs"})]),_:1},8,["type"])]),_:1})]),y(a(ve),{class:"flex md:hidden"},{popper:x(()=>[c("ul",an,[c("li",{class:"el-dropdown-menu__item",style:X(a(i)==="grid"?{color:"var(--el-color-primary)"}:{}),onClick:f[8]||(f[8]=e=>i.value="grid")},[y(g,{icon:"grip-horizontal",class:"mr-3 text-xs"}),H(" "+v(s.$t("Grid")),1)],4),c("li",{class:"el-dropdown-menu__item",style:X(a(i)==="list"?{color:"var(--el-color-primary)"}:{}),onClick:f[9]||(f[9]=e=>i.value="list")},[y(g,{icon:"list",class:"mr-3 text-xs"}),H(" "+v(s.$t("List")),1)],4),s.readonly?p("",!0):(n(),r("li",{key:0,class:"el-dropdown-menu__item",onClick:f[10]||(f[10]=e=>$())},[y(a(he),{class:"mr-2 h-4 w-4"}),H(" "+v(s.$t("uploadFile")),1)]))])]),default:x(()=>[y(E,null,{default:x(()=>[y(g,{icon:"ellipsis-v",class:"text-xs"})]),_:1})]),_:1})]),a(u)&&s.fileTreeLoader&&a(i)==="grid"?(n(),r("div",{key:0,ref_key:"gridRef",ref:m,class:"grid grid-cols-[repeat(auto-fill,minmax(125px,1fr))] gap-1 w-full"},[a(w)&&!s.fileTreeLoader.isUploading.value?(n(),V(j,{key:0,class:"col-span-full row-span-2"},{default:x(()=>[y(E,{type:"primary",onClick:f[11]||(f[11]=e=>$())},{default:x(()=>[y(a(he),{class:"mr-2"}),H(" "+v(s.$t("uploadFile")),1)]),_:1})]),_:1})):p("",!0),(n(!0),r(ne,null,ce(a(I),e=>(n(),r("div",{key:e.id,title:e.label,class:O(["group w-full flex justify-center hover:bg-slate-200 cursor-pointer rounded",{"is-file":e.type==="file"}]),draggable:e.type==="file"?"true":"false",onClick:o=>W(e),onContextmenu:o=>!s.readonly&&R(e,o),onDragstart:o=>!s.readonly&&s.fileTreeLoader.onDragStart(e)(o)},[e.type==="file"?(n(),V(a(ve),{key:0,ref_for:!0,ref:o=>h(e.id,o),triggers:[],class:"h-full w-full"},{popper:x(()=>[y(a(K),{child:e},null,8,["child"])]),default:x(()=>[c("div",on,[e.upload?(n(),V(Ba,{key:0,upload:e.upload,"file-icon-class":"size-1/2",class:"w-full aspect-[4/3] bg-white group-hover:shadow transition flex items-center justify-center rounded"},null,8,["upload"])):p("",!0),c("div",rn,[e.categoryColor?(n(),r("div",{key:0,class:"h-3 w-3 rounded-[50%] min-w-[0.75rem] min-h-[0.75rem]",style:X({"background-color":e.categoryColor})},null,4)):p("",!0),c("p",ln,v(e.label),1)])])]),_:2},1536)):p("",!0),e.type==="assignment-event"||e.type==="assignment-group"||e.type==="upload-category"||e.type==="upload-category-root"||e.type==="all-files-root"?(n(),r("div",{key:1,class:"flex flex-col gap-0.5 align-middle items-center border-2 rounded border-transparent w-full",onDragover:o=>!s.readonly&&s.fileTreeLoader.onDragOver(e)(o),onDrop:o=>!s.readonly&&s.fileTreeLoader.onDrop(e)(o),onDragleave:f[12]||(f[12]=o=>!s.readonly&&s.fileTreeLoader.onDragLeave(o))},[c("div",cn,[c("div",un,[y(a(qe),{class:O(["size-full",[e.uploadsAndChildrenUploads.length?"text-slate-600":"text-slate-400"]])},null,8,["class"]),e.type==="upload-category"?(n(),V(a(Ya),{key:0,class:"absolute bottom-0 right-0 size-3/5",style:X(e.type==="upload-category"?{color:e.color}:{})},null,8,["style"])):p("",!0)])]),c("div",mn,[c("div",pn,v(e.label),1),c("div",fn,v("uploadsAndChildrenUploads"in e&&e.uploadsAndChildrenUploads.length?` (${e.uploadsAndChildrenUploads.length})`:""),1)])],40,dn)):p("",!0)],42,nn))),128)),!s.readonly&&!a(u).node.childrenGrid.some(e=>e.type==="placeholder")&&a(u).node.type!=="upload-category-root"?(n(),r("div",{key:1,class:"group w-full flex justify-center hover:bg-slate-200 transition cursor-pointer rounded",onClick:f[13]||(f[13]=e=>$())},[c("div",gn,[c("div",vn,[y(a(he),{class:"size-1/3 text-slate-500"})]),c("p",hn,[s.fileTreeLoader.isUploading.value?(n(),r(ne,{key:0},[H(v(s.fileTreeLoader.uploadProgress)+" % "+v(s.$t("uploading")),1)],64)):(n(),r(ne,{key:1},[H(v(s.$t("uploadFile")),1)],64))])])])):p("",!0)],512)):a(u)&&s.fileTreeLoader&&a(i)==="list"?(n(),r("div",yn,[y(st,{data:a(I),"key-property":"id"},{default:x(()=>[y(ue,{width:"32px",class:"!p-0 !items-stretch cursor-pointer"},{default:x(({row:e})=>[c("div",{class:O(["flex-1 px-[6px] py-2 flex items-center",{"bg-slate-200":s.fileTreeLoader.dragoverId.value===e.id}]),draggable:e.type==="file"?"true":"false",onClick:()=>W(e),onDragstart:o=>!s.readonly&&s.fileTreeLoader.onDragStart(e)(o),onDragover:o=>!s.readonly&&s.fileTreeLoader.onDragOver(e)(o),onDrop:o=>!s.readonly&&s.fileTreeLoader.onDrop(e)(o),onDragleave:f[14]||(f[14]=o=>!s.readonly&&s.fileTreeLoader.onDragLeave(o))},[e.type==="file"?(n(),V(Te,{key:0,class:"size-5",upload:e.upload},null,8,["upload"])):(n(),V(a(qe),{key:1,class:O(["size-5",[e.uploadsAndChildrenUploads.length?"text-slate-600":"text-slate-400"]]),style:X(e.type==="upload-category"?{color:e.color}:{})},null,8,["class","style"]))],42,kn)]),_:1}),y(ue,{title:s.$t("files.fileName"),class:"!p-0 !items-stretch cursor-pointer",width:"minmax(200px,1fr)"},{default:x(({row:e})=>[e.type==="file"&&e.categoryColor?(n(),r("span",{key:0,class:"h-3 w-3 rounded-[50%] min-w-[0.75rem] min-h-[0.75rem] mr-1.5",style:X({"background-color":e.categoryColor})},null,4)):p("",!0),c("div",{class:O(["flex-1 px-[6px] py-2 flex items-center",{"bg-slate-200":s.fileTreeLoader.dragoverId.value===e.id}]),draggable:e.type==="file"?"true":"false",onClick:()=>W(e),onDragstart:o=>!s.readonly&&s.fileTreeLoader.onDragStart(e)(o),onDragover:o=>!s.readonly&&s.fileTreeLoader.onDragOver(e)(o),onDrop:o=>!s.readonly&&s.fileTreeLoader.onDrop(e)(o),onDragleave:f[15]||(f[15]=o=>!s.readonly&&s.fileTreeLoader.onDragLeave(o))},[c("a",{class:O(["cursor-pointer",{"border-2 rounded border-transparent":e.type!=="file"}])},[H(v(e.label)+" ",1),e.uploadsAndChildrenUploads?.length?(n(),r("span",In,v(` (${e.uploadsAndChildrenUploads.length})`),1)):p("",!0)],2)],42,$n)]),_:1},8,["title"]),a(q).md?(n(),V(ue,{key:0,title:s.$t("Date"),width:"max-content",class:"!p-0 !items-stretch cursor-pointer"},{default:x(({row:e})=>[c("div",{class:O(["flex-1 px-[6px] py-2 flex items-center",{"bg-slate-200":s.fileTreeLoader.dragoverId.value===e.id}]),draggable:e.type==="file"?"true":"false",onClick:()=>W(e),onDragstart:o=>!s.readonly&&s.fileTreeLoader.onDragStart(e)(o),onDragover:o=>!s.readonly&&s.fileTreeLoader.onDragOver(e)(o),onDrop:o=>!s.readonly&&s.fileTreeLoader.onDrop(e)(o),onDragleave:f[16]||(f[16]=o=>!s.readonly&&s.fileTreeLoader.onDragLeave(o))},v(e.type==="file"?e.upload.createdAt&&a(ke)(e.upload.createdAt):void 0),43,wn)]),_:1},8,["title"])):p("",!0),a(q).md?(n(),V(ue,{key:1,title:s.$t("Size"),width:"minmax(75px,max-content)",class:"!p-0 !items-stretch cursor-pointer"},{default:x(({row:e})=>[c("div",{class:O(["flex-1 px-[6px] py-2 flex items-center justify-end",{"bg-slate-200":s.fileTreeLoader.dragoverId.value===e.id}]),draggable:e.type==="file"?"true":"false",onClick:()=>W(e),onDragstart:o=>!s.readonly&&s.fileTreeLoader.onDragStart(e)(o),onDragover:o=>!s.readonly&&s.fileTreeLoader.onDragOver(e)(o),onDrop:o=>!s.readonly&&s.fileTreeLoader.onDrop(e)(o),onDragleave:f[17]||(f[17]=o=>!s.readonly&&s.fileTreeLoader.onDragLeave(o))},v(e.type==="file"?a(Y)(e.upload.fileSize):void 0),43,_n)]),_:1},8,["title"])):p("",!0),y(ue,{width:"max-content","header-class":"text-center",class:"!p-0 !items-stretch cursor-pointer"},{title:x(()=>[y(g,{icon:"user",class:"text-xs"})]),default:x(({row:e})=>[c("div",{class:O(["flex-1 px-[6px] py-2 flex items-center",{"bg-slate-200":s.fileTreeLoader.dragoverId.value===e.id}]),draggable:e.type==="file"?"true":"false",onClick:()=>W(e),onDragstart:o=>!s.readonly&&s.fileTreeLoader.onDragStart(e)(o),onDragover:o=>!s.readonly&&s.fileTreeLoader.onDragOver(e)(o),onDrop:o=>!s.readonly&&s.fileTreeLoader.onDrop(e)(o),onDragleave:f[18]||(f[18]=o=>!s.readonly&&s.fileTreeLoader.onDragLeave(o))},[e.type==="file"&&e.upload.createdBy?(n(),V(Pt,{key:0,user:e.upload.createdBy,size:"small"},null,8,["user"])):p("",!0)],42,bn)]),_:1}),s.readonly?p("",!0):(n(),V(ue,{key:2,width:"min-content",class:"!p-0 !items-stretch cursor-pointer"},{default:x(({row:e})=>[c("div",{class:O(["flex-1 px-[6px] py-2 flex items-center",{"bg-slate-200":s.fileTreeLoader.dragoverId.value===e.id}])},[e.type==="file"?(n(),V(a(ve),{key:0},{popper:x(()=>[y(a(K),{child:e},null,8,["child"])]),default:x(()=>[y(E,{text:"",size:"small"},{default:x(()=>[y(g,{icon:"ellipsis-v",class:"text-xs"})]),_:1})]),_:2},1024)):p("",!0)],2)]),_:1}))]),_:1},8,["data"])])):p("",!0),y(a(U),null,{default:x(({child:e})=>[c("ul",Tn,[c("li",{class:"el-dropdown-menu__item",onClick:o=>A(e)},[y(g,{icon:"pencil-alt",class:"mr-2 text-xs"}),H(" "+v(s.$t("actions.Rename")),1)],8,xn),s.fileTreeLoader.uploadCategories.value.length?(n(),V(a(ve),{key:0,placement:"right-start","instant-move":""},{popper:x(()=>[c("ul",Cn,[c("li",{class:"el-dropdown-menu__item",onClick:o=>Q(e)},[y(g,{icon:"minus",class:"mr-2 text-xs"}),H(" "+v(s.$t("uploadCategories.noCategory")),1)],8,Pn),(n(!0),r(ne,null,ce(s.fileTreeLoader.uploadCategories.value,o=>(n(),r("li",{key:o.uuid,class:"el-dropdown-menu__item",onClick:ae=>Q(e,o.id)},[y(g,{icon:"plus",class:"mr-2 text-xs",style:X(o.color?{color:o.color}:{})},null,8,["style"]),H(" "+v(o.name),1)],8,Dn))),128))])]),default:x(()=>[c("li",Sn,[y(g,{icon:"folder",class:"mr-2 text-xs"}),H(" "+v(s.$t("uploadCategories.changeCategory")),1)])]),_:2},1024)):p("",!0),c("li",{class:"el-dropdown-menu__item",onClick:o=>D(e)},[y(g,{icon:"trash-alt",class:"mr-2 text-xs text-red-600"}),H(" "+v(s.$t("actions.Delete")),1)],8,Ln),a(q).md?p("",!0):(n(),r("li",An,[y(g,{icon:"clock",class:"mr-2 text-xs"}),e.type==="file"?(n(),V(Ue,{key:0,node:e},{default:x(({upload:o})=>[H(v(o.createdAt&&a(ke)(o.createdAt)),1)]),_:2},1032,["node"])):p("",!0)])),a(q).md?p("",!0):(n(),r("li",Vn,[y(g,{icon:"box",class:"mr-2 text-xs"}),e.type==="file"?(n(),V(Ue,{key:0,node:e},{default:x(({upload:o})=>[H(v(a(Y)(o.fileSize)),1)]),_:2},1032,["node"])):p("",!0)]))])]),_:1})],32)}}}),Un=$e(Fn,[["__scopeId","data-v-c673320c"]]),qn=["draggable","onDragover","onDrop","onDragstart"],En={class:"font-extralight text-slate-500"},zn=se({__name:"AssignmentTreeFileBrowser",props:{assignmentId:{},fileTreeLoader:{},readonly:{type:Boolean,default:!0}},setup(t){const l=t,i=we();function m(k){k.type!=="file"&&k.type!=="placeholder"&&(l.fileTreeLoader.selectionId.value=k.id)}return be([()=>l.fileTreeLoader.treeData.value,()=>l.fileTreeLoader.selectionId.value],([k,u])=>{k&&!u&&m(k[0])},{deep:!0,immediate:!0}),be(()=>l.fileTreeLoader.selectionId.value,k=>{if(!k)return;i.value?.setCurrentKey(k);const u=l.fileTreeLoader.findNodeInTreeData(k,"childrenTree");u&&u.path?.length&&i.value&&u.path.forEach(I=>{const F=i.value.getNode(I);F&&i.value.expandNode(F)})},{deep:!0,immediate:!0}),(k,u)=>(n(),V(a(Re),{ref_key:"treeRef",ref:i,data:k.fileTreeLoader.treeData.value,props:{value:"id",label:"label",children:"childrenTree"},height:400,"expand-on-click-node":!0,"default-expanded-keys":["root","upload-category-root"],class:"[&_.el-tree-node.is-current]:bg-slate-100",onNodeClick:u[1]||(u[1]=I=>m(I))},{default:x(({node:{data:I,label:F}})=>[c("div",{class:"flex drop-target w-full",draggable:I.type==="file"?"true":"false",onDragover:S=>!k.readonly&&k.fileTreeLoader.onDragOver(I)(S),onDrop:S=>!k.readonly&&k.fileTreeLoader.onDrop(I)(S),onDragleave:u[0]||(u[0]=S=>!k.readonly&&k.fileTreeLoader.onDragLeave(S)),onDragstart:S=>!k.readonly&&k.fileTreeLoader.onDragStart(I)(S)},[I.type==="upload-category"?(n(),r("span",{key:0,class:"w-2.5 h-2.5 mt-[0.4rem] rounded-full mr-1",style:X({background:I.category.color??void 0})},null,4)):p("",!0),c("span",{class:O({"text-slate-400":I.type==="placeholder","text-sm":I.type==="placeholder"||I.type==="file"})},[H(v(F)+" ",1),c("span",En,v("uploadsAndChildrenUploads"in I&&I.uploadsAndChildrenUploads.length?` (${I.uploadsAndChildrenUploads.length})`:""),1)],2)],40,qn)]),_:1},8,["data"]))}}),Bn=$e(zn,[["__scopeId","data-v-b88e1a31"]]),Hn=Qe("temp-item-upload-connector",()=>{const t=ge().createScope(),l=Se().createScope(),i=pe().createScope(),m=Ze(new Map);function k(h){let w=null,$=null;if("associated"in h){const A=Fe(h.associated);if(A)if(h.associated.id){h.upload.associatedId=h.associated.id,h.upload.associatedServicePath=A;const D=m.get(h.upload.uuid);D&&"associatedId"in D&&(delete D.associatedId,delete D.associatedServicePath,Object.keys(D).length?m.set(h.upload.uuid,D):m.delete(h.upload.uuid))}else w={associatedId:h.associated.uuid,associatedServicePath:A}}if("parent"in h){const A=Fe(h.parent);if(A)if(h.parent.id){h.upload.associatedParentId=h.parent.id,h.upload.associatedParentServicePath=A;const D=m.get(h.upload.uuid);D&&"associatedParentId"in D&&(delete D.associatedParentId,delete D.associatedParentServicePath,Object.keys(D).length?m.set(h.upload.uuid,D):m.delete(h.upload.uuid))}else $={associatedParentId:h.parent.uuid,associatedParentServicePath:A}}if(w||$){const D={...m.get(h.upload.uuid)??{},...w??{},...$??{}};m.set(h.upload.uuid,D)}}function u(h,w){return!(h==="assignment-events"&&t.localFind(w)?.id||h==="assignment-event-groups"&&l.localFind(w)?.id)}function I(h,w){if(h==="assignment-events"){const $=t.localFind(w);if($)return $}if(h==="assignment-event-groups"){const $=l.localFind(w);if($)return $}}const F=C(()=>{for(const[,h]of m.entries())if("associatedId"in h&&!u(h.associatedServicePath,h.associatedId)||"associatedParentId"in h&&!u(h.associatedParentServicePath,h.associatedParentId))return!0;return!1}),S=C(()=>Array.from(m.keys())),W=C(()=>{const h=[];for(const w of m.keys()){const $=i.localFind(w);$&&$.id&&h.push($.id)}return h});function Q(h){const w=[];for(const[$,A]of m.entries())if("associatedId"in A&&A.associatedId===h.associatedId&&A.associatedServicePath===h.associatedServicePath){const D=i.localFind($);D&&w.push(D)}return w}async function b(){const h=new Set;for(const[w,$]of m.entries()){const A=i.localFind(w);if(A){if("associatedId"in $&&!u($.associatedServicePath,$.associatedId)){const D=I($.associatedServicePath,$.associatedId);D&&(A.associatedId=D.id,A.associatedServicePath=$.associatedServicePath,h.add(A))}if("associatedParentId"in $&&!u($.associatedParentServicePath,$.associatedParentId)){const D=I($.associatedParentServicePath,$.associatedParentId);D&&(A.associatedParentId=D.id,A.associatedParentServicePath=$.associatedParentServicePath,h.add(A))}}}await i.save(Array.from(h));for(const w of h){const $=m.get(w.uuid);$&&"associatedId"in $&&!u($.associatedServicePath,$.associatedId)&&(delete $.associatedId,delete $.associatedServicePath,Object.keys($).length?m.set(w.uuid,$):m.delete(w.uuid)),$&&"associatedParentId"in $&&!u($.associatedParentServicePath,$.associatedParentId)&&(delete $.associatedParentId,delete $.associatedParentServicePath,Object.keys($).length?m.set(w.uuid,$):m.delete(w.uuid))}}function R(){m.clear()}return{tempItemMappings:m,postponeSetUploadService:k,postponeTimeHasCome:F,savePostponedUploads:b,reset:R,uploadUuidsWithTempRelations:S,uploadIdsWithTempRelations:W,uploadsFor:Q}}),Mn=t=>{const l=it(),i=ge().createScope(),m=Se().createScope(),k=lt().createScope(),u=pe().createScope(),{data:I}=m.useFind({localOnly:()=>(G(t.local)||t.eventsLocal)??!1,params:C(()=>{const U=G(t.assignmentId);return U?{query:{assignmentId:U,$sort:{order:1},$limit:100}}:null})}),{data:F}=i.useFind({localOnly:()=>(G(t.local)||t.eventsLocal)??!1,params:C(()=>{const U=G(t.assignmentId);return U?{query:{assignmentId:U,$sort:{order:1},$limit:200}}:null})}),S=C(()=>{const U=G(t.assignmentId);return U?{query:{$sort:{createdAt:1},$limit:-1,$or:[{associatedServicePath:"stairs",associatedId:U},{associatedParentServicePath:"stairs",associatedParentId:U}]}}:null}),{data:W,haveLoaded:Q}=k.useFind({params:C(()=>{const U=G(t.companyId);return U?{query:{companyId:U,$sort:{order:1},$limit:100}}:null})}),{data:b,hasChanges:R,save:h,reset:w,haveLoaded:$}=u.useFeathersItems({localOnly:t.local,params:S}),{groupsAndEventsToShow:A}=At({events:C(()=>F.value),groups:C(()=>I.value)}),D=C(()=>{const U=[],K=b.value.filter(q=>q.associatedServicePath==="stairs");return U.push(...K),A.value.forEach(q=>{if(q.isGroup){const{group:s,events:f}=q.element,E=b.value.filter(J=>J.associatedServicePath==="assignment-event-groups"&&J.associatedId===s.id);U.push(...E),f.forEach(J=>{const d=b.value.filter(g=>g.associatedServicePath==="assignment-events"&&g.associatedId===J.id);U.push(...d)})}else{const s=q.element,f=b.value.filter(E=>E.associatedServicePath==="assignment-events"&&E.associatedId===s.id);U.push(...f)}}),U});function oe(U){const K=[];return U.forEach(q=>{if(!xe(q))return;const s=dt(q);if(s){const f=q.description?`${q.description} - Hochgeladen: ${ke(q.createdAt)}`:`Hochgeladen: ${ke(q.createdAt)}`;K.push({title:q.originalName,alt:f,src:s})}}),K}function ie(U,K){const q=K?.sortedByEvent?D.value:b.value;return l.openFile(U,oe(q))}const{serverCount:Y}=u.useCount({fetchParams:C(()=>a(t.count)?S.value:null)});return{events:F,groups:I,groupsAndEventsToShow:A,uploadCategories:W,uploads:b,uploadsSortedByEventOrder:D,openFile:ie,count:Y,hasChanges:R,save:h,reset:w,haveLoaded:$,haveLoadedCategories:Q}},Ie={image:xe,video:ut,audio:mt,pdf:pt,word:ft,excel:gt,email:vt,xml:ht,technicalDrawing:yt,zip:kt};function Nn(t){const l=Se().createScope(),i=ge().createScope(),m=pe().createScope(),k=ct().createScope(),u=Hn(),{t:I}=fe(),F=Le(t.defaultSelection?typeof t.defaultSelection=="string"?t.defaultSelection:R(t.defaultSelection.path,t.defaultSelection.item):null),S=C(()=>G(t.assignmentId)),{uploadCategories:W,uploads:Q,groupsAndEventsToShow:b}=Mn({assignmentId:t.assignmentId,companyId:t.companyId,local:t.local,eventsLocal:t.eventsLocal});function R(d,g){return d==="uploads"?`file-${g.uuid}`:d==="assignment-events"?`event-${g.uuid}`:d==="assignment-event-groups"?`group-${g.uuid}`:d==="upload-categories"?`upload-category-${g.uuid}`:""}const h=C(()=>({image:I("files.imageFile",2),audio:I("files.audioFile",2),video:I("files.videoFile",2),excel:I("files.excelFile",2),pdf:I("files.pdfFile",2),word:I("files.wordFile",2),misc:I("files.miscFile",2),email:I("files.emailFile",2),technicalDrawing:I("files.technicalDrawingFile",2),xml:I("files.xmlFile",2),zip:I("files.zipFile",2)})),w=C(()=>{const d={id:"root",type:"root",children:[],childrenTree:[],childrenGrid:[],label:I("assignment.name"),uploads:[],uploadsAndChildrenUploads:[]},g={image:[],pdf:[],excel:[],word:[],audio:[],video:[],email:[],technicalDrawing:[],xml:[],zip:[],misc:[]},z=_=>{const T={type:"file",id:R("uploads",_),label:_.originalName,uploadId:_.id,upload:_,categoryColor:_.category?.color??void 0};let B="misc";for(const N in Ie){const Z=N;if(Z in Ie&&Ie[Z](_)){B=Z;break}}return B in g&&!g[B].some(N=>N.upload.id===_.id)&&g[B].push(T),T},j=Q.value;function e(_,T,B){_.children.push(...Array.isArray(T)?T:[T]),B?.includes("tree")&&_.childrenTree.push(...Array.isArray(T)?T:[T]),B?.includes("grid")&&_.childrenGrid.push(...Array.isArray(T)?T:[T])}const o={type:"all-files-root",id:"all-files-root",label:I("files.tree.allFiles"),children:[],childrenTree:[],childrenGrid:[],uploads:[],uploadsAndChildrenUploads:[]};e(d,o,["grid"]);const ae=_=>{const T=_.id?j.filter(N=>N.associatedId===_.id&&N.associatedServicePath==="assignment-events"):u.uploadsFor({associatedId:_.uuid,associatedServicePath:"assignment-events"}),B={type:"assignment-event",id:R("assignment-events",_),label:Dt(_),assignmentEventId:_.id,children:[],childrenTree:[],childrenGrid:[],uploads:T,uploadsAndChildrenUploads:T,isTemp:!_.id,assignmentEventUuid:_.uuid};return e(B,T.map(N=>z(N)),["grid"]),B};b.value.forEach(_=>{if(_.isGroup){const{group:T,events:B}=_.element,N=T.id?j.filter(P=>P.associatedId===T.id&&P.associatedServicePath==="assignment-event-groups"):u.uploadsFor({associatedId:T.uuid,associatedServicePath:"assignment-event-groups"}),Z={type:"assignment-group",id:R("assignment-event-groups",T),label:T.type?.name??"",groupId:T.id,children:[],childrenTree:[],childrenGrid:[],isTemp:!T.id,groupUuid:T.uuid,uploads:N,uploadsAndChildrenUploads:N},le=N.map(P=>z(P));e(o,le,["grid"]),e(Z,B.map(P=>{const L=ae(P);return e(o,L.childrenGrid.filter(te=>te.type==="file"),["grid"]),L}),["tree","grid"]),e(Z,le,["grid"]),Z.children.forEach(P=>{"uploadsAndChildrenUploads"in P&&Z.uploadsAndChildrenUploads.push(...P.uploadsAndChildrenUploads)}),d.uploadsAndChildrenUploads.push(...Z.uploadsAndChildrenUploads),o.uploads.push(...Z.uploadsAndChildrenUploads),o.uploadsAndChildrenUploads.push(...Z.uploadsAndChildrenUploads),e(d,Z,["tree","grid"])}else{const T=_.element,B=ae(T),N=B.childrenGrid.filter(Z=>Z.type==="file");e(d,B,["tree","grid"]),e(o,N,["grid"]),d.uploadsAndChildrenUploads.push(...B.uploads),o.uploads.push(...B.uploads),o.uploadsAndChildrenUploads.push(...B.uploads)}});const re={type:"upload-category-root",id:"upload-category-root",label:I("Category",2),children:[],childrenTree:[],childrenGrid:[],uploads:[],uploadsAndChildrenUploads:[]};for(const _ of W.value){const T=Q.value.filter(N=>N.categoryId===_.id),B={type:"upload-category",id:R("upload-categories",_),label:_.name,category:_,categoryId:_.id,children:[],childrenTree:[],childrenGrid:[],color:_.color??void 0,uploads:T,uploadsAndChildrenUploads:T};e(B,T.map(N=>z(N)),["grid"]),e(re,B,["tree","grid"])}W.value.length&&e(d,re,["grid"]),e(d,j.filter(_=>_.associatedId===S.value&&(_.associatedServicePath==="assignments"||_.associatedServicePath==="stairs")).map(_=>{const T=z(_);return d.uploads.push(_),d.uploadsAndChildrenUploads.push(_),o.uploads.push(_),o.uploadsAndChildrenUploads.push(_),e(o,T,["grid"]),T}),["grid"]);const ee=[o,d];W.value.length&&ee.push(re);for(const _ in g){const T=g[_];if(T.length===0)continue;const B={type:"file-type",id:`file-type-${_}`,children:T,childrenGrid:T,childrenTree:[],label:h.value[_],uploads:T.map(N=>N.upload),uploadsAndChildrenUploads:T.map(N=>N.upload)};e(d,B,["grid"]),ee.push(B)}return ee});function $(d,g){if(d==="root"){const j=w.value.find(e=>e.type==="root");return{node:j,path:[j]}}const z=(j,e=[])=>{for(const o of j){if(o.id===d)return{node:o,path:[...e,o]};if(g in o){const ae=z(o[g],[...e,o]);if(ae)return ae}}};return g==="childrenGrid"?z(w.value[1].childrenGrid,[w.value[1]]):z(w.value)}function A(d){return d.dataTransfer?.types.includes("artesa/file")}function D(d){return d.dataTransfer?.types.includes("Files")}const oe=Le();function ie(d){return g=>{d.type==="file"&&g.dataTransfer&&(g.dataTransfer.clearData(),g.dataTransfer.setData("artesa/file",`${d.uploadId}`),g.dataTransfer.dropEffect="copy")}}function Y(d){return g=>{g.dataTransfer&&(!A(g)&&!D(g)||d.type!=="file"&&(A(g)&&d.type==="file-type"||(g.preventDefault(),g.stopPropagation(),g.dataTransfer.dropEffect="copy",g.currentTarget instanceof Element&&(g.currentTarget.classList.add("drop-target-set"),oe.value=d.id))))}}function U(d){d.currentTarget instanceof Element&&(d.currentTarget.classList.remove("drop-target-set"),oe.value=void 0)}function K(d){return g=>{if(!(d.type!=="assignment-group"&&d.type!=="assignment-event"&&d.type!=="all-files-root"&&d.type!=="root"&&d.type!=="upload-category"&&d.type!=="file-type"&&d.type!=="upload-category-root")&&!(!g.dataTransfer||!A(g)&&!D(g))&&!(A(g)&&d.type==="file-type"))if(g.currentTarget instanceof Element&&(g.currentTarget.classList.remove("drop-target-set"),oe.value=void 0),g.preventDefault(),g.stopPropagation(),A(g)){const z=g.dataTransfer.getData("artesa/file"),j=parseInt(z),e=m.localFind(j);if(!e)return;if(d.type==="assignment-event"){const o=i.localFind(d.assignmentEventUuid);o&&(u.postponeSetUploadService({associated:o,upload:e}),e.associatedParentServicePath="stairs",e.associatedParentId=S.value,G(t.permanent)&&m.save(e))}else if(d.type==="assignment-group"){const o=l.localFind(d.groupUuid);o&&(u.postponeSetUploadService({associated:o,upload:e}),e.associatedParentServicePath="stairs",e.associatedParentId=S.value,G(t.permanent)&&m.save(e))}else if(d.type==="root"||d.type==="all-files-root"){const o=k.localFind(S.value);o&&(u.postponeSetUploadService({associated:o,upload:e}),e.associatedParentServicePath="stairs",e.associatedParentId=S.value,G(t.permanent)&&m.save(e))}else if(d.type==="upload-category"){const o=k.localFind(S.value);o&&(u.postponeSetUploadService({parent:o,upload:e}),e.categoryId=d.categoryId,G(t.permanent)&&m.save(e))}}else D(g)&&q(d,Array.from(g.dataTransfer.files))}}async function q(d,g){let z,j,e;d.type==="assignment-event"&&!d.isTemp?(z="assignment-events",j=d.assignmentEventId):d.type==="assignment-group"&&!d.isTemp?(z="assignment-event-groups",j=d.groupId):d.type==="root"||d.type==="all-files-root"||d.type==="file-type"||d.type==="upload-category-root"?(z="stairs",j=S.value):d.type==="upload-category"&&(z="stairs",j=S.value,e=d.categoryId);for(const o of g){const ae={forService:z,forId:j,properties:{categoryId:e,associatedParentServicePath:"stairs",associatedParentId:S.value}},re=await E(o,ae);if(re){if(d.type==="assignment-event"){const ee=i.localFind(d.assignmentEventUuid);ee&&u.postponeSetUploadService({associated:ee,upload:re})}else if(d.type==="assignment-group"){const ee=l.localFind(d.groupUuid);ee&&u.postponeSetUploadService({associated:ee,upload:re})}}}}const{isUploading:s,uploadProgress:f,uploadFile:E}=ze().useUpload(),J=C(()=>Q.value.reduce((g,z)=>(g[z.id]=z,g),{})??{});return{treeData:w,uploads:Q,uploadsById:J,uploadCategories:W,findNodeInTreeData:$,onDragStart:ie,onDragOver:Y,onDragLeave:U,onDrop:K,isUploading:s,uploadProgress:f,uploadFile:q,itemToId:R,selectionId:F,dragoverId:oe}}const Gn={class:"@container flex grow w-full"},Wn=se({__name:"AssignmentFileBrowser",props:{assignmentId:{},companyId:{},readonly:{type:Boolean,default:!1},hideTree:{type:Boolean,default:!1},local:{type:Boolean,default:!1},eventsLocal:{type:Boolean,default:!1},permanent:{type:Boolean,default:!1},defaultSelection:{default:"all-files-root"}},setup(t){const l=t,i=Nn({assignmentId:()=>l.assignmentId,companyId:()=>l.companyId,eventsLocal:l.eventsLocal,local:()=>l.local,permanent:()=>l.permanent,defaultSelection:l.defaultSelection});return(m,k)=>(n(),r("div",Gn,[y(Bn,{"assignment-id":m.assignmentId,readonly:m.readonly,"file-tree-loader":a(i),"hide-tree":m.hideTree,class:"max-w-[250px] w-full hidden @2xl:block"},null,8,["assignment-id","readonly","file-tree-loader","hide-tree"]),y(Un,{"assignment-id":m.assignmentId,readonly:m.readonly,"file-tree-loader":a(i),class:"bg-slate-100"},null,8,["assignment-id","readonly","file-tree-loader"])]))}}),Do=$e(Wn,[["__scopeId","data-v-67ae9d7c"]]),On={key:0,class:"text-sm px-2 py-1 border-yellow-500 border-l-4 border bg-yellow-50 rounded-sm grid grid-cols-1 gap-2"},jn={key:0,class:"break-normal whitespace-pre-line"},Rn={key:1,class:"break-normal whitespace-pre-line"},Qn={key:2,class:"break-normal whitespace-pre-line"},Zn=se({__name:"DoingCommentForEvent",props:{event:{type:Object,required:!0}},setup(t){return(l,i)=>t.event?.note?.trim()||t.event?.group?.note?.trim()||t.event?.assignment?.comment?.trim()?(n(),r("div",On,[t.event.note?.trim()?(n(),r("p",jn,v(t.event.note),1)):p("",!0),t.event.group?.note?.trim()?(n(),r("p",Rn,v(t.event.group.note),1)):p("",!0),t.event.assignment?.comment?.trim()?(n(),r("p",Qn,v(t.event.assignment.comment),1)):p("",!0)])):p("",!0)}}),Kn={key:0,class:"flex"},Xn=["onClick"],Yn=se({__name:"FlowDiagram",props:{assignment:{},currentEvent:{}},emits:["click-event"],setup(t,{emit:l}){const i=t,m=l,k=ge().createScope(),{t:u}=fe(),{data:I}=k.useFind({params:C(()=>i.assignment?{query:{assignmentId:i.assignment.id,confirmedAt:{$ne:null},$sort:{order:1},$limit:100}}:null)});function F(S){S.id!==i.currentEvent.id&&m("click-event",S)}return(S,W)=>{const Q=me("font-awesome-icon");return S.assignment&&a(I).length>1?(n(),r("div",Kn,[(n(!0),r(ne,null,ce(a(I),(b,R)=>(n(),r("div",{key:b.id,class:"flex items-center mb-2"},[y($t,{content:a(u)("tracking.card.goToEvent",{event:b.type?.name}),disabled:!!S.currentEvent.id&&S.currentEvent.id===b.id},{default:x(()=>[c("div",{class:O(["relative rounded border-2 border-success py-2 px-1.5 select-none max-w-[120px]",{"current-event":S.currentEvent.id&&S.currentEvent.id===b.id,"cursor-pointer hover:shadow":S.currentEvent.id&&S.currentEvent.id!==b.id}]),onClick:h=>F(b)},[c("div",{class:O(["bg-success absolute top-0 left-0 bottom-0 transition-all duration-200 ease-in-out",b.completedAt?"w-full":"w-0"])},null,2),c("div",{class:O(["relative text-center truncate",{"text-white":!!b.completedAt,"text-gray-500 hover:text-gray-800":!b.completedAt}])},[y(Ft,{value:b},null,8,["value"])],2)],10,Xn)]),_:2},1032,["content","disabled"]),R<a(I).length-1?(n(),V(Q,{key:0,icon:"long-arrow-alt-right",size:"xs",class:"mx-0.5 opacity-70"})):p("",!0)]))),128))])):p("",!0)}}}),Jn=$e(Yn,[["__scopeId","data-v-6eb1d188"]]),eo={class:"@container/task-tracker"},to={class:"mb-2"},so={class:"text-sm text-gray-500 mb-1"},ao={class:"text-sm"},no={class:"flex flex-col mb-2"},oo={class:"text-sm text-gray-500 mb-1"},ro={class:"flex flex-col gap-2 border-b border-slate-200 pb-2"},io={class:"leading-tight"},lo={key:0,class:"font-normal text-sm"},co={key:0,class:"border-t border-slate-200"},uo={key:0,class:"mt-2 border-b border-slate-200"},mo={class:"text-sm text-gray-500"},po={key:0,class:"flex mb-1 items-center justify-center"},fo={class:"mt-4 w-full"},go={key:0,class:"text-slate-500 mb-2"},vo={key:0,class:"ml-0.5 font-extralight"},ho={key:0},Lo=se({__name:"TaskTracker",props:{event:{},user:{default:void 0},tasks:{},showGoToChat:{type:Boolean,default:!1},local:{type:Boolean,default:!1}},emits:["update:event","remove-task","go-to-chat"],setup(t,{emit:l}){const i=t,m=l,k=Ke(i,"event",m),u=It().createScope(),I=wt().createScope(),F=pe().createScope(),S=_t().createScope(),W=ge().createScope(),Q=bt().createScope(),{t:b}=fe(),R=Tt(),h=Et(),w=C(()=>i.user||R.value),$=Xe(),A=zt(["office","admin","superadmin"]);function D(P){k.value=P}async function oe(P){const L=Y.value.find(te=>te.userId===P.id);L&&await u.remove(L)}async function ie(P){if(P&&!Y.value.some(L=>L.userId===P.id))return await u.create({companyId:i.event.companyId,eventId:i.event.id??void 0,userId:P.id??void 0,order:Y.value.length,assignedById:R.value?.id??void 0})}const{data:Y,isPending:U}=u.useFind({localOnly:i.local,params:C(()=>i.event?{query:{eventId:i.event.id,$sort:{createdAt:1},$limit:-1}}:null)}),{data:K}=I.useFind({params:C(()=>i.event?.typeId?{query:{deactivatedAt:null,eventTypeId:i.event.typeId,$sort:{order:1},$limit:100}}:null)}),{serverCount:q,fetch:s}=F.useCount({params:C(()=>i.event?.id?{query:{associatedServicePath:"assignment-events",associatedId:i.event.id}}:null)});Bt("uploads","created",P=>{P.associatedServicePath==="assignment-events"&&i.event&&P.associatedId===i.event.id&&s()});const f=C(()=>i.event.minUploadCount??0),{workPeriods:E,stopActive:J,hasActiveWorkPeriod:d,activeWorkSince:g,hasPausedWorkPeriod:z}=h.useWorkPeriods({eventId:C(()=>i.event?.id)}),j=C(()=>h.isPaused||h.isUnaccountableActive),{uploads:e}=ze(),o=C(()=>e.filter(P=>P.localMeta?.assignmentEvent===i.event.id&&!P.complete).length);be(o,()=>{s()});const ae=C(()=>f.value?o.value+(q.value??0)>=f.value:!0);function re(){return h.isPaused?(Ve({title:b("tracking.notification.startWorkButInPause.title"),type:"warning",message:b("tracking.notification.startWorkButInPause.message")}),!0):!1}function ee(){return h.isUnaccountableActive?(Ve({title:b("tracking.notification.startWorkButInUnaccountable.title"),type:"warning",message:b("tracking.notification.startWorkButInUnaccountable.message")}),!0):!1}async function _(){re()||ee()||(d.value?J():(await S.create({companyId:i.event.companyId,eventId:i.event.id,start:new Date,eventTypeId:i.event.typeId,assignmentId:i.event.assignmentId,userId:w.value?.id}),ie(w.value)))}const T=C(()=>{const P={};return K.value.forEach(L=>{P[L.id]=E.value.some(te=>te.typeId==L.id&&te.end==null)}),P});async function B(P){if(re()||ee())return;const L=E.value.some(de=>de.typeId===P.id);if(await J(),L)return;await h.stopUnaccountable(),await h.stopPausedWorkPeriods(),await h.startWorkPeriod({assignmentId:i.event.assignmentId,eventId:i.event.id,eventTypeId:i.event.typeId,typeId:P.id})&&ie(w.value)}function N(){i.event.completedAt=i.event.completedAt?null:new Date,W.save(i.event)}async function Z(){if(!i.event.company||!w.value||!i.event.assignment)return;const P={order:i.tasks.length+1},L=Q.construct(P);L.event=i.event,L.assignment=i.event.assignment,L.company=i.event.company,L.createdBy=w.value,await Je(),$.value.at(-1)?.focus()}function le(P){return L=>(L.target&&"blur"in L.target&&typeof L.target.blur=="function"&&L.target.blur(),P())}return(P,L)=>{const te=me("font-awesome-icon"),de=_e,Be=me("FontAwesomeIcon"),He=_e,Me=et;return n(),r("div",eo,[a(k).assignment?(n(),V(Jn,{key:0,assignment:a(k).assignment,"current-event":a(k),class:"overflow-x-auto p-2 w-full",onClickEvent:L[0]||(L[0]=M=>D(M))},null,8,["assignment","current-event"])):p("",!0),y(Zn,{event:a(k),class:"mb-2 mx-0.5"},null,8,["event"]),c("div",to,[c("div",so,v(a(b)("tracking.card.assignedUsers"))+":",1),(n(!0),r(ne,null,ce(a(Y),M=>(n(),r("div",{key:M.uuid,class:"ml-2 flex items-center"},[c("div",ao,v(M.user?.fullName),1),M.user&&M.user.id===a(w)?.id?(n(),V(de,{key:0,plain:"",size:"small",class:"ml-1",onClick:()=>oe(M.user)},{default:x(()=>[y(te,{icon:"times",class:"text-red-500"})]),_:2},1032,["onClick"])):p("",!0)]))),128)),a(w)&&a(Y).every(M=>M.userId!==a(w)?.id)?(n(),V(de,{key:0,class:"mt-2",onClick:L[1]||(L[1]=()=>ie(a(w)))},{default:x(()=>[H(v(a(w)?.id===a(R)?.id?a(b)("tracking.card.assignToMe"):a(b)("tracking.card.assignToUser",{user:a(w)?.shortName||a(w)?.fullName||""})),1)]),_:1})):p("",!0)]),c("div",{class:O(["grid gap-2",[a(k).type?.hideInfoInDoing?"":"grid-cols-1 @2xl/task-tracker:grid-cols-2"]])},[c("div",no,[c("span",oo,v(a(b)("TimeTracking"))+":",1),Ae((n(),r("div",ro,[y(de,{type:a(d)||a(z)?"primary":"",disabled:a(j),class:"!h-12",onClick:L[2]||(L[2]=M=>le(_)(M))},{default:x(()=>[y(Be,{icon:a(d)?"stop-circle":a(z)?"hourglass-half":"play-circle",class:"mr-2"},null,8,["icon"]),c("div",io,[H(v(a(d)?a(b)("tracking.time.stop"):a(b)("tracking.time.start"))+" ",1),a(d)||a(z)?(n(),r("div",lo,v(a(d)?a(b)("tracking.time.checkedInSince",{since:a(g)}):a(z)?a(b)("tracking.time.inPauseSince",{since:a(h).inPauseSince}):""),1)):p("",!0)])]),_:1},8,["type","disabled"]),a(K).length?(n(),r("div",co)):p("",!0),(n(!0),r(ne,null,ce(a(K),M=>(n(),V(de,{key:M.id,type:M.id&&a(T)[M.id]?"primary":void 0,disabled:a(j),onClick:Ce=>le(()=>B(M))(Ce)},{default:x(()=>[H(v(M.name),1)]),_:2},1032,["type","disabled","onClick"]))),128))])),[[Me,a(U)]]),P.tasks.length||a(A)?(n(),r("div",uo,[c("div",mo,v(a(b)("assignmentEvent.task",2))+":",1),(n(!0),r(ne,null,ce(P.tasks,M=>(n(),V(Vt,{ref_for:!0,ref:a($).set,key:M.uuid,task:M,checklist:"",onRemove:Ce=>P.$emit("remove-task",M),onEnter:Z},null,8,["task","onRemove"]))),128)),a(A)?(n(),r("div",po,[y(He,{text:"",icon:a(tt),onClick:Z},{default:x(()=>[H(v(a(b)("assignmentEvent.addTask")),1)]),_:1},8,["icon"])])):p("",!0)])):p("",!0),c("div",fo,[a(ae)?p("",!0):(n(),r("div",go,[H(v(a(b)("tracking.card.youHaveToUploadXFilesYet",{count:a(f)-(a(q)??0)}))+" ",1),P.showGoToChat?(n(),r("span",{key:0,class:"underline text-primary ml-1 cursor-pointer",onClick:L[3]||(L[3]=()=>m("go-to-chat"))},[H(v(a(b)("tracking.card.goToChat"))+" ",1),y(te,{icon:"arrow-right"})])):p("",!0)])),y(de,{disabled:!a(ae),type:a(k).completedAt?"":"primary",class:"w-full",onClick:L[4]||(L[4]=M=>le(N)(M))},{default:x(()=>[Ae(y(te,{icon:"check",class:"mr-2"},null,512),[[Ye,!!a(k).completedAt]]),c("span",null,v(a(k).completedAt?a(b)("tracking.card.eventCompleted"):a(b)("tracking.card.completeEvent")),1),a(f)?(n(),r("span",vo," ("+v((a(q)??0)+a(o))+"/"+v(a(f))+") ",1)):p("",!0)]),_:1},8,["disabled","type"])])]),!a(k).type?.hideInfoInDoing&&a(k).assignment?(n(),r("div",ho,[y(As,{class:"mb-2",assignment:a(k).assignment},null,8,["assignment"]),a(k).assignment.customer?(n(),V(cs,{key:0,modelValue:a(k).assignment.customer,"onUpdate:modelValue":L[5]||(L[5]=M=>a(k).assignment.customer=M)},null,8,["modelValue"])):p("",!0)])):p("",!0)],2)])}}});function Ao(t){const l=xt().createScope(),i=St().createScope(),{companyId:m,associatedId:k,associatedServicePath:u,associatedParentId:I,associatedParentServicePath:F,formType:S}=t,{serverCount:W}=l.useCount({fetchParams:C(()=>({query:{defaultedAt:{$ne:null},publishedAt:{$ne:null},deactivatedAt:null,companyId:G(m),...G(S)!==void 0?{type:{$contains:G(S)}}:{}}}))}),{data:Q,hasChanges:b,save:R,reset:h}=i.useFeathersItems({params:C(()=>({query:{...G(u)!==void 0?{associatedServicePath:G(u)}:{},...G(k)!==void 0?{associatedId:G(k)}:{},...G(F)!==void 0?{associatedParentServicePath:G(F)}:{},...G(I)!==void 0?{associatedParentId:G(I)}:{},companyId:G(m)}}))}),w=C(()=>(W.value??0)>0),$=C(()=>Q.value.length>0);return{hasTemplates:w,hasForms:$,customForms:Q,hasChanges:b,save:R,reset:h}}export{Do as A,As as _,cs as a,Ao as b,Lo as c,Hn as u};
