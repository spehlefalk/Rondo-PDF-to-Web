const __vite__fileDeps=["assets/StandardProcessesSettings-DYhqwnKI.js","assets/DropdownAssignmentEventGroupType.vue_vue_type_script_setup_true_lang-BNpFLTY8.js","assets/vendor-DP6O45ke.js","assets/vendor-Bi5_IIMz.css","assets/index-Dsay-W0g.js","assets/index-DNLwZrWR.css","assets/hasItemsForCompany.store-B-Xh4q3W.js","assets/MakeSortable.vue_vue_type_script_setup_true_lang-7zyUd0na.js","assets/ArtesaTimeInput.vue_vue_type_style_index_0_lang-LvzB_Px3.js","assets/index-wVhGhdDy.js","assets/ArtesaTimeInput-CqnzHY5J.css","assets/DropdownAssignmentEventType.vue_vue_type_script_setup_true_lang-C9gQHB2j.js","assets/FeathersTablePagination.vue_vue_type_style_index_0_lang-BOkRBl1g.js","assets/GridTable.vue_vue_type_style_index_0_lang-D3VXJpla.js","assets/GridTable-MfZ2HMOu.css","assets/usePagination-Ryv7wWJy.js","assets/FeathersTablePagination-BvXyPM5N.css","assets/StandardProcessesSettings-DrIpReWV.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{a as W,u as ae,Y as k,b as z,o as d,az as D,g as v,h as t,f as a,c as e,k as K,t as T,e as P,j as N,i as H,fP as je,f3 as _e,l as ne,fM as nt,ft as Ge,e1 as te,ah as J,e5 as be,bc as Et,e7 as he,fv as Mt,fw as Be,r as R,s as ee,ez as Z,eA as oe,eX as Pt,_ as Te,en as re,g9 as ke,fG as Ue,fH as De,f0 as qt,aO as Ft,ff as ot,w as Le,eo as Se,ep as $e,U as ge,fE as lt,e3 as We,aL as Ot,fF as st,aK as we,$ as Nt,aN as Rt,fs as jt,aB as ve,fr as rt,fu as Gt,a$ as Bt,m as Lt,e2 as Wt,af as Ce,em as Ht,a3 as He,ga as it,fQ as ut,eN as zt,W as dt,eD as Kt,fc as Jt,fb as Yt,M as ct,f9 as Qt,f7 as Xt,gb as Zt,gc as ea,aA as Ve,fj as Re,gd as ta,fI as aa}from"./vendor-DP6O45ke.js";import{aN as mt,$ as pt,G as Ee,D as B,f as na,I as oa,A as la,a4 as sa,Y as ra,d as ze,Q as ia,aM as Ke,aO as ft,ak as Xe,aP as ua,aQ as da,aR as ca,aS as ma,w as Me,t as Je,aT as pa,F as yt,aU as vt,aV as gt,ad as fa,y as _t,H as ya,B as va,aW as Pe,h as ga,C as Ze,aX as _a,aY as bt,aZ as ba,a_ as ha,aH as ht,a$ as wa,aq as Va,b0 as ka,aw as Sa,b1 as $a,V as wt,N as Ye,b2 as xa,z as Ia}from"./index-Dsay-W0g.js";import{_ as se,f as Aa}from"./ArtesaTimeInput.vue_vue_type_style_index_0_lang-LvzB_Px3.js";import{_ as ie}from"./FeathersTablePagination.vue_vue_type_style_index_0_lang-BOkRBl1g.js";import{p as xe}from"./MakeSortable.vue_vue_type_script_setup_true_lang-7zyUd0na.js";import{u as ce,_ as me}from"./SelectDeactivatedFilter.vue_vue_type_script_setup_true_lang-m7PLGbzy.js";import{_ as Ca}from"./AddressForm.vue_vue_type_script_setup_true_lang-BIeTh7fv.js";import{u as Vt,_ as et,f as Oe}from"./formatRelativeTime-Cyw0CVIL.js";import{_ as kt}from"./SelectRole.vue_vue_type_script_setup_true_lang-DGR_GQDZ.js";import{u as Ta}from"./useIsUserOfRole-CsP1Paeq.js";import{_ as St}from"./ArtesaProfilePicture.vue_vue_type_script_setup_true_lang-NQqm-LCY.js";import{_ as Ua}from"./PopperFeathersItems.vue_vue_type_script_setup_true_lang-Dj8XPvGz.js";import{i as Da}from"./index-DruqRWsa.js";import{t as Ea}from"./index-CsgZOv_I.js";import{u as Ma,F as Pa}from"./useFullcalendar-CLA5ahNS.js";import{a as qa}from"./index-5ygR7EGk.js";import{_ as Fa}from"./ArtesaTimePickerForCalendar.vue_vue_type_style_index_0_lang-Bin9FMqz.js";import{v as Oa}from"./validateFormAsync-7W-wrk_Q.js";import{_ as Ae,a as Na}from"./InputWrapperGroup.vue_vue_type_script_setup_true_lang-3_0w4TEL.js";import{v as Ne}from"./index-DlSjbakU.js";import{_ as $t}from"./GridTable.vue_vue_type_style_index_0_lang-D3VXJpla.js";import{i as Ra}from"./isViewDisabledByCompany-sGEq7KGq.js";const ja={class:"flex flex-wrap mb-1 gap-0.5 items-center"},Ga={class:"flex flex-col items-center bg-white rounded px-2 py-0.5"},Ba={class:"text-gray-400 text-xs relative"},La={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},Wa={class:"text-gray-400 text-xs"},Ha={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},za={class:"text-gray-400 text-xs"},Ka={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},Ja={class:"flex items-center"},Ya={class:"text-gray-400 text-xs"},Qa={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},Xa={class:"text-gray-400 text-xs"},Za={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},en={class:"flex items-center"},tn={class:"text-gray-400 text-xs"},an={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},nn={class:"text-gray-400 text-xs"},on={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},ln={class:"text-gray-400 text-xs"},sn={class:"flex flex-col items-center ml-1 bg-white rounded px-2 py-0.5"},rn={class:"text-gray-400 text-xs"},un=W({__name:"AssignmentEventTypeForm",props:{eventType:{type:Object,required:!0}},setup(s){const b=s,{t:o}=ae(),r=k({get(){return b.eventType.defaultEmployeeCount},set(y){b.eventType.defaultEmployeeCount=y,p()}}),n=k({get(){return b.eventType.defaultWorkDays??0},async set(y){b.eventType.defaultWorkDays=y,p()}}),w=k({get(){return b.eventType.defaultWorkingTimePerDay??0},set(y){b.eventType.defaultWorkingTimePerDay=y,p()}}),l=k({get(){return b.eventType.defaultManPower??0},set(y){b.eventType.defaultManPower=y,f()}}),i=k({get(){return(b.eventType.defaultManPower??0)/3600},set(y){l.value=y*3600}}),g=k({get(){return b.eventType.defaultDateAnchor!=="endsAt"},set(y){const u=y?"startsAt":"endsAt";b.eventType.defaultDateAnchor=u}});function p(){const y=(n.value||1)*(w.value||0)*(r.value||0);b.eventType.defaultManPower=y}function f(){if(!w.value||!r.value){n.value=1;return}const y=Math.ceil((l.value||0)/w.value/r.value);n.value=Math.max(y,1)}return(y,u)=>{const _=je,A=z("font-awesome-icon"),V=z("ArtesaTooltip"),c=_e,m=ne;return d(),D("div",null,[v("div",ja,[t(V,{content:e(o)("assignment-event-types.form.employeeCountDescription")},{default:a(()=>[v("div",Ga,[t(_,{modelValue:e(r),"onUpdate:modelValue":u[0]||(u[0]=h=>K(r)?r.value=h:null),min:0,style:{width:"40px"},"value-on-clear":0,controls:!1,class:"inline-edit"},null,8,["modelValue"]),v("div",Ba,[t(A,{icon:e(r)<=0?"user-slash":e(r)===1?"user":"users"},null,8,["icon"])])])]),_:1},8,["content"]),t(V,{content:e(o)("assignment-event-types.form.workDaysDescription",{days:e(n)},e(n))},{default:a(()=>[v("div",La,[t(_,{modelValue:e(n),"onUpdate:modelValue":u[1]||(u[1]=h=>K(n)?n.value=h:null),min:1,style:{width:"38px"},"value-on-clear":1,controls:!1,class:"inline-edit"},null,8,["modelValue"]),v("div",Wa,T(e(o)("Day",e(n))),1)])]),_:1},8,["content"]),t(V,{content:e(o)("assignment-event-types.form.workingTimePerDayDescription",e(n))},{default:a(()=>[v("div",Ha,[t(se,{modelValue:e(w),"onUpdate:modelValue":u[2]||(u[2]=h=>K(w)?w.value=h:null),"value-type":"number",class:"inline-edit !w-12"},null,8,["modelValue"]),v("div",za,T(e(o)("assignment-event-types.form.workingTimePerDay",e(n))),1)])]),_:1},8,["content"]),t(V,{content:e(o)(s.eventType.defaultIsAllDay?"assignment-event-types.form.isAllDayTrueDescription":"assignment-event-types.form.isAllDayFalseDescription")},{default:a(()=>[v("div",Ka,[v("div",Ja,[t(c,{"model-value":!s.eventType.defaultIsAllDay,"onUpdate:modelValue":u[3]||(u[3]=h=>s.eventType.defaultIsAllDay=!h)},null,8,["model-value"]),s.eventType.defaultIsAllDay?N("",!0):(d(),P(se,{key:0,modelValue:s.eventType.defaultStartsAtTime,"onUpdate:modelValue":u[4]||(u[4]=h=>s.eventType.defaultStartsAtTime=h),"value-type":"time",class:"ml-1"},null,8,["modelValue"]))]),v("div",Ya,T(s.eventType.defaultIsAllDay?e(o)("assignment-event-types.form.time"):e(o)("assignment-event-types.form.defaultTime")),1)])]),_:1},8,["content"]),t(V,{content:e(o)("assignment-event-types.form.manPowerDescription")},{default:a(()=>[v("div",Qa,[t(_,{modelValue:e(i),"onUpdate:modelValue":u[5]||(u[5]=h=>K(i)?i.value=h:null),precision:2,step:1*(s.eventType.defaultEmployeeCount||1),min:0,"value-on-clear":0,controls:!1,style:{width:"70px"},class:"inline-edit"},null,8,["modelValue","step"]),v("div",Xa,T(e(o)("assignment-event-types.form.effort")),1)])]),_:1},8,["content"]),t(V,{content:e(o)(s.eventType.defaultIsOutward?"assignment-event-types.form.isOutwardTrueDescription":"assignment-event-types.form.isOutwardFalseDescription")},{default:a(()=>[v("div",Za,[v("div",en,[t(c,{"model-value":!!s.eventType.defaultIsOutward,"onUpdate:modelValue":u[6]||(u[6]=h=>s.eventType.defaultIsOutward=!!h)},null,8,["model-value"]),s.eventType.defaultIsOutward?(d(),P(se,{key:0,modelValue:s.eventType.defaultDurationDrive,"onUpdate:modelValue":u[7]||(u[7]=h=>s.eventType.defaultDurationDrive=h),"value-type":"number",class:"ml-1"},null,8,["modelValue"])):N("",!0)]),v("div",tn,[t(A,{icon:"truck"})])])]),_:1},8,["content"]),t(V,{content:e(o)("assignment-event-types.form.minUploadCountDescription",{count:s.eventType.defaultMinUploadCount},s.eventType.defaultMinUploadCount??0)},{default:a(()=>[v("div",an,[t(_,{modelValue:s.eventType.defaultMinUploadCount,"onUpdate:modelValue":u[8]||(u[8]=h=>s.eventType.defaultMinUploadCount=h),min:0,"value-on-clear":0,controls:!1,style:{width:"70px"},class:"inline-edit"},null,8,["modelValue"]),v("div",nn,T(e(o)("assignment-event-types.form.requiredDocumentation")),1)])]),_:1},8,["content"]),t(V,{content:e(o)(e(g)?"assignment-event-types.form.isSchedulingForwardDescription":"assignment-event-types.form.isSchedulingBackwardsDescription")},{default:a(()=>[v("div",on,[t(m,{size:"small",class:"my-1",onClick:u[9]||(u[9]=h=>g.value=!e(g))},{default:a(()=>[H(T(e(g)?y.$t("Forwards"):y.$t("Backwards")),1)]),_:1}),v("div",ln,T(e(o)("assignment-event-types.form.scheduling")),1)])]),_:1},8,["content"]),t(V,{content:e(o)("assignment-event-types.form.hideInfoInDoingDescription")},{default:a(()=>[v("div",sn,[t(c,{"model-value":!s.eventType.hideInfoInDoing,"onUpdate:modelValue":u[10]||(u[10]=h=>s.eventType.hideInfoInDoing=!h)},null,8,["model-value"]),v("div",rn,T(e(o)("assignment-event-types.form.showInfoInDoing")),1)])]),_:1},8,["content"])])])}}}),dn={class:"flex justify-center items-center text-gray-700"},cn=W({__name:"SelectFontAwesomeIcon",props:{modelValue:{type:String,default:null},size:nt,disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:b}){const n=Ge(s,"modelValue",b),w=k(()=>{const i=Et?.definitions?.fas;return i?Object.keys(i):[]});function l(){n.value=null}return(i,g)=>{const p=z("font-awesome-icon"),f=he,y=be;return d(),P(y,{modelValue:e(n),"onUpdate:modelValue":g[0]||(g[0]=u=>K(n)?n.value=u:null),clearable:"",class:"select-icon",placeholder:" ",size:s.size,disabled:s.disabled,style:{width:"72px"},onClear:l},{prefix:a(()=>[v("div",dn,[e(n)?(d(),P(p,{key:0,icon:e(n),"fixed-width":""},null,8,["icon"])):N("",!0)])]),default:a(()=>[(d(!0),D(J,null,te(e(w),u=>(d(),P(f,{key:u,value:u,label:" "},{default:a(()=>[t(p,{icon:u,"fixed-width":""},null,8,["icon"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","size","disabled"])}}}),mn=W({__name:"SelectAssignmentEventGroupType",props:Mt({clearable:{type:Boolean,default:!1},params:{type:Object,default:void 0},fetchParams:{type:Object,default:void 0}},{modelValue:{default:null},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const b=s,o=Be(s,"modelValue"),r=mt().createScope(),n=k(()=>({...b.params,query:{$sort:{order:1},...b.params?.query}})),w=k(()=>{if(b.fetchParams===null)return null;const l=b.fetchParams??b.params;return{...l,query:{$sort:{order:1},...l?.query}}});return(l,i)=>(d(),P(pt,{"model-value":o.value,store:e(r),limit:100,clearable:s.clearable,"label-field":"name",placeholder:l.$t("group"),"disable-autocomplete":"",params:e(n),"fetch-params":e(w),"onUpdate:modelValue":i[0]||(i[0]=g=>o.value=g)},null,8,["model-value","store","clearable","placeholder","params","fetch-params"]))}}),pn=Ft(()=>na(()=>import("./StandardProcessesSettings-DYhqwnKI.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))),fn=W({__name:"SettingsAssignmentEvents",props:{companyId:{type:Number,required:!0}},setup(s,{expose:b}){const o=s,r=R(["standard-processes"]),n=ee(),w=ee(),l=ee(),i=mt().createScope(),g=Ee().createScope(),p=ce(),f=ce(),y=k(()=>!!n.value?.hasChanges||!!w.value?.hasChanges||!!l.value?.hasChanges);function u(){n.value?.reset(),w.value?.reset(),l.value?.reset()}async function _(){await n.value?.save(),await Te(),await w.value?.save(),await Te(),await l.value?.save()}const A=k(()=>({query:{companyId:o.companyId,$sort:{order:1}}})),V=k(()=>({query:{companyId:o.companyId,$sort:{order:1}}}));return b({cancel:u,save:_,hasChanges:y}),(c,m)=>{const h=re,I=ke,U=z("font-awesome-icon"),j=ne,S=z("ArtesaTooltip"),$=Ue,E=De,O=qt;return d(),D("div",null,[t(E,{modelValue:e(r),"onUpdate:modelValue":m[6]||(m[6]=x=>K(r)?r.value=x:null)},{default:a(()=>[t($,{title:c.$t("assignmentEvent.settings.assignmentEvents"),name:"event-types"},{default:a(()=>[m._lazyshow1||e(r).includes("event-types")?(m._lazyshow1=!0,d(),D(J,null,[Z(v("div",null,[t(ie,{ref_key:"refTableEventTypes",ref:w,store:e(g),params:e(V),sortable:"",collapsable:"","hide-delete-button":"","active-status-filter":e(p),"create-data":({items:x})=>({companyId:s.companyId,order:x.length+1}),onSorted:m[1]||(m[1]=({items:x})=>x.forEach((F,C)=>F.order=C+1)),onDeleted:m[2]||(m[2]=({items:x})=>x.forEach((F,C)=>F.order=C+1))},{topLeft:a(()=>[t(me,{modelValue:e(p),"onUpdate:modelValue":m[0]||(m[0]=x=>K(p)?p.value=x:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),"expanded-row":a(({row:x})=>[t(un,{"event-type":x},null,8,["event-type"])]),default:a(()=>[t(B,{title:c.$t("assignmentEvent.name"),width:"minmax(200px, 1fr)"},{default:a(({row:x})=>[t(h,{modelValue:x.name,"onUpdate:modelValue":F=>x.name=F,placeholder:c.$t("assignmentEvent.settings.new")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["title"]),t(B,{title:c.$t("ShortName"),width:"95px"},{default:a(({row:x})=>[t(h,{modelValue:x.shortName,"onUpdate:modelValue":F=>x.shortName=F},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(B,{label:c.$t("Icon"),width:"min-content"},{default:a(({row:x})=>[t(cn,{modelValue:x.icon,"onUpdate:modelValue":F=>x.icon=F},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),t(B,{title:"Gruppe",width:"170px"},{default:a(({row:x})=>[t(mn,{modelValue:x.defaultGroupType,"onUpdate:modelValue":F=>x.defaultGroupType=F,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(B,{width:"min-content"},{default:a(({row:x})=>[t(I,{modelValue:x.color,"onUpdate:modelValue":F=>x.color=F,predefine:e(xe)},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:1}),t(B,{width:"min-content"},{default:a(({row:x})=>[t(S,{content:x.deactivatedAt?c.$t("actions.Activate"):c.$t("actions.Deactivate")},{default:a(()=>[t(j,{onClick:()=>x.deactivatedAt=x.deactivatedAt?null:new Date},{default:a(()=>[t(U,{icon:x.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","active-status-filter","create-data"])],512),[[oe,e(r).includes("event-types")]])],64)):N("v-show-if",!0)]),_:1},8,["title"]),t($,{title:c.$t("assignmentEvent.settings.assignmentEventGroups"),name:"group-types"},{default:a(()=>[m._lazyshow2||e(r).includes("group-types")?(m._lazyshow2=!0,d(),D(J,null,[Z(v("div",null,[t(ie,{ref_key:"refTableGroupTypes",ref:n,store:e(i),params:e(A),"company-id":s.companyId,"hide-delete-button":"","active-status-filter":e(f),"create-data":({items:x})=>({companyId:s.companyId,order:x.length+1}),sortable:"",onSorted:m[4]||(m[4]=({items:x})=>x.forEach((F,C)=>F.order=C+1)),onDeleted:m[5]||(m[5]=({items:x})=>x.forEach((F,C)=>F.order=C+1))},{topLeft:a(()=>[t(me,{modelValue:e(f),"onUpdate:modelValue":m[3]||(m[3]=x=>K(f)?f.value=x:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),default:a(()=>[t(B,{title:c.$t("Group"),width:"minmax(200px, 1fr)"},{default:a(({row:x})=>[t(h,{modelValue:x.name,"onUpdate:modelValue":F=>x.name=F,placeholder:c.$t("NewGroup")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["title"]),t(B,{width:"min-content"},{default:a(({row:x})=>[t(S,{content:x.deactivatedAt?c.$t("actions.Activate"):c.$t("actions.Deactivate")},{default:a(()=>[t(j,{onClick:()=>x.deactivatedAt=x.deactivatedAt?null:new Date},{default:a(()=>[t(U,{icon:x.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","company-id","active-status-filter","create-data"])],512),[[oe,e(r).includes("group-types")]])],64)):N("v-show-if",!0)]),_:1},8,["title"]),t($,{title:c.$t("assignmentEvent.settings.assignmentEventStandardProcesses"),name:"standard-processes"},{default:a(()=>[m._lazyshow3||e(r).includes("standard-processes")?(m._lazyshow3=!0,d(),D(J,null,[Z(v("div",null,[(d(),P(Pt,null,{fallback:a(()=>[Z(v("div",{class:"flex"},null,512),[[O,!0]])]),default:a(()=>[t(e(pn),{ref_key:"refStandardProcesses",ref:l,"company-id":s.companyId},null,8,["company-id"])]),_:1}))],512),[[oe,e(r).includes("standard-processes")]])],64)):N("v-show-if",!0)]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}}),yn=W({__name:"SettingsAssignmentStatusTypes",props:{companyId:{}},setup(s,{expose:b}){const o=oa().createScope(),r=R(),n=ce();function w(){return r.value?.reset()}function l(){return r.value?.save()}const i=k(()=>!!r.value?.hasChanges),{t:g}=ae(),p=k(()=>[{value:"new",label:g("assignmentStatusTypes.new")},{value:"inProgress",label:g("assignmentStatusTypes.inProgress")},{value:"done",label:g("assignmentStatusTypes.done")},{value:"cancelled",label:g("assignmentStatusTypes.cancelled")}]);function f(y){switch(y){case"new":return"warning";case"inProgress":return"info";case"done":return"success";case"cancelled":return"danger"}}return b({cancel:w,save:l,hasChanges:i}),(y,u)=>{const _=re,A=ot,V=he,c=be,m=z("font-awesome-icon"),h=ne;return d(),D("div",null,[t(ie,{ref_key:"refTable",ref:r,store:e(o),"company-id":y.companyId,"create-data":({items:I})=>({companyId:y.companyId,order:I.length+1}),params:{query:{$sort:{order:1}}},"active-status-filter":e(n),collapsable:"","hide-delete-button":"",sortable:"",onSorted:u[1]||(u[1]=({items:I})=>I.forEach((U,j)=>U.order=j+1)),onDeleted:u[2]||(u[2]=({items:I})=>I.forEach((U,j)=>U.order=j+1))},{topLeft:a(()=>[t(me,{modelValue:e(n),"onUpdate:modelValue":u[0]||(u[0]=I=>K(n)?n.value=I:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),"expanded-row":a(({row:I})=>[t(_,{modelValue:I.description,"onUpdate:modelValue":U=>I.description=U,type:"textarea",placeholder:y.$t("Description")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),default:a(()=>[t(B,{title:y.$t("name"),width:"minmax(200px, 1fr)"},{default:a(({row:I})=>[t(_,{modelValue:I.name,"onUpdate:modelValue":U=>I.name=U},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(B,{title:y.$t("Category"),width:"minmax(200px, 300px)"},{default:a(({row:I})=>[t(c,{"model-value":I.category??void 0,"fit-input-width":"",class:"w-full","onUpdate:modelValue":U=>I.category=U},{default:a(()=>[(d(!0),D(J,null,te(e(p),U=>(d(),P(V,{key:U.value,label:U.label,value:U.value},{default:a(()=>[t(A,{effect:"light",type:f(U.value)},{default:a(()=>[H(T(U.label),1)]),_:2},1032,["type"])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue"])]),_:1},8,["title"]),t(B,{width:"min-content"},{default:a(({row:I})=>[t(la,{content:I.deactivatedAt?e(g)("actions.Activate"):e(g)("actions.Deactivate")},{default:a(()=>[t(h,{onClick:()=>I.deactivatedAt=I.deactivatedAt?null:new Date},{default:a(()=>[t(m,{icon:I.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","company-id","create-data","active-status-filter"])])}}}),vn=W({__name:"SettingsAssignmentTagTypes",props:{companyId:{}},setup(s,{expose:b}){const o=s,r=sa().createScope(),n=R(),w=ce(),l=k(()=>({query:{companyId:o.companyId,$sort:{order:1}}}));function i(){return n.value?.reset()}function g(){return n.value?.save()}const p=k(()=>!!n.value?.hasChanges);return b({cancel:i,save:g,hasChanges:p}),(f,y)=>{const u=re,_=ke,A=z("font-awesome-icon"),V=ne,c=z("ArtesaTooltip");return d(),D("div",null,[t(ie,{ref_key:"refTable",ref:n,store:e(r),"company-id":f.companyId,"create-data":({items:m})=>({companyId:f.companyId,order:m.length+1}),sortable:"",params:e(l),"hide-delete-button":"","active-status-filter":e(w),onSorted:y[1]||(y[1]=({items:m})=>m.forEach((h,I)=>h.order=I+1)),onDeleted:y[2]||(y[2]=({items:m})=>m.forEach((h,I)=>h.order=I+1))},{topLeft:a(()=>[t(me,{modelValue:e(w),"onUpdate:modelValue":y[0]||(y[0]=m=>K(w)?w.value=m:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),default:a(()=>[t(B,{title:f.$t("name"),width:"1fr"},{default:a(({row:m})=>[t(u,{modelValue:m.name,"onUpdate:modelValue":h=>m.name=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(B,{width:"min-content"},{default:a(({row:m})=>[t(_,{modelValue:m.color,"onUpdate:modelValue":h=>m.color=h,predefine:e(xe)},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:1}),t(B,{width:"min-content"},{default:a(({row:m})=>[t(c,{content:m.deactivatedAt?f.$t("actions.Activate"):f.$t("actions.Deactivate")},{default:a(()=>[t(V,{onClick:()=>m.deactivatedAt=m.deactivatedAt?null:new Date},{default:a(()=>[t(A,{icon:m.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","company-id","create-data","params","active-status-filter"])])}}}),gn=W({__name:"SettingsAssignmentTypes",props:{companyId:{}},setup(s,{expose:b}){const o=s,r=ra().createScope(),n=R(),w=ce(),l=k(()=>({query:{companyId:o.companyId,$sort:{order:1}}}));function i(){return n.value?.reset()}function g(){return n.value?.save()}const p=k(()=>n.value?.hasChanges);return b({cancel:i,save:g,hasChanges:p}),(f,y)=>{const u=re,_=ke,A=z("font-awesome-icon"),V=ne,c=z("ArtesaTooltip");return d(),D("div",null,[t(ie,{ref_key:"refTable",ref:n,store:e(r),params:e(l),sortable:"","hide-delete-button":"","active-status-filter":e(w),"create-data":({items:m})=>({companyId:f.companyId,order:m.length+1}),onSorted:y[1]||(y[1]=({items:m})=>m.forEach((h,I)=>h.order=I+1)),onDeleted:y[2]||(y[2]=({items:m})=>m.forEach((h,I)=>h.order=I+1))},{topLeft:a(()=>[t(me,{modelValue:e(w),"onUpdate:modelValue":y[0]||(y[0]=m=>K(w)?w.value=m:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),default:a(()=>[t(B,{title:f.$t("name"),width:"1fr"},{default:a(({row:m})=>[t(u,{modelValue:m.name,"onUpdate:modelValue":h=>m.name=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(B,{width:"min-content"},{default:a(({row:m})=>[t(_,{modelValue:m.color,"onUpdate:modelValue":h=>m.color=h,predefine:e(xe)},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:1}),t(B,{width:"min-content"},{default:a(({row:m})=>[t(c,{content:m.deactivatedAt?f.$t("actions.Activate"):f.$t("actions.Deactivate")},{default:a(()=>[t(V,{onClick:()=>m.deactivatedAt=m.deactivatedAt?null:new Date},{default:a(()=>[t(A,{icon:m.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","active-status-filter","create-data"])])}}}),_n={class:"space-y-2"},bn={key:0},hn=W({__name:"SettingsCompany",props:{companyId:{}},setup(s,{expose:b}){const o=s,r=ze(),{t:n}=ae(),w=ia().createScope(),l=Ke().createScope(),{data:i}=l.useGet({id:()=>o.companyId,lazy:!0}),g=k(()=>i.value?.address),p=k(()=>!i.value||i.value.address?!1:!i.value.addressId);Le(p,()=>{i.value?.address&&(i.value.address=w.construct({companyId:o.companyId}))});const f=k(()=>{const _={number:n("assignment.property.number"),name:n("assignment.property.name"),addressProperty:n("assignment.relation.addressProperty"),customer:n("assignment.relation.customer")};return Object.entries(_).map(([A,V])=>({label:V,value:A}))}),y=k(()=>w.hasChanges(g.value)||l.hasChanges(i.value));async function u(){await w.save(g.value),await l.save(i.value)}return b({save:u,hasChanges:y}),(_,A)=>{const V=z("InputGoogleAutocomplete"),c=Se,m=$e,h=he,I=be;return d(),D("div",_n,[e(g)?(d(),D("div",bn,[v("h4",null,T(e(n)("addresses.name"))+": ",1),t(m,{"label-position":e(r).sm?"left":"top"},{default:a(()=>[t(c,{label:_.$t("companyAddress")},{default:a(()=>[e(g)?(d(),P(V,{key:0,modelValue:e(g),"onUpdate:modelValue":A[0]||(A[0]=U=>K(g)?g.value=U:null),placeholder:_.$t("address")},null,8,["modelValue","placeholder"])):N("",!0)]),_:1},8,["label"])]),_:1},8,["label-position"]),t(Ca,{modelValue:e(g),"onUpdate:modelValue":A[1]||(A[1]=U=>K(g)?g.value=U:null),disabled:""},null,8,["modelValue"])])):N("",!0),v("div",null,[v("h4",null,T(e(n)("settings.company-settings.assignmentNameToShow"))+": ",1),t(I,{modelValue:e(i).assignmentNameToShow,"onUpdate:modelValue":A[2]||(A[2]=U=>e(i).assignmentNameToShow=U)},{default:a(()=>[(d(!0),D(J,null,te(e(f),U=>(d(),P(h,{key:U.value,label:U.label,value:U.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])}}}),wn=W({__name:"ArtesaElInputJson",props:{modelValue:{type:[Object,Array,String,Number],default:null}},emits:["update:modelValue"],setup(s,{emit:b}){const o=s,r=b,n=R(JSON.stringify(o.modelValue)),w=R(!1),l=R(!1);let i;ge(l,y=>{y||(i=Date.now())}),ge(()=>o.modelValue,y=>{n.value=JSON.stringify(y)});function g(){l.value||Date.now()-i<150||(l.value=!0)}async function p(){if(l.value){try{const y=JSON.parse(n.value);r("update:modelValue",y)}catch(y){console.error(y);return}l.value=!1}}function f(){l.value?p():g()}return(y,u)=>{const _=z("font-awesome-icon"),A=ne,V=re;return d(),P(V,{modelValue:e(n),"onUpdate:modelValue":u[0]||(u[0]=c=>K(n)?n.value=c:null),disabled:!e(l),onKeyup:We(f,["enter"]),onClick:g,onMouseover:u[1]||(u[1]=()=>w.value=!0),onMouseleave:u[2]||(u[2]=()=>w.value=!1)},lt({_:2},[e(w)?{name:"append",fn:a(()=>[t(A,{onClick:f},{default:a(()=>[t(_,{icon:e(l)?"check":"edit",class:"text-xs"},null,8,["icon"])]),_:1})]),key:"0"}:void 0]),1032,["modelValue","disabled"])}}}),Vn=W({__name:"SettingsCustomViewsData",props:{companyId:{},customView:{}},setup(s,{expose:b}){const o=s,r=ft().createScope(),n=R(),w=k(()=>({query:{viewUuid:o.customView.uuid}})),l=k(()=>({query:{viewId:o.customView.id}}));async function i(){await n.value?.save()}function g(){n.value?.reset()}return b({cancel:g,save:i,hasChanges:k(()=>n.value?.hasChanges)}),(p,f)=>{const y=re,u=z("GridTableColumn");return d(),P(ie,{ref_key:"refTable",ref:n,store:e(r),params:e(w),"fetch-params":e(l),"company-id":p.companyId,"create-data":()=>({view:p.customView,companyId:p.companyId})},{default:a(()=>[t(u,{title:p.$t("service")},{default:a(({row:_})=>[t(y,{modelValue:_.servicePath,"onUpdate:modelValue":A=>_.servicePath=A},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(u,{title:p.$t("Key")},{default:a(({row:_})=>[t(y,{modelValue:_.routeKey,"onUpdate:modelValue":A=>_.routeKey=A},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(u,{title:p.$t("data")},{default:a(({row:_})=>[t(wn,{modelValue:_.data,"onUpdate:modelValue":A=>_.data=A},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"])]),_:1},8,["store","params","fetch-params","company-id","create-data"])}}}),xt=W({__name:"FeathersMNSelect",props:{junctionStore:{},relationStore:{},singleObject:{},labelField:{},companyId:{},data:{default:void 0},placeholder:{default:void 0},collapseTags:{type:Boolean,default:!1},relationSecondaryKey:{},singleObjectSecondaryKey:{},localOnly:{type:Boolean,default:!1}},setup(s,{expose:b}){const o=s,r=k(()=>o.labelField),n=Xe(o.junctionStore),w=Xe(o.relationStore),l=ua(()=>({companyId:o.companyId,singleObjectUuid:o.singleObject.uuid,singleObjectId:o.singleObject.id})),{data:i,hasChanges:g,save:p,cancel:f}=n.useFeathersItems({params:k(()=>({query:{companyId:l.value.companyId,[`${o.singleObjectSecondaryKey}Uuid`]:l.value.singleObjectUuid}})),fetchParams:k(()=>({query:{companyId:l.value.companyId,[`${o.singleObjectSecondaryKey}Id`]:l.value.singleObjectId}})),limit:1e3,localOnly:()=>o.localOnly}),y=k(()=>i.value.map(V=>V[`${o.relationSecondaryKey}Id`])),{data:u}=w.useFindOnce({params:k(()=>({query:{uuid:{$in:i.value.map(V=>V[`${o.relationSecondaryKey}Uuid`])}}})),items:y,fetchParams:V=>({query:{id:{$in:V},$limit:-1}})});function _(V){n.construct({companyId:o.companyId,[o.singleObjectSecondaryKey]:o.singleObject,[o.relationSecondaryKey]:V})}function A(V){const c=i.value.find(m=>m[`${o.relationSecondaryKey}Uuid`]===V.uuid);c&&n.markForRemove(c)}return b({hasChanges:g,save:p,cancel:f}),(V,c)=>(d(),P(pt,{"model-value":e(u),store:e(w),"label-field":e(r),placeholder:V.placeholder,"collapse-tags":V.collapseTags,params:{query:{companyId:V.companyId}},"fetch-params":{query:{companyId:V.companyId}},multi:!0,onAdded:_,onRemoved:A},null,8,["model-value","store","label-field","placeholder","collapse-tags","params","fetch-params"]))}}),It=W({__name:"SelectView",props:{modelValue:{type:String,default:void 0},disabled:{type:Boolean,default:!1},size:nt,placeholder:{type:String,default:null},filterable:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},filterView:{type:Function,default:void 0}},emits:["update:modelValue"],setup(s,{emit:b}){const o=s,r=b,n=Ot(),w=R("");function l(p){w.value=p}const i=k(()=>st(da.map(p=>{let f=p;try{f=n.resolve({name:p})?.meta?.name||p}catch{}return{value:p,label:f}}),"label")),g=k(()=>{const p=[];return i.value.forEach(f=>{o.filterView&&!o.filterView(f.value)||w.value&&!f.label.toLowerCase().includes(w.value.toLowerCase())||p.push(f)}),p});return(p,f)=>{const y=he,u=be;return d(),P(u,{"model-value":s.modelValue,clearable:s.clearable,disabled:s.disabled,size:s.size,placeholder:s.placeholder??p.$t("selectView"),filterable:s.filterable,"filter-method":l,"onUpdate:modelValue":f[0]||(f[0]=_=>r("update:modelValue",_))},{default:a(()=>[(d(!0),D(J,null,te(e(g),_=>(d(),P(y,{key:_.value,value:_.value,innerHTML:_.label},null,8,["value","innerHTML"]))),128))]),_:1},8,["model-value","clearable","disabled","size","placeholder","filterable"])}}}),kn={class:"p-3"},Sn=W({__name:"SettingsCustomViews",props:{companyId:{}},setup(s,{expose:b}){const o=s,r=ca().createScope(),n=ma().createScope(),w=ft().createScope(),l=Me().createScope(),{hasChanges:i,save:g,reset:p}=n.useFeathersItems({params:k(()=>({query:{companyId:o.companyId}})),localOnly:!0,limit:-1}),{hasChanges:f,save:y,reset:u}=w.useFeathersItems({params:k(()=>({query:{companyId:o.companyId}})),localOnly:!0,limit:-1}),_=R(),{can:A}=we();function V(){p(),_.value?.reset(),u()}async function c(){await g(),await _.value?.save(),await y()}const m=k(()=>_.value?.hasChanges||i.value||f.value),h=k(()=>({query:{companyId:o.companyId}}));return b({cancel:V,save:c,hasChanges:m}),(I,U)=>{const j=Se,S=$e,$=z("GridTableColumn"),E=re;return d(),D("div",null,[t(ie,{ref_key:"refTable",ref:_,store:e(r),params:e(h),"company-id":I.companyId,collapsable:!0},{"expanded-row":a(({row:O})=>[v("div",kn,[t(S,null,{default:a(()=>[t(j,{label:I.$t("roles.name")+":"},{default:a(()=>[t(xt,{"single-object":O,"company-id":I.companyId,"junction-store":e(n),"relation-store":e(l),placeholder:I.$t("roles.name"),"label-field":"name","relation-secondary-key":"role","single-object-secondary-key":"view",class:"w-96"},null,8,["single-object","company-id","junction-store","relation-store","placeholder"])]),_:2},1032,["label"])]),_:2},1024),t(Vn,{"custom-view":O,"company-id":I.companyId},null,8,["custom-view","company-id"])])]),default:a(()=>[t($,{width:"300px"},{default:a(({row:O})=>[t(It,{modelValue:O.name,"onUpdate:modelValue":x=>O.name=x,class:"w-full",disabled:!e(A)("update",O)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),t($,{width:"minmax(200px, 1fr)"},{default:a(({row:O})=>[t(E,{modelValue:O.text,"onUpdate:modelValue":x=>O.text=x,disabled:!e(A)("update",O),placeholder:I.$t("name")},null,8,["modelValue","onUpdate:modelValue","disabled","placeholder"])]),_:1})]),_:1},8,["store","params","company-id"])])}}}),$n={key:0},xn=W({__name:"EditUsersTable",props:{params:{type:Object,default:void 0},companyId:{type:Number,default:null},hideBottomButtons:{type:Boolean,default:!1}},setup(s,{expose:b}){const o=s,r=R(),n=R(),w=R(),l=Je().createScope(),{t:i}=ae(),g=pa().createScope(),{save:p,reset:f,hasChanges:y}=g.useFeathersItems({params:k(()=>({query:{}})),limit:-1,localOnly:!0}),{save:u,cancel:_,hasChanges:A}=Vt({companyId:()=>o.companyId,local:!0}),V=ce(),c=Nt({role:null,fullName:""}),m=k(()=>{const S={...o.params,query:{...o.params?.query,$sort:{createdAt:1,...o.params?.query?.$sort}}},{role:$}=c;return $?.id&&(S.query.roleId=$.id),c?.fullName&&(S.query.fullName={$regex:new RegExp(`^.*(${c.fullName}).*$`,"gim")}),o.companyId&&(S.query.companyId=o.companyId),S}),h=k(()=>{const S={...o.params,query:{...o.params?.query}},{role:$}=c;return $?.id&&(S.query.roleId=$.id),c?.fullName&&(S.query.fullName={$iLike:`%${c.fullName}%`}),o.companyId&&(S.query.companyId=o.companyId),S});function I(){_(),f(),r.value?.reset()}async function U(){await r.value?.save(),await Te(),await Promise.all([u(),p()])}const j=k(()=>!!r.value?.hasChanges||A.value||y.value);return b({cancel:I,save:U,hasChanges:j}),(S,$)=>{const E=z("GridTableColumn"),O=z("font-awesome-icon"),x=re,F=ne;return d(),P(ie,{ref_key:"refTable",ref:r,store:e(l),params:e(m),"fetch-params":e(h),"create-data":()=>({companyId:s.companyId,createdAt:new Date}),"hide-delete-button":"","active-status-filter":e(V),onCloseCreateDialog:$[4]||($[4]=()=>e(n)?.cancel()),onCloseEditDialog:$[5]||($[5]=()=>e(w)?.cancel())},{topLeft:a(()=>[t(x,{modelValue:e(c).fullName,"onUpdate:modelValue":$[0]||($[0]=C=>e(c).fullName=C),placeholder:"Name",clearable:"",style:{width:"170px"},onKeyup:$[1]||($[1]=We(()=>e(c).fullName="",["esc"]))},{prefix:a(()=>[t(O,{icon:"search"})]),_:1},8,["modelValue"]),t(kt,{modelValue:e(c).role,"onUpdate:modelValue":$[2]||($[2]=C=>e(c).role=C),clearable:"","company-id":s.companyId,style:{width:"170px"}},null,8,["modelValue","company-id"]),t(me,{modelValue:e(V),"onUpdate:modelValue":$[3]||($[3]=C=>K(V)?V.value=C:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),createForm:a(({item:C})=>[t(et,{ref_key:"refCreateForm",ref:n,"model-value":C,"hide-bottom-buttons":""},null,8,["model-value"])]),editForm:a(({item:C})=>[t(et,{ref_key:"refEditForm",ref:w,"model-value":C,"hide-bottom-buttons":""},null,8,["model-value"])]),editDialogButtons:a(({item:C})=>[C?(d(),D("div",$n,[t(F,{type:C.deactivatedAt?"default":"danger",plain:"",onClick:X=>C.deactivatedAt=C.deactivatedAt?null:new Date},{default:a(()=>[H(T(C.deactivatedAt?e(i)("actions.Activate"):e(i)("actions.Deactivate")),1)]),_:2},1032,["type","onClick"])])):N("",!0)]),default:a(()=>[t(E,{title:S.$t("Employee"),width:"minmax(max-content, auto)"},{default:a(({row:C})=>[H(T(C.fullName),1)]),_:1},8,["title"]),t(E,{title:S.$t("Email"),width:"minmax(max-content, auto)"},{default:a(({row:C})=>[H(T(C.email),1)]),_:1},8,["title"]),t(E,{title:S.$t("workType"),width:"minmax(max-content, auto)"},{default:a(({row:C})=>[H(T(C.role?.name),1)]),_:1},8,["title"])]),_:1},8,["store","params","fetch-params","create-data","active-status-filter"])}}}),In=W({__name:"SettingsEditUsers",props:{companyId:{}},setup(s,{expose:b}){const o=Ta("superadmin"),r=k(()=>!!n.value?.hasChanges),n=R();function w(){return n.value?.cancel()}function l(){return n.value?.save()}return b({cancel:w,save:l,hasChanges:r}),(i,g)=>(d(),D("div",null,[t(xn,{ref_key:"refTable",ref:n,"company-id":i.companyId,"hide-bottom-buttons":"","edit-dialog-hide-delete-button":!e(o)},null,8,["company-id","edit-dialog-hide-delete-button"])]))}}),An={class:"flex flex-wrap items-center"},Cn=["onClick"],Tn=W({__name:"PopperSelectUser",props:{value:{type:Array,default:()=>[]},readonly:{type:Boolean,default:!1},params:{type:Object,default:void 0},fetchParams:{type:Object,default:void 0}},emits:["add-user","remove-user"],setup(s,{emit:b}){const o=R(),r=s,n=b,w=Je().createScope();function l(y){return y===null?null:{...r.params,query:{id:{$nin:r.value.map(u=>u.id).filter(yt)},deactivatedAt:null,$limit:20,...r.params?.query,$sort:{fullName:1,...r.params?.query?.$sort}}}}const i=k(()=>l(r.params)),g=k(()=>{const y=r.fetchParams!==void 0?r.fetchParams:r.params;return l(y)});function p(y){n("add-user",{user:y})}function f(y){n("remove-user",{user:y,index:r.value.indexOf(y)})}return(y,u)=>{const _=z("font-awesome-icon"),A=ne;return d(),D("div",null,[v("div",An,[(d(!0),D(J,null,te(s.value,V=>(d(),P(St,{key:V.uuid,user:V,size:"small",class:"group relative !overflow-visible my-1 mr-1"},{default:a(()=>[s.readonly?N("",!0):(d(),D("div",{key:0,class:"hidden group-hover:flex absolute w-4 h-4 bg-red-700 rounded-full -right-1.5 -top-1.5 items-center justify-center cursor-pointer text-white",onClick:()=>!s.readonly&&f(V)},[t(e(Rt),{class:"w-3 h-3"})],8,Cn))]),_:2},1032,["user"]))),128)),s.readonly?N("",!0):(d(),P(Ua,{key:0,ref_key:"refPopper",ref:o,store:e(w),params:e(i)??void 0,"fetch-params":e(g)??void 0,readonly:s.readonly,"search-field":"fullName","use-search":"","prepend-search":"","append-search":"","use-search-on-server":"","onUpdate:modelValue":p},{item:a(({item:V})=>[H(T(V.fullName),1)]),default:a(()=>[t(A,{circle:"",type:"primary",class:"!w-[30px] !h-[30px] my-1 mr-1"},{default:a(()=>[t(_,{icon:"user-plus",class:"ml-0.5 w-4 h-4"})]),_:1})]),_:1},8,["store","params","fetch-params","readonly"]))])])}}}),Un={class:"@container w-full"},Dn={class:"font-bold text-gray-500"},En={class:"mt-4 mb-2 font-bold text-gray-600 flex"},Mn={class:"flex-1"},Pn={key:0},qn={class:"grid grid-cols-1 @md:grid-cols-2 @xl:grid-cols-3 @2xl:grid-cols-4 border-t border-l border-gray-200 ml-2"},Fn=["onClick"],On={class:"mr-auto @3xl:mr-0"},Nn=W({__name:"GangForm",props:{gang:{type:Object,required:!0}},setup(s){const{t:b}=ae(),o=s,r=vt().createScope(),n=gt().createScope(),w=Ee().createScope(),{can:l}=we(),{data:i,markForRemove:g}=r.useFeathersItems({params:k(()=>({query:{companyUuid:o.gang.companyUuid,gangUuid:o.gang.uuid,$sort:{order:1}}})),localOnly:!0,limit:1e3}),p=k(()=>{const S={users:[],gangUsers:[]};return i.value.forEach($=>{$.user&&(S.users.push($.user),S.gangUsers.push($))}),S});function f(S){r.construct({companyUuid:o.gang.companyUuid,gang:o.gang,user:S,order:i.value.length+1})}function y(S){g(S)}const{data:u,markForRemove:_}=n.useFeathersItems({params:k(()=>({query:{gangUuid:o.gang.uuid}})),fetchParams:k(()=>({query:{gangId:o.gang.id}})),localOnly:!0,limit:1e3}),{data:A}=w.useFind({params:k(()=>({query:{companyId:o.gang.companyId,$limit:1e3,$sort:{order:1}}}))}),V=k(()=>{const S={};for(const $ of u.value){const E=$.gangUuid;S[E]||(S[E]={});const O=$.eventTypeUuid;S[E][O]=$}return S}),c=k(()=>{const S=V.value[o.gang.uuid];return Object.values(S||{}).length===A.value.length}),m=k(()=>{const S=V.value[o.gang.uuid];return!!Object.values(S||{}).length});function h({eventType:S}){return V.value[o.gang.uuid]?.[S.uuid]}function I({eventType:S}){const $=h({eventType:S});U({eventType:S,isActive:!$})}function U({eventType:S,isActive:$}){const E=h({eventType:S});E&&$||!E&&!$||($?n.construct({companyId:o.gang.companyId,eventType:S,gang:o.gang}):E&&_(E))}function j(S){A.value.forEach($=>{U({eventType:$,isActive:S})})}return(S,$)=>{const E=z("font-awesome-icon"),O=ne,x=jt,F=_e;return d(),D("div",Un,[v("div",Dn,T(e(b)("user.name"))+":",1),t(Tn,{value:e(p).users,class:"ml-2",onAddUser:$[0]||($[0]=({user:C})=>f(C)),onRemoveUser:$[1]||($[1]=({index:C})=>y(e(p).gangUsers[C]))},null,8,["value"]),v("div",En,[v("div",Mn,T(e(b)("gang-capabilities.name",2))+":",1),e(l)("update",e(n).servicePath)?(d(),D("div",Pn,[t(x,null,{default:a(()=>[t(O,{disabled:!e(m),size:"small",onClick:$[2]||($[2]=()=>j(!1))},{default:a(()=>[t(E,{icon:"times"})]),_:1},8,["disabled"]),t(O,{disabled:e(c),size:"small",onClick:$[3]||($[3]=()=>j(!0))},{default:a(()=>[t(E,{icon:"check"})]),_:1},8,["disabled"])]),_:1})])):N("",!0)]),v("div",qn,[(d(!0),D(J,null,te(e(A),C=>(d(),D("div",{key:C.uuid,class:ve(["flex-1 flex items-center flex-row border-r border-b border-gray-200 py-1 px-3",[e(V)[s.gang.uuid]?.[C.uuid]?"bg-primary/10 text-gray-800":"bg-white text-gray-500"]])},[v("div",{class:"flex-1 flex text-sm w-full overflow-hidden text-ellipsis whitespace-nowrap cursor-pointer",onClick:()=>I({eventType:C})},T(C.name),9,Fn),v("div",On,[t(F,{disabled:!e(l)("update",e(n).servicePath),"model-value":!!e(V)[s.gang.uuid]?.[C.uuid],"onUpdate:modelValue":X=>U({eventType:C,isActive:!!X})},null,8,["disabled","model-value","onUpdate:modelValue"])])],2))),128))])])}}}),Rn=W({__name:"SettingsGangs",props:{companyId:{type:Number,required:!0}},setup(s,{expose:b}){const o=s,{t:r}=ae(),n=ee(),w=fa().createScope(),l=vt().createScope(),i=gt().createScope(),{data:g,hasChanges:p,reset:f,save:y,markForRemove:u}=l.useFeathersItems({params:k(()=>({query:{companyId:o.companyId,$sort:{order:1}}})),fetchParams:k(()=>({query:{companyId:o.companyId,$sort:{order:1}}})),limit:1e3}),{data:_,hasChanges:A,reset:V,save:c,markForRemove:m}=i.useFeathersItems({params:k(()=>({query:{companyId:o.companyId}})),fetchParams:k(()=>({query:{companyId:o.companyId}})),limit:1e3}),h=k(()=>n.value?.hasChanges||p.value||A.value);function I({item:S,items:$}){const E=g.value.filter(x=>x.gangUuid===S.uuid),O=_.value.filter(x=>x.gangUuid===S.uuid);E.forEach(x=>u(x)),O.forEach(x=>m(x)),$.forEach((x,F)=>{x.order!==F+1&&(x.order=F+1)})}function U(){n.value?.reset(),f(),V()}async function j(){await n.value?.save({saveNew:!0,saveChanged:!0,saveRemoved:!1}),await Promise.all([y({deep:!1}),c({deep:!1})]),await n.value?.save({saveNew:!1,saveChanged:!1,saveRemoved:!0})}return b({hasChanges:h,cancel:U,save:j}),(S,$)=>{const E=re,O=z("GridTableColumn");return d(),D("div",null,[t(ie,{ref_key:"tableRef",ref:n,store:e(w),params:{query:{companyId:s.companyId,$sort:{order:1}}},sortable:!0,collapsable:"","create-data":({items:x})=>({companyId:s.companyId,order:x.length+1}),onSorted:$[0]||($[0]=({items:x})=>{x.forEach((F,C)=>F.order=C+1)}),onDeleted:$[1]||($[1]=({item:x,items:F})=>I({item:x,items:F}))},{"expanded-row":a(({row:x})=>[t(Nn,{gang:x},null,8,["gang"])]),default:a(()=>[t(O,{title:e(r)("gangs.property.name"),width:"minmax(200px, 1fr)"},{default:a(({row:x})=>[t(E,{modelValue:x.name,"onUpdate:modelValue":F=>x.name=F},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"])]),_:1},8,["store","params","create-data"])])}}}),jn={class:"flex justify-between mt-6"},Gn=W({__name:"FormHoliday",props:{modelValue:{type:Object,required:!0}},emits:["deleted","saved","created","canceled"],setup(s,{expose:b,emit:o}){const{can:r}=we(),{t:n}=ae(),w=s,l=_t().createScope(),i=R(),g=o,p=k(()=>w.modelValue),f=n("userAbsence.form.error.required")??"d",y={name:[{required:!0,message:f}],startsAt:[{type:"date",required:!0,message:f},{validator:(h,I,U)=>{if(I>(p.value.endsAt??0)){const j=n("userAbsence.form.error.startsAtBeforeEndsAt")??"d";U(new Error(j))}else U()}}]},u=k({set:h=>{if(!h){p.value.startsAt=null,p.value.endsAt=null;return}const[I,U]=h;p.value.startsAt=new Date(I),p.value.endsAt=Bt(new Date(U))},get:()=>p.value.startsAt&&p.value.endsAt?[p.value.startsAt,p.value.endsAt]:void 0}),_=R(!1),A=R(!1);function V(){l.resetOrRemove(p.value),g("canceled",p.value)}async function c(){_.value=!0;try{await rt.confirm(n("holidays.form.doYouWantToDelete"),n("holidays.form.delete"),{confirmButtonText:n("actions.Delete"),cancelButtonText:n("actions.Cancel"),type:"warning",confirmButtonClass:"el-button--danger"}),await l.remove(p.value),g("deleted",p.value)}finally{_.value=!1}}async function m(){A.value=!0;try{await Oa(i);const h=!p.value.id;await l.save(p.value),h&&g("created",p.value),g("saved",p.value)}finally{A.value=!1}}return b({cancel:V,remove:c,save:m}),(h,I)=>{const U=re,j=Se,S=Gt,$=z("font-awesome-icon"),E=ne,O=$e;return d(),P(O,{ref_key:"refForm",ref:i,model:e(p),rules:y,"label-width":"80px","hide-required-asterisk":""},{default:a(()=>[t(j,{prop:"name",label:e(n)("holidays.name")},{default:a(()=>[t(U,{modelValue:e(p).name,"onUpdate:modelValue":I[0]||(I[0]=x=>e(p).name=x),placeholder:e(n)("holidays.name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(j,{prop:"startsAt",label:e(n)("Date")},{default:a(()=>[t(S,{modelValue:e(u),"onUpdate:modelValue":I[1]||(I[1]=x=>K(u)?u.value=x:null),type:"daterange","unlink-panels":"",format:"DD.MM.YY"},null,8,["modelValue"])]),_:1},8,["label"]),v("div",jn,[v("div",null,[e(p).id&&e(r)("delete",e(p))?(d(),P(E,{key:0,loading:e(_),plain:"",type:"danger",class:"mr-2",onClick:c},{default:a(()=>[t($,{icon:"trash-alt",class:"mr-2"}),H(" "+T(e(n)("actions.Delete")),1)]),_:1},8,["loading"])):N("",!0)]),v("div",null,[t(E,{text:"",class:"mr-2",onClick:V},{default:a(()=>[H(T(e(n)("actions.Cancel")),1)]),_:1}),t(E,{type:"primary",onClick:m},{default:a(()=>[H(T(e(n)("actions.Save")),1)]),_:1})])])]),_:1},8,["model"])}}}),Bn=W({__name:"DialogFormHoliday",props:{modelValue:{type:Object,required:!0},visible:{type:Boolean,default:!1}},emits:["update:visible","canceled","deleted","saved","created"],setup(s,{emit:b}){const o=b,{t:r}=ae(),n=ee();return(w,l)=>{const i=Lt;return d(),P(i,{"model-value":s.visible,title:e(r)("holidays.form.create"),class:"dialog-form-holiday","onUpdate:modelValue":l[4]||(l[4]=g=>o("update:visible",g)),onClose:l[5]||(l[5]=()=>e(n)?.cancel())},{default:a(()=>[t(Gn,{ref_key:"refFormHoliday",ref:n,"model-value":s.modelValue,onCanceled:l[0]||(l[0]=g=>{o("canceled",g),o("update:visible",!1)}),onDeleted:l[1]||(l[1]=g=>{o("deleted",g),o("update:visible",!1)}),onSaved:l[2]||(l[2]=g=>{o("saved",g),o("update:visible",!1)}),onCreated:l[3]||(l[3]=g=>o("created",g))},null,8,["model-value"])]),_:1},8,["model-value","title"])}}}),Ln={class:"flex items-center justify-between mb-4"},Wn={class:"flex items-center"},Hn={class:"hidden sm:block text-lg mr-2 font-bold"},zn={class:"fc-event-inner"},Kn={class:"fc-event-title"},Jn=W({__name:"SettingsHolidays",props:{companyId:{}},setup(s,{expose:b}){const o=s,{t:r}=ae(),n=R(null),w=_t().createScope(),l=R(null),i=R(new Date),{data:g}=w.useFind({params:k(()=>!n.value||!o.companyId?null:{query:{startsAt:{$lt:n.value.endsAt},endsAt:{$gte:n.value.startsAt},companyId:o.companyId,$limit:-1}}),fetchParams:k(()=>!n.value||!o.companyId?null:{query:{startsAt:{$lt:n.value.endsAt},endsAt:{$gte:n.value.startsAt},companyId:o.companyId,$limit:-1}}),reevaluateAfter:["created","removed"]});function p(V,c){l.value=w.construct({companyId:o.companyId,startsAt:V,endsAt:c})}const f=k(()=>g.value.map(V=>({id:V.uuid,title:V.name??"",start:V.startsAt,end:V.endsAt&&qa(V.endsAt,{seconds:1}),extendedProps:{holiday:V},allDay:!0,backgroundColor:ya,textColor:va,borderColor:"transparent",className:"cursor-pointer"}))),{ref:y,options:u,rerender:_}=Ma({plugins:[Da,Ea],initialView:"dayGridMonth",headerToolbar:!1,selectable:!0,select:V=>{p(V.start,new Date(V.end.getTime()-1))},selectMirror:!0,eventClick:({event:V})=>{const{holiday:c}=V.extendedProps;l.value=c},views:{dayGridMonth:{dayMaxEventRows:6}},events:f},{dateRange:n,calendarDate:i});function A(V){Ce({title:r("holidays.dialog.success"),message:r("holidays.dialog.message",[V.name]),type:"info"})}return b({rerender:_}),(V,c)=>{const m=z("font-awesome-icon"),h=ne;return d(),D("div",null,[v("div",Ln,[v("div",Wn,[v("div",Hn,T(e(r)("holidays.name",2)),1),t(Fa,{modelValue:e(i),"onUpdate:modelValue":c[0]||(c[0]=I=>K(i)?i.value=I:null),size:"default","class-button-today":"hidden md:block",resolution:"month","picker-width":"95px"},null,8,["modelValue"])]),t(h,{type:"primary",onClick:c[1]||(c[1]=()=>p())},{default:a(()=>[t(m,{icon:"plus",class:"mr-2"}),H(" "+T(e(r)("holidays.form.create")),1)]),_:1})]),t(e(Pa),{ref_key:"calendarRef",ref:y,options:e(u),class:"absences-calendar"},{eventContent:a(({event:I})=>[v("div",{class:"fc-event-container rounded-sm",style:Wt(I.extendedProps.style)},[v("div",zn,[v("div",Kn,T(I.title),1)])],4)]),_:1},8,["options"]),e(l)?(d(),P(Bn,{key:0,"model-value":e(l),visible:!!e(l),"onUpdate:visible":c[2]||(c[2]=()=>l.value=null),onCreated:A},null,8,["model-value","visible"])):N("",!0)])}}}),Yn={key:0},Qn={key:0},Xn=W({__name:"SettingsManufacturing",props:{companyId:{}},setup(s,{expose:b}){const o=s,r=Ke().createScope(),{data:n}=r.useGet({id:k(()=>o.companyId),lazy:!0});async function w(){await r.save(n.value)}function l(){r.reset(n.value)}const i=k(()=>r.hasChanges(n.value));return b({save:w,cancel:l,hasChanges:i}),(g,p)=>{const f=Ht,y=je,u=Se,_=$e,A=re;return d(),D("div",null,[t(_,null,{default:a(()=>[e(n)?(d(),D("div",Yn,[t(f,{type:"info",description:g.$t("manufacturing.timeoutDescription"),"show-icon":""},null,8,["description"]),t(u,{label:g.$t("manufacturing.timeoutManufacturing"),class:"mt-2"},{default:a(()=>[t(y,{modelValue:e(n).manufacturingTimeout,"onUpdate:modelValue":p[0]||(p[0]=V=>e(n).manufacturingTimeout=V),min:0,step:5},null,8,["modelValue"])]),_:1},8,["label"])])):N("",!0)]),_:1}),e(n)?(d(),D("div",Qn,[t(f,{type:"info",description:g.$t("manufacturing.noteDescription"),"show-icon":""},null,8,["description"]),t(A,{modelValue:e(n).manufacturingMessage,"onUpdate:modelValue":p[1]||(p[1]=V=>e(n).manufacturingMessage=V),autosize:{minRows:4,maxRows:8},type:"textarea",class:"mt-2"},null,8,["modelValue"])])):N("",!0)])}}}),Zn=W({__name:"SelectRoleType",props:{value:{type:String,default:void 0},role:{type:Object,default:void 0}},setup(s){const b=Me().createScope(),o=s,{t:r}=ae(),n=Ge(o),w=k(()=>[{label:r("roles.admin"),value:"admin"},{label:r("roles.office"),value:"office"},{label:r("roles.craft"),value:"craft"},{label:r("roles.spectator"),value:"spectator"},{label:r("roles.superadmin"),value:"superadmin"}]),{can:l}=we(),i=k(()=>o.role?w.value.filter(({value:g})=>{if(!o.role)return!1;const p=b.construct({type:g,name:o.role.name,companyId:o.role.companyId},!0),f=l("create",p);return b.resetOrRemove(p),f}):w.value);return(g,p)=>{const f=he,y=be;return d(),P(y,{modelValue:e(n),"onUpdate:modelValue":p[0]||(p[0]=u=>K(n)?n.value=u:null)},{default:a(()=>[(d(!0),D(J,null,te(e(i),u=>(d(),P(f,{key:u.value,value:u.value,label:u.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])}}}),eo={class:"flex flex-col"},to={class:"text-gray-500 font-bold"},ao=W({__name:"SettingsRoles",props:{companyId:{}},setup(s,{expose:b}){const o=s,r=Me().createScope(),{can:n}=we(),{t:w}=ae(),l=R(),i=ce(),g=k(()=>({query:{companyId:o.companyId,$sort:{order:1}}})),p=k(()=>({query:{companyId:o.companyId,$sort:{order:1}}})),f=k(()=>!!l.value?.hasChanges);function y(){return l.value?.reset()}function u(){return l.value?.save()}return b({cancel:y,save:u,hasChanges:f}),(_,A)=>{const V=re,c=z("font-awesome-icon"),m=ne,h=z("ArtesaTooltip"),I=_e;return d(),D("div",null,[t(ie,{ref_key:"refTable",ref:l,store:e(r),params:e(g),"fetch-params":e(p),sortable:"","hide-delete-button":"",collapsable:"","active-status-filter":e(i),"create-data":({items:U})=>({companyId:_.companyId,order:U.length+1}),onSorted:A[1]||(A[1]=({items:U})=>U.forEach((j,S)=>j.order=S+1)),onDeleted:A[2]||(A[2]=({items:U})=>U.forEach((j,S)=>j.order=S+1))},{topLeft:a(()=>[t(me,{modelValue:e(i),"onUpdate:modelValue":A[0]||(A[0]=U=>K(i)?i.value=U:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),"expanded-row":a(({row:U})=>[v("div",eo,[v("div",to,T(e(w)("role.permissions"))+":",1),t(I,{modelValue:U.canJustSeeOwnAbsences,"onUpdate:modelValue":j=>U.canJustSeeOwnAbsences=j,class:"ml-2"},{default:a(()=>[H(T(e(w)("role.canOnlySeeOwnAbsences")),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),t(I,{modelValue:U.canJustSeeOwnEvents,"onUpdate:modelValue":j=>U.canJustSeeOwnEvents=j,class:"ml-2"},{default:a(()=>[H(T(e(w)("role.canOnlySeeOwnEvents")),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),default:a(()=>[t(B,{title:_.$t("name"),width:"minmax(200px, 1fr)"},{default:a(({row:U})=>[t(V,{modelValue:U.name,"onUpdate:modelValue":j=>U.name=j,disabled:!e(n)("update",U),placeholder:_.$t("roles.properties.name")},null,8,["modelValue","onUpdate:modelValue","disabled","placeholder"])]),_:1},8,["title"]),t(B,{title:_.$t("roles.properties.type"),width:"150px"},{default:a(({row:U})=>[t(Zn,{modelValue:U.type,"onUpdate:modelValue":j=>U.type=j,role:U},null,8,["modelValue","onUpdate:modelValue","role"])]),_:1},8,["title"]),t(B,{width:"min-content"},{default:a(({row:U})=>[t(h,{content:U.deactivatedAt?e(w)("actions.Activate"):e(w)("actions.Deactivate")},{default:a(()=>[t(m,{onClick:()=>U.deactivatedAt=U.deactivatedAt?null:new Date},{default:a(()=>[t(c,{icon:U.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","fetch-params","active-status-filter","create-data"])])}}}),no={class:"mb-2"},oo={class:"font-bold"},lo=["innerHTML"],so={key:0},ro={class:"font-bold"},io={class:"font-bold"},uo=W({__name:"SettingsSuperAdmin",props:{companyId:{}},setup(s,{expose:b}){const o=s,r=Pe().createScope(),{getRouteViewName:n}=ga(),w=Ke().createScope(),{data:l}=w.useGet({id:k(()=>o.companyId),lazy:!0}),{data:i}=r.useGet({id:k(()=>o.companyId),lazy:!0}),g=r.useHasChanges(()=>i.value),p=He(new Map),f=it(async()=>{if(!i.value?.stripeCustomer)return null;const S=p.get(i.value.stripeCustomer);if(S)return S;const $=await Ze.service("stripe/customers").get(i.value.stripeCustomer,{});return p.set(i.value.stripeCustomer,$),$},null),y=k({get(){return f.value},set(S){i.value&&(S?i.value.stripeCustomer=S.id:i.value.stripeCustomer=null)}}),u=ee([]),_=k(()=>u.value.map(S=>({value:S,label:S.name}))),A=ee(!1),V=async S=>{A.value=!0;try{if(S!==""){const $=await Ze.service("stripe/customers").search({query:{query:`name~"${S}"`},$limit:5,paginate:!1});u.value=$}else u.value=[]}finally{A.value=!1}},c=k(()=>w.hasChanges(l.value)||g.value);function m(S){l.value&&(l.value.disabledViews=[...l.value.disabledViews??[],S])}function h(S){l.value&&(l.value.disabledViews=(l.value.disabledViews??[]).filter($=>$!==S))}function I(S){return l.value?!(l.value.disabledViews??[]).includes(S):!1}function U(){w.reset(l.value),r.reset(i.value)}async function j(){await Promise.all([w.save(l.value),r.save(i.value)])}return b({hasChanges:c,save:j,cancel:U}),(S,$)=>{const E=z("font-awesome-icon"),O=ne,x=ut,F=zt;return d(),D("div",null,[v("div",no,[v("div",oo,T(S.$t("settings.hideViews"))+":",1),t(It,{"filter-view":I,clearable:"",filterable:"","onUpdate:modelValue":m}),(d(!0),D(J,null,te(e(l)?.disabledViews??[],C=>(d(),D("div",{key:C,class:"flex items-center"},[v("div",{innerHTML:e(n)(C)},null,8,lo),t(O,{text:"",onClick:()=>h(C)},{default:a(()=>[t(E,{icon:"times"})]),_:2},1032,["onClick"])]))),128))]),e(l)?(d(),D("div",so,[v("div",ro,T(S.$t("settings.activateRfidLogin"))+":",1),t(x,{"model-value":!!e(l).RFIDEnabled,"onUpdate:modelValue":$[0]||($[0]=C=>e(l).RFIDEnabled=!!C)},null,8,["model-value"])])):N("",!0),v("div",null,[v("div",io,"Stripe "+T(S.$t("customer.name"))+":",1),t(F,{modelValue:e(y),"onUpdate:modelValue":$[1]||($[1]=C=>K(y)?y.value=C:null),filterable:"",remote:"",clearable:"","value-key":"name","remote-method":V,options:e(_),loading:e(A)},null,8,["modelValue","options","loading"])])])}}});function co(){const{dayJsLocale:s}=_a();return s}function At(){const s=co();return k(()=>{const{weekStart:b}=s.value;return b===void 0||b<0||b>6?0:b})}function mo(){const s=At();return k(()=>[...Array(7).keys()].map((o,r)=>{const n=r+s.value;return n>6?n-7:n}))}function po(s,b){const o=At();return k(()=>st(dt(s),(n,w)=>{const l=b(n,w);return l<o.value?l+7:l}))}const fo={class:"border border-gray-300 mb-2"},yo=v("th",{class:"border-gray-300 border-r border-r-gray-400 bg-gray-100",rowspan:"2"},null,-1),vo={class:"text-center p-2 pb-1 border-gray-300 border-r border-r-gray-400 bg-gray-100 !font-normal",colspan:"3",rowspan:"2"},go={class:"text-center px-2 py-1 bg-gray-100 border-gray-300 border-r-gray-400 border-r !font-normal",colspan:"4"},_o={class:"px-2 py-1 bg-gray-100 w-24",rowspan:"3"},bo=["innerHTML"],ho={class:"text-center px-2 border-gray-300 border-r border-t bg-gray-100",colspan:"2"},wo={class:"text-center px-2 border-gray-300 border-t border-r-gray-400 border-r bg-gray-100",colspan:"2"},Vo={class:"text-center px-2 pb-1 border-gray-300 border-r border-r-gray-400 border-b bg-gray-100"},ko={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-y bg-gray-100"},So={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-y border-r bg-gray-100"},$o={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-y border-r border-r-gray-400 bg-gray-100"},xo={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-b bg-gray-100 !font-normal"},Io={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-b border-r bg-gray-100 !font-normal"},Ao={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-b bg-gray-100 !font-normal"},Co={class:"text-center px-2 pt-0 pb-1 border-gray-300 border-b border-r-gray-400 border-r bg-gray-100 !font-normal"},To={class:"px-2 py-1 border-gray-200 border-r border-r-gray-400"},Uo={class:"px-2 py-1 border-gray-200"},Do={class:"px-2 py-1 border-gray-200 border-r"},Eo={class:"px-2 py-1 border-gray-200 border-r border-r-gray-400"},Mo={class:"px-2 py-1"},Po={class:"px-2 py-1 border-gray-200 border-r"},qo={class:"px-2 py-1"},Fo={class:"px-2 py-1 border-r-gray-400 border-r"},Oo={class:"px-2 py-1 flex justify-center"},No={colspan:"3",class:"border-gray-300 border-t text-right text-sm text-gray-500 py-1 bg-gray-100"},Ro={class:"leading-normal text-center px-2 py-1 text-gray-500 text-sm border-gray-300 border-t border-r-gray-400 border-r bg-gray-100"},jo=v("td",{colspan:"5",class:"border-gray-300 border-t bg-gray-100"},null,-1),Go={class:"flex items-center mb-2"},Bo={class:"mr-2 text-gray-500"},Lo={class:"flex items-center mb-2"},Wo={class:"mr-2 text-gray-500"},Ho={class:"flex items-center mb-2"},zo={class:"mr-2 text-gray-500"},Ko={class:"flex mb-1"},Jo={class:"text-gray-500"},Yo=W({__name:"WorkingTimeModelForm",props:{model:{type:Object,required:!0}},setup(s){const b=s,o=bt().createScope(),{t:r}=ae(),{data:n}=o.useFeathersItems({localOnly:!0,params:k(()=>({query:{workingTimeModelUuid:b.model.uuid,$limit:-1}}))}),w=mo(),l=k(()=>w.value.map(u=>{const _=n.value?.find(A=>A.weekday===u);return{weekday:u,get isActive(){return _?.isActive??!1},set isActive(A){_?_.isActive=A:o.construct({companyId:b.model.companyId,weekday:u,isActive:A,workingTimeModel:b.model})},model:_}})),i=k(()=>{const y=[];for(const u of l.value)u.isActive&&u.model&&y.push(u.model);return y}),g=k(()=>{let y=0;return i.value.forEach(u=>{y+=u.duration??0}),y});function p(){b.model.pauseRules||=[],b.model.pauseRules.push({breakTimeDefault:null,durationMin:null,breakTimeMin:null,breakTimeMax:null})}function f(y){b.model.pauseRules.splice(y,1)}return(y,u)=>{const _=_e,A=z("font-awesome-icon"),V=ne;return d(),D("div",null,[v("table",fo,[v("thead",null,[v("tr",null,[yo,v("th",vo,T(e(r)("working-time-model-weekdays.default")),1),v("th",go,T(e(r)("working-time-model-weekdays.adjustment")),1),v("th",_o,[v("div",{class:"w-20 text-center break-normal",innerHTML:e(r)("working-time-model-weekdays.property.durationMax")},null,8,bo)])]),v("tr",null,[v("th",ho,T(e(r)("working-time-model-weekdays.property.start")),1),v("th",wo,T(e(r)("working-time-model-weekdays.property.end")),1)]),v("tr",null,[v("th",Vo,T(e(r)("Day")),1),v("th",ko,T(e(r)("working-time-model-weekdays.property.start")),1),v("th",So,T(e(r)("working-time-model-weekdays.property.end")),1),v("th",$o,T(e(r)("working-time-model-weekdays.property.duration")),1),v("th",xo,T(e(r)("working-time-model-weekdays.minShort")),1),v("th",Io,T(e(r)("working-time-model-weekdays.maxShort")),1),v("th",Ao,T(e(r)("working-time-model-weekdays.minShort")),1),v("th",Co,T(e(r)("working-time-model-weekdays.maxShort")),1)])]),(d(!0),D(J,null,te(e(l),c=>(d(),D("tr",{key:c.weekday},[v("td",To,[t(_,{modelValue:c.isActive,"onUpdate:modelValue":m=>c.isActive=m},{default:a(()=>[H(T(e(r)("weekday."+c.weekday)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),v("td",Uo,[c.model&&c.isActive?(d(),P(se,{key:0,modelValue:c.model.start,"onUpdate:modelValue":m=>c.model.start=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),v("td",Do,[c.model&&c.isActive?(d(),P(se,{key:0,modelValue:c.model.end,"onUpdate:modelValue":m=>c.model.end=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),v("td",Eo,[c.model&&c.isActive?(d(),P(se,{key:0,modelValue:c.model.duration,"onUpdate:modelValue":m=>c.model.duration=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),v("td",Mo,[c.model&&c.isActive?(d(),P(se,{key:0,modelValue:c.model.startMin,"onUpdate:modelValue":m=>c.model.startMin=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),v("td",Po,[c.model&&c.isActive?(d(),P(se,{key:0,modelValue:c.model.startMax,"onUpdate:modelValue":m=>c.model.startMax=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),v("td",qo,[c.model&&c.isActive?(d(),P(se,{key:0,modelValue:c.model.endMin,"onUpdate:modelValue":m=>c.model.endMin=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),v("td",Fo,[c.model&&c.isActive?(d(),P(se,{key:0,modelValue:c.model.endMax,"onUpdate:modelValue":m=>c.model.endMax=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),v("td",Oo,[c.model&&c.isActive?(d(),P(se,{key:0,modelValue:c.model.durationMax,"onUpdate:modelValue":m=>c.model.durationMax=m,"value-type":"number","clear-null":"",placeholder:"-"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)])]))),128)),v("tr",null,[v("td",No,T(e(i).length)+" "+T(e(r)("Day",e(i).length))+": ",1),v("td",Ro,T(e(Aa)(e(g)))+T(e(r)("hoursUnit")),1),jo])]),v("div",Go,[v("div",Bo,T(e(r)("working-time-models.carryOverMonthMaximum"))+":",1),t(se,{modelValue:s.model.carryOverMonthMaximum,"onUpdate:modelValue":u[0]||(u[0]=c=>s.model.carryOverMonthMaximum=c),"value-type":"hours","clear-null":"",placeholder:"00:00",style:{width:"70px !important"}},null,8,["modelValue"])]),v("div",Lo,[v("div",Wo,T(e(r)("working-time-models.countHolidaysAsWorkdays"))+":",1),t(_,{modelValue:s.model.countHolidaysAsWorkdays,"onUpdate:modelValue":u[1]||(u[1]=c=>s.model.countHolidaysAsWorkdays=c)},null,8,["modelValue"])]),v("div",Ho,[v("div",zo,T(e(r)("working-time-models.showIsManipulated")),1),t(_,{modelValue:s.model.showIsManipulated,"onUpdate:modelValue":u[2]||(u[2]=c=>s.model.showIsManipulated=c)},null,8,["modelValue"])]),v("div",Ko,[v("div",Jo,T(e(r)("working-time-models.pauseRules"))+":",1),t(V,{size:"small",class:"ml-2",onClick:p},{default:a(()=>[t(A,{icon:"plus"})]),_:1})]),(d(!0),D(J,null,te(s.model.pauseRules??[],(c,m)=>(d(),P(Na,{class:"items-center"},{default:a(()=>[t(Ae,{title:e(r)("working-time-models.property.pauseRule.durationMin")},{default:a(()=>[t(se,{modelValue:c.durationMin,"onUpdate:modelValue":h=>c.durationMin=h,"value-type":"number",clearable:"","clear-null":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["title"]),t(Ae,{title:e(r)("working-time-models.property.pauseRule.breakTimeDefault")},{default:a(()=>[t(se,{modelValue:c.breakTimeDefault,"onUpdate:modelValue":h=>c.breakTimeDefault=h,"value-type":"number",clearable:"","clear-null":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["title"]),t(Ae,{title:e(r)("working-time-models.property.pauseRule.breakTimeMin")},{default:a(()=>[t(se,{modelValue:c.breakTimeMin,"onUpdate:modelValue":h=>c.breakTimeMin=h,"value-type":"number",clearable:"","clear-null":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["title"]),t(Ae,{title:e(r)("working-time-models.property.pauseRule.breakTimeMax")},{default:a(()=>[t(se,{modelValue:c.breakTimeMax,"onUpdate:modelValue":h=>c.breakTimeMax=h,"value-type":"number",clearable:"","clear-null":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["title"]),t(V,{onClick:()=>f(m)},{default:a(()=>[t(A,{icon:"times"})]),_:2},1032,["onClick"])]),_:2},1024))),256))])}}}),Qo={class:"overflow-x-auto w-0 flex-1"},Xo=W({__name:"SettingsTimeSheets",props:{companyId:{type:Number,required:!0}},setup(s,{expose:b}){const o=s,{t:r}=ae(),n=ba().createScope(),w=bt().createScope(),l="working-time-models",i=ee([l]),g=ee(),p=ce(),f=k(()=>g.value?.items??[]),y=k(()=>[...g.value?.collapsed.values()??[]].every(E=>!E)),{data:u,markForRemove:_,save:A,reset:V,hasChanges:c}=w.useFeathersItems({params:k(()=>({query:{companyId:o.companyId,$limit:500}}))}),m=k(()=>g.value?.hasChanges||c.value);function h(){g.value?.reset(),V()}async function I(){await g.value?.save({saveNew:!0,saveChanged:!0,saveRemoved:!1}),await A(),await g.value?.save({saveNew:!1,saveChanged:!1,saveRemoved:!0})}function U(E){const O=u.value.filter(x=>x.workingTimeModelUuid===E.uuid);_(O)}function j(E,O){O&&f.value.forEach(x=>x.isDefault=!1),E.isDefault=O}function S(){f.value.length&&(f.value[0].isDefault=!0)}function $(E,O){O.forEach((x,F)=>x.order=F+1),U(E),E.isDefault&&S()}return b({hasChanges:m,cancel:h,save:I}),(E,O)=>{const x=re,F=_e,C=z("font-awesome-icon"),X=ne,pe=z("ArtesaTooltip"),Q=Ue,Y=De;return d(),D("div",null,[t(Y,{modelValue:e(i),"onUpdate:modelValue":O[3]||(O[3]=L=>K(i)?i.value=L:null)},{default:a(()=>[t(Q,{title:E.$t("working-time-models.name",2),name:l},{default:a(()=>[t(ie,{ref_key:"tableRef",ref:g,store:e(n),params:{query:{companyId:s.companyId,$sort:{order:1}}},sortable:e(y),collapsable:"","create-data":({items:L})=>({companyId:s.companyId,order:L.length+1,isDefault:!L.length||!L.some(le=>!le.deactivatedAt&&le.isDefault)}),"active-status-filter":e(p),"hide-delete-button":"","disable-pagination":"","before-save":L=>(L.pauseRules??[]).sort((le,ue)=>(le.durationMin??0)-(ue.durationMin??0)),onSorted:O[1]||(O[1]=({items:L})=>L.forEach((le,ue)=>le.order=ue+1)),onDeleted:O[2]||(O[2]=({item:L,items:le})=>$(L,le))},{topLeft:a(()=>[t(me,{modelValue:e(p),"onUpdate:modelValue":O[0]||(O[0]=L=>K(p)?p.value=L:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),"expanded-row":a(({row:L})=>[v("div",Qo,[t(Yo,{model:L},null,8,["model"])])]),default:a(()=>[t(B,{title:e(r)("working-time-models.property.name")},{default:a(({row:L})=>[t(x,{modelValue:L.name,"onUpdate:modelValue":le=>L.name=le,placeholder:e(r)("working-time-models.name")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["title"]),t(B,{title:e(r)("working-time-models.property.isDefault"),width:"max-content"},{default:a(({row:L})=>[t(F,{"model-value":L.isDefault,"onUpdate:modelValue":le=>j(L,!!le)},null,8,["model-value","onUpdate:modelValue"])]),_:1},8,["title"]),t(B,{width:"max-content"},{default:a(({row:L})=>[t(pe,{content:L.deactivatedAt?e(r)("actions.Activate"):e(r)("actions.Deactivate")},{default:a(()=>[t(X,{onClick:()=>L.deactivatedAt=L.deactivatedAt?null:new Date},{default:a(()=>[t(C,{icon:L.deactivatedAt?"fa-eye":"fa-eye-slash","fixed-width":"",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","sortable","create-data","active-status-filter","before-save"])]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}}),Zo={class:"text-xs text-gray-500 leading-tight"},el={class:"text-xs text-gray-500 leading-tight"},tl={class:"text-xs text-gray-500 leading-tight"},tt=W({__name:"FormUserAbsenceType",props:{modelValue:{default:null,local:!0},modelModifiers:{}},emits:["update:modelValue"],setup(s,{expose:b}){const o=Be(s,"modelValue"),r=R();function n(...l){return r.value?.validate(...l)}function w(...l){return r.value?.clearValidate(...l)}return b({validate:n,clearValidate:w}),(l,i)=>{const g=re,p=Se,f=ke,y=ut,u=$e;return o.value?(d(),P(u,{key:0,ref_key:"refForm",ref:r,"label-width":"110px",model:o.value},{default:a(()=>[t(p,{label:l.$t("name",1),prop:"name"},{default:a(()=>[t(g,{modelValue:o.value.name,"onUpdate:modelValue":i[0]||(i[0]=_=>o.value.name=_),placeholder:l.$t("userAbsence.form.type.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:l.$t("color",1),prop:"color"},{default:a(()=>[t(f,{modelValue:o.value.color,"onUpdate:modelValue":i[1]||(i[1]=_=>o.value.color=_),size:"default",predefine:e(xe)},null,8,["modelValue","predefine"])]),_:1},8,["label"]),t(p,{label:l.$t("userAbsence.form.type.needApproval")},{default:a(()=>[v("div",null,[t(y,{modelValue:o.value.needApproval,"onUpdate:modelValue":i[2]||(i[2]=_=>o.value.needApproval=_)},null,8,["modelValue"]),v("div",Zo,T(l.$t("userAbsence.form.type.needApprovalExplanation")),1)])]),_:1},8,["label"]),t(p,{label:l.$t("userAbsence.form.type.needCompensation")},{default:a(()=>[v("div",null,[t(y,{modelValue:o.value.needCompensation,"onUpdate:modelValue":i[3]||(i[3]=_=>o.value.needCompensation=_)},null,8,["modelValue"]),v("div",el,T(l.$t("userAbsence.form.type.needCompensationExplanation")),1)])]),_:1},8,["label"]),t(p,{label:l.$t("userAbsence.form.type.countAsWorkingTime")},{default:a(()=>[v("div",null,[t(y,{modelValue:o.value.countAsWorkingTime,"onUpdate:modelValue":i[4]||(i[4]=_=>o.value.countAsWorkingTime=_)},null,8,["modelValue"]),v("div",tl,T(l.$t("userAbsence.form.type.countAsWorkingTimeExplanation")),1)])]),_:1},8,["label"])]),_:1},8,["model"])):N("",!0)}}}),al=W({__name:"SettingsUserAbsenceTypes",props:{companyId:{}},setup(s,{expose:b}){const o=s,r=R(),n=ce(),w=ha().createScope(),{t:l}=ae(),i=k(()=>({query:{companyId:o.companyId,$sort:{order:1}}})),g=k(()=>r.value?.hasChanges);function p(){return r.value?.reset()}function f(){return r.value?.save()}return b({cancel:p,save:f,hasChanges:g}),(y,u)=>{const _=ke,A=z("font-awesome-icon"),V=ne,c=z("ArtesaTooltip");return d(),D("div",null,[t(ie,{ref_key:"refTable",ref:r,store:e(w),"hide-delete-button":"",sortable:"",params:e(i),"active-status-filter":e(n),"create-data":({items:m})=>({companyId:o.companyId,order:m.length+1}),onSorted:u[1]||(u[1]=({items:m})=>m.forEach((h,I)=>h.order=I+1)),onDeleted:u[2]||(u[2]=({items:m})=>m.forEach((h,I)=>h.order=I+1))},{topLeft:a(()=>[t(me,{modelValue:e(n),"onUpdate:modelValue":u[0]||(u[0]=m=>K(n)?n.value=m:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),createForm:a(m=>[t(tt,{ref:"createForm","model-value":m?.item},null,8,["model-value"])]),editForm:a(m=>[t(tt,{ref:"editForm","model-value":m?.item},null,8,["model-value"])]),default:a(()=>[t(B,{title:y.$t("name",1),width:"1fr"},{default:a(({row:m})=>[H(T(m.name),1)]),_:1},8,["title"]),t(B,{title:y.$t("userAbsence.form.type.needApproval"),width:"max-content"},{default:a(({row:m})=>[H(T(m.needApproval?y.$t("Yes"):y.$t("No")),1)]),_:1},8,["title"]),t(B,{title:y.$t("userAbsence.form.type.needCompensation"),width:"max-content"},{default:a(({row:m})=>[H(T(m.needCompensation?y.$t("Yes"):y.$t("No")),1)]),_:1},8,["title"]),t(B,{width:"min-content"},{default:a(({row:m})=>[t(_,{modelValue:m.color,"onUpdate:modelValue":h=>m.color=h,disable:"",predefine:e(xe)},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:1}),t(B,{width:"min-content"},{default:a(({row:m})=>[t(c,{content:m.deactivatedAt?e(l)("actions.Activate"):e(l)("actions.Deactivate")},{default:a(()=>[t(V,{onClick:()=>m.deactivatedAt=m.deactivatedAt?null:new Date},{default:a(()=>[t(A,{icon:m.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","active-status-filter","create-data"])])}}}),nl={class:"font-bold mb-3"},ol={class:"text-gray-400 ml-2"},ll={class:"font-bold my-3"},sl={class:"flex items-center gap-2 mb-2"},rl={class:"overflow-auto max-h-screen"},il={key:0,class:"relative h-1"},ul={class:"sticky z-30 border border-gray-200 bg-white text-center top-0 left-0"},dl={class:"max-w-[110px] overflow-hidden overflow-ellipsis"},cl={class:"p-2 overflow-hidden text-ellipsis"},ml={key:0,class:"border border-gray-200"},pl=["colspan"],fl={class:"flex items-center w-36"},yl={class:"line-clamp-2 w-0 flex-1"},vl={class:"flex items-center justify-center min-w-[80px]"},gl=W({__name:"SettingsUserCapabilities",props:{companyId:{}},setup(s,{expose:b}){const o=s,{t:r}=ae(),n=ze(),w=ee(""),l=ee(null),i=Ee().createScope(),g=Je().createScope(),{data:p,save:f,cancel:y,hasChanges:u,haveLoaded:_}=i.useFeathersItems({params:k(()=>({query:{companyId:o.companyId,$sort:{order:1}}})),fetchParams:k(()=>({query:{companyId:o.companyId,$sort:{order:1}}})),limit:1e3});function A(Q,Y){Q.manPowerOfferPerDay=Math.round(Y*60*60)}const{data:V,haveLoaded:c}=g.useFind({params:k(()=>({query:{companyId:o.companyId,deactivatedAt:null,$sort:{fullName:1},$limit:1e3}})),fetchParams:k(()=>({query:{companyId:o.companyId,deactivatedAt:null,$sort:{fullName:1},$limit:1e3}}))}),m=k(()=>{let Q=V.value;return l.value&&(Q=Q.filter(Y=>Y.roleUuid===l.value?.uuid)),w.value&&(Q=Q.filter(Y=>Y.fullName.toLowerCase().includes(w.value.toLowerCase()))),Q}),{capabilities:h,cancel:I,hasChanges:U,save:j,setCapability:S}=Vt({companyId:()=>o.companyId}),$=k(()=>c.value&&_.value),E=k(()=>{const Q={};if(!$.value)return Q;for(const Y of V.value){Q[Y.uuid]={};for(const L of p.value){const le=h.value.find(ue=>ue.userUuid===Y.uuid&&ue.eventTypeUuid===L.uuid);Q[Y.uuid][L.uuid]=!!le}}return Q}),O=ee(null),x=ee(null);function F(Q,Y,L){L?(O.value=Y,x.value=Q):(O.value=null,x.value=null)}const C=k(()=>U.value||u.value);function X(){I(),y()}async function pe(){await Promise.all([j(),f()])}return b({save:pe,cancel:X,hasChanges:C}),(Q,Y)=>{const L=je,le=Se,ue=$e,ye=z("font-awesome-icon"),Ie=re,fe=z("ArtesaTooltip"),q=_e;return d(),D("div",null,[v("div",nl,T(Q.$t("capabilities.standardPersonnelHoursPerWorkAreaPerDay")),1),t(ue,{"label-width":"180px","label-position":e(n).md?"left":"top"},{default:a(()=>[(d(!0),D(J,null,te(e(p),M=>(d(),P(le,{key:M.uuid,label:`${M.name}:`},{default:a(()=>[t(L,{"model-value":(M.manPowerOfferPerDay||0)/(60*60),"show-man-hours":"",min:0,precision:2,step:8,style:{width:"140px"},"onUpdate:modelValue":G=>G!==void 0&&A(M,G)},null,8,["model-value","onUpdate:modelValue"]),v("span",ol,T(Q.$t("capabilities.personnelHours")),1)]),_:2},1032,["label"]))),128))]),_:1},8,["label-position"]),v("div",ll,T(Q.$t("capabilities.employeeSkills")),1),v("div",sl,[t(ye,{icon:"search",class:"ml-2 text-gray-500"}),t(Ie,{modelValue:e(w),"onUpdate:modelValue":Y[0]||(Y[0]=M=>K(w)?w.value=M:null),clearable:"",placeholder:e(r)("user.name",1),style:{width:"170px"}},null,8,["modelValue","placeholder"]),t(kt,{modelValue:e(l),"onUpdate:modelValue":Y[1]||(Y[1]=M=>K(l)?l.value=M:null),clearable:""},null,8,["modelValue"])]),v("div",rl,[e($)?(d(),D("table",il,[v("tr",null,[v("th",ul,T(e(r)("user.name")),1),(d(!0),D(J,null,te(e(p),M=>Z((d(),D("th",{key:M.uuid,class:ve(["sticky top-0 z-10 border border-gray-200 text-center",[e(x)===M?"bg-gray-100":"bg-white"]])},[v("div",dl,[t(fe,{content:M.name,placement:"top"},{default:a(()=>[v("div",cl,T((M.shortName||M.name)??""),1)]),_:2},1032,["content"])])],2)),[[e(Ne),G=>F(M,null,G)]])),128))]),e(m).length===0?(d(),D("tr",ml,[v("td",{colspan:e(p).length+1},T(Q.$t("capabilities.noEmployeesFound")),9,pl)])):(d(!0),D(J,{key:1},te(e(m),M=>(d(),D("tr",{key:M.uuid},[Z((d(),D("th",{class:ve(["z-20 border border-gray-200 p-1 font-normal sticky left-0",[e(O)===M?"bg-gray-100":"bg-white"]])},[v("div",fl,[t(St,{user:M,size:"mini",class:"m-0.5 mr-2"},null,8,["user"]),v("div",yl,T(M.fullName),1)])],2)),[[e(Ne),G=>F(null,M,G)]]),(d(!0),D(J,null,te(e(p),G=>Z((d(),D("td",{key:G.uuid,class:ve(["border border-gray-200",{"bg-gray-100":G===e(x)||e(O)===M}])},[v("div",vl,[t(q,{"model-value":e(E)[M.uuid][G.uuid],"onUpdate:modelValue":de=>e(S)({eventType:G,user:M,isActive:!!de})},null,8,["model-value","onUpdate:modelValue"])])],2)),[[e(Ne),de=>F(G,M,de)]])),128))]))),128))])):N("",!0)])])}}}),_l={key:0,class:"flex mt-2"},bl=W({__name:"SettingsWorkPeriodsPerEventType",props:{companyId:{type:Number,required:!0},eventType:{type:Object,required:!0}},emits:["has-changes"],setup(s,{expose:b,emit:o}){const r=s,n=ht().createScope(),w=o,{t:l}=ae(),{can:i}=we(),g=R(),p=R(""),f=ce(),y=k(()=>({query:{companyId:r.companyId,eventTypeUuid:r.eventType.uuid,$sort:{order:1}}})),u=k(()=>({query:{companyId:r.companyId,eventTypeId:r.eventType.id,$sort:{order:1}}}));function _(){return g.value?.reset()}async function A(){return await g.value?.save()}return ge(()=>g.value?.hasChanges,V=>{V!=null&&w("has-changes",V)}),b({cancel:_,save:A}),(V,c)=>{const m=re,h=z("font-awesome-icon"),I=ne,U=z("ArtesaTooltip"),j=ne;return d(),D("div",null,[t(ie,{ref_key:"refTable",ref:g,store:e(n),params:e(y),"fetch-params":e(u),"hide-edit-button":"","hide-create-button":"","hide-limit-select":"","disable-pagination":"","hide-delete-button":"",sortable:"","create-data":({items:S})=>({companyId:r.companyId,eventType:s.eventType,name:e(p),order:S.length+1}),"active-status-filter":e(f),onCreated:c[1]||(c[1]=()=>p.value=""),onSorted:c[2]||(c[2]=({items:S})=>S.forEach(($,E)=>$.order=E+1)),onDeleted:c[3]||(c[3]=({items:S})=>S.forEach(($,E)=>$.order=E+1))},{topLeft:a(()=>[t(me,{modelValue:e(f),"onUpdate:modelValue":c[0]||(c[0]=S=>K(f)?f.value=S:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),default:a(()=>[t(B,{title:e(l)("Label")},{default:a(({row:S})=>[t(m,{modelValue:S.name,"onUpdate:modelValue":$=>S.name=$,disabled:!e(i)("update","assignment-event-work-types")},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1},8,["title"]),t(B,{width:"max-content"},{default:a(({row:S})=>[t(U,{content:S.deactivatedAt?e(l)("actions.Activate"):e(l)("actions.Deactivate")},{default:a(()=>[t(I,{onClick:()=>S.deactivatedAt=S.deactivatedAt?null:new Date},{default:a(()=>[t(h,{icon:S.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","fetch-params","create-data","active-status-filter"]),e(i)("create","assignment-event-work-types")?(d(),D("div",_l,[t(m,{modelValue:e(p),"onUpdate:modelValue":c[5]||(c[5]=S=>K(p)?p.value=S:null),class:"flex-1",placeholder:V.$t("timeSheets.newWorkTime"),onKeydown:c[6]||(c[6]=We(Kt(()=>e(g)?.newItem(),["stop"]),["enter"]))},lt({_:2},[e(p)?{name:"append",fn:a(()=>[t(j,{type:"primary",onClick:c[4]||(c[4]=()=>e(g)?.newItem())},{default:a(()=>[t(h,{icon:"plus"})]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder"])])):N("",!0)])}}});function Ct(s,b,o){const r=[];b=e(b);const n=(Array.isArray(b)?b:[b]).filter(yt);if(!n?.length)return r;const w=[].map(l=>e(l));for(let l=0;l<n.length;l++){let i=n[l];if(Array.isArray(i)){if(i.length!==1)continue;[i]=i}if(!i||w.includes(i)){w.includes(i);continue}s in i&&typeof i[s]=="function"&&r.push(i)}return r}async function hl(s,b){const o=Ct("save",s);return await Promise.all(o.map(async r=>await r.save()))}function wl(s,b){Ct("cancel",s).forEach(r=>r.cancel())}const Vl={class:"border border-gray-300 mb-4"},kl={class:"text-center p-2 pb-1 border-b bg-gray-100"},Sl={class:"text-center p-2 pb-1 border-b bg-gray-100"},$l={class:"text-center p-2 pb-1 border-b bg-gray-100"},xl={class:"text-center p-2 pb-1 border-b bg-gray-100"},Il={class:"text-center p-2 pb-1 border-b bg-gray-100"},Al={class:"p-2 border-b"},Cl={class:"p-2 border-b"},Tl={class:"p-2 text-gray-500 border-b"},Ul={class:"p-2 border-b"},Dl={class:"p-2 border-b"},El=W({__name:"SettingsWorkPeriods",props:{companyId:{type:Number,required:!0}},setup(s,{expose:b}){const{t:o}=ae(),r=s,n=R(["work-periods"]),w=R([]),l=ee(),i=ce(),g=Ee().createScope(),p=wa().createScope(),f=Va().createScope();ht().createScope().useFeathersItems({params:k(()=>({query:{companyId:r.companyId,$limit:1e3}}))});const{data:u}=g.useFind({params:k(()=>({query:{companyId:r.companyId,$sort:{order:1},$limit:100}}))}),{data:_,hasChanges:A,save:V,cancel:c}=p.useFeathersItems({params:k(()=>({query:{companyId:r.companyId,$limit:1e3}}))}),m=ka();function h(F){const C=(F.start||0)+(F.duration||0)+(F.pause||0);return F.end=C,C}const I=k(()=>m.map(F=>{const C=_.value.find(X=>X.weekday===F);return{workingTime:C,weekday:F,get isActive(){return!!C?.isActive},set isActive(X){C?C.isActive=X:p.construct({companyId:r.companyId,weekday:F,isActive:X})},get start(){return C?.start??0},set start(X){C?C.start=X:p.construct({companyId:r.companyId,weekday:F,isActive:!0,start:X}),C&&h(C)},get duration(){return C?.duration??0},set duration(X){C?C.duration=X:p.construct({companyId:r.companyId,weekday:F,isActive:!0,duration:X}),C&&h(C)},get pause(){return C?.pause??0},set pause(X){C?C.pause=X:p.construct({companyId:r.companyId,weekday:F,isActive:!0,pause:X}),C&&h(C)}}})),U=po(I,F=>F.weekday),j=R({}),S=R(void 0);ge(u,F=>{(!S.value||S.value==="0")&&F.length&&(S.value=`eventType-${F[0].uuid}`)},{immediate:!0});function $(F,C){j.value[F.uuid]=C}const E=k(()=>Object.values(j.value).some(F=>F===!0)||A.value||l.value?.hasChanges);async function O(){await Promise.all([V(),hl(w),l.value?.save()])}function x(){wl(w),c(),l.value?.reset()}return b({save:O,cancel:x,hasChanges:E}),(F,C)=>{const X=_e,pe=Ue,Q=re,Y=z("GridTableColumn"),L=z("font-awesome-icon"),le=ne,ue=z("ArtesaTooltip"),ye=Yt,Ie=Jt,fe=De;return d(),D("div",null,[t(fe,{modelValue:e(n),"onUpdate:modelValue":C[4]||(C[4]=q=>K(n)?n.value=q:null)},{default:a(()=>[t(pe,{title:e(o)("working-times.name",2),name:"working-times"},{default:a(()=>[v("table",Vl,[v("tr",null,[v("th",kl,T(e(o)("working-times.name")),1),v("th",Sl,T(e(o)("working-times.property.start")),1),v("th",$l,T(e(o)("working-times.property.duration")),1),v("th",xl,T(e(o)("working-times.property.pause")),1),v("th",Il,T(e(o)("working-times.property.end")),1)]),(d(!0),D(J,null,te(e(U),q=>(d(),D("tr",{key:q.weekday},[v("td",Al,[t(X,{modelValue:q.isActive,"onUpdate:modelValue":M=>q.isActive=M,label:e(o)(`weekday.${q.weekday}`),class:"w-32"},null,8,["modelValue","onUpdate:modelValue","label"])]),v("td",Cl,[q.isActive?(d(),P(se,{key:0,modelValue:q.start,"onUpdate:modelValue":M=>q.start=M,"value-type":"number",disabled:!q.workingTime?.isActive},null,8,["modelValue","onUpdate:modelValue","disabled"])):N("",!0)]),v("td",Tl,[q.isActive?(d(),P(se,{key:0,modelValue:q.duration,"onUpdate:modelValue":M=>q.duration=M,"value-type":"number",disabled:!q.workingTime?.isActive},null,8,["modelValue","onUpdate:modelValue","disabled"])):N("",!0)]),v("td",Ul,[q.isActive?(d(),P(se,{key:0,modelValue:q.pause,"onUpdate:modelValue":M=>q.pause=M,"value-type":"number",disabled:!q.workingTime?.isActive},null,8,["modelValue","onUpdate:modelValue","disabled"])):N("",!0)]),v("td",Dl,[q.isActive?(d(),P(se,{key:0,"model-value":q.workingTime?.end,disabled:"","value-type":"number"},null,8,["model-value"])):N("",!0)])]))),128))])]),_:1},8,["title"]),t(pe,{title:e(o)("unaccountable-work-periods.name",2),name:"unaccountable-periods"},{default:a(()=>[t(ie,{ref_key:"refUnaccountable",ref:l,store:e(f),params:{query:{companyId:s.companyId,$sort:{order:1}}},sortable:"","create-data":({items:q})=>({companyId:s.companyId,order:q.length+1}),"active-status-filter":e(i),"hide-delete-button":"",onSorted:C[1]||(C[1]=({items:q})=>q.forEach((M,G)=>M.order=G+1)),onDeleted:C[2]||(C[2]=({items:q})=>q.forEach((M,G)=>M.order=G+1))},{topLeft:a(()=>[t(me,{modelValue:e(i),"onUpdate:modelValue":C[0]||(C[0]=q=>K(i)?i.value=q:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),default:a(()=>[t(Y,null,{default:a(({row:q})=>[t(Q,{modelValue:q.name,"onUpdate:modelValue":M=>q.name=M,placeholder:"Name"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(Y,{width:"min-content"},{default:a(({row:q})=>[t(ue,{content:q.deactivatedAt?e(o)("actions.Activate"):e(o)("actions.Deactivate")},{default:a(()=>[t(le,{onClick:()=>q.deactivatedAt=q.deactivatedAt?null:new Date},{default:a(()=>[t(L,{icon:q.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","create-data","active-status-filter"])]),_:1},8,["title"]),t(pe,{title:e(o)("assignment-event-work-periods.name",2),name:"work-periods"},{default:a(()=>[t(Ie,{modelValue:e(S),"onUpdate:modelValue":C[3]||(C[3]=q=>K(S)?S.value=q:null),type:"card"},{default:a(()=>[(d(!0),D(J,null,te(e(u),q=>(d(),P(ye,{key:q.uuid,name:`eventType-${q.uuid}`,label:q.name,lazy:""},{default:a(()=>[t(bl,{ref_for:!0,ref_key:"refsSettingsPerEventType",ref:w,"company-id":s.companyId,"event-type":q,onHasChanges:M=>$(q,M)},null,8,["company-id","event-type","onHasChanges"])]),_:2},1032,["name","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}}),Ml=W({__name:"SettingsUploadCategories",props:{companyId:{}},setup(s,{expose:b}){const o=s,{t:r}=ae(),n=ce(),w=k(()=>({query:{companyId:o.companyId,$sort:{order:1}}})),l=k(()=>({query:{companyId:o.companyId,$sort:{order:1}}})),i=Sa().createScope(),g=$a().createScope(),p=Me().createScope(),{save:f,reset:y,hasChanges:u}=g.useFeathersItems({params:k(()=>({query:{companyId:o.companyId,$limit:-1}}))}),_=R();function A(){_.value?.reset(),y()}async function V(){await Promise.all([_.value?.save({saveNew:!0,saveChanged:!0,saveRemoved:!1}),f({saveChanged:!0,saveRemoved:!0,saveNew:!1})]),await Te(),await Promise.all([_.value?.save({saveRemoved:!0,saveChanged:!1,saveNew:!1}),f({saveNew:!0,saveChanged:!1,saveRemoved:!1})])}const c=k(()=>!!_.value?.hasChanges||!!u.value);return b({cancel:A,save:V,hasChanges:c}),(m,h)=>{const I=ke,U=re,j=z("font-awesome-icon"),S=ne,$=z("ArtesaTooltip");return d(),D("div",null,[v("h4",null,T(e(r)("uploadCategories.name",2)),1),t(ie,{ref_key:"refTable",ref:_,store:e(i),params:e(w),"fetch-params":e(l),sortable:"","hide-delete-button":"","active-status-filter":e(n),"create-data":({items:E})=>({companyId:m.companyId,order:E.length+1}),onSorted:h[1]||(h[1]=({items:E})=>E.forEach((O,x)=>O.order=x+1)),onDeleted:h[2]||(h[2]=({items:E})=>E.forEach((O,x)=>O.order=x+1))},{topLeft:a(()=>[t(me,{modelValue:e(n),"onUpdate:modelValue":h[0]||(h[0]=E=>K(n)?n.value=E:null),style:{"--el-select-width":"170px"}},null,8,["modelValue"])]),default:a(()=>[t(B,{title:e(r)("color"),width:"max-content"},{default:a(({row:E})=>[t(I,{modelValue:E.color,"onUpdate:modelValue":O=>E.color=O,predefine:e(xe)},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:1},8,["title"]),t(B,{title:e(r)("name"),width:"minmax(200px,1fr)"},{default:a(({row:E})=>[t(U,{modelValue:E.name,"onUpdate:modelValue":O=>E.name=O},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),t(B,{title:e(r)("roles.name",2),width:"200px"},{default:a(({row:E})=>[t(xt,{"junction-store":e(g),"relation-store":e(p),"single-object":E,"label-field":"name","company-id":E.companyId,"single-object-secondary-key":"category","relation-secondary-key":"role","local-only":""},null,8,["junction-store","relation-store","single-object","company-id"])]),_:1},8,["title"]),t(B,{width:"min-content"},{default:a(({row:E})=>[t($,{content:E.deactivatedAt?e(r)("actions.Activate"):e(r)("actions.Deactivate")},{default:a(()=>[t(S,{onClick:()=>E.deactivatedAt=E.deactivatedAt?null:new Date},{default:a(()=>[t(j,{icon:E.deactivatedAt?"fa-eye":"fa-eye-slash",class:"text-xs"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["store","params","fetch-params","active-status-filter","create-data"])])}}}),Pl=W({__name:"SelectStripeInvoiceStatusFilter",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(s){const b=Be(s,"modelValue"),{t:o}=ae(),r=k(()=>[{value:"draft",label:o("stripe.status.draft")},{value:"open",label:o("stripe.status.open")},{value:"paid",label:o("stripe.status.paid")},{value:"uncollectible",label:o("stripe.status.uncollectible")},{value:"void",label:o("stripe.status.void")}]);return(n,w)=>{const l=he,i=be;return d(),P(i,{modelValue:b.value,"onUpdate:modelValue":w[0]||(w[0]=g=>b.value=g),clearable:"",placeholder:e(o)("stripe.status.name")},{default:a(()=>[(d(!0),D(J,null,te(e(r),g=>(d(),P(l,{key:g.value,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])}}});function at(s,b,o){const r=k({get(){return s.value},set(n){b(n),s.value=n,o?.(n)}});return r.bypass=n=>{s.value=n},r}const ql={class:"flex gap-2"},Fl={class:"min-w-44"},Ol={class:"flex gap-2"},Nl={class:"flex justify-end mt-2"},Rl=W({__name:"StripeInvoices",props:{companyId:{},subscriptionId:{}},setup(s){const b=s,{locale:o}=ae(),n=Pe().createScope().useGet({id:k(()=>b.companyId)}),w=k(()=>n.data.value?.stripeCustomer??null),l=He([]),i=ee(null),g=ee(!0),p=ee(!0),f=at(ee(null),()=>u(),()=>V()),y=at(ee(null),()=>u(),()=>V());function u(){g.value=!0,p.value=!0,i.value=null,l.splice(0,l.length)}const{execute:_,isLoading:A}=wt(async()=>{if(!g.value||!w.value)return;let h=`customer:'${w.value}' AND subscription:'${b.subscriptionId}'`;f.value&&(h+=` AND status:'${f.value}'`),y.value&&(h+=` AND number:'${y.value}'`);const I=await Ye.service("stripe/invoices").search({paginate:!0,query:{page:i.value??void 0,limit:5,query:h,expand:["data.subscription"]}});g.value=I.has_more,i.value=I.next_page,l.push(...I.data),p.value=!1},{useNProgress:!0}),V=ct(_,1e3,{leading:!0});ge(w,(h,I)=>{h&&h!==I&&(f.bypass(null),y.bypass(null),u(),V())},{immediate:!0});function c(h){return h.status==="open"&&h.due_date&&new Date(h.due_date*1e3)<new Date}function m(h){if(c(h))return"danger";if(h.status!=="open"){if(h.status==="paid")return"success";if(h.status==="draft")return"info";if(h.status==="uncollectible"||h.status==="void")return"danger"}}return(h,I)=>{const U=re,j=ot,S=ne;return d(),D("div",null,[v("div",ql,[v("div",Fl,[t(Pl,{modelValue:e(f),"onUpdate:modelValue":I[0]||(I[0]=$=>K(f)?f.value=$:null)},null,8,["modelValue"])]),v("div",null,[t(U,{modelValue:e(y),"onUpdate:modelValue":I[1]||(I[1]=$=>K(y)?y.value=$:null),clearable:"",placeholder:h.$t("stripe.number")},null,8,["modelValue","placeholder"])])]),t($t,{data:e(l),"key-property":"id"},{default:a(()=>[t(B,{title:h.$t("stripe.amount")},{default:a(({row:$})=>[H(T(($.total/100).toLocaleString(e(o),{style:"currency",currency:$.currency}))+" ",1),t(j,{class:"ml-2",type:m($)},{default:a(()=>[H(T(h.$t(c($)?"stripe.status.overdue":`stripe.status.${$.status}`)),1)]),_:2},1032,["type"])]),_:1},8,["title"]),t(B,{title:h.$t("stripe.number")},{default:a(({row:$})=>[H(T($.number),1)]),_:1},8,["title"]),t(B,{title:h.$t("stripe.due_date")},{default:a(({row:$})=>[$.due_date?(d(),D(J,{key:0},[H(T(e(xa)(new Date($.due_date*1e3))),1)],64)):N("",!0)]),_:1},8,["title"]),t(B,{title:h.$t("stripe.created")},{default:a(({row:$})=>[H(T(e(Ia)(new Date($.created*1e3))),1)]),_:1},8,["title"]),t(B,{width:"max-content"},{default:a(({row:$})=>[v("div",Ol,[v("div",null,[$.invoice_pdf?(d(),P(S,{key:0,tag:"a",target:"_blank",rel:"noopener noreferrer",href:$.invoice_pdf},{default:a(()=>[H(T(h.$t("stripe.pdf")),1)]),_:2},1032,["href"])):N("",!0)]),v("div",null,[$.hosted_invoice_url?(d(),P(S,{key:0,tag:"a",target:"_blank",rel:"noopener noreferrer",href:$.hosted_invoice_url},{default:a(()=>[H(T(h.$t("stripe.webInvoice")),1)]),_:2},1032,["href"])):N("",!0)])])]),_:1})]),_:1},8,["data"]),v("div",Nl,[e(g)&&!e(p)?(d(),P(S,{key:0,disabled:e(A),onClick:I[2]||(I[2]=$=>e(V)())},{default:a(()=>[H(T(h.$t("stripe.loadMore")),1)]),_:1},8,["disabled"])):N("",!0)])])}}});function jl(s){const b=ee(!1);return Le(()=>dt(s),()=>{b.value||(b.value=!0)},{immediate:!0}),b}function Gl(){const{locale:s}=ae();return k(()=>new Intl.ListFormat(s.value))}const Bl={key:0},Ll=W({__name:"StripeSubscription",props:{subscription:{},expanded:{type:Boolean},companyId:{}},setup(s){const b=s,{locale:o}=ae(),r=jl(()=>b.expanded),n=it(async l=>{const i=b.subscription.id,g=[];let p=!0;for(l(()=>p=!1);p;){const f=await Ye.service("stripe/subscription-items").find({paginate:!0,query:{subscription:i,expand:["data.plan.product"]}});g.push(...f.data),p=f.has_more}return g},null),w=Gl();return(l,i)=>{const g=Qt,p=Xt,f=Zt,y=ea,u=Ue;return d(),P(u,{key:l.subscription.id,name:l.subscription.id},{title:a(()=>[t(p,{loading:e(n)===null},{template:a(()=>[t(g,{variant:"p",style:{width:"50%"}})]),default:a(()=>[typeof l.subscription.customer!="string"&&"name"in l.subscription.customer?(d(),D(J,{key:0},[H(T(l.subscription.customer.name)+" - ",1),(d(!0),D(J,null,te(e(n),_=>(d(),D("span",{key:_.id},[typeof _.plan.product=="object"&&_.plan.product&&"name"in _.plan.product?(d(),D(J,{key:0},[H(T(_.plan.product.name)+" ",1)],64)):N("",!0)]))),128))],64)):N("",!0)]),_:1},8,["loading"])]),default:a(()=>[t(y,null,{default:a(()=>[t(f,{label:l.$t("stripe.subscriptions.startedAt")},{default:a(()=>[H(T(e(Oe)(new Date(l.subscription.start_date*1e3))),1)]),_:1},8,["label"]),t(f,{label:l.$t("stripe.subscriptions.currentPeriod")},{default:a(()=>[H(T(e(Oe)(new Date(l.subscription.current_period_start*1e3)))+" - "+T(e(Oe)(new Date(l.subscription.current_period_end*1e3))),1)]),_:1},8,["label"]),b.subscription.payment_settings?.payment_method_types?(d(),P(f,{key:0,label:l.$t("stripe.subscriptions.payment_method",b.subscription.payment_settings.payment_method_types.length)},{default:a(()=>[H(T(e(w).format(b.subscription.payment_settings.payment_method_types.map(_=>l.$t(`stripe.subscriptions.payment_method_types.${_}`)))),1)]),_:1},8,["label"])):N("",!0)]),_:1}),t($t,{data:e(n)??[],"key-property":"id"},{default:a(()=>[t(B,{title:l.$t("stripe.subscriptions.product")},{default:a(({row:_})=>[_.plan.product&&typeof _.plan.product=="object"&&"name"in _.plan.product?(d(),D(J,{key:0},[H(T(_.plan.product.name),1)],64)):N("",!0)]),_:1},8,["title"]),t(B,{title:l.$t("stripe.subscriptions.quantity"),width:"max-content"},{default:a(({row:_})=>[H(T(_.quantity),1)]),_:1},8,["title"]),t(B,{title:l.$t("stripe.subscriptions.price"),width:"max-content"},{default:a(({row:_})=>[H(T(((_.price.unit_amount??0)/100).toLocaleString(e(o),{style:"currency",currency:_.price.currency}))+" ",1),_.price.recurring?(d(),D(J,{key:0},[H(" / "+T(l.$t(`stripe.interval.${_.price.recurring.interval}`)),1)],64)):N("",!0)]),_:1},8,["title"])]),_:1},8,["data"]),e(r)?(d(),D("div",Bl,[t(Rl,{"company-id":l.companyId,"subscription-id":l.subscription.id},null,8,["company-id","subscription-id"])])):N("",!0)]),_:1},8,["name"])}}}),Wl=W({__name:"SettingsStripeSubscriptions",props:{companyId:{}},setup(s,{expose:b}){const o=s,n=Pe().createScope().useGet({id:k(()=>o.companyId)}),w=k(()=>n.data.value?.stripeCustomer??null),l=ee(null),i=ee(!0),g=ee(!0),p=He([]),f=ee([]);function y(){i.value=!0,g.value=!0,l.value=null}const{execute:u}=wt(async()=>{if(!i.value||!w.value)return;const A=await Ye.service("stripe/subscriptions").find({paginate:!0,query:{limit:5,customer:w.value,expand:["data.customer"]}});if(i.value=A.has_more,l.value=A.data.at(-1)?.id??null,p.push(...A.data),g.value){const V=p.at(0)?.id;V&&(f.value=[V])}g.value=!1},{useNProgress:!0}),_=ct(u,1e3,{leading:!0});return ge(w,(A,V)=>{A&&A!==V&&(p.splice(0,p.length),f.value=[],y(),_())},{immediate:!0}),b({activeSubscriptions:f}),(A,V)=>{const c=De;return d(),P(c,{modelValue:e(f),"onUpdate:modelValue":V[0]||(V[0]=m=>K(f)?f.value=m:null)},{default:a(()=>[(d(!0),D(J,null,te(e(p),m=>(d(),P(Ll,{key:m.id,subscription:m,"company-id":A.companyId,expanded:e(f).includes(m.id)},null,8,["subscription","company-id","expanded"]))),128))]),_:1},8,["modelValue"])}}}),Tt=W({__name:"SettingPaneItem",props:{item:{type:Object,required:!0},isActive:{type:Boolean,default:!1}},setup(s){return(b,o)=>(d(),D("li",{class:ve(["px-3 py-1.5 mb-1 rounded transition-all duration-150 ease-in-out w-44 truncate",[s.isActive?"bg-white shadow-sm":"cursor-pointer text-gray-600 hover:text-black hover:bg-white/70",s.item.hasChanges?"border-l-4 border-l-red-700":"pl-4"]])},[Ve(b.$slots,"default",{item:s.item},()=>[H(T(s.item.title),1)])],2))}}),Hl={class:"w-44 cursor-pointer"},zl={class:"flex-1 font-bold text-gray-500"},Kl=W({__name:"SettingPaneGroup",props:{modelValue:{type:String,default:void 0},group:{type:Object,required:!0}},emits:["click-item"],setup(s,{emit:b}){const o=R(!0),r=b;return(n,w)=>{const l=z("font-awesome-icon");return d(),D("li",Hl,[v("div",{class:"flex items-center my-1.5",onClick:w[0]||(w[0]=()=>o.value=!e(o))},[v("div",zl,[Ve(n.$slots,"group",{item:s.group},()=>[H(T(s.group.title),1)])]),t(l,{icon:"angle-down",class:ve(["text-xs text-gray-400 p-2 transition-all ease-in-out duration-200",{"rotate-180":e(o)}])},null,8,["class"])]),v("ul",{class:ve(["transition-all ease-in-out duration-250 overflow-hidden",{"max-h-0":!e(o),"max-h-96":e(o)}])},[(d(!0),D(J,null,te(s.group.items,i=>(d(),P(Tt,{key:i.value,item:i,"is-active":i.value===s.modelValue,onClick:g=>r("click-item",i.value)},{default:a(g=>[Ve(n.$slots,"default",Re({ref_for:!0},g))]),_:2},1032,["item","is-active","onClick"]))),128))],2)])}}}),Jl={key:0},Yl=W({__name:"SettingsPanes",props:{modelValue:{type:String,default:void 0},items:{type:Array,required:!0},isDropdown:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:b}){const o=s,r=b,n=k(()=>{for(const i of o.items){if(l(i))return i;if(i.items.length>0)return i.items[0]}});o.modelValue||n.value&&r("update:modelValue",n.value.value);function w(i){return"items"in i}function l(i){return!w(i)}return(i,g)=>{const p=he,f=ta,y=be;return s.isDropdown?(d(),P(y,{key:1,"model-value":s.modelValue,style:{width:"100%"},"onUpdate:modelValue":g[1]||(g[1]=u=>r("update:modelValue",u))},{default:a(()=>[(d(!0),D(J,null,te(s.items,u=>(d(),D(J,{key:u.value},[w(u)?(d(),P(f,{key:0,label:u.title},{default:a(()=>[(d(!0),D(J,null,te(u.items,_=>(d(),P(p,{key:_.value,label:_.title,value:_.value},null,8,["label","value"]))),128))]),_:2},1032,["label"])):(d(),P(p,{key:1,label:u.title,value:u.value},null,8,["label","value"]))],64))),128))]),_:1},8,["model-value"])):(d(),D("ul",Jl,[(d(!0),D(J,null,te(s.items,u=>(d(),D(J,{key:u.value},[w(u)?(d(),P(Kl,{key:0,"model-value":s.modelValue,group:u,onClickItem:g[0]||(g[0]=_=>r("update:modelValue",_))},{group:a(()=>[Ve(i.$slots,"group",{item:u})]),default:a(_=>[Ve(i.$slots,"default",Re({ref_for:!0},_))]),_:2},1032,["model-value","group"])):(d(),P(Tt,{key:1,item:u,"is-active":s.modelValue===u.value,onClick:_=>r("update:modelValue",u.value)},{default:a(_=>[Ve(i.$slots,"default",Re({ref_for:!0},_))]),_:2},1032,["item","is-active","onClick"]))],64))),128))]))}}}),Ql=()=>we(),Xl={class:"flex flex-col lg:flex-row gap-2"},Zl={class:"flex-1 overflow-hidden bg-white rounded p-4 shadow"},es={key:18,class:"flex mt-4 justify-end gap-2"},ks=W({__name:"ArtesaSettings",props:{modelValue:{type:String,default:"users"},companyId:{type:Number,required:!0}},emits:["update:modelValue","canceled","saved"],setup(s,{emit:b}){const o=s,r=b,{t:n}=ae(),w=Pe().createScope(),l=k(()=>({users:{title:n("settings.groups.users-group"),name:"users-group"},assignment:{title:n("settings.groups.assignment-group"),name:"assignment-group"},timeTracking:{title:n("settings.groups.timeTracking-group"),name:"timeTracking-group"},stripe:{title:n("settings.groups.stripe"),name:"stripe"},misc:{title:n("settings.groups.misc-group"),name:"misc-group"}})),i={};function g(q){return i[q]||(i[q]=Ra(q,o.companyId)),i[q].value}const p=w.useGet({id:k(()=>o.companyId)}),f=k(()=>{function q(G){return _("view",G)&&!g(G)}function M(G,de,qe,Qe,Ut,Dt){const Fe=q(qe)&&(Dt??!0);return{title:de,name:G,isActive:Fe,group:Ut,shown:Fe&&u.value.includes(G),show:Fe&&L.value===G,ref:Qe,hasChanges:!!Qe.value?.hasChanges}}return{users:M("users",n("settings.tab.users"),"ViewSettings.Users",S,l.value.users),roles:M("roles",n("settings.tab.roles"),"ViewSettings.Roles",U,l.value.users),capabilities:M("capabilities",n("user-capabilities.name",2),"ViewSettings.Capabilities",E,l.value.users),gangs:M("gangs",n("settings.tab.gangs"),"ViewSettings.Gangs",O,l.value.users),assignmentTypes:M("assignment-types",n("settings.tab.assignmentTypes"),"ViewSettings.AssignmentTypes",c,l.value.assignment),assignmentTagTypes:M("assignment-tag-types",n("settings.tab.assignmentCategories"),"ViewSettings.AssignmentTagTypes",V,l.value.assignment),assignmentEvents:M("assignment-events",n("settings.tab.assignmentEvents"),"ViewSettings.AssignmentEventTypes",A,l.value.assignment),assignmentStatusTypes:M("assignment-status-types",n("assignmentStatusTypes.tab"),"ViewSettings.AssignmentStatusTypes",pe,l.value.assignment),workPeriods:M("work-periods",n("settings.tab.workPeriods"),"ViewSettings.AssignmentEventWorkPeriods",$,l.value.timeTracking),userAbsenceTypes:M("user-absence-types",n("userAbsence.absence",2),"ViewSettings.UserAbsenceTypes",j,l.value.timeTracking),timeSheets:M("time-sheets",n("settings.tab.timeSheets"),"ViewSettings.TimeSheets",C,l.value.timeTracking),uploadCategories:M("upload-categories",n("settings.tab.uploadCategories"),"ViewSettings.UploadCategories",X,l.value.misc),manufacturing:M("manufacturing",n("settings.tab.manufacturing"),"ViewSettings.Manufacturing",I,l.value.misc),customViews:M("custom-views",n("settings.tab.customViews"),"ViewSettings.CustomViews",h,l.value.misc),holidays:M("holidays",n("holidays.name",2),"ViewSettings.Holidays",x,l.value.misc),company:M("company",n("settings.tab.company"),"ViewSettings.Company",m,l.value.misc),stripeSubscriptions:M("stripeSubscriptions",n("settings.tab.stripeSubscriptions"),"ViewSettings.StripeSubscriptions",Q,l.value.stripe,!!(p.data.value?.stripeCustomer??!1)),superadmin:M("superadmin","SuperAdmin","ViewSettings.SuperAdmin",F,l.value.misc)}}),y=k(()=>{const q=[];for(const M in f.value){const G=f.value[M];if(!G.isActive)continue;const de=q.find(qe=>qe.value===G.group.name);de?de.items.push({title:G.title,value:G.name,hasChanges:G.hasChanges}):q.push({title:G.group.title,value:G.group.name,items:[{title:G.title,value:G.name,hasChanges:G.hasChanges}]})}return q}),u=R([]),{can:_}=Ql(),A=R(),V=R(),c=R(),m=R(),h=R(),I=R(),U=R(),j=R(),S=R(),$=R(),E=R(),O=R(),x=R(),F=R(),C=R(),X=R(),pe=R(),Q=R(),Y={refAssignmentEventTypes:A,refAssignmentTagTypes:V,refAssignmentTypes:c,refCompany:m,refCustomViews:h,refManufacturing:I,refRoles:U,refUserAbsenceTypes:j,refUsers:S,refWorkPeriods:$,refCapabilities:E,refGangs:O,refHolidays:x,refSuperAdmin:F,refTimeSheets:C,refAssignmentStatusTypes:pe,refUploadCategories:X,refStripeSubscriptions:Q},L=Ge(o,"modelValue",r);ge(L,q=>{q&&!u.value.includes(q)&&u.value.push(q)},{immediate:!0});const le=ze();Le(()=>o.modelValue==="holidays",()=>{x.value?.rerender()});function ue(){for(const q in Y){const M=Y[q];M.value&&"cancel"in M.value&&typeof M.value.cancel=="function"&&M.value.cancel()}Ce({title:n("settings.events.canceled"),type:"info"}),r("canceled")}const ye=R(!1);async function Ie(){const q=[];ye.value=!0;for(const M in Y){const G=Y[M];G.value&&"save"in G.value&&typeof G.value.save=="function"&&q.push(G.value.save())}try{await Promise.all(q),Ce({title:n("settings.events.saved"),type:"success"}),r("saved")}catch{Ce({title:n("settings.events.notSaved"),message:n("settings.events.notSavedMessage"),type:"error"})}finally{ye.value=!1}}aa(async()=>fe.value?!!await rt.confirm(n("discardReminder"),n("warning"),{confirmButtonText:n("Yes"),cancelButtonText:n("actions.Cancel"),type:"warning",confirmButtonClass:"el-button--warning"}).then(()=>Promise.resolve(!0)).catch(()=>Promise.resolve(!1)):!0);const fe=k(()=>{for(const q in Y)if(Y[q].value?.hasChanges)return!0;return!1});return(q,M)=>{const G=ne;return d(),D("div",Xl,[v("div",null,[t(Yl,{modelValue:e(L),"onUpdate:modelValue":M[0]||(M[0]=de=>K(L)?L.value=de:null),items:e(y),"is-dropdown":e(le).maxLg},{default:a(({item:de})=>[H(T(de.title),1)]),_:1},8,["modelValue","items","is-dropdown"])]),v("div",Zl,[e(f).users.shown?Z((d(),P(In,{key:0,ref_key:"refUsers",ref:S,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).users.show]]):N("",!0),e(f).roles.shown?Z((d(),P(ao,{key:1,ref_key:"refRoles",ref:U,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).roles.show]]):N("",!0),e(f).capabilities.shown?Z((d(),P(gl,{key:2,ref_key:"refCapabilities",ref:E,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).capabilities.show]]):N("",!0),e(f).gangs.shown?Z((d(),P(Rn,{key:3,ref_key:"refGangs",ref:O,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).gangs.show]]):N("",!0),e(f).assignmentTypes.shown?Z((d(),P(gn,{key:4,ref_key:"refAssignmentTypes",ref:c,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).assignmentTypes.show]]):N("",!0),e(f).assignmentTagTypes.shown?Z((d(),P(vn,{key:5,ref_key:"refAssignmentTagTypes",ref:V,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).assignmentTagTypes.show]]):N("",!0),e(f).assignmentEvents.shown?Z((d(),P(fn,{key:6,ref_key:"refAssignmentEventTypes",ref:A,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).assignmentEvents.show]]):N("",!0),e(f).assignmentStatusTypes.shown?Z((d(),P(yn,{key:7,ref_key:"refAssignmentStatusTypes",ref:pe,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).assignmentStatusTypes.show]]):N("",!0),e(f).workPeriods.shown?Z((d(),P(El,{key:8,ref_key:"refWorkPeriods",ref:$,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).workPeriods.show]]):N("",!0),e(f).userAbsenceTypes.shown?Z((d(),P(al,{key:9,ref_key:"refUserAbsenceTypes",ref:j,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).userAbsenceTypes.show]]):N("",!0),e(f).timeSheets.shown?Z((d(),P(Xo,{key:10,ref_key:"refTimeSheets",ref:C,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).timeSheets.show]]):N("",!0),e(f).holidays.shown?Z((d(),P(Jn,{key:11,ref_key:"refHolidays",ref:x,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).holidays.show]]):N("",!0),e(f).customViews.shown?Z((d(),P(Sn,{key:12,ref_key:"refCustomViews",ref:h,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).customViews.show]]):N("",!0),e(f).manufacturing.shown?Z((d(),P(Xn,{key:13,ref_key:"refManufacturing",ref:I,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).manufacturing.show]]):N("",!0),e(f).company.shown?Z((d(),P(hn,{key:14,ref_key:"refCompany",ref:m,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).company.show]]):N("",!0),e(f).uploadCategories.shown?Z((d(),P(Ml,{key:15,ref_key:"refUploadCategories",ref:X,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).uploadCategories.show]]):N("",!0),e(f).stripeSubscriptions.shown?Z((d(),P(Wl,{key:16,ref_key:"refStripeSubscriptions",ref:Q,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).stripeSubscriptions.show]]):N("",!0),e(f).superadmin.shown?Z((d(),P(uo,{key:17,ref_key:"refSuperAdmin",ref:F,"company-id":s.companyId},null,8,["company-id"])),[[oe,e(f).superadmin.show]]):N("",!0),e(fe)?(d(),D("div",es,[t(G,{text:!e(fe),plain:"",type:e(fe)?"warning":void 0,onClick:ue},{default:a(()=>[H(T(q.$t("actions.Cancel")),1)]),_:1},8,["text","type"]),t(G,{loading:e(ye),type:"primary",onClick:Ie},{default:a(()=>[H(T(q.$t("actions.Save")),1)]),_:1},8,["loading"])])):N("",!0)])])}}});export{ks as _};
