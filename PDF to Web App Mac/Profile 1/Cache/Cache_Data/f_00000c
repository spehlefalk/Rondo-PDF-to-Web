import{a as W,r as O,fL as Ke,Y as I,X as Ot,o as r,e as y,f as o,g as v,aA as $e,e2 as Bt,c as e,fj as jt,eC as Nt,_ as he,fM as Ft,w as nt,U as fe,b as ee,h as n,az as U,e1 as _e,ah as Z,j as $,l as ue,eG as Be,eH as je,i as x,t as p,eI as Ne,u as oe,ez as Ue,eA as Ie,fr as st,en as ce,fC as Fe,fv as Rt,fw as Re,fN as Mt,V as ot,aN as lt,aB as Y,ff as Gt,W as Le,aZ as zt,b2 as qt,aY as Ht,fO as Wt,k as ne,fP as Kt,fQ as Lt,e7 as Yt,e5 as Qt,eo as we,ep as ke,m as rt,eT as Xt,b0 as Jt,ae as Zt,fJ as dt,fR as it,fS as ut,fT as mt,a3 as ea,ag as ta,aL as aa,fs as na,f3 as sa}from"./vendor-DP6O45ke.js";import{_ as oa,D as Ye}from"./DropdownAssignmentEventGroupType.vue_vue_type_script_setup_true_lang-BNpFLTY8.js";import{u as ct}from"./useCompanySettingValue-VN6qEXyo.js";import{R as pt,a9 as la,aa as ra,ab as da,S as vt,ac as ia,M as ua,F as Ee,t as ma,ad as ca,a7 as pa,A as be,a as Me,z as xe,a2 as va,N as fa,d as Ce,Q as ft,K as ya,i as ga,ae as Qe,n as Ge,X as ba,D as ve,W as ha,af as yt}from"./index-Dsay-W0g.js";import{c as wa,u as ka,r as ye,a as Pe,b as ge}from"./assignment-events.helpers-CWYDlrj6.js";import{_ as gt}from"./DropdownAssignmentEventType.vue_vue_type_script_setup_true_lang-C9gQHB2j.js";import{u as Va}from"./hasItemsForCompany.store-B-Xh4q3W.js";import{_ as Aa,u as Da,a as Sa}from"./AddressMap.vue_vue_type_script_setup_true_lang-CdLWc4NG.js";import{_ as Te,s as Xe}from"./ArtesaTimeInput.vue_vue_type_style_index_0_lang-LvzB_Px3.js";import{a as Je}from"./index-Cih2BPF-.js";import{_ as Se}from"./ArtesaDatePicker.vue_vue_type_style_index_0_lang-DcLt-5Pt.js";import{_ as Ea}from"./AssignmentEventName.vue_vue_type_script_setup_true_lang-DS0TEwVk.js";import{_ as bt}from"./PopperFeathersItems.vue_vue_type_script_setup_true_lang-Dj8XPvGz.js";import{_ as $a}from"./ArtesaProfilePicture.vue_vue_type_script_setup_true_lang-NQqm-LCY.js";import{u as _a}from"./user-capabilities.store-B-DXkmw8.js";import{u as Ca,b as Ua}from"./arrayById-BY_S6K77.js";import{a as Ia,o as xa}from"./MakeSortable.vue_vue_type_script_setup_true_lang-7zyUd0na.js";import{u as ht}from"./useContainerQuery-B2PH6oRc.js";import{a as Pa}from"./index-DqnrlXPQ.js";import{_ as Ta}from"./SelectProject.vue_vue_type_script_setup_true_lang-D0AdlxPF.js";import{_ as Oa}from"./SelectUser.vue_vue_type_script_setup_true_lang-ecQ9vvXJ.js";import{_ as Ba}from"./SelectAssignmentType.vue_vue_type_script_setup_true_lang-BGPxGenl.js";import{_ as Ze}from"./AssignmentStatusTag.vue_vue_type_script_setup_true_lang-RumqvLqr.js";import{_ as ja}from"./FeathersTablePagination.vue_vue_type_style_index_0_lang-BOkRBl1g.js";import{_ as Na}from"./AddressForm.vue_vue_type_script_setup_true_lang-BIeTh7fv.js";const Fa=W({__name:"StickyContent",props:{tag:{type:String,default:"div"},top:{type:Number,default:0},bottom:{type:Number,default:0}},setup(i){const l=i,s=O(),t=O(),{y:u,bottom:d,height:S}=Ke(s,{windowResize:!0,windowScroll:!0}),{height:V}=Ke(t,{windowResize:!0,windowScroll:!0}),f=I(()=>{const b=u.value;if(b-l.top>0)return 0;let E=-b+l.top;return V.value+l.top+l.bottom>d.value&&(E=S.value-V.value-l.bottom-l.top),E<0?0:E});Ot(f,()=>{A.value.transform=`translateY(${f.value}px)`},{debounce:10,maxWait:20});const A=O({transform:"translateY(0px)"});return(b,E)=>(r(),y(Nt(i.tag),jt({ref_key:"container",ref:s},b.$attrs),{default:o(()=>[v("div",{ref_key:"child",ref:t,class:"transition-transform",style:Bt(e(A))},[$e(b.$slots,"default")],4)]),_:3},16))}});function Ra(i){return pt().createScope().construct({companyId:i.companyId,typeId:i.groupTypeId,order:i.order})}async function Ma(i){const l=la().createScope(),s=ra().createScope(),t=da().createScope(),u=vt().createScope(),{assignment:d,user:S,standardProcess:V}=i,[f]=ct("addressId"),[A,b,E]=await Promise.all([l.find({query:{companyId:d.companyId,standardProcessId:V.id,$limit:100,$sort:{order:1,id:1}}}).then(h=>h.data),s.find({query:{companyId:d.companyId,standardProcessId:V.id,$limit:100,$sort:{order:1,id:1}},$populateParams:{name:"withTypes"}}).then(h=>h.data),t.find({query:{companyId:d.companyId,standardProcessId:V.id,$limit:500}}).then(h=>h.data)]),D=await Promise.all(A.map(async h=>{const C=Ra(h);return C.assignment=d,C.order=(C.order??0)+i.startOrder,await he(),{group:C,groupSetting:h}}));return{events:await Promise.all(b.map(h=>{const C=wa(h);C.order=(C.order??0)+i.startOrder;const B=h.groupId&&D.find(c=>c.groupSetting.uuid===h.groupUuid);B&&(C.group=B.group),C.assignment=d,C.manPower=h.workDays*h.workingTimePerDay*h.employeeCount,h.isOutward?(C.durationDriveFromStart=null,C.durationDriveReturnTo=null,C.addressDestination=d.addressProperty,C.addressStartFromId=f.value,C.addressReturnToId=f.value):(C.durationDriveFromStart=0,C.durationDriveReturnTo=0);const T=E.filter(c=>c.eventUuid===h.uuid);for(const c of T)u.construct({name:c.name,order:c.order,event:C,assignment:C.assignment,company:C.company,createdBy:S});return C})),groups:D.map(h=>h.group),eventSettings:b,groupSettings:A}}const Ga=W({__name:"DropdownAssignmentEventStandardProcess",props:{type:{type:String,default:void 0},size:Ft,disabled:{type:Boolean,default:!1},companyId:{type:Number,required:!0},loading:{type:Boolean,default:!1}},emits:["changed"],setup(i,{emit:l}){const s=i,t=l,u=ia().createScope(),d=Va().useHasItems("assignment-event-standard-processes"),S=I(()=>({query:{companyId:s.companyId,$sort:{order:1},$limit:100}})),{data:V,fetch:f}=u.useFind({params:S,localOnly:!0});function A(){f(),E.value=!1}const b=O(!1),E=O(!0);return nt(()=>b.value&&E.value,()=>{A()}),fe(S,()=>{if(!b.value){E.value=!0;return}A()}),(D,g)=>{const h=ee("font-awesome-icon"),C=ue,B=Ne,T=Be,c=je;return e(d)?(r(),y(c,{key:0,onCommand:g[0]||(g[0]=j=>t("changed",j)),onVisibleChange:g[1]||(g[1]=j=>b.value=j)},{dropdown:o(()=>[n(T,null,{default:o(()=>[(r(!0),U(Z,null,_e(e(V),j=>(r(),y(B,{key:j.uuid,command:j},{default:o(()=>[x(p(j.name),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:o(()=>[n(C,{size:i.size,disabled:i.disabled,loading:i.loading,type:i.type},{default:o(()=>[$e(D.$slots,"default",{},()=>[n(h,{icon:"plus"})])]),_:3},8,["size","disabled","loading","type"])]),_:3})):$("",!0)}}}),za={class:"@container"},qa={key:0,class:"flex justify-between"},Ha={class:"font-bold"},Wa={class:"ml-1"},Ka={key:1,class:"px-2 pb-2"},La={class:"flex mt-2"},Ya={class:"px-3 pt-2 pb-3 border-gray-300 border-t-2"},Qa={class:"px-2 pb-1 text-sm"},Xa=W({__name:"EditAssignmentEventGroup",props:{assignment:{type:Object,required:!0},group:{type:[Object],required:!0},events:{type:Array,required:!0},expandByDefault:{type:Boolean,default:!1},hideNotes:{type:Boolean,default:!1}},emits:["add-event","remove-group"],setup(i,{emit:l}){const{t:s}=oe(),t=i,u=I(()=>({query:{defaultGroupTypeId:{$in:[null,t.group.typeId]}}})),d=l,S=O(!t.expandByDefault),V=O(!S.value);function f(){S.value=!S.value,!V.value&&!S.value&&(V.value=!0)}const A=I(()=>t.events.length?Fe(t.events,"order")?.order||0:t.group.order||0);function b(g){d("add-event",g,{group:t.group,order:A.value+.5})}const E=O(!1);async function D(){if(t.group)try{const g=t.group?.type?.name?`"${t.group.type?.name}"`:"";await st.confirm(t.events.length?s("assignmentEventGroup.form.doYouWantToDeleteTheGroupAndEvents",{name:g}):s("assignmentEventGroup.form.doYouWantToDeleteTheGroup",{name:g}),"",{confirmButtonText:s("actions.Delete"),cancelButtonText:s("actions.Cancel"),type:"warning",confirmButtonClass:"el-button--danger"}),d("remove-group",t.group,t.events)}catch{}}return(g,h)=>{const C=ee("font-awesome-icon"),B=ue,T=ce;return Ue((r(),U("div",za,[i.group?(r(),U("div",qa,[n(B,{class:"flex-1 flex !justify-start !pl-2 pr-4 py-3 text-left drag-handle",text:"",onClick:f},{default:o(()=>[n(C,{icon:"angle-right",rotation:e(S)?void 0:"90",class:"mr-2 transition-all","fixed-width":""},null,8,["rotation"]),v("span",Ha,[i.group?(r(),U(Z,{key:0},[x(p(i.group.type&&i.group.type.name),1)],64)):$("",!0)]),v("span",Wa,"("+p(i.events.length)+")",1)]),_:1}),n(B,{text:"",class:"px-4 py-2.5",onClick:D},{default:o(()=>[n(C,{icon:"times"})]),_:1})])):$("",!0),e(V)?Ue((r(),U("div",Ka,[$e(g.$slots,"default"),v("div",La,[n(gt,{trigger:"click",type:"primary",params:e(u),"company-id":i.assignment.companyId,"onUpdate:modelValue":b},{default:o(()=>[x(p(e(s)("assignmentEvent.name",1))+" ",1),n(C,{icon:"plus",class:"ml-1 text-xs"})]),_:1},8,["params","company-id"])])],512)),[[Ie,!e(S)]]):$("",!0),Ue(v("div",Ya,[v("div",Qa,p(e(s)("assignmentEventGroup.form.annotationsForGroup",{name:i.group.type?.name}))+": ",1),n(T,{modelValue:i.group.note,"onUpdate:modelValue":h[0]||(h[0]=c=>i.group.note=c),rows:i.group.note?2:1,type:"textarea",placeholder:e(s)("assignmentEventGroup.form.annotationPlaceholder")},null,8,["modelValue","rows","placeholder"])],512),[[Ie,!e(S)&&!i.hideNotes]])],512)),[[Ie,!e(E)]])}}}),Ja=W({__name:"ElTextareaAutosize",props:Rt({placeholder:{default:""},disabled:{type:Boolean,default:!1},size:{default:void 0},readonly:{type:Boolean,default:!1}},{modelValue:{default:void 0},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const l=Re(i,"modelValue"),s=O(),t=I(()=>{const u=s.value?.$el;if(u)return u.querySelector("textarea")});return Mt({element:t,input:l}),(u,d)=>(r(),y(e(ce),{ref_key:"refInput",ref:s,modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=S=>l.value=S),placeholder:u.placeholder,type:"textarea",resize:"none",disabled:u.disabled,size:u.size,readonly:u.readonly},null,8,["modelValue","placeholder","disabled","size","readonly"]))}}),wt=i=>{const l=ot(i.event),s=ua().createScope(),{data:t,markForRemove:u}=s.useFeathersItems({localOnly:i.localOnly,params:I(()=>({query:{eventUuid:l.value.uuid,$sort:{order:1}}})),fetchParams:I(()=>l.value.id?{query:{eventId:l.value.id,$sort:{order:1},$limit:-1}}:null)}),d=I(()=>Fe(t.value,"order")?.order||0);function S(E){if(!t.value.some(D=>D.userUuid===E.uuid&&D.eventUuid===l.value.uuid))return s.construct({companyId:l.value.companyId,user:E,event:l.value,order:d.value+1})}function V(E){return E.map(S).filter(Ee)}function f(E){u(E)}function A(E){const D=t.value.find(g=>g.userUuid===E.uuid&&g.eventUuid===l.value.uuid);if(D)return f(D),D}function b(E){return E.map(A).filter(Ee)}return{eventUsers:t,addUser:S,addUsers:V,removeUser:A,removeUsers:b,removeEventUser:f}},Za={class:"flex flex-wrap items-center"},en=["onClick"],et=W({__name:"ChangeEventUsers",props:{event:{type:Object,required:!0},readonly:{type:Boolean,default:!1}},emits:["add-user","remove-user"],setup(i,{emit:l}){const s=O(),t=_a(),u=i,d=l,S=ma().createScope(),{useUsersForAssignmentEventTypes:V}=t,{users:f}=V({eventTypeIds:()=>[u.event.typeId]}),{eventUsers:A,addUser:b,removeEventUser:E}=wt({event:()=>u.event,localOnly:!0}),D=I(()=>{const c={query:{id:{$nin:C.value},deactivatedAt:null,$limit:20,$sort:{fullName:1}}};return s.value&&!s.value.searchValue&&f.value.length&&(c.query.id.$in=f.value.map(j=>j.id)),c}),g=I(()=>{const c={query:{deactivatedAt:null,$limit:20,$sort:{fullName:1}}};return s.value&&!s.value.searchValue&&f.value.length&&(c.query.id={$in:f.value.map(j=>j.id)}),c}),h=I(()=>A.value.map(c=>c.user).filter(Ee)),C=I(()=>h.value.map(c=>c?.id));function B(c){b(c)&&d("add-user",{user:c,eventUsers:A.value})}function T(c){E(c),c.user&&d("remove-user",{user:c.user,eventUsers:A.value})}return(c,j)=>{const X=ee("font-awesome-icon"),te=ue;return r(),U("div",null,[v("div",Za,[(r(!0),U(Z,null,_e(e(A),N=>(r(),U(Z,{key:N.uuid},[N.user?(r(),y($a,{key:0,user:N.user,size:"small",class:"group relative !overflow-visible my-1 mr-1"},{default:o(()=>[i.readonly?$("",!0):(r(),U("div",{key:0,class:"hidden group-hover:flex absolute w-4 h-4 bg-red-700 rounded-full -right-1.5 -top-1.5 items-center justify-center cursor-pointer text-white",onClick:()=>!i.readonly&&T(N)},[n(e(lt),{class:"w-3 h-3"})],8,en))]),_:2},1032,["user"])):$("",!0)],64))),128)),n(bt,{ref_key:"refPopper",ref:s,store:e(S),params:e(D),"fetch-params":e(g),readonly:i.readonly,triggers:[],"search-field":"fullName","use-search":"","prepend-search":"","append-search":"","use-search-on-server":"","onUpdate:modelValue":B},{default:o(({toggle:N})=>[i.readonly?$("",!0):(r(),y(te,{key:0,circle:"",type:"primary",class:"!w-[30px] !h-[30px] my-1 mr-1",onClick:()=>N()},{default:o(()=>[n(X,{icon:"user-plus",class:"ml-0.5 text-xs"})]),_:2},1032,["onClick"]))]),item:o(({item:N})=>[x(p(N.fullName),1)]),_:1},8,["store","params","fetch-params","readonly"])])])}}}),tn={class:"flex flex-wrap items-center gap-2"},an={class:"group relative p-1"},nn=["onClick"],sn=["onClick"],on={class:"text-sm leading-tight"},ln={class:"text-xs text-gray-500 leading-tight truncate"},rn=W({__name:"ChangeGangEvent",props:{event:{type:Object,required:!0},local:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},emits:["added","removed"],setup(i,{emit:l}){const s=i,t=l,u=O(),{t:d}=oe(),S=ca().createScope(),V=pa().createScope(),{data:f,markForRemove:A}=V.useFeathersItems({params:I(()=>({query:{eventUuid:s.event.uuid,$sort:{order:1}}})),fetchParams:I(()=>s.event.id?{query:{eventId:s.event.id,$sort:{order:1},$limit:-1}}:null),localOnly:s.local}),{usersByGangUuid:b}=Ca(),E=I(()=>f.value.map(c=>c.gang).filter(Ee)),D=I(()=>E.value.map(c=>c.id)),g=I(()=>({query:{id:{$nin:D.value},deactivatedAt:null,$limit:20,$sort:{order:1}}})),h=I(()=>({query:{deactivatedAt:null,$limit:20,$sort:{order:1}}})),C=I(()=>Fe(f.value,"order")?.order??0);async function B(c){V.construct({companyId:c.companyId,gang:c,event:s.event,order:C.value+1}),await he(),t("added",{gang:c,gangEvents:f.value,users:b.value[c.uuid]??[]})}async function T(c){A(c),await he(),t("removed",{gangEvent:c,gangEvents:f.value,users:b.value[c.gangUuid]??[]})}return(c,j)=>{const X=ee("font-awesome-icon"),te=ue;return r(),U("div",tn,[(r(!0),U(Z,null,_e(e(f),N=>(r(),y(be,{key:N.uuid,disabled:!e(b)[N.gangUuid]?.length,content:(e(b)[N.gangUuid]??[]).map(se=>se.shortName||se.fullName).join(", ")},{default:o(()=>[v("div",an,[i.readonly?$("",!0):(r(),U("div",{key:0,class:"hidden group-hover:flex absolute w-4 h-4 bg-red-700 rounded-full -right-1.5 -top-1.5 items-center justify-center cursor-pointer text-white",onClick:()=>!i.readonly&&T(N)},[n(e(lt),{class:"w-3 h-3"})],8,nn)),x(" "+p(N.gang?.name),1)])]),_:2},1032,["disabled","content"]))),128)),n(bt,{ref_key:"refPopper",ref:u,store:e(S),params:e(g),"fetch-params":e(h),readonly:i.readonly,"search-field":"name","use-search":"","prepend-search":"","append-search":"","use-search-on-server":"","hide-on-select":"","onUpdate:modelValue":B},{default:o(({show:N})=>[e(f).length?$("",!0):(r(),U("span",{key:0,class:"mr-1 text-gray-500 cursor-pointer",onClick:()=>N()},p(e(d)("gang-events.add")),9,sn)),n(te,{circle:"",type:"primary",class:"!w-[30px] !h-[30px] my-1 mr-1",onClick:()=>N()},{default:o(()=>[n(X,{icon:"users",class:"ml-0.5 w-4 h-4"})]),_:2},1032,["onClick"])]),item:o(({item:N})=>[v("div",on,p(N.name),1),v("div",ln,p((e(b)[N.uuid]??[]).map(se=>se.shortName||se.fullName).join(", ")),1)]),_:1},8,["store","params","fetch-params","readonly"])])}}}),dn=W({__name:"AssignmentEventStatusTag",props:{value:{type:Object,required:!0},readOnly:{type:Boolean,default:!1}},setup(i){const{t:l}=oe(),s=i,t=Me(),u=O(!1),d=I(()=>s.value.completedAt?l("assignmentEventStatus.done"):s.value.confirmedAt?l("assignmentEventStatus.planned"):l("assignmentEventStatus.draft")),S=I(()=>s.value.completedAt?"success":s.value.confirmedAt?"info":"warning"),V=I(()=>{if(s.value.completedAt)return l("assignmentEventStatus.tooltip.completedAt",{date:xe(s.value.completedAt??new Date)});if(s.value.startsAt){const b=va(s.value.startsAt,s.value.endsAt,{isAllDay:s.value.isAllDay});return l("assignmentEventStatus.tooltip.startsAt",{date:b})}else return s.value.confirmedAt?l("assignmentEventStatus.tooltip.confirmedAt",{date:xe(s.value.confirmedAt??new Date)}):s.value.createdAt?l("assignmentEventStatus.tooltip.createdAt",{date:xe(s.value.createdAt)}):""}),f=I(()=>!V.value);function A(b){b==="new"?(s.value.confirmedAt=null,s.value.confirmedById=null,s.value.completedAt=null,s.value.completedById=null):b==="confirmed"?(s.value.confirmedAt||(s.value.confirmedAt=new Date,s.value.confirmedById=t.value?.id??null),s.value.completedAt=null,s.value.completedById=null):b==="completed"&&(s.value.confirmedAt||(s.value.confirmedAt=new Date,s.value.confirmedById=t.value?.id??null),s.value.completedAt||(s.value.completedAt=new Date,s.value.completedById=t.value?.id??null))}return(b,E)=>{const D=ee("font-awesome-icon"),g=Gt,h=ee("ArtesaTooltip"),C=Ne,B=Be,T=je;return r(),y(T,{trigger:"click",disabled:i.readOnly,onCommand:A,onVisibleChange:E[0]||(E[0]=c=>u.value=c)},{dropdown:o(()=>[i.readOnly?$("",!0):(r(),y(B,{key:0},{default:o(()=>[n(C,{disabled:e(d)==="Entwurf",command:"new"},{default:o(()=>[x(p(b.$t("timeSheets.draft")),1)]),_:1},8,["disabled"]),n(C,{disabled:e(d)==="geplant",command:"confirmed"},{default:o(()=>[x(p(b.$t("assignmentEventStatus.planned")),1)]),_:1},8,["disabled"]),n(C,{disabled:e(d)==="fertig",command:"completed"},{default:o(()=>[x(p(b.$t("assignmentEventStatus.done")),1)]),_:1},8,["disabled"])]),_:1}))]),default:o(()=>[v("div",null,[n(h,{effect:"dark",disabled:e(f)||e(u),content:e(V),placement:"top"},{default:o(()=>[n(g,{type:e(S),size:"default",effect:"dark",class:Y([i.readOnly?"cursor-auto":"cursor-pointer"])},{default:o(()=>[x(p(e(d))+" ",1),i.readOnly?$("",!0):(r(),y(D,{key:0,icon:"angle-down",class:"text-xs"}))]),_:1},8,["type","class"])]),_:1},8,["disabled","content"])])]),_:1},8,["disabled"])}}}),tt=(i,l)=>I(()=>{const s=Le(i);if(!s)return"";const t=Le(l?.dateToCompare)||new Date,{showAlwaysTime:u=!1}=l||{};let d="";return zt(s,t)?d="HH:mm":qt(s,t)?d=u?"dd.MM. HH:mm":"dd.MM.":d=u?"dd.MM.yy HH:mm":"dd.MM.yy",Ht(s,d)});async function at(i,l){return(await fa.service("maps/durations").find({query:{origin:i,destination:l}}))?.duration||0}const un={class:"flex items-center bg-white mb-1 pr-2 rounded outline outline-2 outline-gray-100"},mn={class:"flex mb-1 items-stretch"},cn={class:"flex-1 flex outline outline-2 outline-gray-100"},pn={class:"flex flex-col items-center bg-white rounded px-1 pb-1"},vn={class:"text-gray-400 text-xs"},fn={class:"flex flex-col items-center ml-1 bg-white rounded px-1 pb-1"},yn={class:"text-gray-400 text-xs"},gn={class:"flex flex-col items-center ml-1 bg-white rounded px-1 pb-1"},bn={class:"text-gray-400 text-xs"},hn={key:0,class:"flex flex-col items-center ml-1 bg-white rounded pb-1"},wn={class:"text-gray-400 text-xs px-1"},kn={key:0},Vn={class:"text-gray-500 text-sm"},An={class:"bg-white rounded p-2 mb-1 outline outline-2 outline-gray-100"},Dn={key:0,class:"flex justify-between items-center mb-2"},Sn={class:"flex items-center"},En={class:"text-gray-500"},$n={key:1,class:"flex items-center mb-2"},_n={class:"flex-1"},Cn={key:0},Un={class:"font-semibold"},In={class:"flex items-center"},xn={class:"flex items-center"},Pn={class:"flex-1"},Tn={class:"flex items-center mb-2"},On={class:"flex items-center"},Bn={key:2,class:"flex items-center mt-2"},jn={class:"flex items-center"},Nn={key:0},Fn={class:"font-semibold"},Rn={class:"text-gray-500 text-sm"},Mn={class:"bg-white rounded p-2 mb-1 outline outline-2 outline-gray-100"},Gn={class:"flex items-center bg-white rounded p-2 mb-1 outline outline-2 outline-gray-100"},zn={class:"text-gray-500 mr-1 text-sm"},qn={class:"flex-1"},Hn={class:"flex"},Wn={class:"text-gray-500"},Kn={key:0,class:"flex text-right"},Ln={class:"w-20 text-right mr-1"},Yn={class:"text-gray-500"},Qn={key:1,class:"flex"},Xn={class:"w-20 text-right mr-1"},Jn={class:"text-gray-500"},Zn={class:"flex gap-1"},es={class:"w-0 flex-1 flex flex-col"},ts={class:"text-gray-500 text-sm"},as={class:"flex-1 bg-white rounded p-2 mb-1 outline outline-2 outline-gray-100"},ns={class:"w-0 flex-1 flex flex-col"},ss={class:"text-gray-500 text-sm"},os={class:"flex-1 bg-white rounded p-2 mb-1 outline outline-2 outline-gray-100"},ls={class:"text-xs text-gray-500 italic"},rs={class:"text-sm"},ds={class:"bg-white rounded mb-1 outline outline-2 outline-gray-100"},is={class:"text-sm"},us={class:"flex justify-center"},ms={class:"flex justify-between mt-2"},cs=v("div",null,null,-1),ps={key:1,class:"flex-1 flex items-center justify-center text-gray-500"},vs={class:"flex justify-end"},Oe=W({__name:"AssignmentEventForm",props:{event:{},tasks:{},size:{default:void 0},draggable:{type:Boolean,default:!1},short:{type:Boolean,default:!1},expandable:{type:Boolean,default:!1},expandByDefault:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},emits:["click-title","remove","remove-task"],setup(i,{expose:l,emit:s}){const t=i,u=Ce(),{t:d}=oe(),S=Ua(),V=O(t.short&&!t.expandByDefault);fe(()=>t.expandable,a=>{a||(V.value=!0)});const f=s,A=Wt(),b=I({get(){return parseFloat((t.event.manPower/3600).toFixed(2))},set(a){const m=a*3600;if(m===t.event.manPower)return;t.event.manPower=m;let k;!j.value||!le.value?k=1:k=Math.ceil(m/j.value/le.value),C.value=Math.max(k,1)}}),E=I(()=>{const m=(t.event.manPowerDrive||0)/3600;return parseFloat(m.toFixed(2))}),D=I(()=>{const m=((t.event.manPower||0)+(t.event.manPowerDrive||0))/3600;return parseFloat(m.toFixed(2))});async function g(a){if(!T.value){t.event.startsAt=a;return}if(!(!t.event.startsAt&&!a)){if(!a){t.event.startsAt=null,t.event.endsAt=null,t.event.days=null;return}await ye(t.event,{direction:"forward",date:a,mutateEvent:!0})}}async function h(a){if(T.value){t.event.endsAt=a;return}if(!(!t.event.endsAt&&!a)){if(!a){t.event.startsAt=null,t.event.endsAt=null,t.event.days=null;return}await ye(t.event,{direction:"backward",date:a,mutateEvent:!0})}}const C=I({get(){return t.event.workDays},async set(a){if(a!==t.event.workDays&&(t.event.workDays=a,Pe(t.event),ge(t.event),C.value<=1&&(de.value=null),t.event.startsAt&&t.event.endsAt)){const{startsAt:m,endsAt:k}=t.event;await ye(t.event,{direction:c.value,date:c.value==="forward"?m:k,mutateEvent:!0})}}});I(()=>{if(t.event.startsAt)return Jt(t.event.startsAt)});const B=I({get(){return t.event.isAllDay},async set(a){if(t.event.isAllDay=a,a)t.event.startsAt&&(t.event.startsAt=Xe(t.event.startsAt,{hours:0,minutes:0,seconds:0})),t.event.endsAt&&(t.event.endsAt=Xe(t.event.endsAt,{hours:23,minutes:59,seconds:59}));else{if(t.event.startsAt&&t.event.startsAtDefaultTime){const pe=t.event.startsAtDefaultTime.split(":");if([2,3].includes(pe.length)){const ie=parseInt(pe[0]),G=parseInt(pe[1]);(ie>=0||ie<=23||G>=0||G<=59)&&(ie.toString().padStart(2,"0"),G.toString().padStart(2,"0"),t.event.startsAt.setHours(ie,G))}}const{startsAt:m,endsAt:k}=t.event;!B.value&&(c.value==="forward"&&m||c.value==="backward"&&k)&&await ye(t.event,{direction:c.value,date:c.value==="forward"?m:k,mutateEvent:!0})}}}),T=I({get(){return t.event.dateAnchor!=="endsAt"},set(a){t.event.dateAnchor=a?"startsAt":"endsAt"}}),c=I(()=>T.value?"forward":"backward"),j=I({get(){return t.event.workingTimePerDay},async set(a){if(a===t.event.workingTimePerDay)return;t.event.workingTimePerDay=a,Pe(t.event);const{startsAt:m,endsAt:k}=t.event;!B.value&&(c.value==="forward"&&m||c.value==="backward"&&k)&&await ye(t.event,{direction:c.value,date:c.value==="forward"?m:k,mutateEvent:!0})}}),X=I({get(){return t.event.durationDriveFromStart},set(a){a!==t.event.durationDriveFromStart&&(t.event.durationDriveFromStart=a,ge(t.event))}}),te=I({get(){return t.event.durationDriveReturnTo},set(a){a!==t.event.durationDriveReturnTo&&(t.event.durationDriveReturnTo=a,ge(t.event))}}),N=tt(()=>t.event.isOutward&&t.event.startsAt&&t.event.durationDriveFromStart?Je(t.event.startsAt,-t.event.durationDriveFromStart):null,{dateToCompare:()=>t.event.startsAt}),se=tt(()=>t.event.isOutward&&t.event.endsAt&&t.event.durationDriveReturnTo?Je(t.event.endsAt,t.event.durationDriveReturnTo):null,{dateToCompare:()=>t.event.endsAt}),le=I({get(){return t.event.plannedEmployeeCount},set(a){a!==t.event.plannedEmployeeCount&&(t.event.plannedEmployeeCount=a,Pe(t.event),ge(t.event))}}),[L]=ct("addressId"),K=O(!1),M=O(null),ae=O(null),w=I({get(){return!!t.event.isOutward},async set(a){a!==t.event.isOutward&&(t.event.isOutward=a,a||(de.value=null),a&&(t.event.addressStartFromId||(t.event.addressStartFromId=L.value),t.event.addressReturnToId||(t.event.addressReturnToId=L.value),t.event.addressDestinationId||(t.event.addressDestination=t.event.assignment?.addressProperty||null),t.event.durationDriveFromStart||(X.value=1*60*60),t.event.durationDriveReturnTo||(te.value=1*60*60),await Promise.all([re(),me()])),ge(t.event))}});async function P({id:a,idKey:m}){a!=="new"?t.event[m]=a:(ae.value=m,K.value=!0)}const Q=I(()=>ae.value&&{addressStartFromId:"addressStartFrom",addressDestinationId:"addressDestination",addressReturnToId:"addressReturnTo"}[ae.value]||null),z=ft().createScope();fe(K,a=>{if(a&&!ae.value){K.value=!1;return}if(a){M.value=z.construct({});return}M.value=null,ae.value=null});const F=O(!1),R=O(!1),q=I(()=>!!t.event.addressStartFrom?.latitude&&!!t.event.addressStartFrom?.longitude&&!!t.event.addressDestination?.latitude&&!!t.event.addressDestination?.longitude);async function re(){if(R.value)return;const a=t.event.addressStartFrom,m=t.event.addressDestination;if(!(!a?.latitude||!a.longitude||!m?.latitude||!m.longitude)){R.value=!0;try{const k=await at({latitude:a.latitude,longitude:a.longitude},{latitude:m.latitude,longitude:m.longitude});X.value=k}finally{R.value=!1}}}const H=I(()=>!!t.event.addressReturnTo?.latitude&&!!t.event.addressReturnTo?.longitude&&!!t.event.addressDestination?.latitude&&!!t.event.addressDestination?.longitude);async function me(){if(F.value)return;const a=t.event.addressDestination,m=t.event.addressReturnTo;if(!(!a?.latitude||!a.longitude||!m?.latitude||!m.longitude)){F.value=!0;try{const k=await at({latitude:a.latitude,longitude:a.longitude},{latitude:m.latitude,longitude:m.longitude});te.value=k}finally{F.value=!1}}}const de=I({get(){return t.event.bookingDoneAt?"bookingDone":t.event.isOvernightNeeded===!1?"notNecessary":t.event.isOvernightNeeded===!0?"necessary":"automatically"},set(a){t.event.bookingDoneAt=a==="bookingDone"?new Date:null,a?a==="notNecessary"?t.event.isOvernightNeeded=!1:a==="necessary"?t.event.isOvernightNeeded=!0:a==="automatically"&&(t.event.isOvernightNeeded=null):t.event.isOvernightNeeded=!1}});fe(K,a=>{if(a&&!ae.value){K.value=!1;return}if(a){M.value=z.construct({});return}M.value=null,ae.value=null});function Vt(){M.value&&!M.value.id&&(z.resetOrRemove(M.value),M.value=null),K.value=!1}async function At(){if(!M.value||!ae.value){K.value=!1;return}await z.save(M.value),t.event[Q.value]=M.value,t.event[ae.value]=M.value.id,K.value=!1}function ze(){V.value=!V.value}const Dt=ka();function qe(a){return Dt(t.event,a,{showNotification:!0})}const He=Me(),St=vt().createScope();async function Et(){if(!t.event.company||!He.value||!t.event.assignment)return;const a=St.construct({order:t.tasks.length+1});a.event=t.event,a.assignment=t.event.assignment,a.company=t.event.company,a.createdBy=He.value,await he(),A.value.at(-1)?.focus()}const{addUsers:$t,removeUsers:_t}=wt({event:()=>t.event,localOnly:!0});return l({toggleCollapse:ze}),(a,m)=>{const k=ee("font-awesome-icon"),pe=ce,ie=Kt,G=ue,We=Lt,J=Ne,Ve=Be,Ae=je,De=Yt,Ct=Qt,Ut=ue,It=ee("InputGoogleAutocomplete"),xt=we,Pt=ke,Tt=rt;return r(),U("div",null,[v("div",un,[v("div",{class:Y(["flex items-center py-2 pl-2 overflow-hidden",{"drag-handle cursor-pointer select-none":a.draggable,"flex-1":e(V)&&!a.event.name}]),onClick:m[0]||(m[0]=_=>f("click-title"))},[a.event.type&&a.event.type.icon?(r(),y(k,{key:0,icon:a.event.type.icon,"fixed-width":"",class:"mr-2"},null,8,["icon"])):$("",!0),n(Ea,{value:a.event,"line-through-on-completed":"","transparent-for-draft":"","hide-custom-name":"",class:"font-bold overflow-hidden text-ellipsis"},null,8,["value"])],2),e(V)&&a.event.name?(r(),y(pe,{key:0,modelValue:a.event.name,"onUpdate:modelValue":m[1]||(m[1]=_=>a.event.name=_),size:"small",placeholder:a.$t("Description"),readonly:a.readonly,disabled:a.readonly,class:"flex-1 inline-edit ml-2"},null,8,["modelValue","placeholder","readonly","disabled"])):e(V)?$("",!0):(r(),y(Ja,{key:1,modelValue:a.event.name,"onUpdate:modelValue":m[2]||(m[2]=_=>a.event.name=_),class:"flex-1 inline-edit ml-2",size:"small",placeholder:a.$t("Description"),readonly:a.readonly,disabled:a.readonly},null,8,["modelValue","placeholder","readonly","disabled"])),e(V)&&e(u).sm?(r(),U(Z,{key:2},[e(T)?(r(),y(Se,{key:0,"model-value":a.event.startsAt,"date-disabled":!e(T),"time-disabled":!e(T),"show-time":!a.event.isAllDay&&!!a.event.startsAt,size:a.size,"show-default-time":!a.event.isAllDay&&!a.event.startsAt,"default-time":a.event.startsAtDefaultTime,readonly:a.readonly,disabled:a.readonly,class:"my-1 ml-1","onUpdate:modelValue":g,"onUpdate:defaultTime":m[3]||(m[3]=_=>a.event.startsAtDefaultTime=_)},null,8,["model-value","date-disabled","time-disabled","show-time","size","show-default-time","default-time","readonly","disabled"])):(r(),y(Se,{key:1,"model-value":a.event.endsAt,"date-disabled":e(T),"time-disabled":e(T),"show-time":!a.event.isAllDay,size:a.size,readonly:a.readonly,disabled:a.readonly,class:"my-1 ml-1","onUpdate:modelValue":h},null,8,["model-value","date-disabled","time-disabled","show-time","size","readonly","disabled"]))],64)):$("",!0),n(dn,{value:a.event,"read-only":a.readonly,class:"ml-2"},null,8,["value","read-only"])]),v("div",mn,[v("div",cn,[v("div",pn,[n(ie,{modelValue:e(le),"onUpdate:modelValue":m[4]||(m[4]=_=>ne(le)?le.value=_:null),min:0,style:{width:"40px"},"value-on-clear":0,controls:!1,readonly:a.readonly,disabled:a.readonly,class:"inline-edit"},null,8,["modelValue","readonly","disabled"]),v("div",vn,[n(k,{icon:e(le)<=0?"user-slash":e(le)===1?"user":"users",class:"text-xs"},null,8,["icon"])])]),v("div",fn,[n(ie,{modelValue:e(C),"onUpdate:modelValue":m[5]||(m[5]=_=>ne(C)?C.value=_:null),min:1,style:{width:"38px"},"value-on-clear":1,controls:!1,readonly:a.readonly,disabled:a.readonly,class:"inline-edit"},null,8,["modelValue","readonly","disabled"]),v("div",yn,p(e(d)("Day",e(C))),1)]),v("div",gn,[n(Te,{modelValue:e(j),"onUpdate:modelValue":m[6]||(m[6]=_=>ne(j)?j.value=_:null),"value-type":"number",readonly:a.readonly,disabled:a.readonly,class:"inline-edit !w-12"},null,8,["modelValue","readonly","disabled"]),v("div",bn,p(e(d)("assignmentEvent.workingTimePerDay",e(C))),1)]),!e(V)||e(u).sm?(r(),U("div",hn,[n(ie,{modelValue:e(b),"onUpdate:modelValue":m[7]||(m[7]=_=>ne(b)?b.value=_:null),precision:2,step:1*(a.event.plannedEmployeeCount||1),min:0,"value-on-clear":0,controls:!1,style:{width:"70px"},readonly:a.readonly,disabled:a.readonly,class:"inline-edit"},null,8,["modelValue","step","readonly","disabled"]),v("div",wn,p(e(d)("assignmentEvent.effort")),1)])):$("",!0)]),!e(V)&&e(u).sm?(r(),U("div",kn,[n(be,{content:e(w)?e(d)("assignmentEvent.drive.deactivateDrive"):e(d)("assignmentEvent.drive.activateDrive"),placement:"bottom-end"},{default:o(()=>[n(G,{type:e(w)?"primary":"default",disabled:a.readonly,onClick:m[8]||(m[8]=()=>!a.readonly&&(w.value=!e(w)))},{default:o(()=>[n(k,{icon:"truck","fixed-width":"",class:"text-xs"})]),_:1},8,["type","disabled"])]),_:1},8,["content"])])):e(V)?(r(),y(et,{key:1,event:a.event,readonly:a.readonly,class:"flex-1 bg-white rounded ml-1 p-1",onAddUser:m[9]||(m[9]=({eventUsers:_})=>qe(_.length))},null,8,["event","readonly"])):$("",!0)]),e(V)?$("",!0):(r(),U(Z,{key:0},[v("div",Vn,p(e(d)("assignmentEvent.Appointment"))+":",1),v("div",An,[e(u).xs?$("",!0):(r(),U("div",Dn,[v("div",Sn,[v("span",En,p(e(d)("assignmentEvent.time")),1),n(We,{"model-value":!e(B),disabled:a.readonly,class:"ml-2 mr-1",size:"small","onUpdate:modelValue":m[10]||(m[10]=_=>B.value=!_)},null,8,["model-value","disabled"])]),v("div",null,[n(be,{content:e(w)?e(d)("assignmentEvent.drive.deactivateDrive"):e(d)("assignmentEvent.drive.activateDrive"),placement:"bottom-end"},{default:o(()=>[n(G,{type:e(w)?"primary":"default",disabled:a.readonly,onClick:m[11]||(m[11]=()=>!a.readonly&&(w.value=!e(w)))},{default:o(()=>[n(k,{icon:"truck","fixed-width":"",class:"text-xs"})]),_:1},8,["type","disabled"])]),_:1},8,["content"])])])),a.event.isOutward?(r(),U("div",$n,[n(k,{icon:"truck",class:"mr-2 text-gray-500 text-xs"}),v("div",_n,[a.event.isOutward&&a.event.durationDriveFromStart&&a.event.startsAt&&!a.event.isAllDay?(r(),U("div",Cn,[v("span",Un,p(e(d)("assignmentEvent.drive.Departure"))+":",1),x(" "+p(e(N)),1)])):$("",!0),v("div",In,[v("div",null,[n(Te,{modelValue:e(X),"onUpdate:modelValue":m[12]||(m[12]=_=>ne(X)?X.value=_:null),readonly:a.readonly,disabled:a.readonly,"value-type":"number"},null,8,["modelValue","readonly","disabled"]),e(q)?(r(),y(G,{key:0,size:"default",disabled:a.readonly,class:"ml-0.5",onClick:m[13]||(m[13]=_=>!a.readonly&&re())},{default:o(()=>[n(k,{icon:"sync-alt","fixed-width":"",spin:e(R),class:"text-xs"},null,8,["spin"])]),_:1},8,["disabled"])):$("",!0)]),n(Ae,{disabled:a.readonly,class:"ml-2",onCommand:P},{dropdown:o(()=>[n(Ve,null,{default:o(()=>[n(J,{command:{id:e(L),idKey:"addressStartFromId"}},{default:o(()=>[n(k,{icon:"home",class:"mr-2 text-xs"}),x(" "+p(e(d)("assignmentEvent.drive.company")),1)]),_:1},8,["command"]),a.event.assignment&&a.event.assignment.addressPropertyId?(r(),y(J,{key:0,command:{id:a.event.assignment.addressPropertyId,idKey:"addressStartFromId"}},{default:o(()=>[n(k,{icon:"map-marker-alt",class:"mr-2 text-xs"}),x(" "+p(e(d)("assignmentEvent.drive.constructionSite")),1)]),_:1},8,["command"])):$("",!0),n(J,{command:{id:"new",idKey:"addressStartFromId"}},{default:o(()=>[n(k,{icon:"globe-europe",class:"mr-2 text-xs"}),x(" "+p(e(d)("New")),1)]),_:1})]),_:1})]),default:o(()=>[n(G,{text:""},{default:o(()=>[a.event.addressStartFromId===e(L)?(r(),y(k,{key:0,icon:"home","fixed-width":"",class:"text-xs"})):a.event.assignment?.addressPropertyUuid&&a.event.addressStartFromUuid===a.event.assignment.addressPropertyUuid?(r(),y(k,{key:1,icon:"map-marker-alt","fixed-width":"",class:"text-xs"})):a.event.addressStartFromUuid?(r(),y(k,{key:2,icon:"globe-europe","fixed-width":"",class:"text-xs"})):(r(),y(k,{key:3,icon:"question","fixed-width":""}))]),_:1})]),_:1},8,["disabled"]),n(k,{icon:"arrow-right",class:"mx-1 text-xs"}),n(Ae,{disabled:a.readonly,onCommand:P},{dropdown:o(()=>[n(Ve,null,{default:o(()=>[n(J,{command:{id:e(L),idKey:"addressDestinationId"}},{default:o(()=>[n(k,{icon:"home",class:"mr-2 text-xs"}),x(" "+p(e(d)("assignmentEvent.drive.company")),1)]),_:1},8,["command"]),a.event.assignment&&a.event.assignment.addressPropertyId?(r(),y(J,{key:0,command:{id:a.event.assignment.addressPropertyId,idKey:"addressDestinationId"}},{default:o(()=>[n(k,{icon:"map-marker-alt",class:"mr-2"}),x(" "+p(e(d)("assignmentEvent.drive.constructionSite")),1)]),_:1},8,["command"])):$("",!0),n(J,{command:{id:"new",idKey:"addressDestinationId"}},{default:o(()=>[n(k,{icon:"globe-europe",class:"mr-2 text-xs"}),x(" "+p(e(d)("New")),1)]),_:1})]),_:1})]),default:o(()=>[n(G,{text:""},{default:o(()=>[a.event.addressDestinationId===e(L)?(r(),y(k,{key:0,icon:"home","fixed-width":"",class:"text-xs"})):a.event.assignment?.addressPropertyUuid&&a.event.addressDestinationUuid===a.event.assignment.addressPropertyUuid?(r(),y(k,{key:1,icon:"map-marker-alt","fixed-width":"",class:"text-xs"})):a.event.addressDestinationUuid?(r(),y(k,{key:2,icon:"globe-europe","fixed-width":"",class:"text-xs"})):(r(),y(k,{key:3,icon:"question","fixed-width":"",class:"text-xs"}))]),_:1})]),_:1},8,["disabled"])])])])):$("",!0),v("div",xn,[v("div",null,[a.event.isOutward?(r(),y(k,{key:0,icon:"hammer",class:"mr-2 text-gray-500 text-xs"})):$("",!0)]),v("div",Pn,[v("div",Tn,[n(Se,{"model-value":a.event.startsAt,"date-disabled":!e(T),"time-disabled":!e(T),"show-time":!a.event.isAllDay&&!!a.event.startsAt,size:a.size,"show-default-time":!a.event.isAllDay&&!a.event.startsAt,"default-time":a.event.startsAtDefaultTime,readonly:a.readonly,"onUpdate:modelValue":g,"onUpdate:defaultTime":m[14]||(m[14]=_=>a.event.startsAtDefaultTime=_)},null,8,["model-value","date-disabled","time-disabled","show-time","size","show-default-time","default-time","readonly"]),n(be,{content:e(d)("assignmentEvent.schedulingForward"),disabled:e(T),placement:"top"},{default:o(()=>[n(G,{type:e(T)?"primary":void 0,text:!e(T),disabled:a.readonly,class:"ml-1",onClick:m[15]||(m[15]=()=>!a.readonly&&(T.value=!0))},{default:o(()=>[n(k,{icon:"link",class:"text-xs"})]),_:1},8,["type","text","disabled"])]),_:1},8,["content","disabled"]),e(u).sm?(r(),U(Z,{key:0},[n(We,{"model-value":!e(B),class:"ml-2 mr-1",size:"small",disabled:a.readonly,"onUpdate:modelValue":m[16]||(m[16]=_=>B.value=!_)},null,8,["model-value","disabled"]),x(" "+p(e(d)("assignmentEvent.time")),1)],64)):$("",!0)]),v("div",On,[n(Se,{"model-value":a.event.endsAt,"date-disabled":e(T),"time-disabled":e(T),"show-time":!a.event.isAllDay,size:a.size,disabled:a.readonly,"onUpdate:modelValue":h},null,8,["model-value","date-disabled","time-disabled","show-time","size","disabled"]),n(be,{content:e(d)("assignmentEvent.schedulingBackward"),disabled:!e(T),placement:"bottom"},{default:o(()=>[n(G,{type:e(T)?void 0:"primary",text:e(T),disabled:a.readonly,class:"ml-1",onClick:m[17]||(m[17]=()=>!a.readonly&&(T.value=!1))},{default:o(()=>[n(k,{icon:"link",class:"text-xs"})]),_:1},8,["type","text","disabled"])]),_:1},8,["content","disabled"])])])]),a.event.isOutward?(r(),U("div",Bn,[n(k,{icon:"truck",class:"mr-2 text-xs text-gray-500",flip:"horizontal"}),v("div",null,[v("div",jn,[v("div",null,[n(Te,{modelValue:e(te),"onUpdate:modelValue":m[18]||(m[18]=_=>ne(te)?te.value=_:null),disabled:a.readonly,"value-type":"number"},null,8,["modelValue","disabled"]),e(H)?(r(),y(G,{key:0,size:"default",class:"ml-0.5",disabled:a.readonly,onClick:me},{default:o(()=>[n(k,{icon:"sync-alt","fixed-width":"",spin:e(F),class:"text-xs"},null,8,["spin"])]),_:1},8,["disabled"])):$("",!0)]),n(Ae,{disabled:a.readonly,class:"ml-2",onCommand:P},{dropdown:o(()=>[n(Ve,null,{default:o(()=>[n(J,{command:{id:e(L),idKey:"addressDestinationId"}},{default:o(()=>[n(k,{icon:"home",class:"mr-2 text-xs"}),x(" "+p(e(d)("assignmentEvent.drive.company")),1)]),_:1},8,["command"]),a.event.assignment&&a.event.assignment.addressPropertyId?(r(),y(J,{key:0,command:{id:a.event.assignment.addressPropertyId,idKey:"addressDestinationId"}},{default:o(()=>[n(k,{icon:"map-marker-alt",class:"mr-2 text-xs"}),x(" "+p(e(d)("assignmentEvent.drive.constructionSite")),1)]),_:1},8,["command"])):$("",!0),n(J,{command:{id:"new",idKey:"addressDestinationId"}},{default:o(()=>[n(k,{icon:"globe-europe",class:"mr-2 text-xs"}),x(" "+p(e(d)("New")),1)]),_:1})]),_:1})]),default:o(()=>[n(G,{text:""},{default:o(()=>[a.event.addressDestinationId===e(L)?(r(),y(k,{key:0,icon:"home","fixed-width":"",class:"text-xs"})):a.event.assignment?.addressPropertyUuid&&a.event.addressDestinationUuid===a.event.assignment.addressPropertyUuid?(r(),y(k,{key:1,icon:"map-marker-alt","fixed-width":"",class:"text-xs"})):a.event.addressDestinationUuid?(r(),y(k,{key:2,icon:"globe-europe","fixed-width":"",class:"text-xs"})):(r(),y(k,{key:3,icon:"question","fixed-width":""}))]),_:1})]),_:1},8,["disabled"]),n(k,{icon:"arrow-right",class:"mx-1 text-xs"}),n(Ae,{disabled:a.readonly,onCommand:P},{dropdown:o(()=>[n(Ve,null,{default:o(()=>[n(J,{command:{id:e(L),idKey:"addressReturnToId"}},{default:o(()=>[n(k,{icon:"home",class:"mr-2 text-xs"}),x(" "+p(e(d)("assignmentEvent.drive.company")),1)]),_:1},8,["command"]),a.event.assignment&&a.event.assignment.addressPropertyId?(r(),y(J,{key:0,command:{id:a.event.assignment.addressPropertyId,idKey:"addressReturnToId"}},{default:o(()=>[n(k,{icon:"map-marker-alt",class:"mr-2 text-xs"}),x(" "+p(e(d)("assignmentEvent.drive.constructionSite")),1)]),_:1},8,["command"])):$("",!0),n(J,{command:{id:"new",idKey:"addressReturnToId"}},{default:o(()=>[n(k,{icon:"globe-europe",class:"mr-2 text-xs"}),x(" "+p(e(d)("New")),1)]),_:1})]),_:1})]),default:o(()=>[n(G,{text:""},{default:o(()=>[a.event.addressReturnToId===e(L)?(r(),y(k,{key:0,icon:"home","fixed-width":"",class:"text-xs"})):a.event.assignment?.addressPropertyUuid&&a.event.addressReturnToUuid===a.event.assignment.addressPropertyUuid?(r(),y(k,{key:1,icon:"map-marker-alt","fixed-width":"",class:"text-xs"})):a.event.addressReturnToUuid?(r(),y(k,{key:2,icon:"globe-europe","fixed-width":"",class:"text-xs"})):(r(),y(k,{key:3,icon:"question","fixed-width":"",class:"text-xs"}))]),_:1})]),_:1},8,["disabled"])]),a.event.isOutward&&a.event.durationDriveReturnTo&&a.event.endsAt&&!a.event.isAllDay?(r(),U("div",Nn,[v("span",Fn,p(e(d)("assignmentEvent.drive.Arrival"))+":",1),x(" "+p(e(se)),1)])):$("",!0)])])):$("",!0)]),a.event.isOutward&&a.event.workDays>1?(r(),U(Z,{key:0},[v("div",Rn,p(e(d)("assignmentEvent.drive.Accommodation"))+":",1),v("div",Mn,[n(Ct,{modelValue:e(de),"onUpdate:modelValue":m[19]||(m[19]=_=>ne(de)?de.value=_:null),size:"default",placeholder:a.$t("assignmentEvent.accommodationRequired"),disabled:a.readonly,clearable:""},{default:o(()=>[n(De,{value:"automatically",label:e(d)("assignmentEvent.drive.needAccommodation.automatic")},null,8,["label"]),n(De,{value:"necessary",label:e(d)("assignmentEvent.drive.needAccommodation.necessary")},null,8,["label"]),n(De,{value:"notNecessary",label:e(d)("assignmentEvent.drive.needAccommodation.notNecessary")},null,8,["label"]),n(De,{value:"bookingDone",label:e(d)("assignmentEvent.drive.needAccommodation.bookingDone")},null,8,["label"])]),_:1},8,["modelValue","placeholder","disabled"])])],64)):$("",!0),v("div",Gn,[v("div",zn,p(e(d)("assignmentEvent.effort"))+":",1),v("div",qn,[v("div",Hn,[v("div",{class:Y(["text-right mr-1",{"w-20":a.event.isOutward}])},p(e(b)),3),v("span",Wn,p(e(d)("hoursShort"))+" "+p(e(d)("assignmentEvent.work")),1)]),a.event.isOutward?(r(),U("div",Kn,[v("div",Ln,"+ "+p(e(E)),1),v("span",Yn,p(e(d)("hoursShort"))+" "+p(e(d)("assignmentEvent.driveWork")),1)])):$("",!0),a.event.isOutward?(r(),U("div",Qn,[v("div",Xn,p(e(D)),1),v("span",Jn,p(e(d)("hoursShort"))+" "+p(e(d)("overall")),1)])):$("",!0)])]),v("div",Zn,[v("div",es,[v("div",ts,p(e(d)("user.name",2))+":",1),v("div",as,[n(et,{event:a.event,readonly:a.readonly,onAddUser:m[20]||(m[20]=({eventUsers:_})=>qe(_.length))},null,8,["event","readonly"]),e(S).hasGangs?(r(),y(rn,{key:0,event:a.event,readonly:a.readonly,local:"",onAdded:m[21]||(m[21]=({users:_})=>e($t)(_)),onRemoved:m[22]||(m[22]=({users:_})=>e(_t)(_))},null,8,["event","readonly"])):$("",!0)])]),v("div",ns,[v("div",ss,p(e(d)("assignmentEvent.requiredDocumentation"))+":",1),v("div",os,[n(ie,{modelValue:a.event.minUploadCount,"onUpdate:modelValue":m[23]||(m[23]=_=>a.event.minUploadCount=_),min:0,"value-on-clear":0,disabled:a.readonly,style:{width:"40px"},class:"inline-edit",controls:!1},null,8,["modelValue","disabled"]),v("div",ls,p(e(d)("assignmentEvent.photosNeedToBeDone"))+". ",1)])])]),v("div",rs,p(e(d)("assignmentEvent.annotations"))+":",1),v("div",ds,[n(pe,{modelValue:a.event.note,"onUpdate:modelValue":m[24]||(m[24]=_=>a.event.note=_),rows:a.event.note?2:1,disabled:a.readonly,type:"textarea",placeholder:"Anmerkungen",class:"inline-edit"},null,8,["modelValue","rows","disabled"])]),v("div",is,p(e(d)("assignmentEvent.task",a.tasks.length))+":",1),(r(!0),U(Z,null,_e(a.tasks,_=>(r(),U("div",{key:_.uuid,class:"bg-white rounded mb-1 outline outline-2 outline-gray-100 p-2"},[n(Aa,{ref_for:!0,ref:e(A).set,task:_,onRemove:Fs=>a.$emit("remove-task",_)},null,8,["task","onRemove"])]))),128)),v("div",us,[n(Ut,{text:"",icon:e(Xt),onClick:Et},{default:o(()=>[x(p(e(d)("assignmentEvent.addTask")),1)]),_:1},8,["icon"])]),v("div",ms,[cs,a.showDelete&&!a.readonly?(r(),y(G,{key:0,type:"danger",plain:"",onClick:m[25]||(m[25]=_=>f("remove"))},{default:o(()=>[n(k,{icon:"trash-alt",class:"mr-2 text-xs"}),x(" "+p(e(d)("actions.Delete")),1)]),_:1})):$("",!0)])],64)),a.short&&a.expandable?(r(),U("div",ps,[n(G,{text:"",class:"!text-sm !font-normal",onClick:m[26]||(m[26]=()=>a.expandable&&ze())},{default:o(()=>[x(p(e(V)?e(d)("showMore"):e(d)("showLess"))+" ",1),n(k,{icon:"angle-down",class:"ml-1 transition-all text-xs",rotation:e(V)?void 0:"180"},null,8,["rotation"])]),_:1})])):$("",!0),e(K)?(r(),y(Tt,{key:2,modelValue:e(K),"onUpdate:modelValue":m[28]||(m[28]=_=>ne(K)?K.value=_:null),"append-to-body":""},{header:o(()=>[v("span",null,p(e(d)("addresses.create",1)),1)]),default:o(()=>[n(Pt,null,{default:o(()=>[n(xt,{label:`${e(d)("addresses.form.googleMaps")}:`},{default:o(()=>[n(It,{modelValue:e(M),"onUpdate:modelValue":m[27]||(m[27]=_=>ne(M)?M.value=_:null),placeholder:e(d)("addresses.form.googleMapsPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),v("div",vs,[n(G,{class:"mr-2",onClick:Vt},{default:o(()=>[x(p(e(d)("actions.Cancel")),1)]),_:1}),n(G,{type:"primary",disabled:!e(M)||!e(M).googlePlaceId,onClick:At},{default:o(()=>[x(p(e(d)("actions.Ok")),1)]),_:1},8,["disabled"])])]),_:1},8,["modelValue"])):$("",!0)])}}}),fs={class:"flex justify-between mb-3 gap-2"},ys={class:"flex gap-2"},gs={key:0,class:"flex gap-2 px-1"},bs={class:"flex-1"},hs={key:1,class:"text-center"},ws={key:1,class:"bg-gray-100 rounded text-center p-2 drop-shadow text-sm text-slate-600"},co=W({__name:"EditAssignmentEvents",props:{assignment:{},events:{},eventGroups:{},tasksByEventUuid:{},hideStatus:{type:Boolean,default:!1},hideManPower:{type:Boolean,default:!1},hideCheckbox:{type:Boolean,default:!1},expandByDefault:{type:Boolean,default:!1},hideNewIndicator:{type:Boolean,default:!1},hideNotes:{type:Boolean,default:!1},hideExpandRow:{type:Boolean,default:!1},debug:{type:Boolean,default:!1},skipStyleRows:{type:Boolean,default:!1}},emits:["remove-event","remove-group","remove-task"],setup(i,{emit:l}){const{t:s}=oe(),t=i,u=l,d=ya().createScope(),S=pt().createScope(),V=ga(),f=Me(),A=O(!1),b=O(null),E=O({}),D=O(null),g=O(null),h=O(),{cq:C}=ht(h),B=I(()=>C.value["3xl"]);nt(()=>!B.value&&D.value,()=>{D.value=null});const{maxOrder:T,recalculateOrder:c,groupsAndEventsToShow:j}=Da({events:I(()=>t.events),groups:I(()=>t.eventGroups)});async function X(w,P){if(!w)return;const Q=d.construct({companyId:w.companyId,assignment:t.assignment,typeId:w.id,order:T.value+.5,plannedEmployeeCount:w.defaultEmployeeCount,workDays:w.defaultWorkDays,workingTimePerDay:w.defaultWorkingTimePerDay,isOutward:w.defaultIsOutward,durationDriveFromStart:w.defaultIsOutward?w.defaultDurationDrive:0,durationDriveReturnTo:w.defaultIsOutward?w.defaultDurationDrive:0,dateAnchor:w.defaultDateAnchor,manPower:w.defaultManPower,isAllDay:w.defaultIsAllDay,startsAtDefaultTime:w.defaultStartsAtTime,minUploadCount:w.defaultMinUploadCount,...P});return D.value=Q,await c(),Q}function te(w){return S.construct({companyId:w.companyId,assignment:t.assignment,typeId:w.id,order:T.value+1})}function N({dragged:w,to:P}){if(w.classList.contains("is-group")&&P.classList.contains("is-group"))return!1}async function se(w,P,Q){const{moved:z,added:F}=w;if(z){const R=Ia(P,z.oldIndex,z.newIndex),q=[];R.forEach(H=>{Qe(H,"assignment-events")?q.push(H):H.isGroup?q.push(H.element.group,...H.element.events):q.push(H.element)});const re=Zt(q,"order")?.order||1;q.forEach((H,me)=>{H.order=re+me})}else if(F){const R=Qe(F.element,"assignment-events")?F.element:F.element.element,q=F.newIndex;if(Q.group){const re=[...P];re.splice(q,0,R);const H=q>0?re[q-1]?.order||0:Q?.group?.order||0;R.order=H+.5,R.group=Q?.group||null,await c()}else{const re=[...P];let H;if(q>0){const me=re[q-1];if(me.isGroup){const de=me.element;H=de.events.length>0?de.events.at(-1)?.order||0:de.group.order||0}else H=me.element.order||0}else H=0;R.order=H+.5,R.group=null,await c()}}}async function le(w,P){D.value&&P.includes(D.value)&&(D.value=null),u("remove-group",w,P),await c()}async function L(w){try{await st.confirm(s("assignmentEvent.deleteConfirmMessage",{eventType:w.type?.name}),"",{confirmButtonText:s("actions.Delete"),cancelButtonText:s("actions.Cancel"),type:"warning",confirmButtonClass:"el-button--danger"}),w===D.value&&(D.value=null),u("remove-event",w),await c()}catch{}}function K(w){B.value?D.value=w:E.value[w.uuid]?.toggleCollapse()}const M=O(!1);async function ae(w){if(f.value){M.value=!0;try{return await Ma({assignment:t.assignment,startOrder:T.value,user:f.value,standardProcess:w})}finally{M.value=!1}}}return(w,P)=>{const Q=ee("font-awesome-icon");return r(),U("div",{ref_key:"refContainer",ref:h},[v("div",fs,[v("div",null,[n(gt,{"company-id":e(V),type:"primary",trigger:"click","onUpdate:modelValue":X},{default:o(()=>[x(p(w.$t("assignmentEvent.name"))+" ",1),n(Q,{icon:"plus",class:"ml-1 text-xs"})]),_:1},8,["company-id"])]),v("div",ys,[n(Ga,{"company-id":e(V),disabled:e(M),loading:e(M),type:"primary",onChanged:P[0]||(P[0]=z=>ae(z))},{default:o(()=>[x(p(e(s)("assignment-event-standard-processes.name"))+" ",1),n(Q,{icon:"plus",class:"ml-1 text-xs"})]),_:1},8,["company-id","disabled","loading"]),n(oa,{"company-id":e(V),trigger:"click",type:"default","onUpdate:modelValue":te},{default:o(()=>[x(p(w.$t("Group"))+" ",1),n(Q,{icon:"plus",class:"ml-1 text-xs"})]),_:1},8,["company-id"])])]),w.events.length||w.eventGroups.length?(r(),U("div",gs,[v("div",bs,[n(e(Ye),{modelValue:e(j),"onUpdate:modelValue":P[6]||(P[6]=z=>ne(j)?j.value=z:null),handle:".drag-handle",group:"events","item-key":"uuid",move:N,onChange:P[7]||(P[7]=z=>se(z,e(j),{group:null})),onStart:P[8]||(P[8]=()=>A.value=!0),onEnd:P[9]||(P[9]=()=>A.value=!1)},{item:o(({element:{isGroup:z,element:F}})=>[z?(r(),y(Xa,{key:0,assignment:w.assignment,group:F.group,events:F.events,"expand-by-default":"",class:"mb-2 bg-gray-200 rounded border-gray-300 border-l-4 is-group",onAddEvent:X,onRemoveGroup:le,onMouseenter:()=>b.value=F.group.uuid,onMouseleave:P[4]||(P[4]=()=>b.value=null)},{default:o(()=>[n(e(Ye),{"model-value":F.events,handle:".drag-handle",group:"events","item-key":"uuid",class:Y(["grid grid-cols-1 @4xl:grid-cols-2 @6xl:grid-cols-3 gap-2 is-group",{"min-h-[100px]":e(A)&&e(b)===F.group.uuid}]),onChange:R=>se(R,F.events,{group:F.group}),onStart:P[2]||(P[2]=()=>A.value=!0),onEnd:P[3]||(P[3]=()=>A.value=!1)},{item:o(({element:R})=>[n(Oe,{ref:q=>e(E)[R.uuid]=q,event:R,tasks:w.tasksByEventUuid[R.uuid]??[],class:Y(["p-2 bg-gray-100 rounded-md drop-shadow hover:drop-shadow-lg transition-all",{"ring ring-primary":R===e(D)}]),draggable:"",short:"","expand-by-default":w.expandByDefault,expandable:!e(B),"show-delete":"",onClickTitle:()=>K(R),onRemove:()=>L(R),onRemoveTask:P[1]||(P[1]=q=>w.$emit("remove-task",q))},null,8,["event","tasks","class","expand-by-default","expandable","onClickTitle","onRemove"])]),_:2},1032,["model-value","class","onChange"])]),_:2},1032,["assignment","group","events","onMouseenter"])):(r(),y(Oe,{key:1,event:F,tasks:w.tasksByEventUuid[F.uuid]??[],class:Y(["mb-2 p-2 bg-gray-100 rounded-md drop-shadow hover:drop-shadow-lg",{"ring ring-primary":F===e(D)}]),draggable:"",short:"","drag-handle":"drag-handle-first","expand-by-default":w.expandByDefault,expandable:!e(B),"show-delete":"",onClickTitle:()=>K(F),onRemove:()=>L(F),onRemoveTask:P[5]||(P[5]=R=>w.$emit("remove-task",R))},null,8,["event","tasks","class","expand-by-default","expandable","onClickTitle","onRemove"]))]),_:1},8,["modelValue"])]),e(B)?(r(),y(Fa,{key:0,class:"bg-gray-100 p-2 flex-1 overflow-hidden drop-shadow rounded-md",top:10,bottom:10},{default:o(()=>[e(D)?(r(),y(Oe,{key:0,ref_key:"activeEventForm",ref:g,event:e(D),tasks:w.tasksByEventUuid[e(D).uuid]??[],class:"max-h-screen overflow-y-auto transition-all duration-75","show-delete":"",onRemove:P[10]||(P[10]=()=>L(e(D))),onRemoveTask:P[11]||(P[11]=z=>w.$emit("remove-task",z))},null,8,["event","tasks"])):(r(),U("div",hs,[n(Q,{icon:"arrow-left",class:"mr-2"}),x(" "+p(w.$t("assignmentEvent.clickToEditMessage"))+". ",1)]))]),_:1})):$("",!0)])):(r(),U("div",ws,p(w.$t("assignmentEvent.createdStepsYouCanEditHere")),1))],512)}}});function ks(i,l){dt(2,arguments);var s=it(l);return Pa(i,s*12)}function kt(i,l){dt(2,arguments);var s=it(l);return ks(i,-s)}const Vs={key:0},po=W({__name:"FormConstructionManager",props:{modelValue:{default:null},modelModifiers:{}},emits:["update:modelValue"],setup(i){const l=Re(i,"modelValue"),{t:s}=oe(),t=Ce(),u=Ge().createScope(),d=O(kt(new Date,2));function S(f,A){f?u.service.find({query:{"constructionManager.name":{$iLike:`%${f}%`},createdAt:{$gt:d.value},$sort:{createdAt:-1},$limit:1e3,$select:["id","constructionManager"]}}).then(b=>{const E=Array.isArray(b)?b:b.data,D=ut(E,(g,h)=>g&&h&&g.constructionManager.name===h.constructionManager.name);A(D)}):A([])}function V(f){l.value||(l.value={name:"",tel:"",mail:""}),l.value.name=f.constructionManager.name,l.value.tel=f.constructionManager.tel,l.value.mail=f.constructionManager.mail}return(f,A)=>{const b=mt,E=we,D=ce,g=ke;return l.value?(r(),y(g,{key:0,model:l.value,"label-position":e(t).md?"left":"top","label-width":"70px"},{default:o(()=>[n(E,{label:`${e(s)("customer.property.fullName")}:`},{default:o(()=>[n(b,{modelValue:l.value.name,"onUpdate:modelValue":A[0]||(A[0]=h=>l.value.name=h),"fetch-suggestions":S,class:"el-input",placeholder:e(s)("customer.form.fullNamePlaceholder"),clearable:"",onSelect:V},{default:o(({item:h})=>[h.constructionManager.name?(r(),U("span",Vs,p(h.constructionManager.name),1)):$("",!0)]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),n(E,{label:`${e(s)("customer.property.telephone")}:`},{default:o(()=>[n(D,{modelValue:l.value.tel,"onUpdate:modelValue":A[1]||(A[1]=h=>l.value.tel=h),clearable:"",placeholder:e(s)("customer.property.telephone")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(E,{label:`${e(s)("customer.property.email")}:`},{default:o(()=>[n(D,{modelValue:l.value.mail,"onUpdate:modelValue":A[2]||(A[2]=h=>l.value.mail=h),clearable:"",placeholder:e(s)("customer.property.email")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","label-position"])):$("",!0)}}}),As={key:0},vo=W({__name:"FormArchitect",props:{modelValue:{default:null},modelModifiers:{}},emits:["update:modelValue"],setup(i){const l=Re(i,"modelValue"),{t:s}=oe(),t=Ce(),u=Ge().createScope(),d=O(kt(new Date,2));function S(f,A){f?u.service.find({query:{"architect.name":{$iLike:`%${f}%`},createdAt:{$gt:d.value},$sort:{createdAt:-1},$limit:1e3,$select:["id","architect"]}}).then(b=>{const E=Array.isArray(b)?b:b.data,D=ut(E,(g,h)=>g&&h&&g.architect.name===h.architect.name);A(D)}):A([])}function V(f){l.value||(l.value={name:"",tel:"",mail:""}),l.value.name=f.architect.name,l.value.tel=f.architect.tel,l.value.mail=f.architect.mail}return(f,A)=>{const b=mt,E=we,D=ce,g=ke;return l.value?(r(),y(g,{key:0,model:l.value,"label-position":e(t).md?"left":"top","label-width":"70px"},{default:o(()=>[n(E,{label:`${e(s)("customer.property.fullName")}:`},{default:o(()=>[n(b,{modelValue:l.value.name,"onUpdate:modelValue":A[0]||(A[0]=h=>l.value.name=h),"fetch-suggestions":S,class:"el-input",placeholder:e(s)("customer.form.fullNamePlaceholder"),clearable:"",onSelect:V},{default:o(({item:h})=>[h.architect.name?(r(),U("span",As,p(h.architect.name),1)):$("",!0)]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),n(E,{label:`${e(s)("customer.property.telephone")}:`},{default:o(()=>[n(D,{modelValue:l.value.tel,"onUpdate:modelValue":A[1]||(A[1]=h=>l.value.tel=h),clearable:"",placeholder:e(s)("customer.property.telephone")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(E,{label:`${e(s)("customer.property.email")}:`},{default:o(()=>[n(D,{modelValue:l.value.mail,"onUpdate:modelValue":A[2]||(A[2]=h=>l.value.mail=h),clearable:"",placeholder:e(s)("customer.property.email")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","label-position"])):$("",!0)}}}),Ds=W({name:"UseContainerQuery",props:{as:{type:String,default:"div"}},setup(i,{slots:l}){const s=O(),t=ea(ht(s));return()=>{if(l.default)return ta(i.as,{ref:s},l.default(t))}}}),Ss={class:"dialog-title"},Es={class:"flex justify-end gap-2"},$s=W({__name:"DialogProjectView",props:{project:{type:Object,required:!0},currentAssignment:{type:Object,default:void 0}},setup(i){const l=i,{t:s}=oe(),t=aa(),u=Ge().createScope(),d=ba().createScope();fe(()=>l.project,(D,g)=>{d.resetOrRemove(g)});const S=O(!1),V=O(!1);function f(){S.value=!0,V.value=!0}function A(){V.value=!1}fe(V,(D,g)=>{!D&&g&&d.hasChanges(l.project)&&d.reset(l.project)});const b=I(()=>({query:{$sort:{createdAt:-1},projectId:l.project.id},debounce:350,paginate:!0,$populateParams:{name:"withCustomer"}}));async function E(D){await t.push({params:{assignmentId:D.id}}),await he(),window.location.reload()}return(D,g)=>{const h=ee("font-awesome-icon"),C=ue,B=ue,T=rt;return r(),U(Z,null,[$e(D.$slots,"default",{open:f,close:A}),e(S)?(r(),y(T,{key:0,modelValue:e(V),"onUpdate:modelValue":g[2]||(g[2]=c=>ne(V)?V.value=c:null),class:"dialog-messagebox-[1000px]"},{header:o(()=>[v("div",Ss,[v("div",null,[v("span",null,p(e(s)("project.name"))+" "+p(i.project.projectNumber),1)])])]),footer:o(()=>[v("div",Es,[n(B,{text:"",onClick:g[0]||(g[0]=c=>(e(d).hasChanges(i.project)&&e(d).reset(i.project),A()))},{default:o(()=>[x(p(e(d).hasChanges(i.project)?e(s)("actions.Cancel"):e(s)("actions.Close")),1)]),_:1}),e(d).hasChanges(i.project)?(r(),y(B,{key:0,type:"primary",onClick:g[1]||(g[1]=c=>e(d).save(i.project).then(()=>A()))},{default:o(()=>[x(p(e(s)("actions.Save")),1)]),_:1})):$("",!0)])]),default:o(()=>[v("div",null,[n(ja,{store:e(u),params:e(b),"read-only":"","show-total":""},{default:o(()=>[n(ve,{width:"50px"},{default:o(({row:c})=>[c.id!==i.currentAssignment?.id?(r(),y(C,{key:0,size:"default",type:"info",plain:"",onClick:j=>E(c)},{default:o(()=>[n(h,{icon:"info"})]),_:2},1032,["onClick"])):$("",!0)]),_:1}),n(ve,{title:e(s)("project.property.number"),width:"120px"},{default:o(({row:c})=>[x(p(c.project.projectNumber),1)]),_:1},8,["title"]),n(ve,{title:e(s)("assignment.property.number"),width:"130px"},{default:o(({row:c})=>[x(p(c.number),1)]),_:1},8,["title"]),n(ve,{title:e(s)("assignment.property.name")},{default:o(({row:c})=>[x(p(c.name),1)]),_:1},8,["title"]),n(ve,{title:e(s)("customer.name")},{default:o(({row:c})=>[x(p(c.customer&&(c.customer.fullName||c.customer.companyName)),1)]),_:1},8,["title"]),n(ve,{title:e(s)("commonProperty.createdAt"),width:"128px"},{default:o(({row:c})=>[x(p(c.createdAt&&e(ha)(c.createdAt,"dd.MM.yy HH:mm")),1)]),_:1},8,["title"])]),_:1},8,["store","params"])])]),_:1},8,["modelValue"])):$("",!0)],64)}}}),_s=["onClick"],Cs={key:1,class:"flex w-full"},Us={key:0,class:"flex-1"},Is={key:0,class:"leading-tight"},xs={key:0,class:"leading-tight"},Ps={key:0,class:"leading-tight"},Ts={key:0,class:"leading-tight"},Os={key:0},Bs={key:0},fo=W({__name:"FormProject",props:{modelValue:{},readOnly:{type:Boolean,default:!1},showChangeProjectName:{type:Boolean,default:!1}},setup(i){const{t:l}=oe(),s=O();return(t,u)=>{const d=ee("NotAssignedIndicator"),S=ce,V=ee("font-awesome-icon"),f=ue,A=na,b=we,E=ke;return r(),y(e(Ds),null,{default:o(({cq:D})=>[n(E,{model:t.modelValue,"label-position":D.xs?"left":"top","label-width":"120px",class:Y([t.readOnly&&"[&_.el-form-item--default_.el-form-item\\_\\_label]:h-auto [&_.el-form-item--default_.el-form-item\\_\\_label]:leading-[inherit]"])},{default:o(()=>[n(b,{label:e(l)("project.property.number")+":",class:Y({"text-only":t.readOnly})},{default:o(()=>[t.readOnly?(r(),U(Z,{key:0},[t.modelValue.project?(r(),y($s,{key:0,project:t.modelValue.project,"current-assignment":t.modelValue},{default:o(({open:g})=>[v("a",{class:"url",onClick:g},p(t.modelValue.project.projectNumber),9,_s)]),_:1},8,["project","current-assignment"])):(r(),y(d,{key:1}))],64)):(r(),U("div",Cs,[!e(s)&&t.showChangeProjectName&&t.modelValue.project?(r(),U("div",Us,p(t.modelValue.project?.projectNumber),1)):e(s)==="changeName"&&t.modelValue.project?(r(),y(S,{key:1,modelValue:t.modelValue.project.projectNumber,"onUpdate:modelValue":u[0]||(u[0]=g=>t.modelValue.project.projectNumber=g),class:"[&_.el-input\\_\\_wrapper]:!rounded-r-none"},null,8,["modelValue"])):e(s)==="changeProject"||!t.modelValue.project||!t.showChangeProjectName?(r(),y(Ta,{key:2,modelValue:t.modelValue.project,"onUpdate:modelValue":u[1]||(u[1]=g=>t.modelValue.project=g),clearable:"",class:Y(["w-full",{"[&_.el-select\\_\\_wrapper]:!rounded-r-none":e(s)==="changeProject"}]),"allow-create":""},null,8,["modelValue","class"])):$("",!0),!e(s)&&t.showChangeProjectName&&t.modelValue.project?(r(),y(A,{key:3},{default:o(()=>[n(f,{onClick:u[2]||(u[2]=g=>s.value="changeName")},{default:o(()=>[n(V,{icon:"pencil-alt"})]),_:1}),n(f,{onClick:u[3]||(u[3]=g=>s.value="changeProject")},{default:o(()=>[n(V,{icon:"exchange-alt"})]),_:1})]),_:1})):t.showChangeProjectName&&t.modelValue.project?(r(),y(f,{key:4,type:"primary",class:"!rounded-l-none",onClick:u[4]||(u[4]=()=>s.value=void 0)},{default:o(()=>[n(V,{icon:"check"})]),_:1})):$("",!0)]))]),_:1},8,["label","class"]),n(b,{class:Y({"text-only":t.readOnly}),prop:t.readOnly?void 0:"number",label:e(l)("assignment.property.number")+":"},{default:o(()=>[t.readOnly?(r(),U("span",Is,p(t.modelValue.number),1)):(r(),y(S,{key:1,modelValue:t.modelValue.number,"onUpdate:modelValue":u[5]||(u[5]=g=>t.modelValue.number=g),type:"text",placeholder:e(l)("assignment.property.number"),required:""},{append:o(()=>[n(V,{icon:"arrows-alt-h"}),x(" "+p((t.modelValue.number&&t.modelValue.number.length)??0),1)]),_:1},8,["modelValue","placeholder"]))]),_:1},8,["class","prop","label"]),n(b,{label:e(l)("assignment.property.name")+":",class:Y({"text-only":t.readOnly}),prop:t.readOnly?void 0:"name"},{default:o(()=>[t.readOnly?(r(),U("span",xs,p(t.modelValue.name),1)):(r(),y(S,{key:1,modelValue:t.modelValue.name,"onUpdate:modelValue":u[6]||(u[6]=g=>t.modelValue.name=g),placeholder:e(l)("assignment.property.name"),required:""},null,8,["modelValue","placeholder"]))]),_:1},8,["label","class","prop"]),n(b,{label:e(l)("assignment-types.name")+":",class:Y({"text-only":t.readOnly})},{default:o(()=>[t.readOnly?(r(),U("div",Ps,p(t.modelValue.type?.name),1)):(r(),y(Ba,{key:1,modelValue:t.modelValue.type,"onUpdate:modelValue":u[7]||(u[7]=g=>t.modelValue.type=g),placeholder:e(l)("assignment-types.name"),class:"w-full"},null,8,["modelValue","placeholder"]))]),_:1},8,["label","class"]),n(b,{label:e(l)("assignment.relation.serviceWorker")+":",class:Y({"text-only":t.readOnly})},{default:o(()=>[t.readOnly?(r(),U("div",Ts,[t.modelValue.serviceWorker?(r(),U("span",Os,p(t.modelValue.serviceWorker.fullName),1)):(r(),y(d,{key:1}))])):t.readOnly?$("",!0):(r(),y(Oa,{key:1,modelValue:t.modelValue.serviceWorker,"onUpdate:modelValue":u[8]||(u[8]=g=>t.modelValue.serviceWorker=g),clearable:"",placeholder:t.$t("assignment.relation.serviceWorker"),class:"w-full"},null,8,["modelValue","placeholder"]))]),_:1},8,["label","class"]),n(b,{label:e(l)("assignmentStatusTypes.name")+":",class:Y({"text-only":t.readOnly})},{default:o(()=>[t.readOnly?(r(),U("div",Bs,[t.modelValue.status?(r(),y(Ze,{key:0,modelValue:t.modelValue.status,"onUpdate:modelValue":u[9]||(u[9]=g=>t.modelValue.status=g)},null,8,["modelValue"])):(r(),y(d,{key:1}))])):(r(),y(Ze,{key:1,modelValue:t.modelValue.status,"onUpdate:modelValue":u[10]||(u[10]=g=>t.modelValue.status=g),editable:""},null,8,["modelValue"]))]),_:1},8,["label","class"])]),_:2},1032,["model","label-position","class"])]),_:1})}}}),yo=W({__name:"FormCustomer",props:{modelValue:{type:Object,default:null},disabled:{type:Boolean,default:!1}},setup(i){const{t:l}=oe(),s=Ce();return(t,u)=>{const d=ce,S=we,V=ke;return i.modelValue!=null?(r(),y(V,{key:0,"label-position":e(s).md?"left":"top",model:i.modelValue,"label-width":"70px"},{default:o(()=>[n(S,{label:`${e(l)("customer.property.companyName")}:`},{default:o(()=>[n(d,{modelValue:i.modelValue.companyName,"onUpdate:modelValue":u[0]||(u[0]=f=>i.modelValue.companyName=f),placeholder:e(l)("customer.property.companyName"),name:"companyName",disabled:i.disabled,clearable:""},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),n(S,{prop:"fullName",label:`${e(l)("customer.property.fullName")}:`},{default:o(()=>[n(d,{modelValue:i.modelValue.fullName,"onUpdate:modelValue":u[1]||(u[1]=f=>i.modelValue.fullName=f),placeholder:e(l)("customer.form.fullNamePlaceholder"),name:"name",disabled:i.disabled,clearable:""},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),n(S,{label:`${e(l)("customer.form.address")}:`},{default:o(()=>[n(yt,{modelValue:i.modelValue.address,"onUpdate:modelValue":u[2]||(u[2]=f=>i.modelValue.address=f),disabled:i.disabled,placeholder:e(l)("customer.form.googleMaps")},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"]),v("div",null,[n(S,{label:`${e(l)("customer.property.telephone")}:`,"label-width":"90px",prop:"telephone"},{default:o(()=>[n(d,{modelValue:i.modelValue.telephone,"onUpdate:modelValue":u[3]||(u[3]=f=>i.modelValue.telephone=f),name:"telephone",placeholder:e(l)("customer.property.telephone"),disabled:i.disabled,clearable:""},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),n(S,{label:`${e(l)("customer.property.mobile")}:`,"label-width":"90px"},{default:o(()=>[n(d,{modelValue:i.modelValue.mobile,"onUpdate:modelValue":u[4]||(u[4]=f=>i.modelValue.mobile=f),name:"mobile",placeholder:e(l)("customer.property.mobile"),disabled:i.disabled,clearable:""},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),n(S,{label:`${e(l)("customer.property.fax")}:`,"label-width":"90px"},{default:o(()=>[n(d,{modelValue:i.modelValue.fax,"onUpdate:modelValue":u[5]||(u[5]=f=>i.modelValue.fax=f),name:"fax",placeholder:e(l)("customer.property.fax"),disabled:i.disabled,clearable:""},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),n(S,{label:`${e(l)("customer.property.email")}:`,"label-width":"90px",prop:"email"},{default:o(()=>[n(d,{modelValue:i.modelValue.email,"onUpdate:modelValue":u[6]||(u[6]=f=>i.modelValue.email=f),name:"email",placeholder:e(l)("customer.property.email"),disabled:i.disabled,clearable:""},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"])])]),_:1},8,["label-position","model"])):$("",!0)}}});function js(i){const l=ft().createScope(),s=ot(i.assignment);return I({get(){return!!s.value?.addressPropertyUuid&&s.value.addressPropertyUuid===s.value?.customer?.addressUuid},set(u){s.value?.customer?.address&&(u?(s.value.addressProperty&&l.resetOrRemove(s.value.addressProperty),s.value.addressProperty=s.value.customer.address):s.value.addressProperty=l.construct(xa(s.value.customer.address,["id","uuid","createdAt","updatedAt","deletedAt"])))}})}const Ns={class:"grid gap-2"},go=W({__name:"AddressPropertyForm",props:{assignment:{},clickable:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},setup(i){const l=i,s=js({assignment:()=>l.assignment});return(t,u)=>{const d=sa;return r(),U("div",Ns,[v("div",null,[n(d,{"model-value":e(s),"onUpdate:modelValue":u[0]||(u[0]=S=>s.value=!!S)},{default:o(()=>[x(p(t.$t("forms.assignment.propertyAddressIsSameAsCustomerAddress")),1)]),_:1},8,["model-value"]),n(yt,{modelValue:t.assignment.addressProperty,"onUpdate:modelValue":u[1]||(u[1]=S=>t.assignment.addressProperty=S),disabled:e(s),placeholder:t.$t("createAssignment.GoogleMapsProperty")},null,8,["modelValue","disabled","placeholder"])]),n(Sa,{address:t.assignment.addressProperty,class:"mt-2 w-full !h-80",clickable:t.clickable,draggable:t.draggable,readonly:t.readonly||e(s)},null,8,["address","clickable","draggable","readonly"]),!t.assignment.addressProperty?.googleString&&t.assignment.addressProperty?.latitude?(r(),y(Na,{key:0,modelValue:t.assignment.addressProperty,"onUpdate:modelValue":u[2]||(u[2]=S=>t.assignment.addressProperty=S),class:"mt-2"},null,8,["modelValue"])):$("",!0)])}}});export{yo as _,fo as a,go as b,co as c,po as d,vo as e,et as f,dn as g,Oe as h};
