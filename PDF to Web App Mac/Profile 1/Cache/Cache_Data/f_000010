import{a as Y,ag as z,s as Z,u as tt,Y as C,e4 as B,eF as et,U as $,w as st,X as nt,r as F,H as it,b as at,o as x,e as T,f as P,g as _,aB as ot,c as y,h as E,j as I,az as D,ah as V,i as A,t as S,k as O,l as rt,en as ht,m as lt}from"./vendor-DP6O45ke.js";import{a as ct}from"./custom-forms-CQ9kZIgl.js";import{_ as ut}from"./ArtesaFormElement.vue_vue_type_script_setup_true_lang-D9BNQHXF.js";import{t as dt,P as mt,A as gt,z as ft}from"./index-Dsay-W0g.js";import"./ajv-8eipPnTn.js";/*!
 * Signature Pad v3.0.0-beta.4 | https://github.com/szimek/signature_pad
 * (c) 2020 Szymon Nowak | Released under the MIT license
 */class W{constructor(t,e,s){this.x=t,this.y=e,this.time=s||Date.now()}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}equals(t){return this.x===t.x&&this.y===t.y&&this.time===t.time}velocityFrom(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):0}}class U{constructor(t,e,s,i,n,r){this.startPoint=t,this.control2=e,this.control1=s,this.endPoint=i,this.startWidth=n,this.endWidth=r}static fromPoints(t,e){const s=this.calculateControlPoints(t[0],t[1],t[2]).c2,i=this.calculateControlPoints(t[1],t[2],t[3]).c1;return new U(t[1],s,i,t[2],e.start,e.end)}static calculateControlPoints(t,e,s){const i=t.x-e.x,n=t.y-e.y,r=e.x-s.x,o=e.y-s.y,l={x:(t.x+e.x)/2,y:(t.y+e.y)/2},h={x:(e.x+s.x)/2,y:(e.y+s.y)/2},c=Math.sqrt(i*i+n*n),v=Math.sqrt(r*r+o*o),w=l.x-h.x,f=l.y-h.y,d=v/(c+v),m={x:h.x+w*d,y:h.y+f*d},p=e.x-m.x,b=e.y-m.y;return{c1:new W(l.x+p,l.y+b),c2:new W(h.x+p,h.y+b)}}length(){let e=0,s,i;for(let n=0;n<=10;n+=1){const r=n/10,o=this.point(r,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),l=this.point(r,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(n>0){const h=o-s,c=l-i;e+=Math.sqrt(h*h+c*c)}s=o,i=l}return e}point(t,e,s,i,n){return e*(1-t)*(1-t)*(1-t)+3*s*(1-t)*(1-t)*t+3*i*(1-t)*t*t+n*t*t*t}}function vt(a,t=250){let e=0,s=null,i,n,r;const o=()=>{e=Date.now(),s=null,i=a.apply(n,r),s||(n=null,r=[])};return function(...h){const c=Date.now(),v=t-(c-e);return n=this,r=h,v<=0||v>t?(s&&(clearTimeout(s),s=null),e=c,i=a.apply(n,r),s||(n=null,r=[])):s||(s=window.setTimeout(o,v)),i}}class L{constructor(t,e={}){this.canvas=t,this.options=e,this._handleMouseDown=s=>{s.which===1&&(this._mouseButtonDown=!0,this._strokeBegin(s))},this._handleMouseMove=s=>{this._mouseButtonDown&&this._strokeMoveUpdate(s)},this._handleMouseUp=s=>{s.which===1&&this._mouseButtonDown&&(this._mouseButtonDown=!1,this._strokeEnd(s))},this._handleTouchStart=s=>{if(s.preventDefault(),s.targetTouches.length===1){const i=s.changedTouches[0];this._strokeBegin(i)}},this._handleTouchMove=s=>{s.preventDefault();const i=s.targetTouches[0];this._strokeMoveUpdate(i)},this._handleTouchEnd=s=>{if(s.target===this.canvas){s.preventDefault();const n=s.changedTouches[0];this._strokeEnd(n)}},this.velocityFilterWeight=e.velocityFilterWeight||.7,this.minWidth=e.minWidth||.5,this.maxWidth=e.maxWidth||2.5,this.throttle="throttle"in e?e.throttle:16,this.minDistance="minDistance"in e?e.minDistance:5,this.dotSize=e.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=e.penColor||"black",this.backgroundColor=e.backgroundColor||"rgba(0,0,0,0)",this.onBegin=e.onBegin,this.onEnd=e.onEnd,this._strokeMoveUpdate=this.throttle?vt(L.prototype._strokeUpdate,this.throttle):L.prototype._strokeUpdate,this._ctx=t.getContext("2d"),this.clear(),this.on()}clear(){const{_ctx:t,canvas:e}=this;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._data=[],this._reset(),this._isEmpty=!0}fromDataURL(t,e={},s){const i=new Image,n=e.ratio||window.devicePixelRatio||1,r=e.width||this.canvas.width/n,o=e.height||this.canvas.height/n;this._reset(),i.onload=()=>{this._ctx.drawImage(i,0,0,r,o),s&&s()},i.onerror=l=>{s&&s(l)},i.src=t,this._isEmpty=!1}toDataURL(t="image/png",e){switch(t){case"image/svg+xml":return this._toSVG();default:return this.canvas.toDataURL(t,e)}}on(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",window.PointerEvent?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())}off(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.removeEventListener("pointerdown",this._handleMouseDown),this.canvas.removeEventListener("pointermove",this._handleMouseMove),document.removeEventListener("pointerup",this._handleMouseUp),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)}isEmpty(){return this._isEmpty}fromData(t){this.clear(),this._fromData(t,({color:e,curve:s})=>this._drawCurve({color:e,curve:s}),({color:e,point:s})=>this._drawDot({color:e,point:s})),this._data=t}toData(){return this._data}_strokeBegin(t){const e={color:this.penColor,points:[]};typeof this.onBegin=="function"&&this.onBegin(t),this._data.push(e),this._reset(),this._strokeUpdate(t)}_strokeUpdate(t){if(this._data.length===0){this._strokeBegin(t);return}const e=t.clientX,s=t.clientY,i=this._createPoint(e,s),n=this._data[this._data.length-1],r=n.points,o=r.length>0&&r[r.length-1],l=o?i.distanceTo(o)<=this.minDistance:!1,h=n.color;if(!o||!(o&&l)){const c=this._addPoint(i);o?c&&this._drawCurve({color:h,curve:c}):this._drawDot({color:h,point:i}),r.push({time:i.time,x:i.x,y:i.y})}}_strokeEnd(t){this._strokeUpdate(t),typeof this.onEnd=="function"&&this.onEnd(t)}_handlePointerEvents(){this._mouseButtonDown=!1,this.canvas.addEventListener("pointerdown",this._handleMouseDown),this.canvas.addEventListener("pointermove",this._handleMouseMove),document.addEventListener("pointerup",this._handleMouseUp)}_handleMouseEvents(){this._mouseButtonDown=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)}_handleTouchEvents(){this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)}_reset(){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor}_createPoint(t,e){const s=this.canvas.getBoundingClientRect();return new W(t-s.left,e-s.top,new Date().getTime())}_addPoint(t){const{_lastPoints:e}=this;if(e.push(t),e.length>2){e.length===3&&e.unshift(e[0]);const s=this._calculateCurveWidths(e[1],e[2]),i=U.fromPoints(e,s);return e.shift(),i}return null}_calculateCurveWidths(t,e){const s=this.velocityFilterWeight*e.velocityFrom(t)+(1-this.velocityFilterWeight)*this._lastVelocity,i=this._strokeWidth(s),n={end:i,start:this._lastWidth};return this._lastVelocity=s,this._lastWidth=i,n}_strokeWidth(t){return Math.max(this.maxWidth/(t+1),this.minWidth)}_drawCurveSegment(t,e,s){const i=this._ctx;i.moveTo(t,e),i.arc(t,e,s,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve({color:t,curve:e}){const s=this._ctx,i=e.endWidth-e.startWidth,n=Math.floor(e.length())*2;s.beginPath(),s.fillStyle=t;for(let r=0;r<n;r+=1){const o=r/n,l=o*o,h=l*o,c=1-o,v=c*c,w=v*c;let f=w*e.startPoint.x;f+=3*v*o*e.control1.x,f+=3*c*l*e.control2.x,f+=h*e.endPoint.x;let d=w*e.startPoint.y;d+=3*v*o*e.control1.y,d+=3*c*l*e.control2.y,d+=h*e.endPoint.y;const m=Math.min(e.startWidth+h*i,this.maxWidth);this._drawCurveSegment(f,d,m)}s.closePath(),s.fill()}_drawDot({color:t,point:e}){const s=this._ctx,i=typeof this.dotSize=="function"?this.dotSize():this.dotSize;s.beginPath(),this._drawCurveSegment(e.x,e.y,i),s.closePath(),s.fillStyle=t,s.fill()}_fromData(t,e,s){for(const i of t){const{color:n,points:r}=i;if(r.length>1)for(let o=0;o<r.length;o+=1){const l=r[o],h=new W(l.x,l.y,l.time);this.penColor=n,o===0&&this._reset();const c=this._addPoint(h);c&&e({color:n,curve:c})}else this._reset(),s({color:n,point:r[0]})}}_toSVG(){const t=this._data,e=Math.max(window.devicePixelRatio||1,1),s=0,i=0,n=this.canvas.width/e,r=this.canvas.height/e,o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("width",this.canvas.width.toString()),o.setAttribute("height",this.canvas.height.toString()),this._fromData(t,({color:f,curve:d})=>{const m=document.createElement("path");if(!isNaN(d.control1.x)&&!isNaN(d.control1.y)&&!isNaN(d.control2.x)&&!isNaN(d.control2.y)){const p=`M ${d.startPoint.x.toFixed(3)},${d.startPoint.y.toFixed(3)} C ${d.control1.x.toFixed(3)},${d.control1.y.toFixed(3)} ${d.control2.x.toFixed(3)},${d.control2.y.toFixed(3)} ${d.endPoint.x.toFixed(3)},${d.endPoint.y.toFixed(3)}`;m.setAttribute("d",p),m.setAttribute("stroke-width",(d.endWidth*2.25).toFixed(3)),m.setAttribute("stroke",f),m.setAttribute("fill","none"),m.setAttribute("stroke-linecap","round"),o.appendChild(m)}},({color:f,point:d})=>{const m=document.createElement("circle"),p=typeof this.dotSize=="function"?this.dotSize():this.dotSize;m.setAttribute("r",p.toString()),m.setAttribute("cx",d.x.toString()),m.setAttribute("cy",d.y.toString()),m.setAttribute("fill",f),o.appendChild(m)});const l="data:image/svg+xml;base64,",h=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="${s} ${i} ${n} ${r}" width="${n}" height="${r}">`;let c=o.innerHTML;if(c===void 0){const f=document.createElement("dummy"),d=o.childNodes;f.innerHTML="";for(let m=0;m<d.length;m+=1)f.appendChild(d[m].cloneNode(!0));c=f.innerHTML}const w=h+c+"</svg>";return l+btoa(w)}}var pt={format:"image/png",quality:.92,width:void 0,height:void 0,Canvas:void 0,crossOrigin:void 0},j=function(a,t){return a===void 0&&(a=[]),t===void 0&&(t={}),new Promise(function(e){t=Object.assign({},pt,t);var s=t.Canvas?new t.Canvas:window.document.createElement("canvas"),i=t.Canvas?t.Canvas.Image:window.Image;t.Canvas&&(t.quality*=100);var n=a.map(function(o){return new Promise(function(l,h){o.constructor.name!=="Object"&&(o={src:o});var c=new i;c.crossOrigin=t.crossOrigin,c.onerror=function(){return h(new Error("Couldn't load image"))},c.onload=function(){return l(Object.assign({},o,{img:c}))},c.src=o.src})}),r=s.getContext("2d");e(Promise.all(n).then(function(o){var l=function(h){return t[h]||Math.max.apply(Math,o.map(function(c){return c.img[h]}))};return s.width=l("width"),s.height=l("height"),o.forEach(function(h){return r.globalAlpha=h.opacity?h.opacity:1,r.drawImage(h.img,h.x||0,h.y||0)}),t.Canvas&&t.format==="image/jpeg"?new Promise(function(h){s.toDataURL(t.format,{quality:t.quality,progressive:!1},function(c,v){if(c)throw c;h(v)})}):s.toDataURL(t.format,t.quality)}))})};const N=["image/png","image/jpeg","image/svg+xml"],yt=a=>N.includes(a),_t={dotSize:(.5+2.5)/2,minWidth:.5,maxWidth:2.5,throttle:16,minDistance:5,backgroundColor:"rgba(0,0,0,0)",penColor:"black",velocityFilterWeight:.7,onBegin:()=>{},onEnd:()=>{}},q=a=>JSON.parse(JSON.stringify(a)),H={src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",x:0,y:0};var G=Y({name:"VueSignaturePad",props:{width:{type:String,default:"100%"},height:{type:String,default:"100%"},customStyle:{type:Object,default:()=>({})},options:{type:Object,default:()=>({})},images:{type:Array,default:()=>[]},scaleToDevicePixelRatio:{type:Boolean,default:()=>!0}},data:()=>({signaturePad:{},cacheImages:[],signatureData:H,onResizeHandler:null}),computed:{propsImagesAndCustomImages(){const a=q(this.images),t=q(this.cacheImages);return[...a,...t]}},watch:{options:function(a){Object.keys(a).forEach(t=>{this.signaturePad[t]&&(this.signaturePad[t]=a[t])})}},mounted(){const{options:a}=this,t=this.$refs.signaturePadCanvas,e=new L(t,{..._t,...a});this.signaturePad=e,a.resizeHandler&&(this.resizeCanvas=a.resizeHandler.bind(this)),this.onResizeHandler=this.resizeCanvas.bind(this),window.addEventListener("resize",this.onResizeHandler,!1),this.resizeCanvas()},beforeUnmount(){this.onResizeHandler&&window.removeEventListener("resize",this.onResizeHandler,!1)},methods:{resizeCanvas(){const a=this.$refs.signaturePadCanvas,t=this.signaturePad.toData(),e=this.scaleToDevicePixelRatio?Math.max(window.devicePixelRatio||1,1):1;a.width=a.offsetWidth*e,a.height=a.offsetHeight*e,a.getContext("2d").scale(e,e),this.signaturePad.clear(),this.signatureData=H,this.signaturePad.fromData(t)},saveSignature(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:N[0],t=arguments.length>1?arguments[1]:void 0;const{signaturePad:e}=this,s={isEmpty:!1,data:void 0};if(!yt(a)){const i=N.join(", ");throw new Error(`The Image type is incorrect! We are support ${i} types.`)}return e.isEmpty()?{...s,isEmpty:!0}:(this.signatureData=e.toDataURL(a,t),{...s,data:this.signatureData})},undoSignature(){const{signaturePad:a}=this,t=a.toData();if(t)return a.fromData(t.slice(0,-1))},mergeImageAndSignature(a){return this.signatureData=a,j([...this.images,...this.cacheImages,this.signatureData])},addImages(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return this.cacheImages=[...this.cacheImages,...a],j([...this.images,...this.cacheImages,this.signatureData])},fromDataURL(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return this.signaturePad.fromDataURL(a,t,e)},fromData(a){return this.signaturePad.fromData(a)},toData(){return this.signaturePad.toData()},lockSignaturePad(){return this.signaturePad.off()},openSignaturePad(){return this.signaturePad.on()},isEmpty(){return this.signaturePad.isEmpty()},getPropImagesAndCacheImages(){return this.propsImagesAndCustomImages},clearCacheImages(){return this.cacheImages=[],this.cacheImages},clearSignature(){return this.signaturePad.clear()}},render(){const{width:a,height:t,customStyle:e}=this;return z("div",{style:{width:a,height:t,...e}},[z("canvas",{style:{width:a,height:t},ref:"signaturePadCanvas"})])}});G.__file="src/components/VueSignaturePad.vue";const wt={class:"absolute right-0 mt-1 mr-1"},xt={class:"h-[100px] w-[366px]"},Pt=["src"],St={class:"flex gap-2 justify-between text-slate-500 text-sm border-t border-[var(--el-border-color)] mx-1 px-2 pt-0.5 pb-1"},Et={key:1,class:"text-slate-300"},Ct={key:1,class:"text-slate-300"},Dt={class:"flex flex-col gap-2"},At={class:"flex gap-1 items-center"},bt={class:"text-slate-400 text-sm"},kt={class:"flex gap-2 justify-end flex-wrap"},Mt={class:"flex-1"},Nt=Y({__name:"ArtesaCustomFormSignatureInput",props:{uiSchema:{type:Object,required:!0},data:{type:Object,required:!0},suppressError:{type:Boolean,default:!1}},setup(a){const t=a,e=Z(null),s=ct(),{t:i}=tt(),n=C({get(){return B(t.data,t.uiSchema.scope)},set(u){et(t.data,t.uiSchema.scope,u)}}),r=C({get(){return n.value?.signature},set(u){n.value??={},n.value.signature=u}}),o=C({get(){return n.value?.timestamp?new Date(n.value.timestamp):void 0},set(u){n.value??={},n.value.timestamp=u?.toISOString()}}),l=C({get(){return n.value?.name??void 0},set(u){n.value??={},n.value.name=u}}),h=dt().createScope(),c=mt().createScope(),v=C(()=>{if(!t.uiSchema.options?.defaultName?.scope)return;const u=B(t.data,t.uiSchema.options.defaultName.scope);if(typeof u!="number")return;const{type:g}=t.uiSchema.options.defaultName;if(g==="customer")return c.getFromStore(u).value?.fullName??void 0;if(g==="user")return h.getFromStore(u).value?.fullName??void 0});$(v,(u,g)=>{r.value||s.readonly.value||(!l.value||g===l.value)&&(l.value=u)},{immediate:!0}),st(()=>!!e.value,()=>{w()}),nt(n,()=>{w()},{debounce:500});function w(){n.value&&typeof n.value=="string"&&e.value?.fromDataURL(n.value)}function f(){const u=e.value?.saveSignature();u&&!u.isEmpty?(r.value=u.data,o.value=new Date):u&&u.isEmpty&&d()}function d(){e.value?.clearSignature(),r.value=void 0,o.value=void 0}const m=F(),p=F(!1);$(p,u=>{u?(m.value=it(n.value),d()):m.value=void 0});function b(){m.value&&(n.value=m.value),p.value=!1,m.value=void 0}function X(){e.value?.resizeCanvas()}const{formattedError:J}=s.useError({uiSchema:()=>t.uiSchema,data:()=>t.data,suppressError:()=>t.suppressError,formatError:u=>{if(u.isRequired||u.errors.some(g=>g.keyword==="required"&&g.params?.missingProperty==="signature"))return i("validation.signature.signatureRequired")}});return(u,g)=>{const k=at("font-awesome-icon"),M=rt,K=ht,Q=lt;return x(),T(ut,{"ui-schema":a.uiSchema,error:y(J)},{default:P(()=>[_("div",{class:ot(["artesa-signature-pad-container border border-[var(--el-border-color)] rounded relative max-w-[366px] w-full",a.uiSchema.class])},[_("div",wt,[y(s).readonly.value?I("",!0):(x(),T(gt,{key:0,content:u.$t("actions.sign")},{default:P(()=>[E(M,{class:"artesa-signature-pad-clear-button",circle:"",plain:"",onClick:g[0]||(g[0]=()=>p.value=!0)},{default:P(()=>[E(k,{icon:"pencil-alt",class:"text-xs"})]),_:1})]),_:1},8,["content"]))]),_("div",xt,[y(n)?.signature?(x(),D("img",{key:0,src:y(n)?.signature,class:"h-[100px] w-[366px]"},null,8,Pt)):I("",!0)]),_("div",St,[_("div",null,[y(l)?(x(),D(V,{key:0},[A(S(y(l)),1)],64)):(x(),D("span",Et,"("+S(u.$t("customer.property.fullName"))+")",1))]),_("div",null,[y(o)?(x(),D(V,{key:0},[A(S(y(ft)(y(o),{showYear:!0})),1)],64)):(x(),D("span",Ct,"("+S(u.$t("Date"))+")",1))])])],2),y(p)?(x(),T(Q,{key:0,modelValue:y(p),"onUpdate:modelValue":g[5]||(g[5]=R=>O(p)?p.value=R:null),"close-on-press-escape":!1,"close-on-click-modal":!1,"show-close":!1,class:"dialog-messagebox-[400px] dialog-center"},{header:P(()=>[A(S(a.uiSchema.title??u.$t("signature")),1)]),default:P(()=>[_("div",Dt,[E(y(G),{ref_key:"refSignature",ref:e,options:{onBegin:X,onEnd:f,minWidth:1,maxWidth:2},height:"100px",class:"artesa-signature-pad border border-slate-300 rounded min-h-[100px]"},null,8,["options"]),_("div",At,[_("div",bt,S(u.$t("customer.property.fullName"))+":",1),E(K,{modelValue:y(l),"onUpdate:modelValue":g[1]||(g[1]=R=>O(l)?l.value=R:null)},null,8,["modelValue"])]),_("div",kt,[_("div",Mt,[y(r)?(x(),T(M,{key:0,onClick:g[2]||(g[2]=()=>d())},{default:P(()=>[E(k,{icon:"undo",class:"text-xs"})]),_:1})):I("",!0)]),E(M,{text:"",onClick:g[3]||(g[3]=()=>b())},{default:P(()=>[A(S(u.$t("actions.Cancel")),1)]),_:1}),E(M,{type:"primary",onClick:g[4]||(g[4]=()=>p.value=!1)},{default:P(()=>[A(S(u.$t("actions.sign")),1)]),_:1})])])]),_:1},8,["modelValue"])):I("",!0)]),_:1},8,["ui-schema","error"])}}});export{Nt as default};
