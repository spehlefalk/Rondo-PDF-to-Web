import{fe as yt,r as C,U as O,V as _t,Y as i,a as ee,u as _e,b as ie,o as n,az as x,g as A,aB as M,c as e,h as p,i as B,t as T,j as E,ez as re,eA as he,ah as j,e1 as Q,e as D,f as b,l as be,fJ as xe,aZ as we,fR as bt,f4 as xt,eD as Be,a_ as De,eE as wt,X as kt,k as K,b0 as Ce,en as Le,fF as Ne,a$ as Pe,x as It,aI as We,M as At,fX as Ut,e2 as ye,_ as Tt,eS as Ve,s as St,b8 as Et,ey as $t,w as Dt,aL as Ct,eG as Nt,eH as Pt,eo as Vt,ep as Ft,fY as qt,m as Mt,f0 as Bt,af as pe,eI as Lt}from"./vendor-DP6O45ke.js";import{a as J}from"./index-5ygR7EGk.js";import{ak as Wt,b as Re,K as ze,ah as ke,F as Oe,al as Rt,W as Fe,i as je,am as zt,an as Ot,ao as jt,ap as Gt,N as Ht,u as Yt,d as Xt,t as Zt,M as Kt,a1 as Jt,G as Qt,a as es,v as ts,Z as qe}from"./index-Dsay-W0g.js";import{_ as ss}from"./TimeTrackingPanel.vue_vue_type_script_setup_true_lang-CxTyk-sb.js";import{_ as ns}from"./DialogDoingAssignmentCard.vue_vue_type_style_index_0_lang-BKabMcVu.js";import{u as Ge,_ as as}from"./manufacturing.store-DEQjZZFM.js";import{a as He,b as Ye,c as Me,d as rs,u as os}from"./timeTracking.store-Bco63arA.js";import{a as oe}from"./index-DuDPwDMn.js";import{i as is}from"./index---ixMF9r.js";import{u as ls}from"./chat.store-WmbfM-QW.js";import{u as us}from"./useAssignmentEventTypesForUser-B5XFrTNb.js";import{u as ge}from"./useCompanySettingValue-VN6qEXyo.js";import{_ as ds}from"./SelectUser.vue_vue_type_script_setup_true_lang-ecQ9vvXJ.js";import"./index-DqnrlXPQ.js";import"./useCustomForms-D5R88O9b.js";import"./GridTable.vue_vue_type_style_index_0_lang-D3VXJpla.js";import"./ArtesaProfilePicture.vue_vue_type_script_setup_true_lang-NQqm-LCY.js";import"./upload.store-CU1g3nY9.js";import"./index-CJWmrMZX.js";import"./assignment-events.helpers-CWYDlrj6.js";import"./stairs.helpers-BIn33vMK.js";import"./colorHelpers-Di3bZx5J.js";import"./AddressMap.vue_vue_type_script_setup_true_lang-CdLWc4NG.js";import"./PopperFeathersItems.vue_vue_type_script_setup_true_lang-Dj8XPvGz.js";import"./usePagination-Ryv7wWJy.js";import"./user-capabilities.store-B-DXkmw8.js";import"./useIsUserOfRole-CsP1Paeq.js";import"./useRole-C0PbMcty.js";import"./AssignmentEventName.vue_vue_type_script_setup_true_lang-DS0TEwVk.js";import"./ButtonAddressNavigation.vue_vue_type_script_setup_true_lang-ZW4GNuo6.js";import"./useServiceEventListener-DCg5b4lA.js";import"./useContainerQuery-B2PH6oRc.js";import"./index-BcZtb1eP.js";import"./computedDebounced-DaN6cEOJ.js";const cs={time:30,updateInterval:1e3};function ms(g){const{time:l,updateInterval:f}=Object.assign({},cs,g),{idle:h,lastActive:k}=yt(l*1e3),c=C(l);let y=null;O(h,_=>{_?U():v()});function v(){c.value=l,y&&(clearInterval(y),y=null),y=setInterval(()=>{if(c.value<f){U();return}c.value=c.value-f},f)}function U(){y&&(clearInterval(y),y=null),c.value=0}return v(),{idle:h,lastActive:k,remainingTime:c}}function fs(g){const l=_t(g.ids),f=Wt(g.store),h=C([]);return O(l,c=>{if(!c.length)return;const y=[];c.forEach(v=>{!f.localFind(v)&&!h.value.includes(v)&&y.push(v)}),y.length&&(f.find({query:{id:{$in:y},$limit:y.length}}),h.value=[...h.value,...y])}),{items:i(()=>{const c=[],y=f.findInStore({query:{id:{$in:l.value}}});return l.value.forEach(v=>{const U=y.find(_=>_.id===v);U&&c.push(U)}),c})}}const vs={key:0,class:"text-xs ml-2 md:ml-0 md:mt-2"},ps={key:1,class:"w-0 flex-1"},gs={class:"truncate"},hs={key:0,class:"text-xs font-normal mt-1"},ys={key:1,class:"text-xs font-normal mt-1"},_s={class:"text-xs mt-2"},bs=ee({__name:"WorkerCard",props:{user:{type:Object,required:!0},workPeriods:{type:Array,required:!0},eventUsers:{type:Array,default:()=>[]}},emits:["click-event"],setup(g){const l=g,{t:f}=_e(),h=C(!1),k=C(null),c=Ge(),y=Re(),v=ze().createScope(),U=i(()=>c.isUserActive),_=i(()=>c.activeUser);He({user:()=>l.user,local:!0});const{unaccountablePeriods:F,hasUnaccountablePeriods:L}=Ye({user:()=>l.user,local:!0}),$=i(()=>!U.value||!_.value||_.value.id!==l.user.id);function q(o){c.isSupervisor&&c.setActiveUser(o)}function V(){h.value=!h.value}function W(o){if(k.value){k.value=null,V();return}k.value=setTimeout(()=>{const d=!k.value;k.value=null,!d&&q(o)},150)}const u=i(()=>[...new Set([...l.eventUsers.map(o=>o.eventId),...l.workPeriods.map(o=>o.eventId)])].filter(Oe)),{items:a}=fs({store:v,ids:u}),m=i(()=>{const o={};return u.value.forEach(d=>{o[d]={eventUsers:[],workPeriods:[],activeWorkPeriods:[],pausedWorkPeriods:[]}}),l.eventUsers.forEach(d=>{o[d.eventId].eventUsers.push(d)}),l.workPeriods.forEach(d=>{d.eventId&&(o[d.eventId].workPeriods.push(d),d.end||o[d.eventId].activeWorkPeriods.push(d),d.pausedAt&&o[d.eventId].pausedWorkPeriods.push(d))}),o}),P=i(()=>{const o={};return l.workPeriods.forEach(d=>{d.end||!d.eventId||(o[d.eventId]||(o[d.eventId]=[]),o[d.eventId].push(d))}),o});return(o,d)=>{const I=ie("font-awesome-icon"),N=be;return n(),x("div",{class:M(["worker-card flex flex-col md:flex-row mb-2 border-2 rounded transition-all",{"bg-red-600 border-red-600 shadow":!e($),"bg-red-300 opacity-80 text-gray-450 border-red-300":e($)}])},[A("div",{class:M(["flex w-full md:w-28 text-white transition-all",{"flex-row flex-1":e(h),"flex-row md:flex-col":!e(h),"opacity-50":e($),"bg-red-600":!e($)}])},[A("div",{class:M(["self-start text-gray-800 cursor-pointer m-1 py-1 px-2 transition-all",{"bg-white":!e($),"bg-slate-100":e($)}]),onClick:d[0]||(d[0]=r=>h.value=!e(h))},[p(I,{icon:e(h)?"angle-down":"angle-up","fixed-width":""},null,8,["icon"])],2),A("div",{class:M(["flex flex-1 justify-center items-center text-center py-2 px-1 flex-row md:flex-col",{"cursor-pointer":e(c).isSupervisor&&g.user!==e(_)}]),onClick:d[1]||(d[1]=r=>W(g.user))},[B(T(g.user.fullName)+" ",1),g.user.shortName?(n(),x("div",vs,"("+T(g.user.shortName)+")",1)):E("",!0)],2)],2),re(A("div",{class:M(["flex flex-1 flex-wrap gap-1 p-2",{"bg-white":!e($),"bg-slate-100":e($),"max-md:rounded-b-sm md:rounded-r-sm":!e(L)}])},[(n(!0),x(j,null,Q(e(a),r=>re((n(),D(N,{key:r.uuid,disabled:e($),class:"w-[170px] !h-12 text-lg !p-1 !flex !items-stretch [&>span]:!flex [&>span]:!flex-1 [&>span]:!overflow-hidden",type:e(m)[r.id].workPeriods.length?"danger":void 0,onClick:()=>o.$emit("click-event",r)},{default:b(()=>[r?.completedAt?(n(),D(I,{key:0,icon:"check",class:"text-xs flex-none mx-2"})):E("",!0),r.assignment?(n(),x("div",ps,[A("div",gs,T(e(ke)(r.assignment,e(y).assignmentNameToShow)),1),e(m)[r.id].activeWorkPeriods.length?(n(),x("div",hs,T(e(f)("tracking.time.checkedInSince",{since:e(Me)(e(P)[r.id][0].start).value})),1)):e(m)[r.id].pausedWorkPeriods.length?(n(),x("div",ys,T(e(f)("paused")),1)):E("",!0)])):E("",!0)]),_:2},1032,["disabled","type","onClick"])),[[he,!e(h)&&r]])),128))],2),[[he,!e(h)]]),e(F).length>0&&!e(h)?(n(),x("div",{key:0,class:M(["flex items-center justify-center p-1 max-md:border-t md:border-l max-md:rounded-b-sm md:rounded-r-sm",{"bg-white border-red-600":!e($),"bg-slate-100 border-red-300":e($)}])},[(n(!0),x(j,null,Q(e(F),r=>(n(),D(N,{key:r.uuid,disabled:"",type:"warning",class:"min-w-[170px] !h-12 text-lg p-2 [&>span]:flex [&>span]:flex-col"},{default:b(()=>[B(T(r.type?.name)+" ",1),A("div",_s,T(e(f)("tracking.time.checkedInSince",{since:e(Me)(r.start).value})),1)]),_:2},1024))),128))],2)):E("",!0)],2)}}});function xs(g){return xe(1,arguments),we(g,oe(Date.now(),1))}function ws(g,l){xe(2,arguments);var f=bt(l);return oe(g,-f)}function ks(g){return xe(1,arguments),we(g,ws(Date.now(),1))}const Is={class:"flex-1 flex w-0 justify-center items-center"},As={class:"truncate px-1"},Us={key:0,class:"truncate text-xs mt-1 px-1"},Ts={class:"flex justify-center items-center py-1 pr-1"},Ss=ee({__name:"AssignmentButton",props:{event:{},disabled:{type:Boolean,default:!1},eventUsers:{default:()=>[]},assignmentNameToShow:{default:Rt[0]}},emits:["click","update:isDialogVisible"],setup(g,{emit:l}){const f=g,h=l,k=i(()=>({assignmentId:f.event.assignmentId})),c=ls(),{hasUnreadMessages:y}=c.useHasUnreadChatMessages(k),v=i(()=>{const{endsAt:a}=f.event;return a?Fe(a,"dd."):null}),U=i(()=>{const{endsAt:a}=f.event;return a?Fe(a,"MM."):null}),_=xt({interval:1e3*60*30}),F=i(()=>{const{endsAt:a}=f.event;return a?we(a,_.value):!1}),L=i(()=>oe(_.value,-1)),$=i(()=>{const{endsAt:a}=f.event;return a?De(a,L.value):!1}),q=i(()=>oe(_.value,-3)),V=i(()=>{const{endsAt:a}=f.event;return a?De(a,q.value):!1}),W=i(()=>f.event.completedAt||F.value?"bg-success text-white":V.value?"bg-danger text-white":$.value?"bg-warning text-gray-700":"");function u(){h("click",f.event)}return(a,m)=>{const P=ie("font-awesome-icon"),o=wt,d=be;return n(),D(d,{class:"!h-10 w-full text-lg !p-0 !flex !items-stretch [&>span]:!flex [&>span]:!flex-1 [&>span]:!overflow-hidden",disabled:a.disabled,onClick:Be(u,["prevent"])},{default:b(()=>[e(v)?(n(),x("div",{key:0,class:M(["text-xs leading-tight px-1 flex flex-col justify-center items-center h-full rounded-l",e(W)])},[A("div",null,T(e(v)),1),A("div",null,T(e(U)),1)],2)):E("",!0),A("div",Is,[p(o,{"is-dot":"",hidden:!e(y),class:"badge overflow-x-hidden"},{default:b(()=>[A("div",As,T(e(ke)(a.event.assignment,a.assignmentNameToShow)),1),a.eventUsers.length?(n(),x("div",Us,[p(P,{icon:"user",class:"mr-1 opacity-60"}),B(" "+T(a.eventUsers.map(I=>I.user?.shortName||I.user?.fullName||"").join(", ")),1)])):E("",!0)]),_:1},8,["hidden"])]),A("div",Ts,[p(P,{icon:"angle-right",class:"text-xs"})])]),_:1},8,["disabled"])}}}),Es={class:"container-assignments flex flex-col"},$s={class:"flex justify-center text-center text-xl mb-2"},Ds={class:"px-1 mb-1"},Cs={class:"flex-1 relative overflow-y-auto"},Ns={class:"mt-2"},Ps={key:0,class:"bg-primary text-white text-center py-2 mb-1"},Vs={class:"px-1"},Fs=ee({__name:"AssignmentList",props:{events:{},disabled:{type:Boolean,default:!1},activeEventUuids:{default:()=>[]},eventUsers:{default:()=>[]}},setup(g){const l=g,{t:f}=_e(),h=je(),k=Re(),c=C(null);function y(u){return u.getTime().toString()}const v=i(()=>{const u=c.value?.toLowerCase();return u?l.events.filter(a=>a.assignment?.number.toLowerCase()?.includes(u)):l.events}),U=zt(),_=Ot({workDays:!0}),F=i(()=>{const u=[],a=Ne(v.value,"startsAt"),m=a.filter(o=>!o.startsAt||!o.endsAt),P=a.filter(o=>!!o.startsAt&&!!o.endsAt);if(P.length){const o=new Date(Math.min(...P.map(r=>r.startsAt.getTime()))),d=new Date(Math.max(...P.map(r=>r.endsAt.getTime())));let I=Ce(o),N=J(Pe(o),{days:-1});for(;I.getTime()<=d.getTime();){const r={start:N,end:Pe(I)};let z=P.filter(R=>{const se=R.startsAt,ne=R.endsAt&&R.endsAt>R.startsAt?R.endsAt:R.startsAt;return It(r,{start:se,end:ne})});z=Ne(z,"endsAt").reverse(),z.length&&u.push({key:I.getTime().toString(),relative:U(I,new Date),date:I,events:z}),I=J(I,{days:1}),N=J(N,{days:1})}}return m.length&&u.push({key:"null",date:null,events:m}),u}),L=i(()=>{const u={};for(const a of l.events)u[a.uuid]||(u[a.uuid]=[]);for(const a of l.eventUsers)u[a.eventUuid]||(u[a.eventUuid]=[]),u[a.eventUuid].push(a);return u}),$=i(()=>F.value.map(u=>u.date).filter(Oe)),q=C({}),V=rs(Ce,{interval:{minutes:60}});O(V,()=>{q.value={},W()}),kt($,async()=>{W()},{debounce:200});async function W(){const u=[];if($.value.forEach(m=>{if(!q.value[y(m)]){if(is(m)||xs(m)||ks(m)||jt(m)||Gt(m)){q.value[y(m)]=U(m,new Date);return}u.push(m)}}),!u.length||!h.value)return;const a=await Ht.service("calculate-working-times").calculateWorkingDaysForForAbsoluteDays({dates:u,companyId:h.value,dateToCompare:new Date});for(let m=0;m<a.counts.length;m++){const P=a.counts[m],o=u[m];q.value[o.getTime().toString()]=_(P,o)}}return(u,a)=>{const m=Le;return n(),x("div",Es,[A("div",$s,T(e(f)("manufacturing.AssignmentList")),1),A("div",Ds,[p(m,{modelValue:e(c),"onUpdate:modelValue":a[0]||(a[0]=P=>K(c)?c.value=P:null),placeholder:e(f)("manufacturing.Search"),clearable:"",disabled:u.disabled},null,8,["modelValue","placeholder","disabled"])]),A("div",Cs,[A("div",Ns,[(n(!0),x(j,null,Q(e(F),({key:P,date:o,relative:d,events:I})=>(n(),x("div",{key:P},[o||e(F).length!==1?(n(),x("div",Ps,[o?(n(),x(j,{key:0},[B(T(e(q)[y(o)]??d),1)],64)):(n(),x(j,{key:1},[B(T(e(f)("manufacturing.NotScheduled")),1)],64))])):E("",!0),A("div",Vs,[(n(!0),x(j,null,Q(I,N=>(n(),D(Ss,{key:N.uuid,disabled:u.disabled,type:u.activeEventUuids.includes(N.uuid)?"danger":void 0,event:N,"event-users":e(L)[N.uuid],"assignment-name-to-show":e(k).assignmentNameToShow,class:"mb-1",onClick:()=>u.$emit("click-event",N)},null,8,["disabled","type","event","event-users","assignment-name-to-show","onClick"]))),128))])]))),128))])])])}}}),qs=We(Fs,[["__scopeId","data-v-36fa8849"]]),Ms=ee({__name:"RfidListener",emits:["scanned"],setup(g,{emit:l}){const f=l,h=C(""),k=C(null);function c(U,_,F){const{key:L,target:$}=U,q=()=>$.tagName!=="INPUT"&&$.tagName!=="TEXTAREA"&&$.tagName!=="VUE-ADVANCED-CHAT",V=()=>L.length===1,W=()=>L[0].match(/^[A-Za-z0-9]+$/)[0]===L[0];return q()&&V()&&W()}function y(U){h.value+=U.key,v(),k.value||(k.value=setTimeout(()=>{f("scanned",h.value),h.value="",k.value=null},300))}function v(){k.value&&(clearTimeout(k.value),k.value=null)}return(U,_)=>{const F=ie("global-events");return n(),D(F,{filter:c,onKeyup:Be(y,["prevent"])})}}}),Bs=ee({__name:"ArtesaMarquee",props:{text:{type:String,default:""},type:{type:String,default:"danger"},duration:{type:String,default:"10"}},setup(g){const l=g,f=C(),h=C(null),k=C(!1),c=C(0),y=i(()=>c.value?{width:`${c.value}px`}:{}),v=i(()=>l.text.replace(/\n/g,"").trim());O(v,()=>{U()});const U=At(function(){const _=h.value;_&&(c.value=0,Tt(()=>{k.value=_.offsetWidth<_.scrollWidth,c.value=_.scrollWidth}))},350);return Ut(window,"resize",U),U(),(_,F)=>(n(),x("div",{ref_key:"refMarquee",ref:f,class:M([`alert-${g.type}`,"marquee bg-danger text-white"])},[A("span",{ref_key:"refMarqueeSpan",ref:h,class:M([[{animating:e(k)},`duration-${g.duration}`],"marquee-span marquee-span1"]),style:ye(e(y))},T(e(v)),7),e(k)?(n(),x("span",{key:0,class:M([[{animating:e(k)},`duration-${g.duration}`],"marquee-span marquee-span2"]),style:ye(e(y))},T(e(v)),7)):E("",!0)],2))}}),Ls=We(Bs,[["__scopeId","data-v-228d56d4"]]),Ws={class:"p-0 h-screen max-h-screen box-border flex flex-col self-stretch"},Rs={class:"w-[13.5rem] text-center text-xl mb-2"},zs={class:"h-0 flex-1 flex flex-col overflow-y-auto"},Os={key:0,class:"mr-2 relative hidden sm:flex self-center"},js={class:"z-20 flex items-center px-2"},Gs={key:0},Hs={key:0},Ys={class:"flex gap-2"},Xs={class:"flex flex-auto h-1 overflow-hidden"},Zs={class:"flex flex-1 flex-col height-full p-2 max-w-full bg-slate-100"},Ks={class:"flex justify-center items-center text-center text-xl mb-2"},Js={class:"flex-1 mb-2 overflow-auto max-w-full"},Qs={key:0},en={class:"flex w-80"},tn=ee({__name:"WorkSpace",props:{eventTypeId:{type:Number,required:!0}},setup(g){const l=g,[f,h]=Ve(),[k,c]=Ve(),y=Ct(),{t:v}=_e(),U=Yt(),_=Xt(),F=ze().createScope(),L=Zt().createScope(),$=Kt().createScope();je();const q=C(!1),V=C(null),W=C([]),u=C([]),a=St(!1),{assignmentNameToShow:m,toggle:P}=Jt(),o=C(!1),d=Et("manufacturing-show-finished-events",!0),I=i({get(){return _.lg?d.value:o.value},set(s){_.lg?d.value=s:o.value=s}}),N=C(!1);O(()=>l.eventTypeId,()=>{u.value=[]});const r=Ge(),z=os(),[R]=ge("manufacturingTimeout",{defaultValue:0}),[se]=ge("RFIDEnabled",{defaultValue:!1});let ne=!1;O(()=>!!R.value&&se.value,s=>{s&&!ne&&Xe()},{immediate:!0});const le=C(0);function Xe(){ne=!0;const{remainingTime:s,idle:t}=ms({time:R.value});O(t,S=>{S&&r.setUserActivity(!1)}),O(s,S=>{le.value=S})}const Ze=Qt().createScope(),{data:ue}=Ze.useGet({id:()=>l.eventTypeId,lazy:!0}),{unaccountablePeriods:Ke}=Ye({user:null}),Je=i(()=>Ke.value.filter(s=>s.eventTypeId===l.eventTypeId)),{activeOrPausedWorkPeriods:Ie}=He({user:null,eventTypeId:i(()=>l.eventTypeId)}),H=es(),{eventTypes:Qe}=us({useAllIfNoCapabilities:!0,userId:i(()=>r.activeUser?.id||H.value?.id)}),{data:de}=F.useFind({params:i(()=>{const s=J(new Date,{months:-6}),t=J(new Date,{months:-9});return{query:{typeId:l.eventTypeId,completedAt:null,$or:[{startsAt:null,confirmedAt:{$gt:t}},{startsAt:{$gt:s},confirmedAt:{$ne:null}}],$sort:{startsAt:1},$limit:1e3}}})}),Y=C(""),{data:et,isPending:tt}=F.useFind({params:i(()=>{const s=J(new Date,{days:-14}),t={query:{typeId:l.eventTypeId,completedAt:{$gt:s},$sort:{startsAt:1},$limit:50},debounce:250};return Y.value&&(t.query["assignment.number"]=qe(Y.value,!0,!0),t.query.completedAt={$ne:null}),t}),fetchParams:i(()=>{if(!I.value)return null;const s=J(new Date,{days:-14}),t={query:{typeId:l.eventTypeId,completedAt:{$gt:s},$sort:{startsAt:1},$limit:50},debounce:250};return Y.value&&(t.query["$assignment.number$"]=qe(Y.value,!0,!0),t.query.completedAt={$ne:null}),t})}),st=i(()=>{const s=[];return et.value.forEach(t=>{!t.assignment||s.includes(t)||s.push(t)}),s}),{data:ce}=$.useFindOnce({params:i(()=>({query:{eventId:{$in:de.value.map(s=>s.id)},$sort:{createdAt:1}}})),items:i(()=>de.value.map(s=>s.id)),fetchParams(s){return{query:{eventId:{$in:s},$limit:1e3}}}}),nt=i(()=>{const s=new Set;return Ie.value.forEach(t=>{t.userId&&s.add(t.userId)}),Je.value.forEach(t=>{t.userId&&s.add(t.userId)}),ce.value.forEach(t=>{t.userId&&s.add(t.userId)}),[...s]}),me=i(()=>{const s=[];return H.value?.id&&s.push(H.value.id),s.push(...nt.value,...u.value),[...new Set(s)]}),{data:at}=L.useFindOnce({params:i(()=>({query:{id:{$in:me.value},$sort:{fullName:1}}})),items:me,fetchParams:s=>({query:{id:{$in:s},$limit:-1}}),debounceTime:100}),Ae=i(()=>{const s=[];return me.value.forEach(t=>{const S=at.value.find(X=>X.id===t);S&&s.push(S)}),s}),ae=i(()=>{const s=[...Ae.value],t=W.value.filter(S=>!Ae.value.some(X=>S.id===X.id));return s.push(...t),s}),rt=i(()=>ae.value.map(s=>s.id)),ot=i(()=>{const s={};return ae.value.forEach(t=>{s[t.id]=[]}),ce.value.forEach(t=>{s[t.userId]||(s[t.userId]=[]),s[t.userId].push(t)}),s}),Ue=i(()=>{const s={};return ae.value.forEach(t=>{s[t.id]=[]}),Ie.value.forEach(t=>{t.userId&&(s[t.userId]||(s[t.userId]=[]),s[t.userId].push(t))}),s}),[Te]=ge("manufacturingMessage",{defaultValue:""});O(rt,(s,t)=>{if(!Array.isArray(s)||!Array.isArray(t))return;const S=s.filter(X=>!t.includes(X));S.length&&u.value.push(...S)}),$t(()=>{z.resetUser()});async function it(s){try{if(!r.activeUser){await U.authenticateRfid(s),fe(),r.setUserActivity(!0);return}const{rfid:t}=r.activeUser;if(t===s){r.toggleUserActivity(),r.activeUser?fe():ut();return}else await U.authenticateRfid(s),fe()}catch{dt()}}function lt(){V.value&&(W.value.push(V.value),r.setActiveUser(V.value),V.value=null)}function fe(){H.value&&pe({title:"",message:`<b>${H.value.fullName}</b> angemeldet`,dangerouslyUseHTMLString:!0,type:"success",duration:5e3,position:"bottom-right"})}function ut(){H.value&&pe({title:"",message:`<b>${H.value.fullName}</b> abgemeldet`,dangerouslyUseHTMLString:!0,type:"success",duration:5e3,position:"bottom-right"})}function dt(){pe({title:"",message:"Anmeldung nicht erfolgreich!",type:"warning",duration:5e3,position:"bottom-right"})}const ct=i(()=>{if(!r.activeUser||!l.eventTypeId)return[];const t=(Ue.value[r.activeUser.id]||[]).map(S=>S.eventUuid);return[...new Set(t)]}),G=C(null);function ve(s){G.value=s.id}const mt=i(()=>u.value.length?{query:{id:{$nin:u.value}}}:{});return Dt(()=>!r.activeUser&&G.value,()=>{G.value=null}),(s,t)=>{const S=ie("font-awesome-icon"),X=Le,Z=be,ft=Lt,vt=Nt,pt=Pt,Se=Vt,Ee=Ft,$e=qt,gt=Mt,ht=Bt;return n(),x("div",Ws,[p(e(f),null,{default:b(({class:w})=>[p(qs,{class:M(["h-full pt-2 box-border w-64",w]),events:e(de),disabled:!e(r).activeUser,"active-event-uuids":e(ct),"event-users":e(ce),onClickEvent:ve},null,8,["class","events","disabled","active-event-uuids","event-users"])]),_:1}),p(e(k),null,{default:b(({class:w})=>[re((n(),x("div",{class:M(["flex flex-col box-border transition-all overflow-x-hidden",[{"w-56 p-1 pt-2 border-l":e(I),"w-0 p-0 border-l-0":!e(I)},w]])},[A("div",Rs,[p(S,{icon:"check",class:"mr-0.5 text-base"}),B(" "+T(e(v)("manufacturing.AssignmentListFinished")),1)]),p(X,{modelValue:e(Y),"onUpdate:modelValue":t[0]||(t[0]=te=>K(Y)?Y.value=te:null),clearable:"",placeholder:e(v)("manufacturing.Search"),class:"mb-1"},null,8,["modelValue","placeholder"]),A("div",zs,[(n(!0),x(j,null,Q(e(st),te=>(n(),D(Z,{key:te.uuid,disabled:!e(r).activeUser||e(z).isPaused||e(z).isUnaccountableActive,class:"w-full mb-1 !h-10 truncate !p-2 [&>span]:!block [&>span]:truncate",onClick:()=>ve(te)},{default:b(()=>[B(T(e(ke)(te.assignment,e(m))),1)]),_:2},1032,["disabled","onClick"]))),128))])],2)),[[ht,e(tt)]])]),_:1}),e(se)?(n(),D(Ms,{key:0,onScanned:it})):E("",!0),p(as,{bg:e(r).activeUser?"bg-primary":"bg-warning"},{"left-left":b(()=>[e(_).md?E("",!0):(n(),D(Z,{key:0,class:"md:hidden mr-2",onClick:t[1]||(t[1]=w=>N.value=!e(N))},{default:b(()=>[p(S,{icon:"angle-right",class:"text-xs"})]),_:1}))]),left:b(()=>[e(r).activeUser&&!s.$can("view","MainMenu")?(n(),x("div",Os,[A("div",js,[p(S,{icon:"user",size:"lg",class:"fa-fw mr-2"}),B(" "+T(e(r).activeUser.shortName||e(r).activeUser.fullName),1)]),e(le)>0&&e(R)>0?(n(),x("div",{key:0,class:"absolute transition-all ease-linear duration-300 bg-black/20 top-0 bottom-0 left-0 z-10",style:ye({width:`${e(le)/e(R)*100}%`})},null,4)):E("",!0)])):E("",!0),p(pt,{"split-button":!0,class:"self-center",onClick:t[2]||(t[2]=w=>e(y).push({name:"ViewShopfloorEntrance"}))},{dropdown:b(()=>[p(vt,null,{default:b(()=>[(n(!0),x(j,null,Q(e(Qe),w=>(n(),D(ft,{key:w.uuid,disabled:w.uuid===e(ue)?.uuid,onClick:()=>e(y).push({name:e(ts).ViewManufacturingWorkSpace,params:{eventTypeId:w.id}})},{default:b(()=>[B(T(w.name),1)]),_:2},1032,["disabled","onClick"]))),128))]),_:1})]),default:b(()=>[p(S,{icon:"map-marker-alt","fixed-width":"",class:"hidden md:inline mr-2 text-xs"}),e(ue)?(n(),x("span",Gs,T(e(ue).name),1)):E("",!0)]),_:1})]),mid:b(()=>[e(r).activeUser?E("",!0):(n(),x("span",Hs,T(e(v)("pleaseLogin")),1))]),"right-right":b(()=>[A("div",Ys,[p(Z,{class:"ml-2",onClick:t[3]||(t[3]=w=>I.value=!e(I))},{default:b(()=>[p(S,{icon:"angle-right",class:M(["transition-all text-xs",{"rotate-180":!e(I)}])},null,8,["class"])]),_:1}),p(Z,{onClick:t[4]||(t[4]=()=>a.value=!0)},{default:b(()=>[p(S,{icon:"cog",class:"text-xs"})]),_:1})])]),_:1},8,["bg"]),e(Te)?(n(),D(Ls,{key:1,text:e(Te),type:"danger",duration:"90"},null,8,["text"])):E("",!0),A("div",Xs,[e(_).md?(n(),D(e(h),{key:0,class:"border-r border-gray-300 mb-2 shadow"})):E("",!0),A("div",Zs,[A("div",Ks,[p(S,{icon:"calendar-alt","fixed-width":"",class:"mr-1 text-xs"}),B(" "+T(e(v)("manufacturing.DailyTask")),1)]),A("div",Js,[(n(!0),x(j,null,Q(e(ae),w=>(n(),D(bs,{key:w.uuid,user:w,"event-users":e(ot)[w.id],"work-periods":e(Ue)[w.id],onClickEvent:ve},null,8,["user","event-users","work-periods"]))),128)),e(r).isSupervisor?(n(),x("div",Qs,[e(q)?(n(),D(Ee,{key:1},{default:b(()=>[p(Se,{label:e(v)("actions.add")+":"},{default:b(()=>[A("div",en,[p(ds,{modelValue:e(V),"onUpdate:modelValue":t[6]||(t[6]=w=>K(V)?V.value=w:null),params:e(mt),class:"w-full"},null,8,["modelValue","params"]),p(Z,{disabled:!e(V),type:"primary",size:"default",onClick:lt},{default:b(()=>[p(S,{icon:"plus",class:"text-xs"})]),_:1},8,["disabled"])])]),_:1},8,["label"])]),_:1})):(n(),D(Z,{key:0,type:"primary",size:"default",onClick:t[5]||(t[5]=w=>q.value=!0)},{default:b(()=>[p(S,{icon:"user-plus",class:"text-xs"})]),_:1}))])):E("",!0)]),re(p(ss,{"event-type-id":g.eventTypeId,class:"bg-white shadow"},null,8,["event-type-id"]),[[he,!!e(r).activeUser]])]),e(_).lg?(n(),D(e(c),{key:1,class:"border-gray-300 shadow"})):E("",!0)]),e(G)?(n(),D(ns,{key:2,id:e(G),"onUpdate:id":t[7]||(t[7]=w=>K(G)?G.value=w:null),user:e(z).user,onClosed:t[8]||(t[8]=w=>G.value=null)},null,8,["id","user"])):E("",!0),e(N)?(n(),D($e,{key:3,modelValue:e(N),"onUpdate:modelValue":t[9]||(t[9]=w=>K(N)?N.value=w:null),direction:"ltr",size:256,class:"w-64 [&>header.el-drawer\\_\\_header]:mb-0 [&>.el-drawer\\_\\_body]:p-0"},{default:b(()=>[p(e(h))]),_:1},8,["modelValue"])):E("",!0),!e(_).lg&&e(I)?(n(),D($e,{key:4,modelValue:e(I),"onUpdate:modelValue":t[10]||(t[10]=w=>K(I)?I.value=w:null),direction:"rtl",size:224,class:"[&>header.el-drawer\\_\\_header]:mb-0 [&>.el-drawer\\_\\_body]:p-0"},{default:b(()=>[p(e(c))]),_:1},8,["modelValue"])):E("",!0),e(a)?(n(),D(gt,{key:5,modelValue:e(a),"onUpdate:modelValue":t[11]||(t[11]=w=>K(a)?a.value=w:null),class:"dialog-messagebox-[500px] self-start"},{header:b(()=>[p(S,{icon:"cog",class:"mr-2 text-xs"}),B(" "+T(e(v)("planningBoard.settings.title")),1)]),default:b(()=>[p(Ee,{"label-width":"130px","label-position":e(_).xs?"left":"top"},{default:b(()=>[p(Se,{label:e(v)("planningBoard.settings.Text")+":"},{default:b(()=>[p(Z,{onClick:e(P)},{default:b(()=>[B(T(e(m)==="name"?e(v)("assignment.property.name"):e(m)==="number"?e(v)("assignment.property.number"):e(m)==="addressProperty"?e(v)("assignment.relation.addressProperty"):e(m)==="customer"?e(v)("assignment.relation.customer"):""),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["label-position"])]),_:1},8,["modelValue"])):E("",!0)])}}}),qn=ee({__name:"ViewWorkSpace",props:{eventTypeId:{type:Number,required:!0}},setup(g){return(l,f)=>(n(),D(tn,{"event-type-id":g.eventTypeId},null,8,["event-type-id"]))}});export{qn as default};
