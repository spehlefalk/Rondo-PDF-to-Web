import{a as Qu,u as Ju,s as $u,Y as ga,$ as Pl,r as ed,w as Dl,fX as td,o as sd,az as ad,c as _t,_ as Ui,P as rd,ay as qi}from"./vendor-DP6O45ke.js";import{i as nd,a as id,n as od,K as ld,R as cd,be as ud,a8 as dd,a1 as md,bf as fd,at as hd,aK as vd,W as Ul,ax as _d,az as pd}from"./index-Dsay-W0g.js";import{a as ba}from"./chat.store-WmbfM-QW.js";import{u as gd}from"./upload.store-CU1g3nY9.js";import{u as wn}from"./useServiceEventListener-DCg5b4lA.js";function Uo(e,t){const s=Object.create(null),a=e.split(",");for(let n=0;n<a.length;n++)s[a[n]]=!0;return n=>!!s[n]}const bd="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",yd=Uo(bd);function E1(e){return!!e||e===""}function At(e){if(Je(e)){const t={};for(let s=0;s<e.length;s++){const a=e[s],n=Pt(a)?Ed(a):At(a);if(n)for(const r in n)t[r]=n[r]}return t}else{if(Pt(e))return e;if(Dt(e))return e}}const wd=/;(?![^(]*\))/g,Sd=/:(.+)/;function Ed(e){const t={};return e.split(wd).forEach(s=>{if(s){const a=s.split(Sd);a.length>1&&(t[a[0].trim()]=a[1].trim())}}),t}function nt(e){let t="";if(Pt(e))t=e;else if(Je(e))for(let s=0;s<e.length;s++){const a=nt(e[s]);a&&(t+=a+" ")}else if(Dt(e))for(const s in e)e[s]&&(t+=s+" ");return t.trim()}function yt(e){if(!e)return null;let{class:t,style:s}=e;return t&&!Pt(t)&&(e.class=nt(t)),s&&(e.style=At(s)),e}const et=e=>Pt(e)?e:e==null?"":Je(e)||Dt(e)&&(e.toString===k1||!it(e.toString))?JSON.stringify(e,M1,2):String(e),M1=(e,t)=>t&&t.__v_isRef?M1(e,t.value):sr(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((s,[a,n])=>(s[`${a} =>`]=n,s),{})}:A1(t)?{[`Set(${t.size})`]:[...t.values()]}:Dt(t)&&!Je(t)&&!R1(t)?String(t):t,Mt={},tr=[],qs=()=>{},Md=()=>!1,Ad=/^on[^a-z]/,ni=e=>Ad.test(e),qo=e=>e.startsWith("onUpdate:"),Ut=Object.assign,Vo=(e,t)=>{const s=e.indexOf(t);s>-1&&e.splice(s,1)},Td=Object.prototype.hasOwnProperty,ut=(e,t)=>Td.call(e,t),Je=Array.isArray,sr=e=>ii(e)==="[object Map]",A1=e=>ii(e)==="[object Set]",it=e=>typeof e=="function",Pt=e=>typeof e=="string",zo=e=>typeof e=="symbol",Dt=e=>e!==null&&typeof e=="object",T1=e=>Dt(e)&&it(e.then)&&it(e.catch),k1=Object.prototype.toString,ii=e=>k1.call(e),kd=e=>ii(e).slice(8,-1),R1=e=>ii(e)==="[object Object]",Yo=e=>Pt(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Un=Uo(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),oi=e=>{const t=Object.create(null);return s=>t[s]||(t[s]=e(s))},Rd=/-(\w)/g,ws=oi(e=>e.replace(Rd,(t,s)=>s?s.toUpperCase():"")),xd=/\B([A-Z])/g,Vs=oi(e=>e.replace(xd,"-$1").toLowerCase()),li=oi(e=>e.charAt(0).toUpperCase()+e.slice(1)),Vi=oi(e=>e?`on${li(e)}`:""),qr=(e,t)=>!Object.is(e,t),zi=(e,t)=>{for(let s=0;s<e.length;s++)e[s](t)},Kn=(e,t,s)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:s})},Gn=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let ql;const Od=()=>ql||(ql=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let ds;class Id{constructor(t=!1){this.active=!0,this.effects=[],this.cleanups=[],!t&&ds&&(this.parent=ds,this.index=(ds.scopes||(ds.scopes=[])).push(this)-1)}run(t){if(this.active){const s=ds;try{return ds=this,t()}finally{ds=s}}}on(){ds=this}off(){ds=this.parent}stop(t){if(this.active){let s,a;for(s=0,a=this.effects.length;s<a;s++)this.effects[s].stop();for(s=0,a=this.cleanups.length;s<a;s++)this.cleanups[s]();if(this.scopes)for(s=0,a=this.scopes.length;s<a;s++)this.scopes[s].stop(!0);if(this.parent&&!t){const n=this.parent.scopes.pop();n&&n!==this&&(this.parent.scopes[this.index]=n,n.index=this.index)}this.active=!1}}}function Cd(e,t=ds){t&&t.active&&t.effects.push(e)}function Ld(){return ds}function Bd(e){ds&&ds.cleanups.push(e)}const Xo=e=>{const t=new Set(e);return t.w=0,t.n=0,t},x1=e=>(e.w&da)>0,O1=e=>(e.n&da)>0,Nd=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=da},jd=e=>{const{deps:t}=e;if(t.length){let s=0;for(let a=0;a<t.length;a++){const n=t[a];x1(n)&&!O1(n)?n.delete(e):t[s++]=n,n.w&=~da,n.n&=~da}t.length=s}},ho=new WeakMap;let Rr=0,da=1;const vo=30;let ks;const Fa=Symbol(""),_o=Symbol("");class Ko{constructor(t,s=null,a){this.fn=t,this.scheduler=s,this.active=!0,this.deps=[],this.parent=void 0,Cd(this,a)}run(){if(!this.active)return this.fn();let t=ks,s=oa;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=ks,ks=this,oa=!0,da=1<<++Rr,Rr<=vo?Nd(this):Vl(this),this.fn()}finally{Rr<=vo&&jd(this),da=1<<--Rr,ks=this.parent,oa=s,this.parent=void 0,this.deferStop&&this.stop()}}stop(){ks===this?this.deferStop=!0:this.active&&(Vl(this),this.onStop&&this.onStop(),this.active=!1)}}function Vl(e){const{deps:t}=e;if(t.length){for(let s=0;s<t.length;s++)t[s].delete(e);t.length=0}}let oa=!0;const I1=[];function mr(){I1.push(oa),oa=!1}function fr(){const e=I1.pop();oa=e===void 0?!0:e}function fs(e,t,s){if(oa&&ks){let a=ho.get(e);a||ho.set(e,a=new Map);let n=a.get(s);n||a.set(s,n=Xo()),C1(n)}}function C1(e,t){let s=!1;Rr<=vo?O1(e)||(e.n|=da,s=!x1(e)):s=!e.has(ks),s&&(e.add(ks),ks.deps.push(e))}function Ks(e,t,s,a,n,r){const o=ho.get(e);if(!o)return;let u=[];if(t==="clear")u=[...o.values()];else if(s==="length"&&Je(e))o.forEach((_,l)=>{(l==="length"||l>=a)&&u.push(_)});else switch(s!==void 0&&u.push(o.get(s)),t){case"add":Je(e)?Yo(s)&&u.push(o.get("length")):(u.push(o.get(Fa)),sr(e)&&u.push(o.get(_o)));break;case"delete":Je(e)||(u.push(o.get(Fa)),sr(e)&&u.push(o.get(_o)));break;case"set":sr(e)&&u.push(o.get(Fa));break}if(u.length===1)u[0]&&po(u[0]);else{const _=[];for(const l of u)l&&_.push(...l);po(Xo(_))}}function po(e,t){const s=Je(e)?e:[...e];for(const a of s)a.computed&&zl(a);for(const a of s)a.computed||zl(a)}function zl(e,t){(e!==ks||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const Fd=Uo("__proto__,__v_isRef,__isVue"),L1=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(zo)),Hd=Go(),Pd=Go(!1,!0),Dd=Go(!0),Yl=Ud();function Ud(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...s){const a=ht(this);for(let r=0,o=this.length;r<o;r++)fs(a,"get",r+"");const n=a[t](...s);return n===-1||n===!1?a[t](...s.map(ht)):n}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...s){mr();const a=ht(this)[t].apply(this,s);return fr(),a}}),e}function Go(e=!1,t=!1){return function(a,n,r){if(n==="__v_isReactive")return!e;if(n==="__v_isReadonly")return e;if(n==="__v_isShallow")return t;if(n==="__v_raw"&&r===(e?t?am:H1:t?F1:j1).get(a))return a;const o=Je(a);if(!e&&o&&ut(Yl,n))return Reflect.get(Yl,n,r);const u=Reflect.get(a,n,r);return(zo(n)?L1.has(n):Fd(n))||(e||fs(a,"get",n),t)?u:Gt(u)?o&&Yo(n)?u:u.value:Dt(u)?e?P1(u):Qo(u):u}}const qd=B1(),Vd=B1(!0);function B1(e=!1){return function(s,a,n,r){let o=s[a];if(Vr(o)&&Gt(o)&&!Gt(n))return!1;if(!e&&!Vr(n)&&(go(n)||(n=ht(n),o=ht(o)),!Je(s)&&Gt(o)&&!Gt(n)))return o.value=n,!0;const u=Je(s)&&Yo(a)?Number(a)<s.length:ut(s,a),_=Reflect.set(s,a,n,r);return s===ht(r)&&(u?qr(n,o)&&Ks(s,"set",a,n):Ks(s,"add",a,n)),_}}function zd(e,t){const s=ut(e,t);e[t];const a=Reflect.deleteProperty(e,t);return a&&s&&Ks(e,"delete",t,void 0),a}function Yd(e,t){const s=Reflect.has(e,t);return(!zo(t)||!L1.has(t))&&fs(e,"has",t),s}function Xd(e){return fs(e,"iterate",Je(e)?"length":Fa),Reflect.ownKeys(e)}const N1={get:Hd,set:qd,deleteProperty:zd,has:Yd,ownKeys:Xd},Kd={get:Dd,set(e,t){return!0},deleteProperty(e,t){return!0}},Gd=Ut({},N1,{get:Pd,set:Vd}),Wo=e=>e,ci=e=>Reflect.getPrototypeOf(e);function Sn(e,t,s=!1,a=!1){e=e.__v_raw;const n=ht(e),r=ht(t);s||(t!==r&&fs(n,"get",t),fs(n,"get",r));const{has:o}=ci(n),u=a?Wo:s?$o:zr;if(o.call(n,t))return u(e.get(t));if(o.call(n,r))return u(e.get(r));e!==n&&e.get(t)}function En(e,t=!1){const s=this.__v_raw,a=ht(s),n=ht(e);return t||(e!==n&&fs(a,"has",e),fs(a,"has",n)),e===n?s.has(e):s.has(e)||s.has(n)}function Mn(e,t=!1){return e=e.__v_raw,!t&&fs(ht(e),"iterate",Fa),Reflect.get(e,"size",e)}function Xl(e){e=ht(e);const t=ht(this);return ci(t).has.call(t,e)||(t.add(e),Ks(t,"add",e,e)),this}function Kl(e,t){t=ht(t);const s=ht(this),{has:a,get:n}=ci(s);let r=a.call(s,e);r||(e=ht(e),r=a.call(s,e));const o=n.call(s,e);return s.set(e,t),r?qr(t,o)&&Ks(s,"set",e,t):Ks(s,"add",e,t),this}function Gl(e){const t=ht(this),{has:s,get:a}=ci(t);let n=s.call(t,e);n||(e=ht(e),n=s.call(t,e)),a&&a.call(t,e);const r=t.delete(e);return n&&Ks(t,"delete",e,void 0),r}function Wl(){const e=ht(this),t=e.size!==0,s=e.clear();return t&&Ks(e,"clear",void 0,void 0),s}function An(e,t){return function(a,n){const r=this,o=r.__v_raw,u=ht(o),_=t?Wo:e?$o:zr;return!e&&fs(u,"iterate",Fa),o.forEach((l,v)=>a.call(n,_(l),_(v),r))}}function Tn(e,t,s){return function(...a){const n=this.__v_raw,r=ht(n),o=sr(r),u=e==="entries"||e===Symbol.iterator&&o,_=e==="keys"&&o,l=n[e](...a),v=s?Wo:t?$o:zr;return!t&&fs(r,"iterate",_?_o:Fa),{next(){const{value:c,done:b}=l.next();return b?{value:c,done:b}:{value:u?[v(c[0]),v(c[1])]:v(c),done:b}},[Symbol.iterator](){return this}}}}function Qs(e){return function(...t){return e==="delete"?!1:this}}function Wd(){const e={get(r){return Sn(this,r)},get size(){return Mn(this)},has:En,add:Xl,set:Kl,delete:Gl,clear:Wl,forEach:An(!1,!1)},t={get(r){return Sn(this,r,!1,!0)},get size(){return Mn(this)},has:En,add:Xl,set:Kl,delete:Gl,clear:Wl,forEach:An(!1,!0)},s={get(r){return Sn(this,r,!0)},get size(){return Mn(this,!0)},has(r){return En.call(this,r,!0)},add:Qs("add"),set:Qs("set"),delete:Qs("delete"),clear:Qs("clear"),forEach:An(!0,!1)},a={get(r){return Sn(this,r,!0,!0)},get size(){return Mn(this,!0)},has(r){return En.call(this,r,!0)},add:Qs("add"),set:Qs("set"),delete:Qs("delete"),clear:Qs("clear"),forEach:An(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{e[r]=Tn(r,!1,!1),s[r]=Tn(r,!0,!1),t[r]=Tn(r,!1,!0),a[r]=Tn(r,!0,!0)}),[e,s,t,a]}const[Zd,Qd,Jd,$d]=Wd();function Zo(e,t){const s=t?e?$d:Jd:e?Qd:Zd;return(a,n,r)=>n==="__v_isReactive"?!e:n==="__v_isReadonly"?e:n==="__v_raw"?a:Reflect.get(ut(s,n)&&n in a?s:a,n,r)}const em={get:Zo(!1,!1)},tm={get:Zo(!1,!0)},sm={get:Zo(!0,!1)},j1=new WeakMap,F1=new WeakMap,H1=new WeakMap,am=new WeakMap;function rm(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function nm(e){return e.__v_skip||!Object.isExtensible(e)?0:rm(kd(e))}function Qo(e){return Vr(e)?e:Jo(e,!1,N1,em,j1)}function im(e){return Jo(e,!1,Gd,tm,F1)}function P1(e){return Jo(e,!0,Kd,sm,H1)}function Jo(e,t,s,a,n){if(!Dt(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const r=n.get(e);if(r)return r;const o=nm(e);if(o===0)return e;const u=new Proxy(e,o===2?a:s);return n.set(e,u),u}function ar(e){return Vr(e)?ar(e.__v_raw):!!(e&&e.__v_isReactive)}function Vr(e){return!!(e&&e.__v_isReadonly)}function go(e){return!!(e&&e.__v_isShallow)}function D1(e){return ar(e)||Vr(e)}function ht(e){const t=e&&e.__v_raw;return t?ht(t):e}function U1(e){return Kn(e,"__v_skip",!0),e}const zr=e=>Dt(e)?Qo(e):e,$o=e=>Dt(e)?P1(e):e;function q1(e){oa&&ks&&(e=ht(e),C1(e.dep||(e.dep=Xo())))}function V1(e,t){e=ht(e),e.dep&&po(e.dep)}function Gt(e){return!!(e&&e.__v_isRef===!0)}function ui(e){return om(e,!1)}function om(e,t){return Gt(e)?e:new lm(e,t)}class lm{constructor(t,s){this.__v_isShallow=s,this.dep=void 0,this.__v_isRef=!0,this._rawValue=s?t:ht(t),this._value=s?t:zr(t)}get value(){return q1(this),this._value}set value(t){t=this.__v_isShallow?t:ht(t),qr(t,this._rawValue)&&(this._rawValue=t,this._value=this.__v_isShallow?t:zr(t),V1(this))}}function z1(e){return Gt(e)?e.value:e}const cm={get:(e,t,s)=>z1(Reflect.get(e,t,s)),set:(e,t,s,a)=>{const n=e[t];return Gt(n)&&!Gt(s)?(n.value=s,!0):Reflect.set(e,t,s,a)}};function Y1(e){return ar(e)?e:new Proxy(e,cm)}class um{constructor(t,s,a,n){this._setter=s,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new Ko(t,()=>{this._dirty||(this._dirty=!0,V1(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!n,this.__v_isReadonly=a}get value(){const t=ht(this);return q1(t),(t._dirty||!t._cacheable)&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}function dm(e,t,s=!1){let a,n;const r=it(e);return r?(a=e,n=qs):(a=e.get,n=e.set),new um(a,n,r||!n,s)}function la(e,t,s,a){let n;try{n=a?e(...a):e()}catch(r){di(r,t,s)}return n}function bs(e,t,s,a){if(it(e)){const r=la(e,t,s,a);return r&&T1(r)&&r.catch(o=>{di(o,t,s)}),r}const n=[];for(let r=0;r<e.length;r++)n.push(bs(e[r],t,s,a));return n}function di(e,t,s,a=!0){const n=t?t.vnode:null;if(t){let r=t.parent;const o=t.proxy,u=s;for(;r;){const l=r.ec;if(l){for(let v=0;v<l.length;v++)if(l[v](e,o,u)===!1)return}r=r.parent}const _=t.appContext.config.errorHandler;if(_){la(_,null,10,[e,o,u]);return}}mm(e,s,n,a)}function mm(e,t,s,a=!0){console.error(e)}let Wn=!1,bo=!1;const ms=[];let Ys=0;const Nr=[];let xr=null,Ja=0;const jr=[];let ra=null,$a=0;const X1=Promise.resolve();let el=null,yo=null;function K1(e){const t=el||X1;return e?t.then(this?e.bind(this):e):t}function fm(e){let t=Ys+1,s=ms.length;for(;t<s;){const a=t+s>>>1;Yr(ms[a])<e?t=a+1:s=a}return t}function G1(e){(!ms.length||!ms.includes(e,Wn&&e.allowRecurse?Ys+1:Ys))&&e!==yo&&(e.id==null?ms.push(e):ms.splice(fm(e.id),0,e),W1())}function W1(){!Wn&&!bo&&(bo=!0,el=X1.then(J1))}function hm(e){const t=ms.indexOf(e);t>Ys&&ms.splice(t,1)}function Z1(e,t,s,a){Je(e)?s.push(...e):(!t||!t.includes(e,e.allowRecurse?a+1:a))&&s.push(e),W1()}function vm(e){Z1(e,xr,Nr,Ja)}function _m(e){Z1(e,ra,jr,$a)}function mi(e,t=null){if(Nr.length){for(yo=t,xr=[...new Set(Nr)],Nr.length=0,Ja=0;Ja<xr.length;Ja++)xr[Ja]();xr=null,Ja=0,yo=null,mi(e,t)}}function Q1(e){if(mi(),jr.length){const t=[...new Set(jr)];if(jr.length=0,ra){ra.push(...t);return}for(ra=t,ra.sort((s,a)=>Yr(s)-Yr(a)),$a=0;$a<ra.length;$a++)ra[$a]();ra=null,$a=0}}const Yr=e=>e.id==null?1/0:e.id;function J1(e){bo=!1,Wn=!0,mi(e),ms.sort((t,s)=>Yr(t)-Yr(s));try{for(Ys=0;Ys<ms.length;Ys++){const t=ms[Ys];t&&t.active!==!1&&la(t,null,14)}}finally{Ys=0,ms.length=0,Q1(),Wn=!1,el=null,(ms.length||Nr.length||jr.length)&&J1(e)}}function pm(e,t,...s){if(e.isUnmounted)return;const a=e.vnode.props||Mt;let n=s;const r=t.startsWith("update:"),o=r&&t.slice(7);if(o&&o in a){const v=`${o==="modelValue"?"model":o}Modifiers`,{number:c,trim:b}=a[v]||Mt;b&&(n=s.map(w=>w.trim())),c&&(n=s.map(Gn))}let u,_=a[u=Vi(t)]||a[u=Vi(ws(t))];!_&&r&&(_=a[u=Vi(Vs(t))]),_&&bs(_,e,6,n);const l=a[u+"Once"];if(l){if(!e.emitted)e.emitted={};else if(e.emitted[u])return;e.emitted[u]=!0,bs(l,e,6,n)}}function $1(e,t,s=!1){const a=t.emitsCache,n=a.get(e);if(n!==void 0)return n;const r=e.emits;let o={},u=!1;if(!it(e)){const _=l=>{const v=$1(l,t,!0);v&&(u=!0,Ut(o,v))};!s&&t.mixins.length&&t.mixins.forEach(_),e.extends&&_(e.extends),e.mixins&&e.mixins.forEach(_)}return!r&&!u?(a.set(e,null),null):(Je(r)?r.forEach(_=>o[_]=null):Ut(o,r),a.set(e,o),o)}function fi(e,t){return!e||!ni(t)?!1:(t=t.slice(2).replace(/Once$/,""),ut(e,t[0].toLowerCase()+t.slice(1))||ut(e,Vs(t))||ut(e,t))}let Wt=null,e0=null;function Zn(e){const t=Wt;return Wt=e,e0=e&&e.type.__scopeId||null,t}function Ke(e,t=Wt,s){if(!t||e._n)return e;const a=(...n)=>{a._d&&oc(-1);const r=Zn(t),o=e(...n);return Zn(r),a._d&&oc(1),o};return a._n=!0,a._c=!0,a._d=!0,a}function Yi(e){const{type:t,vnode:s,proxy:a,withProxy:n,props:r,propsOptions:[o],slots:u,attrs:_,emit:l,render:v,renderCache:c,data:b,setupState:w,ctx:i,inheritAttrs:F}=e;let B,N;const f=Zn(e);try{if(s.shapeFlag&4){const C=n||a;B=js(v.call(C,C,c,r,w,b,i)),N=_}else{const C=t;B=js(C.length>1?C(r,{attrs:_,slots:u,emit:l}):C(r,null)),N=t.props?_:gm(_)}}catch(C){Pr.length=0,di(C,e,1),B=Ie(ys)}let R=B;if(N&&F!==!1){const C=Object.keys(N),{shapeFlag:k}=R;C.length&&k&7&&(o&&C.some(qo)&&(N=bm(N,o)),R=fa(R,N))}return s.dirs&&(R=fa(R),R.dirs=R.dirs?R.dirs.concat(s.dirs):s.dirs),s.transition&&(R.transition=s.transition),B=R,Zn(f),B}const gm=e=>{let t;for(const s in e)(s==="class"||s==="style"||ni(s))&&((t||(t={}))[s]=e[s]);return t},bm=(e,t)=>{const s={};for(const a in e)(!qo(a)||!(a.slice(9)in t))&&(s[a]=e[a]);return s};function ym(e,t,s){const{props:a,children:n,component:r}=e,{props:o,children:u,patchFlag:_}=t,l=r.emitsOptions;if(t.dirs||t.transition)return!0;if(s&&_>=0){if(_&1024)return!0;if(_&16)return a?Zl(a,o,l):!!o;if(_&8){const v=t.dynamicProps;for(let c=0;c<v.length;c++){const b=v[c];if(o[b]!==a[b]&&!fi(l,b))return!0}}}else return(n||u)&&(!u||!u.$stable)?!0:a===o?!1:a?o?Zl(a,o,l):!0:!!o;return!1}function Zl(e,t,s){const a=Object.keys(t);if(a.length!==Object.keys(e).length)return!0;for(let n=0;n<a.length;n++){const r=a[n];if(t[r]!==e[r]&&!fi(s,r))return!0}return!1}function wm({vnode:e,parent:t},s){for(;t&&t.subTree===e;)(e=t.vnode).el=s,t=t.parent}const Sm=e=>e.__isSuspense;function Em(e,t){t&&t.pendingBranch?Je(e)?t.effects.push(...e):t.effects.push(e):_m(e)}function Mm(e,t){if(Vt){let s=Vt.provides;const a=Vt.parent&&Vt.parent.provides;a===s&&(s=Vt.provides=Object.create(a)),s[e]=t}}function Xi(e,t,s=!1){const a=Vt||Wt;if(a){const n=a.parent==null?a.vnode.appContext&&a.vnode.appContext.provides:a.parent.provides;if(n&&e in n)return n[e];if(arguments.length>1)return s&&it(t)?t.call(a.proxy):t}}const Ql={};function Ha(e,t,s){return t0(e,t,s)}function t0(e,t,{immediate:s,deep:a,flush:n,onTrack:r,onTrigger:o}=Mt){const u=Vt;let _,l=!1,v=!1;if(Gt(e)?(_=()=>e.value,l=go(e)):ar(e)?(_=()=>e,a=!0):Je(e)?(v=!0,l=e.some(N=>ar(N)||go(N)),_=()=>e.map(N=>{if(Gt(N))return N.value;if(ar(N))return Na(N);if(it(N))return la(N,u,2)})):it(e)?t?_=()=>la(e,u,2):_=()=>{if(!(u&&u.isUnmounted))return c&&c(),bs(e,u,3,[b])}:_=qs,t&&a){const N=_;_=()=>Na(N())}let c,b=N=>{c=B.onStop=()=>{la(N,u,4)}};if(Wr)return b=qs,t?s&&bs(t,u,3,[_(),v?[]:void 0,b]):_(),qs;let w=v?[]:Ql;const i=()=>{if(B.active)if(t){const N=B.run();(a||l||(v?N.some((f,R)=>qr(f,w[R])):qr(N,w)))&&(c&&c(),bs(t,u,3,[N,w===Ql?void 0:w,b]),w=N)}else B.run()};i.allowRecurse=!!t;let F;n==="sync"?F=i:n==="post"?F=()=>rs(i,u&&u.suspense):F=()=>vm(i);const B=new Ko(_,F);return t?s?i():w=B.run():n==="post"?rs(B.run.bind(B),u&&u.suspense):B.run(),()=>{B.stop(),u&&u.scope&&Vo(u.scope.effects,B)}}function Am(e,t,s){const a=this.proxy,n=Pt(e)?e.includes(".")?s0(a,e):()=>a[e]:e.bind(a,a);let r;it(t)?r=t:(r=t.handler,s=t);const o=Vt;ir(this);const u=t0(n,r.bind(a),s);return o?ir(o):Pa(),u}function s0(e,t){const s=t.split(".");return()=>{let a=e;for(let n=0;n<s.length&&a;n++)a=a[s[n]];return a}}function Na(e,t){if(!Dt(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),Gt(e))Na(e.value,t);else if(Je(e))for(let s=0;s<e.length;s++)Na(e[s],t);else if(A1(e)||sr(e))e.forEach(s=>{Na(s,t)});else if(R1(e))for(const s in e)Na(e[s],t);return e}function a0(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return l0(()=>{e.isMounted=!0}),u0(()=>{e.isUnmounting=!0}),e}const vs=[Function,Array],Tm={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:vs,onEnter:vs,onAfterEnter:vs,onEnterCancelled:vs,onBeforeLeave:vs,onLeave:vs,onAfterLeave:vs,onLeaveCancelled:vs,onBeforeAppear:vs,onAppear:vs,onAfterAppear:vs,onAppearCancelled:vs},setup(e,{slots:t}){const s=M0(),a=a0();let n;return()=>{const r=t.default&&tl(t.default(),!0);if(!r||!r.length)return;let o=r[0];if(r.length>1){for(const F of r)if(F.type!==ys){o=F;break}}const u=ht(e),{mode:_}=u;if(a.isLeaving)return Ki(o);const l=Jl(o);if(!l)return Ki(o);const v=Xr(l,u,a,s);Kr(l,v);const c=s.subTree,b=c&&Jl(c);let w=!1;const{getTransitionKey:i}=l.type;if(i){const F=i();n===void 0?n=F:F!==n&&(n=F,w=!0)}if(b&&b.type!==ys&&(!Ca(l,b)||w)){const F=Xr(b,u,a,s);if(Kr(b,F),_==="out-in")return a.isLeaving=!0,F.afterLeave=()=>{a.isLeaving=!1,s.update()},Ki(o);_==="in-out"&&l.type!==ys&&(F.delayLeave=(B,N,f)=>{const R=n0(a,b);R[String(b.key)]=b,B._leaveCb=()=>{N(),B._leaveCb=void 0,delete v.delayedLeave},v.delayedLeave=f})}return o}}},r0=Tm;function n0(e,t){const{leavingVNodes:s}=e;let a=s.get(t.type);return a||(a=Object.create(null),s.set(t.type,a)),a}function Xr(e,t,s,a){const{appear:n,mode:r,persisted:o=!1,onBeforeEnter:u,onEnter:_,onAfterEnter:l,onEnterCancelled:v,onBeforeLeave:c,onLeave:b,onAfterLeave:w,onLeaveCancelled:i,onBeforeAppear:F,onAppear:B,onAfterAppear:N,onAppearCancelled:f}=t,R=String(e.key),C=n0(s,e),k=(T,E)=>{T&&bs(T,a,9,E)},L=(T,E)=>{const h=E[1];k(T,E),Je(T)?T.every(y=>y.length<=1)&&h():T.length<=1&&h()},m={mode:r,persisted:o,beforeEnter(T){let E=u;if(!s.isMounted)if(n)E=F||u;else return;T._leaveCb&&T._leaveCb(!0);const h=C[R];h&&Ca(e,h)&&h.el._leaveCb&&h.el._leaveCb(),k(E,[T])},enter(T){let E=_,h=l,y=v;if(!s.isMounted)if(n)E=B||_,h=N||l,y=f||v;else return;let g=!1;const p=T._enterCb=M=>{g||(g=!0,M?k(y,[T]):k(h,[T]),m.delayedLeave&&m.delayedLeave(),T._enterCb=void 0)};E?L(E,[T,p]):p()},leave(T,E){const h=String(e.key);if(T._enterCb&&T._enterCb(!0),s.isUnmounting)return E();k(c,[T]);let y=!1;const g=T._leaveCb=p=>{y||(y=!0,E(),p?k(i,[T]):k(w,[T]),T._leaveCb=void 0,C[h]===e&&delete C[h])};C[h]=e,b?L(b,[T,g]):g()},clone(T){return Xr(T,t,s,a)}};return m}function Ki(e){if(hi(e))return e=fa(e),e.children=null,e}function Jl(e){return hi(e)?e.children?e.children[0]:void 0:e}function Kr(e,t){e.shapeFlag&6&&e.component?Kr(e.component.subTree,t):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function tl(e,t=!1,s){let a=[],n=0;for(let r=0;r<e.length;r++){let o=e[r];const u=s==null?o.key:String(s)+String(o.key!=null?o.key:r);o.type===dt?(o.patchFlag&128&&n++,a=a.concat(tl(o.children,t,u))):(t||o.type!==ys)&&a.push(u!=null?fa(o,{key:u}):o)}if(n>1)for(let r=0;r<a.length;r++)a[r].patchFlag=-2;return a}function i0(e){return it(e)?{setup:e,name:e.name}:e}const Fr=e=>!!e.type.__asyncLoader,hi=e=>e.type.__isKeepAlive;function km(e,t){o0(e,"a",t)}function Rm(e,t){o0(e,"da",t)}function o0(e,t,s=Vt){const a=e.__wdc||(e.__wdc=()=>{let n=s;for(;n;){if(n.isDeactivated)return;n=n.parent}return e()});if(vi(t,a,s),s){let n=s.parent;for(;n&&n.parent;)hi(n.parent.vnode)&&xm(a,t,s,n),n=n.parent}}function xm(e,t,s,a){const n=vi(t,e,a,!0);d0(()=>{Vo(a[t],n)},s)}function vi(e,t,s=Vt,a=!1){if(s){const n=s[e]||(s[e]=[]),r=t.__weh||(t.__weh=(...o)=>{if(s.isUnmounted)return;mr(),ir(s);const u=bs(t,s,e,o);return Pa(),fr(),u});return a?n.unshift(r):n.push(r),r}}const Ws=e=>(t,s=Vt)=>(!Wr||e==="sp")&&vi(e,t,s),Om=Ws("bm"),l0=Ws("m"),Im=Ws("bu"),c0=Ws("u"),u0=Ws("bum"),d0=Ws("um"),Cm=Ws("sp"),Lm=Ws("rtg"),Bm=Ws("rtc");function Nm(e,t=Vt){vi("ec",e,t)}function ma(e,t){const s=Wt;if(s===null)return e;const a=gi(s)||s.proxy,n=e.dirs||(e.dirs=[]);for(let r=0;r<t.length;r++){let[o,u,_,l=Mt]=t[r];it(o)&&(o={mounted:o,updated:o}),o.deep&&Na(u),n.push({dir:o,instance:a,value:u,oldValue:void 0,arg:_,modifiers:l})}return e}function ya(e,t,s,a){const n=e.dirs,r=t&&t.dirs;for(let o=0;o<n.length;o++){const u=n[o];r&&(u.oldValue=r[o].value);let _=u.dir[a];_&&(mr(),bs(_,s,8,[e.el,u,e,t]),fr())}}const sl="components",jm="directives";function Ge(e,t){return al(sl,e,!0,t)||e}const m0=Symbol();function Fm(e){return Pt(e)?al(sl,e,!1)||e:e||m0}function _i(e){return al(jm,e)}function al(e,t,s=!0,a=!1){const n=Wt||Vt;if(n){const r=n.type;if(e===sl){const u=hf(r,!1);if(u&&(u===t||u===ws(t)||u===li(ws(t))))return r}const o=$l(n[e]||r[e],t)||$l(n.appContext[e],t);return!o&&a?r:o}}function $l(e,t){return e&&(e[t]||e[ws(t)]||e[li(ws(t))])}function rt(e,t,s,a){let n;const r=s;if(Je(e)||Pt(e)){n=new Array(e.length);for(let o=0,u=e.length;o<u;o++)n[o]=t(e[o],o,void 0,r)}else if(typeof e=="number"){n=new Array(e);for(let o=0;o<e;o++)n[o]=t(o+1,o,void 0,r)}else if(Dt(e))if(e[Symbol.iterator])n=Array.from(e,(o,u)=>t(o,u,void 0,r));else{const o=Object.keys(e);n=new Array(o.length);for(let u=0,_=o.length;u<_;u++){const l=o[u];n[u]=t(e[l],l,u,r)}}else n=[];return n}function wt(e,t){for(let s=0;s<t.length;s++){const a=t[s];if(Je(a))for(let n=0;n<a.length;n++)e[a[n].name]=a[n].fn;else a&&(e[a.name]=a.fn)}return e}function Le(e,t,s={},a,n){if(Wt.isCE||Wt.parent&&Fr(Wt.parent)&&Wt.parent.isCE)return Ie("slot",t==="default"?null:{name:t},a&&a());let r=e[t];r&&r._c&&(r._d=!1),J();const o=r&&f0(r(s)),u=ft(dt,{key:s.key||`_${t}`},o||(a?a():[]),o&&e._===1?64:-2);return u.scopeId&&(u.slotScopeIds=[u.scopeId+"-s"]),r&&r._c&&(r._d=!0),u}function f0(e){return e.some(t=>$n(t)?!(t.type===ys||t.type===dt&&!f0(t.children)):!0)?e:null}const wo=e=>e?A0(e)?gi(e)||e.proxy:wo(e.parent):null,Qn=Ut(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>wo(e.parent),$root:e=>wo(e.root),$emit:e=>e.emit,$options:e=>v0(e),$forceUpdate:e=>e.f||(e.f=()=>G1(e.update)),$nextTick:e=>e.n||(e.n=K1.bind(e.proxy)),$watch:e=>Am.bind(e)}),Hm={get({_:e},t){const{ctx:s,setupState:a,data:n,props:r,accessCache:o,type:u,appContext:_}=e;let l;if(t[0]!=="$"){const w=o[t];if(w!==void 0)switch(w){case 1:return a[t];case 2:return n[t];case 4:return s[t];case 3:return r[t]}else{if(a!==Mt&&ut(a,t))return o[t]=1,a[t];if(n!==Mt&&ut(n,t))return o[t]=2,n[t];if((l=e.propsOptions[0])&&ut(l,t))return o[t]=3,r[t];if(s!==Mt&&ut(s,t))return o[t]=4,s[t];So&&(o[t]=0)}}const v=Qn[t];let c,b;if(v)return t==="$attrs"&&fs(e,"get",t),v(e);if((c=u.__cssModules)&&(c=c[t]))return c;if(s!==Mt&&ut(s,t))return o[t]=4,s[t];if(b=_.config.globalProperties,ut(b,t))return b[t]},set({_:e},t,s){const{data:a,setupState:n,ctx:r}=e;return n!==Mt&&ut(n,t)?(n[t]=s,!0):a!==Mt&&ut(a,t)?(a[t]=s,!0):ut(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(r[t]=s,!0)},has({_:{data:e,setupState:t,accessCache:s,ctx:a,appContext:n,propsOptions:r}},o){let u;return!!s[o]||e!==Mt&&ut(e,o)||t!==Mt&&ut(t,o)||(u=r[0])&&ut(u,o)||ut(a,o)||ut(Qn,o)||ut(n.config.globalProperties,o)},defineProperty(e,t,s){return s.get!=null?e._.accessCache[t]=0:ut(s,"value")&&this.set(e,t,s.value,null),Reflect.defineProperty(e,t,s)}};let So=!0;function Pm(e){const t=v0(e),s=e.proxy,a=e.ctx;So=!1,t.beforeCreate&&ec(t.beforeCreate,e,"bc");const{data:n,computed:r,methods:o,watch:u,provide:_,inject:l,created:v,beforeMount:c,mounted:b,beforeUpdate:w,updated:i,activated:F,deactivated:B,beforeDestroy:N,beforeUnmount:f,destroyed:R,unmounted:C,render:k,renderTracked:L,renderTriggered:m,errorCaptured:T,serverPrefetch:E,expose:h,inheritAttrs:y,components:g,directives:p,filters:M}=t;if(l&&Dm(l,a,null,e.appContext.config.unwrapInjectedRef),o)for(const X in o){const D=o[X];it(D)&&(a[X]=D.bind(s))}if(n){const X=n.call(s,s);Dt(X)&&(e.data=Qo(X))}if(So=!0,r)for(const X in r){const D=r[X],V=it(D)?D.bind(s,s):it(D.get)?D.get.bind(s,s):qs,d=!it(D)&&it(D.set)?D.set.bind(s):qs,A=cl({get:V,set:d});Object.defineProperty(a,X,{enumerable:!0,configurable:!0,get:()=>A.value,set:W=>A.value=W})}if(u)for(const X in u)h0(u[X],a,s,X);if(_){const X=it(_)?_.call(s):_;Reflect.ownKeys(X).forEach(D=>{Mm(D,X[D])})}v&&ec(v,e,"c");function j(X,D){Je(D)?D.forEach(V=>X(V.bind(s))):D&&X(D.bind(s))}if(j(Om,c),j(l0,b),j(Im,w),j(c0,i),j(km,F),j(Rm,B),j(Nm,T),j(Bm,L),j(Lm,m),j(u0,f),j(d0,C),j(Cm,E),Je(h))if(h.length){const X=e.exposed||(e.exposed={});h.forEach(D=>{Object.defineProperty(X,D,{get:()=>s[D],set:V=>s[D]=V})})}else e.exposed||(e.exposed={});k&&e.render===qs&&(e.render=k),y!=null&&(e.inheritAttrs=y),g&&(e.components=g),p&&(e.directives=p)}function Dm(e,t,s=qs,a=!1){Je(e)&&(e=Eo(e));for(const n in e){const r=e[n];let o;Dt(r)?"default"in r?o=Xi(r.from||n,r.default,!0):o=Xi(r.from||n):o=Xi(r),Gt(o)&&a?Object.defineProperty(t,n,{enumerable:!0,configurable:!0,get:()=>o.value,set:u=>o.value=u}):t[n]=o}}function ec(e,t,s){bs(Je(e)?e.map(a=>a.bind(t.proxy)):e.bind(t.proxy),t,s)}function h0(e,t,s,a){const n=a.includes(".")?s0(s,a):()=>s[a];if(Pt(e)){const r=t[e];it(r)&&Ha(n,r)}else if(it(e))Ha(n,e.bind(s));else if(Dt(e))if(Je(e))e.forEach(r=>h0(r,t,s,a));else{const r=it(e.handler)?e.handler.bind(s):t[e.handler];it(r)&&Ha(n,r,e)}}function v0(e){const t=e.type,{mixins:s,extends:a}=t,{mixins:n,optionsCache:r,config:{optionMergeStrategies:o}}=e.appContext,u=r.get(t);let _;return u?_=u:!n.length&&!s&&!a?_=t:(_={},n.length&&n.forEach(l=>Jn(_,l,o,!0)),Jn(_,t,o)),r.set(t,_),_}function Jn(e,t,s,a=!1){const{mixins:n,extends:r}=t;r&&Jn(e,r,s,!0),n&&n.forEach(o=>Jn(e,o,s,!0));for(const o in t)if(!(a&&o==="expose")){const u=Um[o]||s&&s[o];e[o]=u?u(e[o],t[o]):t[o]}return e}const Um={data:tc,props:Oa,emits:Oa,methods:Oa,computed:Oa,beforeCreate:Jt,created:Jt,beforeMount:Jt,mounted:Jt,beforeUpdate:Jt,updated:Jt,beforeDestroy:Jt,beforeUnmount:Jt,destroyed:Jt,unmounted:Jt,activated:Jt,deactivated:Jt,errorCaptured:Jt,serverPrefetch:Jt,components:Oa,directives:Oa,watch:Vm,provide:tc,inject:qm};function tc(e,t){return t?e?function(){return Ut(it(e)?e.call(this,this):e,it(t)?t.call(this,this):t)}:t:e}function qm(e,t){return Oa(Eo(e),Eo(t))}function Eo(e){if(Je(e)){const t={};for(let s=0;s<e.length;s++)t[e[s]]=e[s];return t}return e}function Jt(e,t){return e?[...new Set([].concat(e,t))]:t}function Oa(e,t){return e?Ut(Ut(Object.create(null),e),t):t}function Vm(e,t){if(!e)return t;if(!t)return e;const s=Ut(Object.create(null),e);for(const a in t)s[a]=Jt(e[a],t[a]);return s}function zm(e,t,s,a=!1){const n={},r={};Kn(r,pi,1),e.propsDefaults=Object.create(null),_0(e,t,n,r);for(const o in e.propsOptions[0])o in n||(n[o]=void 0);s?e.props=a?n:im(n):e.type.props?e.props=n:e.props=r,e.attrs=r}function Ym(e,t,s,a){const{props:n,attrs:r,vnode:{patchFlag:o}}=e,u=ht(n),[_]=e.propsOptions;let l=!1;if((a||o>0)&&!(o&16)){if(o&8){const v=e.vnode.dynamicProps;for(let c=0;c<v.length;c++){let b=v[c];if(fi(e.emitsOptions,b))continue;const w=t[b];if(_)if(ut(r,b))w!==r[b]&&(r[b]=w,l=!0);else{const i=ws(b);n[i]=Mo(_,u,i,w,e,!1)}else w!==r[b]&&(r[b]=w,l=!0)}}}else{_0(e,t,n,r)&&(l=!0);let v;for(const c in u)(!t||!ut(t,c)&&((v=Vs(c))===c||!ut(t,v)))&&(_?s&&(s[c]!==void 0||s[v]!==void 0)&&(n[c]=Mo(_,u,c,void 0,e,!0)):delete n[c]);if(r!==u)for(const c in r)(!t||!ut(t,c))&&(delete r[c],l=!0)}l&&Ks(e,"set","$attrs")}function _0(e,t,s,a){const[n,r]=e.propsOptions;let o=!1,u;if(t)for(let _ in t){if(Un(_))continue;const l=t[_];let v;n&&ut(n,v=ws(_))?!r||!r.includes(v)?s[v]=l:(u||(u={}))[v]=l:fi(e.emitsOptions,_)||(!(_ in a)||l!==a[_])&&(a[_]=l,o=!0)}if(r){const _=ht(s),l=u||Mt;for(let v=0;v<r.length;v++){const c=r[v];s[c]=Mo(n,_,c,l[c],e,!ut(l,c))}}return o}function Mo(e,t,s,a,n,r){const o=e[s];if(o!=null){const u=ut(o,"default");if(u&&a===void 0){const _=o.default;if(o.type!==Function&&it(_)){const{propsDefaults:l}=n;s in l?a=l[s]:(ir(n),a=l[s]=_.call(null,t),Pa())}else a=_}o[0]&&(r&&!u?a=!1:o[1]&&(a===""||a===Vs(s))&&(a=!0))}return a}function p0(e,t,s=!1){const a=t.propsCache,n=a.get(e);if(n)return n;const r=e.props,o={},u=[];let _=!1;if(!it(e)){const v=c=>{_=!0;const[b,w]=p0(c,t,!0);Ut(o,b),w&&u.push(...w)};!s&&t.mixins.length&&t.mixins.forEach(v),e.extends&&v(e.extends),e.mixins&&e.mixins.forEach(v)}if(!r&&!_)return a.set(e,tr),tr;if(Je(r))for(let v=0;v<r.length;v++){const c=ws(r[v]);sc(c)&&(o[c]=Mt)}else if(r)for(const v in r){const c=ws(v);if(sc(c)){const b=r[v],w=o[c]=Je(b)||it(b)?{type:b}:b;if(w){const i=nc(Boolean,w.type),F=nc(String,w.type);w[0]=i>-1,w[1]=F<0||i<F,(i>-1||ut(w,"default"))&&u.push(c)}}}const l=[o,u];return a.set(e,l),l}function sc(e){return e[0]!=="$"}function ac(e){const t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:e===null?"null":""}function rc(e,t){return ac(e)===ac(t)}function nc(e,t){return Je(t)?t.findIndex(s=>rc(s,e)):it(t)&&rc(t,e)?0:-1}const g0=e=>e[0]==="_"||e==="$stable",rl=e=>Je(e)?e.map(js):[js(e)],Xm=(e,t,s)=>{if(t._n)return t;const a=Ke((...n)=>rl(t(...n)),s);return a._c=!1,a},b0=(e,t,s)=>{const a=e._ctx;for(const n in e){if(g0(n))continue;const r=e[n];if(it(r))t[n]=Xm(n,r,a);else if(r!=null){const o=rl(r);t[n]=()=>o}}},y0=(e,t)=>{const s=rl(t);e.slots.default=()=>s},Km=(e,t)=>{if(e.vnode.shapeFlag&32){const s=t._;s?(e.slots=ht(t),Kn(t,"_",s)):b0(t,e.slots={})}else e.slots={},t&&y0(e,t);Kn(e.slots,pi,1)},Gm=(e,t,s)=>{const{vnode:a,slots:n}=e;let r=!0,o=Mt;if(a.shapeFlag&32){const u=t._;u?s&&u===1?r=!1:(Ut(n,t),!s&&u===1&&delete n._):(r=!t.$stable,b0(t,n)),o=t}else t&&(y0(e,t),o={default:1});if(r)for(const u in n)!g0(u)&&!(u in o)&&delete n[u]};function w0(){return{app:null,config:{isNativeTag:Md,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Wm=0;function Zm(e,t){return function(a,n=null){it(a)||(a=Object.assign({},a)),n!=null&&!Dt(n)&&(n=null);const r=w0(),o=new Set;let u=!1;const _=r.app={_uid:Wm++,_component:a,_props:n,_container:null,_context:r,_instance:null,version:_f,get config(){return r.config},set config(l){},use(l,...v){return o.has(l)||(l&&it(l.install)?(o.add(l),l.install(_,...v)):it(l)&&(o.add(l),l(_,...v))),_},mixin(l){return r.mixins.includes(l)||r.mixins.push(l),_},component(l,v){return v?(r.components[l]=v,_):r.components[l]},directive(l,v){return v?(r.directives[l]=v,_):r.directives[l]},mount(l,v,c){if(!u){const b=Ie(a,n);return b.appContext=r,v&&t?t(b,l):e(b,l,c),u=!0,_._container=l,l.__vue_app__=_,gi(b.component)||b.component.proxy}},unmount(){u&&(e(null,_._container),delete _._container.__vue_app__)},provide(l,v){return r.provides[l]=v,_}};return _}}function Ao(e,t,s,a,n=!1){if(Je(e)){e.forEach((b,w)=>Ao(b,t&&(Je(t)?t[w]:t),s,a,n));return}if(Fr(a)&&!n)return;const r=a.shapeFlag&4?gi(a.component)||a.component.proxy:a.el,o=n?null:r,{i:u,r:_}=e,l=t&&t.r,v=u.refs===Mt?u.refs={}:u.refs,c=u.setupState;if(l!=null&&l!==_&&(Pt(l)?(v[l]=null,ut(c,l)&&(c[l]=null)):Gt(l)&&(l.value=null)),it(_))la(_,u,12,[o,v]);else{const b=Pt(_),w=Gt(_);if(b||w){const i=()=>{if(e.f){const F=b?v[_]:_.value;n?Je(F)&&Vo(F,r):Je(F)?F.includes(r)||F.push(r):b?(v[_]=[r],ut(c,_)&&(c[_]=v[_])):(_.value=[r],e.k&&(v[e.k]=_.value))}else b?(v[_]=o,ut(c,_)&&(c[_]=o)):w&&(_.value=o,e.k&&(v[e.k]=o))};o?(i.id=-1,rs(i,s)):i()}}}const rs=Em;function Qm(e){return Jm(e)}function Jm(e,t){const s=Od();s.__VUE__=!0;const{insert:a,remove:n,patchProp:r,createElement:o,createText:u,createComment:_,setText:l,setElementText:v,parentNode:c,nextSibling:b,setScopeId:w=qs,cloneNode:i,insertStaticContent:F}=e,B=(H,z,ee,me=null,he=null,Ee=null,Re=!1,we=null,ke=!!z.dynamicChildren)=>{if(H===z)return;H&&!Ca(H,z)&&(me=ie(H),Q(H,he,Ee,!0),H=null),z.patchFlag===-2&&(ke=!1,z.dynamicChildren=null);const{type:_e,ref:Pe,shapeFlag:je}=z;switch(_e){case il:N(H,z,ee,me);break;case ys:f(H,z,ee,me);break;case Gi:H==null&&R(z,ee,me,Re);break;case dt:p(H,z,ee,me,he,Ee,Re,we,ke);break;default:je&1?L(H,z,ee,me,he,Ee,Re,we,ke):je&6?M(H,z,ee,me,he,Ee,Re,we,ke):(je&64||je&128)&&_e.process(H,z,ee,me,he,Ee,Re,we,ke,le)}Pe!=null&&he&&Ao(Pe,H&&H.ref,Ee,z||H,!z)},N=(H,z,ee,me)=>{if(H==null)a(z.el=u(z.children),ee,me);else{const he=z.el=H.el;z.children!==H.children&&l(he,z.children)}},f=(H,z,ee,me)=>{H==null?a(z.el=_(z.children||""),ee,me):z.el=H.el},R=(H,z,ee,me)=>{[H.el,H.anchor]=F(H.children,z,ee,me,H.el,H.anchor)},C=({el:H,anchor:z},ee,me)=>{let he;for(;H&&H!==z;)he=b(H),a(H,ee,me),H=he;a(z,ee,me)},k=({el:H,anchor:z})=>{let ee;for(;H&&H!==z;)ee=b(H),n(H),H=ee;n(z)},L=(H,z,ee,me,he,Ee,Re,we,ke)=>{Re=Re||z.type==="svg",H==null?m(z,ee,me,he,Ee,Re,we,ke):h(H,z,he,Ee,Re,we,ke)},m=(H,z,ee,me,he,Ee,Re,we)=>{let ke,_e;const{type:Pe,props:je,shapeFlag:De,transition:qe,patchFlag:We,dirs:fe}=H;if(H.el&&i!==void 0&&We===-1)ke=H.el=i(H.el);else{if(ke=H.el=o(H.type,Ee,je&&je.is,je),De&8?v(ke,H.children):De&16&&E(H.children,ke,null,me,he,Ee&&Pe!=="foreignObject",Re,we),fe&&ya(H,null,me,"created"),je){for(const te in je)te!=="value"&&!Un(te)&&r(ke,te,null,je[te],Ee,H.children,me,he,Y);"value"in je&&r(ke,"value",null,je.value),(_e=je.onVnodeBeforeMount)&&Cs(_e,me,H)}T(ke,H,H.scopeId,Re,me)}fe&&ya(H,null,me,"beforeMount");const Se=(!he||he&&!he.pendingBranch)&&qe&&!qe.persisted;Se&&qe.beforeEnter(ke),a(ke,z,ee),((_e=je&&je.onVnodeMounted)||Se||fe)&&rs(()=>{_e&&Cs(_e,me,H),Se&&qe.enter(ke),fe&&ya(H,null,me,"mounted")},he)},T=(H,z,ee,me,he)=>{if(ee&&w(H,ee),me)for(let Ee=0;Ee<me.length;Ee++)w(H,me[Ee]);if(he){let Ee=he.subTree;if(z===Ee){const Re=he.vnode;T(H,Re,Re.scopeId,Re.slotScopeIds,he.parent)}}},E=(H,z,ee,me,he,Ee,Re,we,ke=0)=>{for(let _e=ke;_e<H.length;_e++){const Pe=H[_e]=we?ia(H[_e]):js(H[_e]);B(null,Pe,z,ee,me,he,Ee,Re,we)}},h=(H,z,ee,me,he,Ee,Re)=>{const we=z.el=H.el;let{patchFlag:ke,dynamicChildren:_e,dirs:Pe}=z;ke|=H.patchFlag&16;const je=H.props||Mt,De=z.props||Mt;let qe;ee&&wa(ee,!1),(qe=De.onVnodeBeforeUpdate)&&Cs(qe,ee,z,H),Pe&&ya(z,H,ee,"beforeUpdate"),ee&&wa(ee,!0);const We=he&&z.type!=="foreignObject";if(_e?y(H.dynamicChildren,_e,we,ee,me,We,Ee):Re||V(H,z,we,null,ee,me,We,Ee,!1),ke>0){if(ke&16)g(we,z,je,De,ee,me,he);else if(ke&2&&je.class!==De.class&&r(we,"class",null,De.class,he),ke&4&&r(we,"style",je.style,De.style,he),ke&8){const fe=z.dynamicProps;for(let Se=0;Se<fe.length;Se++){const te=fe[Se],Be=je[te],x=De[te];(x!==Be||te==="value")&&r(we,te,Be,x,he,H.children,ee,me,Y)}}ke&1&&H.children!==z.children&&v(we,z.children)}else!Re&&_e==null&&g(we,z,je,De,ee,me,he);((qe=De.onVnodeUpdated)||Pe)&&rs(()=>{qe&&Cs(qe,ee,z,H),Pe&&ya(z,H,ee,"updated")},me)},y=(H,z,ee,me,he,Ee,Re)=>{for(let we=0;we<z.length;we++){const ke=H[we],_e=z[we],Pe=ke.el&&(ke.type===dt||!Ca(ke,_e)||ke.shapeFlag&70)?c(ke.el):ee;B(ke,_e,Pe,null,me,he,Ee,Re,!0)}},g=(H,z,ee,me,he,Ee,Re)=>{if(ee!==me){for(const we in me){if(Un(we))continue;const ke=me[we],_e=ee[we];ke!==_e&&we!=="value"&&r(H,we,_e,ke,Re,z.children,he,Ee,Y)}if(ee!==Mt)for(const we in ee)!Un(we)&&!(we in me)&&r(H,we,ee[we],null,Re,z.children,he,Ee,Y);"value"in me&&r(H,"value",ee.value,me.value)}},p=(H,z,ee,me,he,Ee,Re,we,ke)=>{const _e=z.el=H?H.el:u(""),Pe=z.anchor=H?H.anchor:u("");let{patchFlag:je,dynamicChildren:De,slotScopeIds:qe}=z;qe&&(we=we?we.concat(qe):qe),H==null?(a(_e,ee,me),a(Pe,ee,me),E(z.children,ee,Pe,he,Ee,Re,we,ke)):je>0&&je&64&&De&&H.dynamicChildren?(y(H.dynamicChildren,De,ee,he,Ee,Re,we),(z.key!=null||he&&z===he.subTree)&&nl(H,z,!0)):V(H,z,ee,Pe,he,Ee,Re,we,ke)},M=(H,z,ee,me,he,Ee,Re,we,ke)=>{z.slotScopeIds=we,H==null?z.shapeFlag&512?he.ctx.activate(z,ee,me,Re,ke):S(z,ee,me,he,Ee,Re,ke):j(H,z,ke)},S=(H,z,ee,me,he,Ee,Re)=>{const we=H.component=cf(H,me,he);if(hi(H)&&(we.ctx.renderer=le),uf(we),we.asyncDep){if(he&&he.registerDep(we,X),!H.el){const ke=we.subTree=Ie(ys);f(null,ke,z,ee)}return}X(we,H,z,ee,he,Ee,Re)},j=(H,z,ee)=>{const me=z.component=H.component;if(ym(H,z,ee))if(me.asyncDep&&!me.asyncResolved){D(me,z,ee);return}else me.next=z,hm(me.update),me.update();else z.el=H.el,me.vnode=z},X=(H,z,ee,me,he,Ee,Re)=>{const we=()=>{if(H.isMounted){let{next:Pe,bu:je,u:De,parent:qe,vnode:We}=H,fe=Pe,Se;wa(H,!1),Pe?(Pe.el=We.el,D(H,Pe,Re)):Pe=We,je&&zi(je),(Se=Pe.props&&Pe.props.onVnodeBeforeUpdate)&&Cs(Se,qe,Pe,We),wa(H,!0);const te=Yi(H),Be=H.subTree;H.subTree=te,B(Be,te,c(Be.el),ie(Be),H,he,Ee),Pe.el=te.el,fe===null&&wm(H,te.el),De&&rs(De,he),(Se=Pe.props&&Pe.props.onVnodeUpdated)&&rs(()=>Cs(Se,qe,Pe,We),he)}else{let Pe;const{el:je,props:De}=z,{bm:qe,m:We,parent:fe}=H,Se=Fr(z);if(wa(H,!1),qe&&zi(qe),!Se&&(Pe=De&&De.onVnodeBeforeMount)&&Cs(Pe,fe,z),wa(H,!0),je&&Ze){const te=()=>{H.subTree=Yi(H),Ze(je,H.subTree,H,he,null)};Se?z.type.__asyncLoader().then(()=>!H.isUnmounted&&te()):te()}else{const te=H.subTree=Yi(H);B(null,te,ee,me,H,he,Ee),z.el=te.el}if(We&&rs(We,he),!Se&&(Pe=De&&De.onVnodeMounted)){const te=z;rs(()=>Cs(Pe,fe,te),he)}(z.shapeFlag&256||fe&&Fr(fe.vnode)&&fe.vnode.shapeFlag&256)&&H.a&&rs(H.a,he),H.isMounted=!0,z=ee=me=null}},ke=H.effect=new Ko(we,()=>G1(_e),H.scope),_e=H.update=()=>ke.run();_e.id=H.uid,wa(H,!0),_e()},D=(H,z,ee)=>{z.component=H;const me=H.vnode.props;H.vnode=z,H.next=null,Ym(H,z.props,me,ee),Gm(H,z.children,ee),mr(),mi(void 0,H.update),fr()},V=(H,z,ee,me,he,Ee,Re,we,ke=!1)=>{const _e=H&&H.children,Pe=H?H.shapeFlag:0,je=z.children,{patchFlag:De,shapeFlag:qe}=z;if(De>0){if(De&128){A(_e,je,ee,me,he,Ee,Re,we,ke);return}else if(De&256){d(_e,je,ee,me,he,Ee,Re,we,ke);return}}qe&8?(Pe&16&&Y(_e,he,Ee),je!==_e&&v(ee,je)):Pe&16?qe&16?A(_e,je,ee,me,he,Ee,Re,we,ke):Y(_e,he,Ee,!0):(Pe&8&&v(ee,""),qe&16&&E(je,ee,me,he,Ee,Re,we,ke))},d=(H,z,ee,me,he,Ee,Re,we,ke)=>{H=H||tr,z=z||tr;const _e=H.length,Pe=z.length,je=Math.min(_e,Pe);let De;for(De=0;De<je;De++){const qe=z[De]=ke?ia(z[De]):js(z[De]);B(H[De],qe,ee,null,he,Ee,Re,we,ke)}_e>Pe?Y(H,he,Ee,!0,!1,je):E(z,ee,me,he,Ee,Re,we,ke,je)},A=(H,z,ee,me,he,Ee,Re,we,ke)=>{let _e=0;const Pe=z.length;let je=H.length-1,De=Pe-1;for(;_e<=je&&_e<=De;){const qe=H[_e],We=z[_e]=ke?ia(z[_e]):js(z[_e]);if(Ca(qe,We))B(qe,We,ee,null,he,Ee,Re,we,ke);else break;_e++}for(;_e<=je&&_e<=De;){const qe=H[je],We=z[De]=ke?ia(z[De]):js(z[De]);if(Ca(qe,We))B(qe,We,ee,null,he,Ee,Re,we,ke);else break;je--,De--}if(_e>je){if(_e<=De){const qe=De+1,We=qe<Pe?z[qe].el:me;for(;_e<=De;)B(null,z[_e]=ke?ia(z[_e]):js(z[_e]),ee,We,he,Ee,Re,we,ke),_e++}}else if(_e>De)for(;_e<=je;)Q(H[_e],he,Ee,!0),_e++;else{const qe=_e,We=_e,fe=new Map;for(_e=We;_e<=De;_e++){const K=z[_e]=ke?ia(z[_e]):js(z[_e]);K.key!=null&&fe.set(K.key,_e)}let Se,te=0;const Be=De-We+1;let x=!1,I=0;const U=new Array(Be);for(_e=0;_e<Be;_e++)U[_e]=0;for(_e=qe;_e<=je;_e++){const K=H[_e];if(te>=Be){Q(K,he,Ee,!0);continue}let P;if(K.key!=null)P=fe.get(K.key);else for(Se=We;Se<=De;Se++)if(U[Se-We]===0&&Ca(K,z[Se])){P=Se;break}P===void 0?Q(K,he,Ee,!0):(U[P-We]=_e+1,P>=I?I=P:x=!0,B(K,z[P],ee,null,he,Ee,Re,we,ke),te++)}const q=x?$m(U):tr;for(Se=q.length-1,_e=Be-1;_e>=0;_e--){const K=We+_e,P=z[K],Z=K+1<Pe?z[K+1].el:me;U[_e]===0?B(null,P,ee,Z,he,Ee,Re,we,ke):x&&(Se<0||_e!==q[Se]?W(P,ee,Z,2):Se--)}}},W=(H,z,ee,me,he=null)=>{const{el:Ee,type:Re,transition:we,children:ke,shapeFlag:_e}=H;if(_e&6){W(H.component.subTree,z,ee,me);return}if(_e&128){H.suspense.move(z,ee,me);return}if(_e&64){Re.move(H,z,ee,le);return}if(Re===dt){a(Ee,z,ee);for(let je=0;je<ke.length;je++)W(ke[je],z,ee,me);a(H.anchor,z,ee);return}if(Re===Gi){C(H,z,ee);return}if(me!==2&&_e&1&&we)if(me===0)we.beforeEnter(Ee),a(Ee,z,ee),rs(()=>we.enter(Ee),he);else{const{leave:je,delayLeave:De,afterLeave:qe}=we,We=()=>a(Ee,z,ee),fe=()=>{je(Ee,()=>{We(),qe&&qe()})};De?De(Ee,We,fe):fe()}else a(Ee,z,ee)},Q=(H,z,ee,me=!1,he=!1)=>{const{type:Ee,props:Re,ref:we,children:ke,dynamicChildren:_e,shapeFlag:Pe,patchFlag:je,dirs:De}=H;if(we!=null&&Ao(we,null,ee,H,!0),Pe&256){z.ctx.deactivate(H);return}const qe=Pe&1&&De,We=!Fr(H);let fe;if(We&&(fe=Re&&Re.onVnodeBeforeUnmount)&&Cs(fe,z,H),Pe&6)Te(H.component,ee,me);else{if(Pe&128){H.suspense.unmount(ee,me);return}qe&&ya(H,null,z,"beforeUnmount"),Pe&64?H.type.remove(H,z,ee,he,le,me):_e&&(Ee!==dt||je>0&&je&64)?Y(_e,z,ee,!1,!0):(Ee===dt&&je&384||!he&&Pe&16)&&Y(ke,z,ee),me&&ve(H)}(We&&(fe=Re&&Re.onVnodeUnmounted)||qe)&&rs(()=>{fe&&Cs(fe,z,H),qe&&ya(H,null,z,"unmounted")},ee)},ve=H=>{const{type:z,el:ee,anchor:me,transition:he}=H;if(z===dt){Me(ee,me);return}if(z===Gi){k(H);return}const Ee=()=>{n(ee),he&&!he.persisted&&he.afterLeave&&he.afterLeave()};if(H.shapeFlag&1&&he&&!he.persisted){const{leave:Re,delayLeave:we}=he,ke=()=>Re(ee,Ee);we?we(H.el,Ee,ke):ke()}else Ee()},Me=(H,z)=>{let ee;for(;H!==z;)ee=b(H),n(H),H=ee;n(z)},Te=(H,z,ee)=>{const{bum:me,scope:he,update:Ee,subTree:Re,um:we}=H;me&&zi(me),he.stop(),Ee&&(Ee.active=!1,Q(Re,H,z,ee)),we&&rs(we,z),rs(()=>{H.isUnmounted=!0},z),z&&z.pendingBranch&&!z.isUnmounted&&H.asyncDep&&!H.asyncResolved&&H.suspenseId===z.pendingId&&(z.deps--,z.deps===0&&z.resolve())},Y=(H,z,ee,me=!1,he=!1,Ee=0)=>{for(let Re=Ee;Re<H.length;Re++)Q(H[Re],z,ee,me,he)},ie=H=>H.shapeFlag&6?ie(H.component.subTree):H.shapeFlag&128?H.suspense.next():b(H.anchor||H.el),ae=(H,z,ee)=>{H==null?z._vnode&&Q(z._vnode,null,null,!0):B(z._vnode||null,H,z,null,null,null,ee),Q1(),z._vnode=H},le={p:B,um:Q,m:W,r:ve,mt:S,mc:E,pc:V,pbc:y,n:ie,o:e};let Ue,Ze;return{render:ae,hydrate:Ue,createApp:Zm(ae,Ue)}}function wa({effect:e,update:t},s){e.allowRecurse=t.allowRecurse=s}function nl(e,t,s=!1){const a=e.children,n=t.children;if(Je(a)&&Je(n))for(let r=0;r<a.length;r++){const o=a[r];let u=n[r];u.shapeFlag&1&&!u.dynamicChildren&&((u.patchFlag<=0||u.patchFlag===32)&&(u=n[r]=ia(n[r]),u.el=o.el),s||nl(o,u))}}function $m(e){const t=e.slice(),s=[0];let a,n,r,o,u;const _=e.length;for(a=0;a<_;a++){const l=e[a];if(l!==0){if(n=s[s.length-1],e[n]<l){t[a]=n,s.push(a);continue}for(r=0,o=s.length-1;r<o;)u=r+o>>1,e[s[u]]<l?r=u+1:o=u;l<e[s[r]]&&(r>0&&(t[a]=s[r-1]),s[r]=a)}}for(r=s.length,o=s[r-1];r-- >0;)s[r]=o,o=t[o];return s}const ef=e=>e.__isTeleport,Hr=e=>e&&(e.disabled||e.disabled===""),ic=e=>typeof SVGElement<"u"&&e instanceof SVGElement,To=(e,t)=>{const s=e&&e.to;return Pt(s)?t?t(s):null:s},tf={__isTeleport:!0,process(e,t,s,a,n,r,o,u,_,l){const{mc:v,pc:c,pbc:b,o:{insert:w,querySelector:i,createText:F,createComment:B}}=l,N=Hr(t.props);let{shapeFlag:f,children:R,dynamicChildren:C}=t;if(e==null){const k=t.el=F(""),L=t.anchor=F("");w(k,s,a),w(L,s,a);const m=t.target=To(t.props,i),T=t.targetAnchor=F("");m&&(w(T,m),o=o||ic(m));const E=(h,y)=>{f&16&&v(R,h,y,n,r,o,u,_)};N?E(s,L):m&&E(m,T)}else{t.el=e.el;const k=t.anchor=e.anchor,L=t.target=e.target,m=t.targetAnchor=e.targetAnchor,T=Hr(e.props),E=T?s:L,h=T?k:m;if(o=o||ic(L),C?(b(e.dynamicChildren,C,E,n,r,o,u),nl(e,t,!0)):_||c(e,t,E,h,n,r,o,u,!1),N)T||kn(t,s,k,l,1);else if((t.props&&t.props.to)!==(e.props&&e.props.to)){const y=t.target=To(t.props,i);y&&kn(t,y,null,l,0)}else T&&kn(t,L,m,l,1)}},remove(e,t,s,a,{um:n,o:{remove:r}},o){const{shapeFlag:u,children:_,anchor:l,targetAnchor:v,target:c,props:b}=e;if(c&&r(v),(o||!Hr(b))&&(r(l),u&16))for(let w=0;w<_.length;w++){const i=_[w];n(i,t,s,!0,!!i.dynamicChildren)}},move:kn,hydrate:sf};function kn(e,t,s,{o:{insert:a},m:n},r=2){r===0&&a(e.targetAnchor,t,s);const{el:o,anchor:u,shapeFlag:_,children:l,props:v}=e,c=r===2;if(c&&a(o,t,s),(!c||Hr(v))&&_&16)for(let b=0;b<l.length;b++)n(l[b],t,s,2);c&&a(u,t,s)}function sf(e,t,s,a,n,r,{o:{nextSibling:o,parentNode:u,querySelector:_}},l){const v=t.target=To(t.props,_);if(v){const c=v._lpa||v.firstChild;if(t.shapeFlag&16)if(Hr(t.props))t.anchor=l(o(e),t,u(e),s,a,n,r),t.targetAnchor=c;else{t.anchor=o(e);let b=c;for(;b;)if(b=o(b),b&&b.nodeType===8&&b.data==="teleport anchor"){t.targetAnchor=b,v._lpa=t.targetAnchor&&o(t.targetAnchor);break}l(c,t,v,s,a,n,r)}}return t.anchor&&o(t.anchor)}const af=tf,dt=Symbol(void 0),il=Symbol(void 0),ys=Symbol(void 0),Gi=Symbol(void 0),Pr=[];let Rs=null;function J(e=!1){Pr.push(Rs=e?null:[])}function rf(){Pr.pop(),Rs=Pr[Pr.length-1]||null}let Gr=1;function oc(e){Gr+=e}function S0(e){return e.dynamicChildren=Gr>0?Rs||tr:null,rf(),Gr>0&&Rs&&Rs.push(e),e}function ce(e,t,s,a,n,r){return S0(pe(e,t,s,a,n,r,!0))}function ft(e,t,s,a,n){return S0(Ie(e,t,s,a,n,!0))}function $n(e){return e?e.__v_isVNode===!0:!1}function Ca(e,t){return e.type===t.type&&e.key===t.key}const pi="__vInternal",E0=({key:e})=>e??null,qn=({ref:e,ref_key:t,ref_for:s})=>e!=null?Pt(e)||Gt(e)||it(e)?{i:Wt,r:e,k:t,f:!!s}:e:null;function pe(e,t=null,s=null,a=0,n=null,r=e===dt?0:1,o=!1,u=!1){const _={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&E0(t),ref:t&&qn(t),scopeId:e0,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:a,dynamicProps:n,dynamicChildren:null,appContext:null};return u?(ol(_,s),r&128&&e.normalize(_)):s&&(_.shapeFlag|=Pt(s)?8:16),Gr>0&&!o&&Rs&&(_.patchFlag>0||r&6)&&_.patchFlag!==32&&Rs.push(_),_}const Ie=nf;function nf(e,t=null,s=null,a=0,n=null,r=!1){if((!e||e===m0)&&(e=ys),$n(e)){const u=fa(e,t,!0);return s&&ol(u,s),Gr>0&&!r&&Rs&&(u.shapeFlag&6?Rs[Rs.indexOf(e)]=u:Rs.push(u)),u.patchFlag|=-2,u}if(vf(e)&&(e=e.__vccOpts),t){t=pt(t);let{class:u,style:_}=t;u&&!Pt(u)&&(t.class=nt(u)),Dt(_)&&(D1(_)&&!Je(_)&&(_=Ut({},_)),t.style=At(_))}const o=Pt(e)?1:Sm(e)?128:ef(e)?64:Dt(e)?4:it(e)?2:0;return pe(e,t,s,a,n,o,r,!0)}function pt(e){return e?D1(e)||pi in e?Ut({},e):e:null}function fa(e,t,s=!1){const{props:a,ref:n,patchFlag:r,children:o}=e,u=t?ll(a||{},t):a;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:u,key:u&&E0(u),ref:t&&t.ref?s&&n?Je(n)?n.concat(qn(t)):[n,qn(t)]:qn(t):n,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:o,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==dt?r===-1?16:r|16:r,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&fa(e.ssContent),ssFallback:e.ssFallback&&fa(e.ssFallback),el:e.el,anchor:e.anchor}}function ha(e=" ",t=0){return Ie(il,null,e,t)}function xe(e="",t=!1){return t?(J(),ft(ys,null,e)):Ie(ys,null,e)}function js(e){return e==null||typeof e=="boolean"?Ie(ys):Je(e)?Ie(dt,null,e.slice()):typeof e=="object"?ia(e):Ie(il,null,String(e))}function ia(e){return e.el===null||e.memo?e:fa(e)}function ol(e,t){let s=0;const{shapeFlag:a}=e;if(t==null)t=null;else if(Je(t))s=16;else if(typeof t=="object")if(a&65){const n=t.default;n&&(n._c&&(n._d=!1),ol(e,n()),n._c&&(n._d=!0));return}else{s=32;const n=t._;!n&&!(pi in t)?t._ctx=Wt:n===3&&Wt&&(Wt.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else it(t)?(t={default:t,_ctx:Wt},s=32):(t=String(t),a&64?(s=16,t=[ha(t)]):s=8);e.children=t,e.shapeFlag|=s}function ll(...e){const t={};for(let s=0;s<e.length;s++){const a=e[s];for(const n in a)if(n==="class")t.class!==a.class&&(t.class=nt([t.class,a.class]));else if(n==="style")t.style=At([t.style,a.style]);else if(ni(n)){const r=t[n],o=a[n];o&&r!==o&&!(Je(r)&&r.includes(o))&&(t[n]=r?[].concat(r,o):o)}else n!==""&&(t[n]=a[n])}return t}function Cs(e,t,s,a=null){bs(e,t,7,[s,a])}const of=w0();let lf=0;function cf(e,t,s){const a=e.type,n=(t?t.appContext:e.appContext)||of,r={uid:lf++,vnode:e,type:a,parent:t,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,scope:new Id(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(n.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:p0(a,n),emitsOptions:$1(a,n),emit:null,emitted:null,propsDefaults:Mt,inheritAttrs:a.inheritAttrs,ctx:Mt,data:Mt,props:Mt,attrs:Mt,slots:Mt,refs:Mt,setupState:Mt,setupContext:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=t?t.root:r,r.emit=pm.bind(null,r),e.ce&&e.ce(r),r}let Vt=null;const M0=()=>Vt||Wt,ir=e=>{Vt=e,e.scope.on()},Pa=()=>{Vt&&Vt.scope.off(),Vt=null};function A0(e){return e.vnode.shapeFlag&4}let Wr=!1;function uf(e,t=!1){Wr=t;const{props:s,children:a}=e.vnode,n=A0(e);zm(e,s,n,t),Km(e,a);const r=n?df(e,t):void 0;return Wr=!1,r}function df(e,t){const s=e.type;e.accessCache=Object.create(null),e.proxy=U1(new Proxy(e.ctx,Hm));const{setup:a}=s;if(a){const n=e.setupContext=a.length>1?ff(e):null;ir(e),mr();const r=la(a,e,0,[e.props,n]);if(fr(),Pa(),T1(r)){if(r.then(Pa,Pa),t)return r.then(o=>{lc(e,o,t)}).catch(o=>{di(o,e,0)});e.asyncDep=r}else lc(e,r,t)}else T0(e,t)}function lc(e,t,s){it(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:Dt(t)&&(e.setupState=Y1(t)),T0(e,s)}let cc;function T0(e,t,s){const a=e.type;if(!e.render){if(!t&&cc&&!a.render){const n=a.template;if(n){const{isCustomElement:r,compilerOptions:o}=e.appContext.config,{delimiters:u,compilerOptions:_}=a,l=Ut(Ut({isCustomElement:r,delimiters:u},o),_);a.render=cc(n,l)}}e.render=a.render||qs}ir(e),mr(),Pm(e),fr(),Pa()}function mf(e){return new Proxy(e.attrs,{get(t,s){return fs(e,"get","$attrs"),t[s]}})}function ff(e){const t=a=>{e.exposed=a||{}};let s;return{get attrs(){return s||(s=mf(e))},slots:e.slots,emit:e.emit,expose:t}}function gi(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Y1(U1(e.exposed)),{get(t,s){if(s in t)return t[s];if(s in Qn)return Qn[s](e)}}))}function hf(e,t=!0){return it(e)?e.displayName||e.name:e.name||t&&e.__name}function vf(e){return it(e)&&"__vccOpts"in e}const cl=(e,t)=>dm(e,t,Wr);function k0(e,t,s){const a=arguments.length;return a===2?Dt(t)&&!Je(t)?$n(t)?Ie(e,null,[t]):Ie(e,t):Ie(e,null,t):(a>3?s=Array.prototype.slice.call(arguments,2):a===3&&$n(s)&&(s=[s]),Ie(e,t,s))}const _f="3.2.37",pf="http://www.w3.org/2000/svg",La=typeof document<"u"?document:null,uc=La&&La.createElement("template"),gf={insert:(e,t,s)=>{t.insertBefore(e,s||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,s,a)=>{const n=t?La.createElementNS(pf,e):La.createElement(e,s?{is:s}:void 0);return e==="select"&&a&&a.multiple!=null&&n.setAttribute("multiple",a.multiple),n},createText:e=>La.createTextNode(e),createComment:e=>La.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>La.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},cloneNode(e){const t=e.cloneNode(!0);return"_value"in e&&(t._value=e._value),t},insertStaticContent(e,t,s,a,n,r){const o=s?s.previousSibling:t.lastChild;if(n&&(n===r||n.nextSibling))for(;t.insertBefore(n.cloneNode(!0),s),!(n===r||!(n=n.nextSibling)););else{uc.innerHTML=a?`<svg>${e}</svg>`:e;const u=uc.content;if(a){const _=u.firstChild;for(;_.firstChild;)u.appendChild(_.firstChild);u.removeChild(_)}t.insertBefore(u,s)}return[o?o.nextSibling:t.firstChild,s?s.previousSibling:t.lastChild]}};function bf(e,t,s){const a=e._vtc;a&&(t=(t?[t,...a]:[...a]).join(" ")),t==null?e.removeAttribute("class"):s?e.setAttribute("class",t):e.className=t}function yf(e,t,s){const a=e.style,n=Pt(s);if(s&&!n){for(const r in s)ko(a,r,s[r]);if(t&&!Pt(t))for(const r in t)s[r]==null&&ko(a,r,"")}else{const r=a.display;n?t!==s&&(a.cssText=s):t&&e.removeAttribute("style"),"_vod"in e&&(a.display=r)}}const dc=/\s*!important$/;function ko(e,t,s){if(Je(s))s.forEach(a=>ko(e,t,a));else if(s==null&&(s=""),t.startsWith("--"))e.setProperty(t,s);else{const a=wf(e,t);dc.test(s)?e.setProperty(Vs(a),s.replace(dc,""),"important"):e[a]=s}}const mc=["Webkit","Moz","ms"],Wi={};function wf(e,t){const s=Wi[t];if(s)return s;let a=ws(t);if(a!=="filter"&&a in e)return Wi[t]=a;a=li(a);for(let n=0;n<mc.length;n++){const r=mc[n]+a;if(r in e)return Wi[t]=r}return t}const fc="http://www.w3.org/1999/xlink";function Sf(e,t,s,a,n){if(a&&t.startsWith("xlink:"))s==null?e.removeAttributeNS(fc,t.slice(6,t.length)):e.setAttributeNS(fc,t,s);else{const r=yd(t);s==null||r&&!E1(s)?e.removeAttribute(t):e.setAttribute(t,r?"":s)}}function Ef(e,t,s,a,n,r,o){if(t==="innerHTML"||t==="textContent"){a&&o(a,n,r),e[t]=s??"";return}if(t==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=s;const _=s??"";(e.value!==_||e.tagName==="OPTION")&&(e.value=_),s==null&&e.removeAttribute(t);return}let u=!1;if(s===""||s==null){const _=typeof e[t];_==="boolean"?s=E1(s):s==null&&_==="string"?(s="",u=!0):_==="number"&&(s=0,u=!0)}try{e[t]=s}catch{}u&&e.removeAttribute(t)}const[R0,Mf]=(()=>{let e=Date.now,t=!1;if(typeof window<"u"){Date.now()>document.createEvent("Event").timeStamp&&(e=performance.now.bind(performance));const s=navigator.userAgent.match(/firefox\/(\d+)/i);t=!!(s&&Number(s[1])<=53)}return[e,t]})();let Ro=0;const Af=Promise.resolve(),Tf=()=>{Ro=0},kf=()=>Ro||(Af.then(Tf),Ro=R0());function Rf(e,t,s,a){e.addEventListener(t,s,a)}function xf(e,t,s,a){e.removeEventListener(t,s,a)}function Of(e,t,s,a,n=null){const r=e._vei||(e._vei={}),o=r[t];if(a&&o)o.value=a;else{const[u,_]=If(t);if(a){const l=r[t]=Cf(a,n);Rf(e,u,l,_)}else o&&(xf(e,u,o,_),r[t]=void 0)}}const hc=/(?:Once|Passive|Capture)$/;function If(e){let t;if(hc.test(e)){t={};let s;for(;s=e.match(hc);)e=e.slice(0,e.length-s[0].length),t[s[0].toLowerCase()]=!0}return[Vs(e.slice(2)),t]}function Cf(e,t){const s=a=>{const n=a.timeStamp||R0();(Mf||n>=s.attached-1)&&bs(Lf(a,s.value),t,5,[a])};return s.value=e,s.attached=kf(),s}function Lf(e,t){if(Je(t)){const s=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{s.call(e),e._stopped=!0},t.map(a=>n=>!n._stopped&&a&&a(n))}else return t}const vc=/^on[a-z]/,Bf=(e,t,s,a,n=!1,r,o,u,_)=>{t==="class"?bf(e,a,n):t==="style"?yf(e,s,a):ni(t)?qo(t)||Of(e,t,s,a,o):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Nf(e,t,a,n))?Ef(e,t,a,r,o,u,_):(t==="true-value"?e._trueValue=a:t==="false-value"&&(e._falseValue=a),Sf(e,t,a,n))};function Nf(e,t,s,a){return a?!!(t==="innerHTML"||t==="textContent"||t in e&&vc.test(t)&&it(s)):t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||vc.test(t)&&Pt(s)?!1:t in e}function jf(e,t){const s=i0(e);class a extends ul{constructor(r){super(s,r,t)}}return a.def=s,a}const Ff=typeof HTMLElement<"u"?HTMLElement:class{};class ul extends Ff{constructor(t,s={},a){super(),this._def=t,this._props=s,this._instance=null,this._connected=!1,this._resolved=!1,this._numberProps=null,this.shadowRoot&&a?a(this._createVNode(),this.shadowRoot):this.attachShadow({mode:"open"})}connectedCallback(){this._connected=!0,this._instance||this._resolveDef()}disconnectedCallback(){this._connected=!1,K1(()=>{this._connected||(Sc(null,this.shadowRoot),this._instance=null)})}_resolveDef(){if(this._resolved)return;this._resolved=!0;for(let a=0;a<this.attributes.length;a++)this._setAttr(this.attributes[a].name);new MutationObserver(a=>{for(const n of a)this._setAttr(n.attributeName)}).observe(this,{attributes:!0});const t=a=>{const{props:n,styles:r}=a,o=!Je(n),u=n?o?Object.keys(n):n:[];let _;if(o)for(const l in this._props){const v=n[l];(v===Number||v&&v.type===Number)&&(this._props[l]=Gn(this._props[l]),(_||(_=Object.create(null)))[l]=!0)}this._numberProps=_;for(const l of Object.keys(this))l[0]!=="_"&&this._setProp(l,this[l],!0,!1);for(const l of u.map(ws))Object.defineProperty(this,l,{get(){return this._getProp(l)},set(v){this._setProp(l,v)}});this._applyStyles(r),this._update()},s=this._def.__asyncLoader;s?s().then(t):t(this._def)}_setAttr(t){let s=this.getAttribute(t);this._numberProps&&this._numberProps[t]&&(s=Gn(s)),this._setProp(ws(t),s,!1)}_getProp(t){return this._props[t]}_setProp(t,s,a=!0,n=!0){s!==this._props[t]&&(this._props[t]=s,n&&this._instance&&this._update(),a&&(s===!0?this.setAttribute(Vs(t),""):typeof s=="string"||typeof s=="number"?this.setAttribute(Vs(t),s+""):s||this.removeAttribute(Vs(t))))}_update(){Sc(this._createVNode(),this.shadowRoot)}_createVNode(){const t=Ie(this._def,Ut({},this._props));return this._instance||(t.ce=s=>{this._instance=s,s.isCE=!0,s.emit=(n,...r)=>{this.dispatchEvent(new CustomEvent(n,{detail:r}))};let a=this;for(;a=a&&(a.parentNode||a.host);)if(a instanceof ul){s.parent=a._instance;break}}),t}_applyStyles(t){t&&t.forEach(s=>{const a=document.createElement("style");a.textContent=s,this.shadowRoot.appendChild(a)})}}const Js="transition",wr="animation",Nt=(e,{slots:t})=>k0(r0,O0(e),t);Nt.displayName="Transition";const x0={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Hf=Nt.props=Ut({},r0.props,x0),Sa=(e,t=[])=>{Je(e)?e.forEach(s=>s(...t)):e&&e(...t)},_c=e=>e?Je(e)?e.some(t=>t.length>1):e.length>1:!1;function O0(e){const t={};for(const g in e)g in x0||(t[g]=e[g]);if(e.css===!1)return t;const{name:s="v",type:a,duration:n,enterFromClass:r=`${s}-enter-from`,enterActiveClass:o=`${s}-enter-active`,enterToClass:u=`${s}-enter-to`,appearFromClass:_=r,appearActiveClass:l=o,appearToClass:v=u,leaveFromClass:c=`${s}-leave-from`,leaveActiveClass:b=`${s}-leave-active`,leaveToClass:w=`${s}-leave-to`}=e,i=Pf(n),F=i&&i[0],B=i&&i[1],{onBeforeEnter:N,onEnter:f,onEnterCancelled:R,onLeave:C,onLeaveCancelled:k,onBeforeAppear:L=N,onAppear:m=f,onAppearCancelled:T=R}=t,E=(g,p,M)=>{na(g,p?v:u),na(g,p?l:o),M&&M()},h=(g,p)=>{g._isLeaving=!1,na(g,c),na(g,w),na(g,b),p&&p()},y=g=>(p,M)=>{const S=g?m:f,j=()=>E(p,g,M);Sa(S,[p,j]),pc(()=>{na(p,g?_:r),zs(p,g?v:u),_c(S)||gc(p,a,F,j)})};return Ut(t,{onBeforeEnter(g){Sa(N,[g]),zs(g,r),zs(g,o)},onBeforeAppear(g){Sa(L,[g]),zs(g,_),zs(g,l)},onEnter:y(!1),onAppear:y(!0),onLeave(g,p){g._isLeaving=!0;const M=()=>h(g,p);zs(g,c),C0(),zs(g,b),pc(()=>{g._isLeaving&&(na(g,c),zs(g,w),_c(C)||gc(g,a,B,M))}),Sa(C,[g,M])},onEnterCancelled(g){E(g,!1),Sa(R,[g])},onAppearCancelled(g){E(g,!0),Sa(T,[g])},onLeaveCancelled(g){h(g),Sa(k,[g])}})}function Pf(e){if(e==null)return null;if(Dt(e))return[Zi(e.enter),Zi(e.leave)];{const t=Zi(e);return[t,t]}}function Zi(e){return Gn(e)}function zs(e,t){t.split(/\s+/).forEach(s=>s&&e.classList.add(s)),(e._vtc||(e._vtc=new Set)).add(t)}function na(e,t){t.split(/\s+/).forEach(a=>a&&e.classList.remove(a));const{_vtc:s}=e;s&&(s.delete(t),s.size||(e._vtc=void 0))}function pc(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Df=0;function gc(e,t,s,a){const n=e._endId=++Df,r=()=>{n===e._endId&&a()};if(s)return setTimeout(r,s);const{type:o,timeout:u,propCount:_}=I0(e,t);if(!o)return a();const l=o+"end";let v=0;const c=()=>{e.removeEventListener(l,b),r()},b=w=>{w.target===e&&++v>=_&&c()};setTimeout(()=>{v<_&&c()},u+1),e.addEventListener(l,b)}function I0(e,t){const s=window.getComputedStyle(e),a=i=>(s[i]||"").split(", "),n=a(Js+"Delay"),r=a(Js+"Duration"),o=bc(n,r),u=a(wr+"Delay"),_=a(wr+"Duration"),l=bc(u,_);let v=null,c=0,b=0;t===Js?o>0&&(v=Js,c=o,b=r.length):t===wr?l>0&&(v=wr,c=l,b=_.length):(c=Math.max(o,l),v=c>0?o>l?Js:wr:null,b=v?v===Js?r.length:_.length:0);const w=v===Js&&/\b(transform|all)(,|$)/.test(s[Js+"Property"]);return{type:v,timeout:c,propCount:b,hasTransform:w}}function bc(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((s,a)=>yc(s)+yc(e[a])))}function yc(e){return Number(e.slice(0,-1).replace(",","."))*1e3}function C0(){return document.body.offsetHeight}const L0=new WeakMap,B0=new WeakMap,Uf={name:"TransitionGroup",props:Ut({},Hf,{tag:String,moveClass:String}),setup(e,{slots:t}){const s=M0(),a=a0();let n,r;return c0(()=>{if(!n.length)return;const o=e.moveClass||`${e.name||"v"}-move`;if(!Yf(n[0].el,s.vnode.el,o))return;n.forEach(qf),n.forEach(Vf);const u=n.filter(zf);C0(),u.forEach(_=>{const l=_.el,v=l.style;zs(l,o),v.transform=v.webkitTransform=v.transitionDuration="";const c=l._moveCb=b=>{b&&b.target!==l||(!b||/transform$/.test(b.propertyName))&&(l.removeEventListener("transitionend",c),l._moveCb=null,na(l,o))};l.addEventListener("transitionend",c)})}),()=>{const o=ht(e),u=O0(o);let _=o.tag||dt;n=r,r=t.default?tl(t.default()):[];for(let l=0;l<r.length;l++){const v=r[l];v.key!=null&&Kr(v,Xr(v,u,a,s))}if(n)for(let l=0;l<n.length;l++){const v=n[l];Kr(v,Xr(v,u,a,s)),L0.set(v,v.el.getBoundingClientRect())}return Ie(_,null,r)}}},dl=Uf;function qf(e){const t=e.el;t._moveCb&&t._moveCb(),t._enterCb&&t._enterCb()}function Vf(e){B0.set(e,e.el.getBoundingClientRect())}function zf(e){const t=L0.get(e),s=B0.get(e),a=t.left-s.left,n=t.top-s.top;if(a||n){const r=e.el.style;return r.transform=r.webkitTransform=`translate(${a}px,${n}px)`,r.transitionDuration="0s",e}}function Yf(e,t,s){const a=e.cloneNode();e._vtc&&e._vtc.forEach(o=>{o.split(/\s+/).forEach(u=>u&&a.classList.remove(u))}),s.split(/\s+/).forEach(o=>o&&a.classList.add(o)),a.style.display="none";const n=t.nodeType===1?t:t.parentNode;n.appendChild(a);const{hasTransform:r}=I0(a);return n.removeChild(a),r}const Xf=["ctrl","shift","alt","meta"],Kf={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>Xf.some(s=>e[`${s}Key`]&&!t.includes(s))},Ps=(e,t)=>(s,...a)=>{for(let n=0;n<t.length;n++){const r=Kf[t[n]];if(r&&r(s,t))return}return e(s,...a)},Gf={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Ia=(e,t)=>s=>{if(!("key"in s))return;const a=Vs(s.key);if(t.some(n=>n===a||Gf[n]===a))return e(s)},bi={beforeMount(e,{value:t},{transition:s}){e._vod=e.style.display==="none"?"":e.style.display,s&&t?s.beforeEnter(e):Sr(e,t)},mounted(e,{value:t},{transition:s}){s&&t&&s.enter(e)},updated(e,{value:t,oldValue:s},{transition:a}){!t!=!s&&(a?t?(a.beforeEnter(e),Sr(e,!0),a.enter(e)):a.leave(e,()=>{Sr(e,!1)}):Sr(e,t))},beforeUnmount(e,{value:t}){Sr(e,t)}};function Sr(e,t){e.style.display=t?e._vod:"none"}const Wf=Ut({patchProp:Bf},gf);let wc;function Zf(){return wc||(wc=Qm(Wf))}const Sc=(...e)=>{Zf().render(...e)};var Tt=(e,t)=>{const s=e.__vccOpts||e;for(const[a,n]of t)s[a]=n;return s};const Qf={name:"AppLoader",props:{show:{type:Boolean,default:!1},infinite:{type:Boolean,default:!1},type:{type:String,required:!0},messageId:{type:String,default:""}}},Jf=pe("div",{id:"vac-circle"},null,-1),$f=pe("div",{id:"vac-circle"},null,-1),eh=pe("div",{id:"vac-circle"},null,-1),th=pe("div",{id:"vac-circle"},null,-1),sh=pe("div",{id:"vac-circle"},null,-1),ah=pe("div",{id:"vac-circle"},null,-1);function rh(e,t,s,a,n,r){return J(),ft(Nt,{name:"vac-fade-spinner",appear:""},{default:Ke(()=>[s.show?(J(),ce("div",{key:0,class:nt(["vac-loader-wrapper",{"vac-container-center":!s.infinite,"vac-container-top":s.infinite}])},[s.type==="rooms"?Le(e.$slots,"spinner-icon-rooms",{key:0},()=>[Jf]):xe("",!0),s.type==="infinite-rooms"?Le(e.$slots,"spinner-icon-infinite-rooms",{key:1},()=>[$f]):xe("",!0),s.type==="message-file"?Le(e.$slots,"spinner-icon-message-file_"+s.messageId,{key:2},()=>[eh]):xe("",!0),s.type==="room-file"?Le(e.$slots,"spinner-icon-room-file",{key:3},()=>[th]):xe("",!0),s.type==="messages"?Le(e.$slots,"spinner-icon-messages",{key:4},()=>[sh]):xe("",!0),s.type==="infinite-messages"?Le(e.$slots,"spinner-icon-infinite-messages",{key:5},()=>[ah]):xe("",!0)],2)):xe("",!0)]),_:3})}var yi=Tt(Qf,[["render",rh]]);const nh={name:"SvgIcon",props:{name:{type:String,default:null},param:{type:String,default:null}},data(){return{svgItem:{search:{path:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},add:{path:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"},toggle:{path:"M5,13L9,17L7.6,18.42L1.18,12L7.6,5.58L9,7L5,11H21V13H5M21,6V8H11V6H21M21,16V18H11V16H21Z"},menu:{path:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"},close:{path:"M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"},file:{path:"M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"},paperclip:{path:"M16.5,6V17.5A4,4 0 0,1 12.5,21.5A4,4 0 0,1 8.5,17.5V5A2.5,2.5 0 0,1 11,2.5A2.5,2.5 0 0,1 13.5,5V15.5A1,1 0 0,1 12.5,16.5A1,1 0 0,1 11.5,15.5V6H10V15.5A2.5,2.5 0 0,0 12.5,18A2.5,2.5 0 0,0 15,15.5V5A4,4 0 0,0 11,1A4,4 0 0,0 7,5V17.5A5.5,5.5 0 0,0 12.5,23A5.5,5.5 0 0,0 18,17.5V6H16.5Z"},"close-outline":{path:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},send:{path:"M2,21L23,12L2,3V10L17,12L2,14V21Z"},emoji:{path:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"},document:{path:"M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"},pencil:{path:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"},checkmark:{path:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"},"double-checkmark":{path:"M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"},eye:{path:"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"},dropdown:{path:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},deleted:{path:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12C4,13.85 4.63,15.55 5.68,16.91L16.91,5.68C15.55,4.63 13.85,4 12,4M12,20A8,8 0 0,0 20,12C20,10.15 19.37,8.45 18.32,7.09L7.09,18.32C8.45,19.37 10.15,20 12,20Z"},microphone:{size:"large",path:"M432.8,216.4v39.2c0,45.2-15.3,84.3-45.2,118.4c-29.8,33.2-67.3,52.8-111.6,57.9v40.9h78.4c5.1,0,10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6c0,5.1-1.7,10.2-6,13.6c-4.3,4.3-8.5,6-13.6,6H157.6c-5.1,0-10.2-1.7-13.6-6c-4.3-4.3-6-8.5-6-13.6c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6H236v-40.9c-44.3-5.1-81.8-23.9-111.6-57.9s-45.2-73.3-45.2-118.4v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6s10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6v39.2c0,37.5,13.6,70.7,40,97.1s59.6,40,97.1,40s70.7-13.6,97.1-40c26.4-26.4,40-59.6,40-97.1v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6c5.1,0,10.2,1.7,13.6,6C430.2,206.2,432.8,211.3,432.8,216.4z M353.5,98v157.6c0,27.3-9.4,50.3-29,69c-19.6,19.6-42.6,29-69,29s-50.3-9.4-69-29c-19.6-19.6-29-42.6-29-69V98c0-27.3,9.4-50.3,29-69c19.6-19.6,42.6-29,69-29s50.3,9.4,69,29C344.2,47.7,353.5,71.6,353.5,98z"},"audio-play":{size:"medium",path:"M43.331,21.237L7.233,0.397c-0.917-0.529-2.044-0.529-2.96,0c-0.916,0.528-1.48,1.505-1.48,2.563v41.684   c0,1.058,0.564,2.035,1.48,2.563c0.458,0.268,0.969,0.397,1.48,0.397c0.511,0,1.022-0.133,1.48-0.397l36.098-20.84   c0.918-0.529,1.479-1.506,1.479-2.564S44.247,21.767,43.331,21.237z"},"audio-pause":{size:"medium",path:"M17.991,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C4.729,2.969,7.698,0,11.36,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z",path2:"M42.877,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C29.616,2.969,32.585,0,36.246,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z"}}}},computed:{svgId(){const e=this.param?"-"+this.param:"";return`vac-icon-${this.name}${e}`},size(){const e=this.svgItem[this.name];return e.size==="large"?512:e.size==="medium"?48:24}}},ih=["viewBox"],oh=["id","d"],lh=["id","d"];function ch(e,t,s,a,n,r){return J(),ce("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",width:"24",height:"24",viewBox:`0 0 ${r.size} ${r.size}`},[pe("path",{id:r.svgId,d:n.svgItem[s.name].path},null,8,oh),n.svgItem[s.name].path2?(J(),ce("path",{key:0,id:r.svgId,d:n.svgItem[s.name].path2},null,8,lh)):xe("",!0)],8,ih)}var zt=Tt(nh,[["render",ch]]);const uh={name:"RoomsSearch",components:{SvgIcon:zt},props:{textMessages:{type:Object,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0}},emits:["search-room","add-room"],computed:{showSearchBar(){return this.showSearch||this.showAddRoom}}},dh={key:0,class:"vac-icon-search"},mh=["placeholder"];function fh(e,t,s,a,n,r){const o=Ge("svg-icon");return J(),ce("div",{class:nt({"vac-box-search":r.showSearchBar,"vac-box-empty":!r.showSearchBar})},[s.showSearch?(J(),ce(dt,{key:0},[!s.loadingRooms&&s.rooms.length?(J(),ce("div",dh,[Le(e.$slots,"search-icon",{},()=>[Ie(o,{name:"search"})])])):xe("",!0),!s.loadingRooms&&s.rooms.length?(J(),ce("input",{key:1,type:"search",placeholder:s.textMessages.SEARCH,autocomplete:"off",class:"vac-input",onInput:t[0]||(t[0]=u=>e.$emit("search-room",u))},null,40,mh)):xe("",!0)],64)):xe("",!0),s.showAddRoom?(J(),ce("div",{key:1,class:"vac-svg-button vac-add-icon",onClick:t[1]||(t[1]=u=>e.$emit("add-room"))},[Le(e.$slots,"add-icon",{},()=>[Ie(o,{name:"add"})])])):xe("",!0)],2)}var hh=Tt(uh,[["render",fh]]),Xt={},hr={};hr.__esModule=!0;hr.inherits=vh;function vh(e,t){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=Object.create(e.prototype);for(var n in s)a[n]=s[n];return a.constructor=t,t.prototype=a,t}var on={};on.__esModule=!0;var _h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},us={defaultProtocol:"http",events:null,format:Ec,formatHref:Ec,nl2br:!1,tagName:"a",target:gh,validate:!0,ignoreTags:[],attributes:null,className:"linkified"};on.defaults=us;on.Options=N0;on.contains=ph;function N0(e){e=e||{},this.defaultProtocol=e.hasOwnProperty("defaultProtocol")?e.defaultProtocol:us.defaultProtocol,this.events=e.hasOwnProperty("events")?e.events:us.events,this.format=e.hasOwnProperty("format")?e.format:us.format,this.formatHref=e.hasOwnProperty("formatHref")?e.formatHref:us.formatHref,this.nl2br=e.hasOwnProperty("nl2br")?e.nl2br:us.nl2br,this.tagName=e.hasOwnProperty("tagName")?e.tagName:us.tagName,this.target=e.hasOwnProperty("target")?e.target:us.target,this.validate=e.hasOwnProperty("validate")?e.validate:us.validate,this.ignoreTags=[],this.attributes=e.attributes||e.linkAttributes||us.attributes,this.className=e.hasOwnProperty("className")?e.className:e.linkClass||us.className;for(var t=e.hasOwnProperty("ignoreTags")?e.ignoreTags:us.ignoreTags,s=0;s<t.length;s++)this.ignoreTags.push(t[s].toUpperCase())}N0.prototype={resolve:function(t){var s=t.toHref(this.defaultProtocol);return{formatted:this.get("format",t.toString(),t),formattedHref:this.get("formatHref",s,t),tagName:this.get("tagName",s,t),className:this.get("className",s,t),target:this.get("target",s,t),events:this.getObject("events",s,t),attributes:this.getObject("attributes",s,t)}},check:function(t){return this.get("validate",t.toString(),t)},get:function(t,s,a){var n=void 0,r=this[t];if(!r)return r;switch(typeof r>"u"?"undefined":_h(r)){case"function":return r(s,a.type);case"object":return n=r.hasOwnProperty(a.type)?r[a.type]:us[t],typeof n=="function"?n(s,a.type):n}return r},getObject:function(t,s,a){var n=this[t];return typeof n=="function"?n(s,a.type):n}};function ph(e,t){for(var s=0;s<e.length;s++)if(e[s]===t)return!0;return!1}function Ec(e){return e}function gh(e,t){return t==="url"?"_blank":null}var Ds={},Xs={};Xs.__esModule=!0;Xs.stateify=Xs.TokenState=Xs.CharacterState=void 0;var j0=hr;function ml(){return function(e){this.j=[],this.T=e||null}}var fl=ml();fl.prototype={defaultTransition:!1,on:function(t,s){if(t instanceof Array){for(var a=0;a<t.length;a++)this.j.push([t[a],s]);return this}return this.j.push([t,s]),this},next:function(t){for(var s=0;s<this.j.length;s++){var a=this.j[s],n=a[0],r=a[1];if(this.test(t,n))return r}return this.defaultTransition},accepts:function(){return!!this.T},test:function(t,s){return t===s},emit:function(){return this.T}};var xo=(0,j0.inherits)(fl,ml(),{test:function(t,s){return t===s||s instanceof RegExp&&s.test(t)}}),bh=(0,j0.inherits)(fl,ml(),{jump:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=this.next(new t(""));return a===this.defaultTransition?(a=new this.constructor(s),this.on(t,a)):s&&(a.T=s),a},test:function(t,s){return t instanceof s}});function yh(e,t,s,a){for(var n=0,r=e.length,o=t,u=[],_=void 0;n<r&&(_=o.next(e[n]));)o=_,n++;if(n>=r)return[];for(;n<r-1;)_=new xo(a),u.push(_),o.on(e[n],_),o=_,n++;return _=new xo(s),u.push(_),o.on(e[r-1],_),u}Xs.CharacterState=xo;Xs.TokenState=bh;Xs.stateify=yh;var ze={},wi={};wi.__esModule=!0;function wh(){return function(e){e&&(this.v=e)}}wi.createTokenClass=wh;ze.__esModule=!0;ze.AMPERSAND=ze.CLOSEPAREN=ze.CLOSEANGLEBRACKET=ze.CLOSEBRACKET=ze.CLOSEBRACE=ze.OPENPAREN=ze.OPENANGLEBRACKET=ze.OPENBRACKET=ze.OPENBRACE=ze.WS=ze.TLD=ze.SYM=ze.UNDERSCORE=ze.SLASH=ze.MAILTO=ze.PROTOCOL=ze.QUERY=ze.POUND=ze.PLUS=ze.NUM=ze.NL=ze.LOCALHOST=ze.PUNCTUATION=ze.DOT=ze.COLON=ze.AT=ze.DOMAIN=ze.Base=void 0;var F0=wi,Sh=hr,hl=(0,F0.createTokenClass)();hl.prototype={toString:function(){return this.v+""}};function kt(e){var t=e?{v:e}:{};return(0,Sh.inherits)(hl,(0,F0.createTokenClass)(),t)}var Eh=kt(),Mh=kt("@"),Ah=kt(":"),Th=kt("."),kh=kt(),Rh=kt(),xh=kt(`
`),Oh=kt(),Ih=kt("+"),Ch=kt("#"),Lh=kt(),Bh=kt("mailto:"),Nh=kt("?"),jh=kt("/"),Fh=kt("_"),Hh=kt(),Ph=kt(),Dh=kt(),Uh=kt("{"),qh=kt("["),Vh=kt("<"),zh=kt("("),Yh=kt("}"),Xh=kt("]"),Kh=kt(">"),Gh=kt(")"),Wh=kt("&");ze.Base=hl;ze.DOMAIN=Eh;ze.AT=Mh;ze.COLON=Ah;ze.DOT=Th;ze.PUNCTUATION=kh;ze.LOCALHOST=Rh;ze.NL=xh;ze.NUM=Oh;ze.PLUS=Ih;ze.POUND=Ch;ze.QUERY=Nh;ze.PROTOCOL=Lh;ze.MAILTO=Bh;ze.SLASH=jh;ze.UNDERSCORE=Fh;ze.SYM=Hh;ze.TLD=Ph;ze.WS=Dh;ze.OPENBRACE=Uh;ze.OPENBRACKET=qh;ze.OPENANGLEBRACKET=Vh;ze.OPENPAREN=zh;ze.CLOSEBRACE=Yh;ze.CLOSEBRACKET=Xh;ze.CLOSEANGLEBRACKET=Kh;ze.CLOSEPAREN=Gh;ze.AMPERSAND=Wh;Ds.__esModule=!0;Ds.start=Ds.run=Ds.TOKENS=Ds.State=void 0;var va=Xs,ot=ze,Zh=Qh(ot);function Qh(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t}var Mc="aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|aetna|af|afamilycompany|afl|africa|ag|agakhan|agency|ai|aig|aigo|airbus|airforce|airtel|akdn|al|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|cat|catering|catholic|cba|cbn|cbre|cbs|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dodge|dog|doha|domains|dot|download|drive|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epost|epson|equipment|er|ericsson|erni|es|esq|estate|esurance|et|etisalat|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glade|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|guardian|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|hospital|host|hosting|hot|hoteles|hotels|hotmail|house|how|hr|hsbc|ht|htc|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|intel|international|intuit|investments|io|ipiranga|iq|ir|irish|is|iselect|ismaili|ist|istanbul|it|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|je|jeep|jetzt|jewelry|jio|jlc|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|lk|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|lupin|luxe|luxury|lv|ly|ma|macys|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|merckmsd|metlife|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|mobily|moda|moe|moi|mom|monash|money|monster|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|mutual|mv|mw|mx|my|mz|na|nab|nadex|nagoya|name|nationwide|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|northwesternmutual|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|om|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|qvc|racing|radio|raid|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|ro|rocher|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sb|sbi|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|sd|se|search|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|showtime|shriram|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|srt|st|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiftcover|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|telecity|telefonica|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelchannel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|uconnect|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vn|vodka|volkswagen|volvo|vote|voting|voto|voyage|vu|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3oq18vl8pn36a|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq61u9w7b|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaakc7dvf|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pbt977c|xn--pgbs0dh|xn--pssy2u|xn--q9jyb4c|xn--qcka1pmc|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zippo|zm|zone|zuerich|zw".split("|"),vl="0123456789".split(""),Si="0123456789abcdefghijklmnopqrstuvwxyz".split(""),H0=[" ","\f","\r","	","\v"," "," ","᠎"],$t=[],bt=function(t){return new va.CharacterState(t)},Ss=bt(),Oo=bt(ot.NUM),or=bt(ot.DOMAIN),Zr=bt(),Io=bt(ot.WS);Ss.on("@",bt(ot.AT)).on(".",bt(ot.DOT)).on("+",bt(ot.PLUS)).on("#",bt(ot.POUND)).on("?",bt(ot.QUERY)).on("/",bt(ot.SLASH)).on("_",bt(ot.UNDERSCORE)).on(":",bt(ot.COLON)).on("{",bt(ot.OPENBRACE)).on("[",bt(ot.OPENBRACKET)).on("<",bt(ot.OPENANGLEBRACKET)).on("(",bt(ot.OPENPAREN)).on("}",bt(ot.CLOSEBRACE)).on("]",bt(ot.CLOSEBRACKET)).on(">",bt(ot.CLOSEANGLEBRACKET)).on(")",bt(ot.CLOSEPAREN)).on("&",bt(ot.AMPERSAND)).on([",",";","!",'"',"'"],bt(ot.PUNCTUATION));Ss.on(`
`,bt(ot.NL)).on(H0,Io);Io.on(H0,Io);for(var Qi=0;Qi<Mc.length;Qi++){var Jh=(0,va.stateify)(Mc[Qi],Ss,ot.TLD,ot.DOMAIN);$t.push.apply($t,Jh)}var P0=(0,va.stateify)("file",Ss,ot.DOMAIN,ot.DOMAIN),D0=(0,va.stateify)("ftp",Ss,ot.DOMAIN,ot.DOMAIN),U0=(0,va.stateify)("http",Ss,ot.DOMAIN,ot.DOMAIN),q0=(0,va.stateify)("mailto",Ss,ot.DOMAIN,ot.DOMAIN);$t.push.apply($t,P0);$t.push.apply($t,D0);$t.push.apply($t,U0);$t.push.apply($t,q0);var $h=P0.pop(),e2=D0.pop(),t2=U0.pop(),s2=q0.pop(),Ei=bt(ot.DOMAIN),Mi=bt(ot.PROTOCOL),a2=bt(ot.MAILTO);e2.on("s",Ei).on(":",Mi);t2.on("s",Ei).on(":",Mi);$t.push(Ei);$h.on(":",Mi);Ei.on(":",Mi);s2.on(":",a2);var r2=(0,va.stateify)("localhost",Ss,ot.LOCALHOST,ot.DOMAIN);$t.push.apply($t,r2);Ss.on(vl,Oo);Oo.on("-",Zr).on(vl,Oo).on(Si,or);or.on("-",Zr).on(Si,or);for(var Ji=0;Ji<$t.length;Ji++)$t[Ji].on("-",Zr).on(Si,or);Zr.on("-",Zr).on(vl,or).on(Si,or);Ss.defaultTransition=bt(ot.SYM);var n2=function(t){for(var s=t.replace(/[A-Z]/g,function(b){return b.toLowerCase()}),a=t.length,n=[],r=0;r<a;){for(var o=Ss,u=null,_=0,l=null,v=-1;r<a&&(u=o.next(s[r]));)o=u,o.accepts()?(v=0,l=o):v>=0&&v++,_++,r++;if(!(v<0)){r-=v,_-=v;var c=l.emit();n.push(new c(t.substr(r-_,_)))}}return n},i2=Ss;Ds.State=va.CharacterState;Ds.TOKENS=Zh;Ds.run=n2;Ds.start=i2;var Us={},ns={};ns.__esModule=!0;ns.URL=ns.TEXT=ns.NL=ns.EMAIL=ns.MAILTOEMAIL=ns.Base=void 0;var vr=wi,ln=hr,Dr=ze;function o2(e){return e instanceof Dr.DOMAIN||e instanceof Dr.TLD}var Ya=(0,vr.createTokenClass)();Ya.prototype={type:"token",isLink:!1,toString:function(){for(var t=[],s=0;s<this.v.length;s++)t.push(this.v[s].toString());return t.join("")},toHref:function(){return this.toString()},toObject:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(t)}}};var l2=(0,ln.inherits)(Ya,(0,vr.createTokenClass)(),{type:"email",isLink:!0}),c2=(0,ln.inherits)(Ya,(0,vr.createTokenClass)(),{type:"email",isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),u2=(0,ln.inherits)(Ya,(0,vr.createTokenClass)(),{type:"text"}),d2=(0,ln.inherits)(Ya,(0,vr.createTokenClass)(),{type:"nl"}),m2=(0,ln.inherits)(Ya,(0,vr.createTokenClass)(),{type:"url",isLink:!0,toHref:function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",s=!1,a=!1,n=this.v,r=[],o=0;n[o]instanceof Dr.PROTOCOL;)s=!0,r.push(n[o].toString().toLowerCase()),o++;for(;n[o]instanceof Dr.SLASH;)a=!0,r.push(n[o].toString()),o++;for(;o2(n[o]);)r.push(n[o].toString().toLowerCase()),o++;for(;o<n.length;o++)r.push(n[o].toString());return r=r.join(""),s||a||(r=t+"://"+r),r},hasProtocol:function(){return this.v[0]instanceof Dr.PROTOCOL}});ns.Base=Ya;ns.MAILTOEMAIL=l2;ns.EMAIL=c2;ns.NL=d2;ns.TEXT=u2;ns.URL=m2;Us.__esModule=!0;Us.start=Us.run=Us.TOKENS=Us.State=void 0;var V0=Xs,is=ns,f2=h2(is),Ae=ze;function h2(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t}var lt=function(t){return new V0.TokenState(t)},Ai=lt(),z0=lt(),Y0=lt(),_l=lt(),X0=lt(),ca=lt(),Ti=lt(),cn=lt(is.URL),K0=lt(),G0=lt(is.URL),Ct=lt(is.URL),Qr=lt(),un=lt(),dn=lt(),mn=lt(),fn=lt(),Da=lt(is.URL),Ua=lt(is.URL),qa=lt(is.URL),Va=lt(is.URL),Jr=lt(),$r=lt(),en=lt(),tn=lt(),rr=lt(),pl=lt(),ki=lt(is.EMAIL),W0=lt(),v2=lt(is.EMAIL),ja=lt(is.MAILTOEMAIL),Co=lt(),lr=lt(),Ri=lt(),Z0=lt(),_2=lt(is.NL);Ai.on(Ae.NL,_2).on(Ae.PROTOCOL,z0).on(Ae.MAILTO,Y0).on(Ae.SLASH,_l);z0.on(Ae.SLASH,_l);_l.on(Ae.SLASH,X0);Ai.on(Ae.TLD,ca).on(Ae.DOMAIN,ca).on(Ae.LOCALHOST,cn).on(Ae.NUM,ca);X0.on(Ae.TLD,Ct).on(Ae.DOMAIN,Ct).on(Ae.NUM,Ct).on(Ae.LOCALHOST,Ct);ca.on(Ae.DOT,Ti);rr.on(Ae.DOT,pl);Ti.on(Ae.TLD,cn).on(Ae.DOMAIN,ca).on(Ae.NUM,ca).on(Ae.LOCALHOST,ca);pl.on(Ae.TLD,ki).on(Ae.DOMAIN,rr).on(Ae.NUM,rr).on(Ae.LOCALHOST,rr);cn.on(Ae.DOT,Ti);ki.on(Ae.DOT,pl);cn.on(Ae.COLON,K0).on(Ae.SLASH,Ct);K0.on(Ae.NUM,G0);G0.on(Ae.SLASH,Ct);ki.on(Ae.COLON,W0);W0.on(Ae.NUM,v2);var Zt=[Ae.DOMAIN,Ae.AT,Ae.LOCALHOST,Ae.NUM,Ae.PLUS,Ae.POUND,Ae.PROTOCOL,Ae.SLASH,Ae.TLD,Ae.UNDERSCORE,Ae.SYM,Ae.AMPERSAND],Qt=[Ae.COLON,Ae.DOT,Ae.QUERY,Ae.PUNCTUATION,Ae.CLOSEBRACE,Ae.CLOSEBRACKET,Ae.CLOSEANGLEBRACKET,Ae.CLOSEPAREN,Ae.OPENBRACE,Ae.OPENBRACKET,Ae.OPENANGLEBRACKET,Ae.OPENPAREN];Ct.on(Ae.OPENBRACE,un).on(Ae.OPENBRACKET,dn).on(Ae.OPENANGLEBRACKET,mn).on(Ae.OPENPAREN,fn);Qr.on(Ae.OPENBRACE,un).on(Ae.OPENBRACKET,dn).on(Ae.OPENANGLEBRACKET,mn).on(Ae.OPENPAREN,fn);un.on(Ae.CLOSEBRACE,Ct);dn.on(Ae.CLOSEBRACKET,Ct);mn.on(Ae.CLOSEANGLEBRACKET,Ct);fn.on(Ae.CLOSEPAREN,Ct);Da.on(Ae.CLOSEBRACE,Ct);Ua.on(Ae.CLOSEBRACKET,Ct);qa.on(Ae.CLOSEANGLEBRACKET,Ct);Va.on(Ae.CLOSEPAREN,Ct);Jr.on(Ae.CLOSEBRACE,Ct);$r.on(Ae.CLOSEBRACKET,Ct);en.on(Ae.CLOSEANGLEBRACKET,Ct);tn.on(Ae.CLOSEPAREN,Ct);un.on(Zt,Da);dn.on(Zt,Ua);mn.on(Zt,qa);fn.on(Zt,Va);un.on(Qt,Jr);dn.on(Qt,$r);mn.on(Qt,en);fn.on(Qt,tn);Da.on(Zt,Da);Ua.on(Zt,Ua);qa.on(Zt,qa);Va.on(Zt,Va);Da.on(Qt,Da);Ua.on(Qt,Ua);qa.on(Qt,qa);Va.on(Qt,Va);Jr.on(Zt,Da);$r.on(Zt,Ua);en.on(Zt,qa);tn.on(Zt,Va);Jr.on(Qt,Jr);$r.on(Qt,$r);en.on(Qt,en);tn.on(Qt,tn);Ct.on(Zt,Ct);Qr.on(Zt,Ct);Ct.on(Qt,Qr);Qr.on(Qt,Qr);Y0.on(Ae.TLD,ja).on(Ae.DOMAIN,ja).on(Ae.NUM,ja).on(Ae.LOCALHOST,ja);ja.on(Zt,ja).on(Qt,Co);Co.on(Zt,ja).on(Qt,Co);var hn=[Ae.DOMAIN,Ae.NUM,Ae.PLUS,Ae.POUND,Ae.QUERY,Ae.UNDERSCORE,Ae.SYM,Ae.AMPERSAND,Ae.TLD];ca.on(hn,lr).on(Ae.AT,Ri);cn.on(hn,lr).on(Ae.AT,Ri);Ti.on(hn,lr);lr.on(hn,lr).on(Ae.AT,Ri).on(Ae.DOT,Z0);Z0.on(hn,lr);Ri.on(Ae.TLD,rr).on(Ae.DOMAIN,rr).on(Ae.LOCALHOST,ki);var p2=function(t){for(var s=t.length,a=0,n=[],r=[];a<s;){for(var o=Ai,u=null,_=null,l=0,v=null,c=-1;a<s&&!(u=o.next(t[a]));)r.push(t[a++]);for(;a<s&&(_=u||o.next(t[a]));)u=null,o=_,o.accepts()?(c=0,v=o):c>=0&&c++,a++,l++;if(c<0)for(var b=a-l;b<a;b++)r.push(t[b]);else{r.length>0&&(n.push(new is.TEXT(r)),r=[]),a-=c,l-=c;var w=v.emit();n.push(new w(t.slice(a-l,a)))}}return r.length>0&&n.push(new is.TEXT(r)),n};Us.State=V0.TokenState;Us.TOKENS=f2;Us.run=p2;Us.start=Ai;Xt.__esModule=!0;Xt.tokenize=Xt.test=Xt.scanner=Xt.parser=Xt.options=Xt.inherits=Xt.find=void 0;var g2=hr,b2=on,y2=gl(b2),w2=Ds,Q0=gl(w2),S2=Us,J0=gl(S2);function gl(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t}Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"});var bl=function(t){return J0.run(Q0.run(t))},E2=function(t){for(var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=bl(t),n=[],r=0;r<a.length;r++){var o=a[r];o.isLink&&(!s||o.type===s)&&n.push(o.toObject())}return n},M2=function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=bl(t);return a.length===1&&a[0].isLink&&(!s||a[0].type===s)};Xt.find=E2;Xt.inherits=g2.inherits;Xt.options=y2;Xt.parser=J0;Xt.scanner=Q0;Xt.test=M2;Xt.tokenize=bl;var $0=Xt,A2=(e,t,s)=>{const a={bold:s.bold,italic:s.italic,strike:s.strike,underline:s.underline,multilineCode:s.multilineCode,inlineCode:s.inlineCode},n={[a.bold]:{end:"\\"+a.bold,allowed_chars:".",type:"bold"},[a.italic]:{end:a.italic,allowed_chars:".",type:"italic"},[a.strike]:{end:a.strike,allowed_chars:".",type:"strike"},[a.underline]:{end:a.underline,allowed_chars:".",type:"underline"},[a.multilineCode]:{end:a.multilineCode,allowed_chars:`(.|
)`,type:"multiline-code"},[a.inlineCode]:{end:a.inlineCode,allowed_chars:".",type:"inline-code"},"<usertag>":{allowed_chars:".",end:"</usertag>",type:"tag"}},r=Vn(e,n),o=T2(r,n),u=[].concat.apply([],o);return t&&R2(u),u};function Vn(e,t){let s=[],a=-1,n=null,r=$0.find(e),o=!1;if(r.length>0&&(a=e.indexOf(r[0].value),o=!0),Object.keys(t).forEach(u=>{const _=e.indexOf(u);_>=0&&(a<0||_<a)&&(a=_,n=u,o=!1)}),o&&n!==-1){let u=e.substr(0,a),_=e.substr(a,r[0].value.length),l=e.substr(a+r[0].value.length);return s.push(u),s.push(_),s=s.concat(Vn(l,t)),s}if(n){let u=e.substr(0,a);const _=n;let l=e.substr(a+_.length);if(e.replace(/\s/g,"").length===_.length*2)return[e];const v=l.match(new RegExp("^("+(t[_].allowed_chars||".")+"*"+(t[_].end?"?":"")+")"+(t[_].end?"("+t[_].end+")":""),"m"));if(!v||!v[1])u=u+_,s.push(u);else{u&&s.push(u);const c={start:_,content:Vn(v[1],t),end:v[2],type:t[_].type};s.push(c),l=l.substr(v[0].length)}return s=s.concat(Vn(l,t)),s}else return e?[e]:[]}function T2(e,t){const s=[];return e.forEach(a=>{typeof a=="string"?s.push({types:[],value:a}):t[a.start]&&s.push(k2(a))}),s}function k2(e){const t=[];return eu(e,t,[]),t}function eu(e,t,s){e.content.forEach(a=>{typeof a=="string"?t.push({types:Ac(s.concat([e.type])),value:a}):eu(a,t,Ac([a.type].concat([e.type]).concat(s)))})}function Ac(e){return[...new Set(e)]}function R2(e){const t=[];return e.forEach(s=>{const a=$0.find(s.value);if(a.length){const n=s.value.replace(a[0].value,"");t.push({types:s.types,value:n}),s.types=["url"].concat(s.types),s.href=a[0].href,s.value=a[0].value}t.push(s)}),t}const yl=["png","jpg","jpeg","webp","svg","gif"],tu=["mp4","video/ogg","webm","quicktime"],x2=["mp3","audio/ogg","wav","mpeg"],O2={name:"FormatMessage",components:{SvgIcon:zt},props:{messageId:{type:String,default:""},roomId:{type:String,default:""},roomList:{type:Boolean,default:!1},content:{type:[String,Number],required:!0},deleted:{type:Boolean,default:!1},users:{type:Array,default:()=>[]},linkify:{type:Boolean,default:!0},singleLine:{type:Boolean,default:!1},reply:{type:Boolean,default:!1},textFormatting:{type:Object,required:!0},textMessages:{type:Object,default:()=>{}},linkOptions:{type:Object,required:!0}},emits:["open-user-tag"],computed:{linkifiedMessage(){if(this.deleted)return[{value:this.textMessages.MESSAGE_DELETED}];const e=A2(this.formatTags(this.content),this.linkify&&!this.linkOptions.disabled,this.textFormatting);return e.forEach(t=>{t.url=this.checkType(t,"url"),t.bold=this.checkType(t,"bold"),t.italic=this.checkType(t,"italic"),t.strike=this.checkType(t,"strike"),t.underline=this.checkType(t,"underline"),t.inline=this.checkType(t,"inline-code"),t.multiline=this.checkType(t,"multiline-code"),t.tag=this.checkType(t,"tag"),t.image=this.checkImageType(t),t.value=this.replaceEmojiByElement(t.value)}),e},formattedContent(){return this.deleted?this.textMessages.MESSAGE_DELETED:this.formatTags(this.content)}},methods:{checkType(e,t){return e.types&&e.types.indexOf(t)!==-1},checkImageType(e){let t=e.value.lastIndexOf(".");e.value.lastIndexOf("/")>t&&(t=-1);const a=e.value.substring(t+1,e.value.length),n=t>0&&yl.some(r=>a.toLowerCase().includes(r));return n&&this.setImageSize(e),n},setImageSize(e){const t=new Image;t.src=e.value,t.addEventListener("load",s);function s(a){const n=a.path[0].width/150;e.height=Math.round(a.path[0].height/n)+"px",t.removeEventListener("load",s)}},formatTags(e){const t="<usertag>",s="</usertag>",a=[...e.matchAll(new RegExp(t,"gi"))].map(r=>r.index),n=e;return a.forEach(r=>{const o=n.substring(r+t.length,n.indexOf(s,r)),u=this.users.find(_=>_._id===o);e=e.replaceAll(o,`@${u?.username||"unknown"}`)}),e},openTag(e){if(!this.singleLine&&this.checkType(e,"tag")){const t=this.users.find(s=>e.value.indexOf(s.username)!==-1);this.$emit("open-user-tag",t)}},replaceEmojiByElement(e){let t;return this.singleLine?t=16:t=this.containsOnlyEmojis()?28:20,e.replaceAll(/[\p{Extended_Pictographic}\u{1F3FB}-\u{1F3FF}\u{1F9B0}-\u{1F9B3}]/gu,s=>`<span style="font-size: ${t}px">${s}</span>`)},containsOnlyEmojis(){const e=this.content.replace(new RegExp("[\0-ữf]","g"),""),t=this.content.replace(new RegExp(`[
\rs]+|( )+`,"g"),"");return e.length===t.length}}},I2={class:"vac-image-link-container"},C2={class:"vac-image-link-message"},L2=["innerHTML"],B2=["innerHTML"];function N2(e,t,s,a,n,r){const o=Ge("svg-icon");return J(),ce("div",{class:nt(["vac-format-message-wrapper",{"vac-text-ellipsis":s.singleLine}])},[s.textFormatting.disabled?(J(),ce("div",{key:1,innerHTML:r.formattedContent},null,8,B2)):(J(),ce("div",{key:0,class:nt({"vac-text-ellipsis":s.singleLine})},[(J(!0),ce(dt,null,rt(r.linkifiedMessage,(u,_)=>(J(),ce("div",{key:_,class:"vac-format-container"},[(J(),ft(Fm(u.url?"a":"span"),{class:nt({"vac-text-ellipsis":s.singleLine,"vac-text-bold":u.bold,"vac-text-italic":s.deleted||u.italic,"vac-text-strike":u.strike,"vac-text-underline":u.underline,"vac-text-inline-code":!s.singleLine&&u.inline,"vac-text-multiline-code":!s.singleLine&&u.multiline,"vac-text-tag":!s.singleLine&&!s.reply&&u.tag}),href:u.href,target:u.href?s.linkOptions.target:null,rel:u.href?s.linkOptions.rel:null,onClick:l=>r.openTag(u)},{default:Ke(()=>[s.deleted?(J(),ce(dt,{key:0},[Le(e.$slots,s.roomList?"deleted-icon-room_"+s.roomId:"deleted-icon_"+s.messageId,{},()=>[Ie(o,{name:"deleted",class:nt(["vac-icon-deleted",{"vac-icon-deleted-room":s.roomList}])},null,8,["class"])]),ha(" "+et(s.textMessages.MESSAGE_DELETED),1)],64)):u.url&&u.image?(J(),ce(dt,{key:1},[pe("div",I2,[pe("div",{class:"vac-image-link",style:At({"background-image":`url('${u.value}')`,height:u.height})},null,4)]),pe("div",C2,[pe("span",null,et(u.value),1)])],64)):(J(),ce("span",{key:2,innerHTML:u.value},null,8,L2))]),_:2},1032,["class","href","target","rel","onClick"]))]))),128))],2))],2)}var vn=Tt(O2,[["render",N2]]);const Ba="__v-click-outside",su=typeof window<"u",j2=typeof navigator<"u",F2=su&&("ontouchstart"in window||j2&&navigator.msMaxTouchPoints>0),H2=F2?["touchstart"]:["click"],P2=e=>{const t=typeof e=="function";if(!t&&typeof e!="object")throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:t?e:e.handler,middleware:e.middleware||(s=>s),events:e.events||H2,isActive:e.isActive!==!1,detectIframe:e.detectIframe!==!1,capture:!!e.capture}},au=({event:e,handler:t,middleware:s})=>{s(e)&&t(e)},D2=({el:e,event:t,handler:s,middleware:a})=>{setTimeout(()=>{const{activeElement:n}=document;n&&n.tagName==="IFRAME"&&!e.contains(n)&&au({event:t,handler:s,middleware:a})},0)},U2=({el:e,event:t,handler:s,middleware:a})=>{const n=t.path||t.composedPath&&t.composedPath();(n?n.indexOf(e)<0:!e.contains(t.target))&&au({event:t,handler:s,middleware:a})},ru=(e,{value:t})=>{const{events:s,handler:a,middleware:n,isActive:r,detectIframe:o,capture:u}=P2(t);if(r){if(e[Ba]=s.map(_=>({event:_,srcTarget:document.documentElement,handler:l=>U2({el:e,event:l,handler:a,middleware:n}),capture:u})),o){const _={event:"blur",srcTarget:window,handler:l=>D2({el:e,event:l,handler:a,middleware:n}),capture:u};e[Ba]=[...e[Ba],_]}e[Ba].forEach(({event:_,srcTarget:l,handler:v})=>setTimeout(()=>{e[Ba]&&l.addEventListener(_,v,u)},0))}},nu=e=>{(e[Ba]||[]).forEach(({event:s,srcTarget:a,handler:n,capture:r})=>a.removeEventListener(s,n,r)),delete e[Ba]},q2=(e,{value:t,oldValue:s})=>{JSON.stringify(t)!==JSON.stringify(s)&&(nu(e),ru(e,{value:t}))},V2={beforeMount:ru,updated:q2,unmounted:nu};var xi=su?V2:{},iu=(e,t,s)=>{if(e.typingUsers&&e.typingUsers.length){const a=e.users.filter(n=>{if(n._id!==t&&e.typingUsers.indexOf(n._id)!==-1&&!(n.status&&n.status.state==="offline"))return!0});return a.length?e.users.length===2?s.IS_TYPING:a.map(n=>n.username).join(", ")+" "+s.IS_TYPING:void 0}};function sn(e,t){if(!(!t||!t.type))return e.some(s=>t.type.toLowerCase().includes(s))}function cr(e){return sn(yl,e)}function _n(e){return sn(tu,e)}function Tc(e){return sn(yl,e)||sn(tu,e)}function Oi(e){return sn(x2,e)}const z2={name:"RoomsContent",components:{SvgIcon:zt,FormatMessage:vn},directives:{clickOutside:xi},props:{currentUserId:{type:[String,Number],required:!0},room:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},roomActions:{type:Array,required:!0}},emits:["room-action-handler"],data(){return{roomMenuOpened:null}},computed:{getLastMessage(){const e=this.typingUsers;if(e)return e;const t=this.room.lastMessage.content;if(this.room.users.length<=2)return t;const s=this.room.users.find(a=>a._id===this.room.lastMessage.senderId);return this.room.lastMessage.username?`${this.room.lastMessage.username} - ${t}`:!s||s._id===this.currentUserId?t:`${s.username} - ${t}`},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const e=this.room.users.find(t=>t._id!==this.currentUserId);return e&&e.status?e.status.state:null},typingUsers(){return iu(this.room,this.currentUserId,this.textMessages)},isMessageCheckmarkVisible(){return!this.typingUsers&&this.room.lastMessage&&!this.room.lastMessage.deleted&&this.room.lastMessage.senderId===this.currentUserId&&(this.room.lastMessage.saved||this.room.lastMessage.distributed||this.room.lastMessage.seen)},formattedDuration(){var e,t;const s=(t=(e=this.room.lastMessage)==null?void 0:e.files)==null?void 0:t[0];if(s){if(!s.duration)return`${s.name}.${s.extension}`;let a=Math.floor(s.duration);return(a-(a%=60))/60+(a>9?":":":0")+a}return""},isAudio(){return this.room.lastMessage.files?Oi(this.room.lastMessage.files[0]):!1}},methods:{roomActionHandler(e){this.closeRoomMenu(),this.$emit("room-action-handler",{action:e,roomId:this.room.roomId})},closeRoomMenu(){this.roomMenuOpened=null}}},Y2={class:"vac-room-container"},X2={class:"vac-name-container vac-text-ellipsis"},K2={class:"vac-title-container"},G2={class:"vac-room-name vac-text-ellipsis"},W2={key:1,class:"vac-text-date"},Z2={key:0},Q2={key:1,class:"vac-text-ellipsis"},J2={key:3,class:"vac-text-ellipsis"},$2={class:"vac-room-options-container"},ev={key:0,class:"vac-badge-counter vac-room-badge"},tv={key:0,class:"vac-menu-options"},sv={class:"vac-menu-list"},av=["onClick"];function rv(e,t,s,a,n,r){const o=Ge("svg-icon"),u=Ge("format-message"),_=_i("click-outside");return J(),ce("div",Y2,[Le(e.$slots,"room-list-item_"+s.room.roomId,{},()=>[Le(e.$slots,"room-list-avatar_"+s.room.roomId,{},()=>[s.room.avatar?(J(),ce("div",{key:0,class:"vac-avatar",style:At({"background-image":`url('${s.room.avatar}')`})},null,4)):xe("",!0)]),pe("div",X2,[pe("div",K2,[r.userStatus?(J(),ce("div",{key:0,class:nt(["vac-state-circle",{"vac-state-online":r.userStatus==="online"}])},null,2)):xe("",!0),pe("div",G2,et(s.room.roomName),1),s.room.lastMessage?(J(),ce("div",W2,et(s.room.lastMessage.timestamp),1)):xe("",!0)]),pe("div",{class:nt(["vac-text-last",{"vac-message-new":s.room.lastMessage&&s.room.lastMessage.new&&!r.typingUsers}])},[r.isMessageCheckmarkVisible?(J(),ce("span",Z2,[Le(e.$slots,"checkmark-icon_"+s.room.roomId,{},()=>[Ie(o,{name:s.room.lastMessage.distributed?"double-checkmark":"checkmark",param:s.room.lastMessage.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):xe("",!0),s.room.lastMessage&&!s.room.lastMessage.deleted&&r.isAudio?(J(),ce("div",Q2,[Le(e.$slots,"microphone-icon_"+s.room.roomId,{},()=>[Ie(o,{name:"microphone",class:"vac-icon-microphone"})]),ha(" "+et(r.formattedDuration),1)])):s.room.lastMessage?(J(),ft(u,{key:2,"message-id":s.room.lastMessage._id,"room-id":s.room.roomId,"room-list":!0,content:r.getLastMessage,deleted:!!s.room.lastMessage.deleted&&!r.typingUsers,users:s.room.users,"text-messages":s.textMessages,linkify:!1,"text-formatting":s.textFormatting,"link-options":s.linkOptions,"single-line":!0},wt({_:2},[rt(e.$slots,(l,v)=>({name:v,fn:Ke(c=>[Le(e.$slots,v,yt(pt(c)))])}))]),1032,["message-id","room-id","content","deleted","users","text-messages","text-formatting","link-options"])):xe("",!0),!s.room.lastMessage&&r.typingUsers?(J(),ce("div",J2,et(r.typingUsers),1)):xe("",!0),pe("div",$2,[s.room.unreadCount?(J(),ce("div",ev,et(s.room.unreadCount),1)):xe("",!0),Le(e.$slots,"room-list-options_"+s.room.roomId,{},()=>[s.roomActions.length?(J(),ce("div",{key:0,class:"vac-svg-button vac-list-room-options",onClick:t[0]||(t[0]=Ps(l=>n.roomMenuOpened=s.room.roomId,["stop"]))},[Le(e.$slots,"room-list-options-icon_"+s.room.roomId,{},()=>[Ie(o,{name:"dropdown",param:"room"})])])):xe("",!0),s.roomActions.length?(J(),ft(Nt,{key:1,name:"vac-slide-left"},{default:Ke(()=>[n.roomMenuOpened===s.room.roomId?ma((J(),ce("div",tv,[pe("div",sv,[(J(!0),ce(dt,null,rt(s.roomActions,l=>(J(),ce("div",{key:l.name},[pe("div",{class:"vac-menu-item",onClick:Ps(v=>r.roomActionHandler(l),["stop"])},et(l.title),9,av)]))),128))])])),[[_,r.closeRoomMenu]]):xe("",!0)]),_:1})):xe("",!0)])])],2)])])])}var nv=Tt(z2,[["render",rv]]),Lo=(e,t,s,a=!1)=>!s||s===""?e:e.filter(n=>a?Rn(n[t]).startsWith(Rn(s)):Rn(n[t]).includes(Rn(s)));function Rn(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}const iv={name:"RoomsList",components:{Loader:yi,RoomsSearch:hh,RoomContent:nv},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},showRoomsList:{type:Boolean,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0},roomsLoaded:{type:Boolean,required:!0},room:{type:Object,required:!0},customSearchRoomEnabled:{type:[Boolean,String],default:!1},roomActions:{type:Array,required:!0},scrollDistance:{type:Number,required:!0}},emits:["add-room","search-room","room-action-handler","loading-more-rooms","fetch-room","fetch-more-rooms"],data(){return{filteredRooms:this.rooms||[],observer:null,showLoader:!0,loadingMoreRooms:!1,selectedRoomId:""}},watch:{rooms:{deep:!0,handler(e,t){this.filteredRooms=e,(e.length!==t.length||this.roomsLoaded)&&(this.loadingMoreRooms=!1)}},loadingRooms(e){e||setTimeout(()=>this.initIntersectionObserver())},loadingMoreRooms(e){this.$emit("loading-more-rooms",e)},roomsLoaded:{immediate:!0,handler(e){e&&(this.loadingMoreRooms=!1,this.loadingRooms||(this.showLoader=!1))}},room:{immediate:!0,handler(e){e&&!this.isMobile&&(this.selectedRoomId=e.roomId)}}},methods:{initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=this.$el.querySelector("#infinite-loader-rooms");if(e){const t={root:this.$el.querySelector("#rooms-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(s=>{s[0].isIntersecting&&this.loadMoreRooms()},t),this.observer.observe(e)}},searchRoom(e){this.customSearchRoomEnabled?this.$emit("search-room",e.target.value):this.filteredRooms=Lo(this.rooms,"roomName",e.target.value)},openRoom(e){e.roomId===this.room.roomId&&!this.isMobile||(this.isMobile||(this.selectedRoomId=e.roomId),this.$emit("fetch-room",{room:e}))},loadMoreRooms(){if(!this.loadingMoreRooms){if(this.roomsLoaded){this.loadingMoreRooms=!1,this.showLoader=!1;return}this.$emit("fetch-more-rooms"),this.loadingMoreRooms=!0}}}},ov={key:0,class:"vac-rooms-empty"},lv={key:1,id:"rooms-list",class:"vac-room-list"},cv=["id","onClick"],uv={key:0,id:"infinite-loader-rooms"};function dv(e,t,s,a,n,r){const o=Ge("rooms-search"),u=Ge("loader"),_=Ge("room-content");return ma((J(),ce("div",{class:nt(["vac-rooms-container",{"vac-rooms-container-full":s.isMobile,"vac-app-border-r":!s.isMobile}])},[Le(e.$slots,"rooms-header"),Le(e.$slots,"rooms-list-search",{},()=>[Ie(o,{rooms:s.rooms,"loading-rooms":s.loadingRooms,"text-messages":s.textMessages,"show-search":s.showSearch,"show-add-room":s.showAddRoom,onSearchRoom:r.searchRoom,onAddRoom:t[0]||(t[0]=l=>e.$emit("add-room"))},wt({_:2},[rt(e.$slots,(l,v)=>({name:v,fn:Ke(c=>[Le(e.$slots,v,yt(pt(c)))])}))]),1032,["rooms","loading-rooms","text-messages","show-search","show-add-room","onSearchRoom"])]),Ie(u,{show:s.loadingRooms,type:"rooms"},wt({_:2},[rt(e.$slots,(l,v)=>({name:v,fn:Ke(c=>[Le(e.$slots,v,yt(pt(c)))])}))]),1032,["show"]),!s.loadingRooms&&!s.rooms.length?(J(),ce("div",ov,[Le(e.$slots,"rooms-empty",{},()=>[ha(et(s.textMessages.ROOMS_EMPTY),1)])])):xe("",!0),s.loadingRooms?xe("",!0):(J(),ce("div",lv,[(J(!0),ce(dt,null,rt(n.filteredRooms,l=>(J(),ce("div",{id:l.roomId,key:l.roomId,class:nt(["vac-room-item",{"vac-room-selected":n.selectedRoomId===l.roomId}]),onClick:v=>r.openRoom(l)},[Ie(_,{"current-user-id":s.currentUserId,room:l,"text-formatting":s.textFormatting,"link-options":s.linkOptions,"text-messages":s.textMessages,"room-actions":s.roomActions,onRoomActionHandler:t[1]||(t[1]=v=>e.$emit("room-action-handler",v))},wt({_:2},[rt(e.$slots,(v,c)=>({name:c,fn:Ke(b=>[Le(e.$slots,c,yt(pt(b)))])}))]),1032,["current-user-id","room","text-formatting","link-options","text-messages","room-actions"])],10,cv))),128)),Ie(Nt,{name:"vac-fade-message"},{default:Ke(()=>[s.rooms.length&&!s.loadingRooms?(J(),ce("div",uv,[Ie(u,{show:n.showLoader,infinite:!0,type:"infinite-rooms"},wt({_:2},[rt(e.$slots,(l,v)=>({name:v,fn:Ke(c=>[Le(e.$slots,v,yt(pt(c)))])}))]),1032,["show"])])):xe("",!0)]),_:3})]))],2)),[[bi,s.showRoomsList]])}var mv=Tt(iv,[["render",dv]]);const fv={name:"RoomHeader",components:{SvgIcon:zt},directives:{clickOutside:xi},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},room:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},messageSelectionActions:{type:Array,required:!0},selectedMessagesTotal:{type:Number,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","cancel-message-selection","message-selection-action-handler"],data(){return{menuOpened:!1,messageSelectionAnimationEnded:!0}},computed:{typingUsers(){return iu(this.room,this.currentUserId,this.textMessages)},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const e=this.room.users.find(s=>s._id!==this.currentUserId);if(!e?.status)return;let t="";return e.status.state==="online"?t=this.textMessages.IS_ONLINE:e.status.lastChanged&&(t=this.textMessages.LAST_SEEN+e.status.lastChanged),t}},watch:{messageSelectionEnabled(e){e?this.messageSelectionAnimationEnded=!1:setTimeout(()=>{this.messageSelectionAnimationEnded=!0},300)}},methods:{menuActionHandler(e){this.closeMenu(),this.$emit("menu-action-handler",e)},closeMenu(){this.menuOpened=!1},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",e)}}},hv={class:"vac-room-header vac-app-border-b"},vv={class:"vac-room-wrapper"},_v={key:0,class:"vac-room-selection"},pv=["id"],gv=["onClick"],bv={class:"vac-selection-button-count"},yv={class:"vac-text-ellipsis"},wv={class:"vac-room-name vac-text-ellipsis"},Sv={key:0,class:"vac-room-info vac-text-ellipsis"},Ev={key:1,class:"vac-room-info vac-text-ellipsis"},Mv={key:0,class:"vac-menu-options"},Av={class:"vac-menu-list"},Tv=["onClick"];function kv(e,t,s,a,n,r){const o=Ge("svg-icon"),u=_i("click-outside");return J(),ce("div",hv,[Le(e.$slots,"room-header",{},()=>[pe("div",vv,[Ie(Nt,{name:"vac-slide-up"},{default:Ke(()=>[s.messageSelectionEnabled?(J(),ce("div",_v,[(J(!0),ce(dt,null,rt(s.messageSelectionActions,_=>(J(),ce("div",{id:_.name,key:_.name},[pe("div",{class:"vac-selection-button",onClick:l=>r.messageSelectionActionHandler(_)},[ha(et(_.title)+" ",1),pe("span",bv,et(s.selectedMessagesTotal),1)],8,gv)],8,pv))),128)),pe("div",{class:"vac-selection-cancel vac-item-clickable",onClick:t[0]||(t[0]=_=>e.$emit("cancel-message-selection"))},et(s.textMessages.CANCEL_SELECT_MESSAGE),1)])):xe("",!0)]),_:1}),!s.messageSelectionEnabled&&n.messageSelectionAnimationEnded?(J(),ce(dt,{key:0},[s.singleRoom?xe("",!0):(J(),ce("div",{key:0,class:nt(["vac-svg-button vac-toggle-button",{"vac-rotate-icon-init":!s.isMobile,"vac-rotate-icon":!s.showRoomsList&&!s.isMobile}]),onClick:t[1]||(t[1]=_=>e.$emit("toggle-rooms-list"))},[Le(e.$slots,"toggle-icon",{},()=>[Ie(o,{name:"toggle"})])],2)),pe("div",{class:nt(["vac-info-wrapper",{"vac-item-clickable":s.roomInfoEnabled}]),onClick:t[2]||(t[2]=_=>e.$emit("room-info"))},[Le(e.$slots,"room-header-avatar",{},()=>[s.room.avatar?(J(),ce("div",{key:0,class:"vac-avatar",style:At({"background-image":`url('${s.room.avatar}')`})},null,4)):xe("",!0)]),Le(e.$slots,"room-header-info",{},()=>[pe("div",yv,[pe("div",wv,et(s.room.roomName),1),r.typingUsers?(J(),ce("div",Sv,et(r.typingUsers),1)):(J(),ce("div",Ev,et(r.userStatus),1))])])],2),s.room.roomId?Le(e.$slots,"room-options",{key:1},()=>[s.menuActions.length?(J(),ce("div",{key:0,class:"vac-svg-button vac-room-options",onClick:t[3]||(t[3]=_=>n.menuOpened=!n.menuOpened)},[Le(e.$slots,"menu-icon",{},()=>[Ie(o,{name:"menu"})])])):xe("",!0),s.menuActions.length?(J(),ft(Nt,{key:1,name:"vac-slide-left"},{default:Ke(()=>[n.menuOpened?ma((J(),ce("div",Mv,[pe("div",Av,[(J(!0),ce(dt,null,rt(s.menuActions,_=>(J(),ce("div",{key:_.name},[pe("div",{class:"vac-menu-item",onClick:l=>r.menuActionHandler(_)},et(_.title),9,Tv)]))),128))])])),[[u,r.closeMenu]]):xe("",!0)]),_:1})):xe("",!0)]):xe("",!0)],64)):xe("",!0)])])])}var Rv=Tt(fv,[["render",kv]]);function xn(e){if(typeof e!="string"||!e)throw new Error("expected a non-empty string, got: "+e)}function $i(e){if(typeof e!="number")throw new Error("expected a number, got: "+e)}const xv=1,Ov=1,Xa="emoji",ur="keyvalue",wl="favorites",Iv="tokens",ou="tokens",Cv="unicode",lu="count",Lv="group",Bv="order",cu="group-order",Bo="eTag",ei="url",kc="skinTone",_r="readonly",Sl="readwrite",uu="skinUnicodes",Nv="skinUnicodes",jv="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",Fv="en";function Hv(e,t){const s=new Set,a=[];for(const n of e){const r=t(n);s.has(r)||(s.add(r),a.push(n))}return a}function Rc(e){return Hv(e,t=>t.unicode)}function Pv(e){function t(s,a,n){const r=a?e.createObjectStore(s,{keyPath:a}):e.createObjectStore(s);if(n)for(const[o,[u,_]]of Object.entries(n))r.createIndex(o,u,{multiEntry:_});return r}t(ur),t(Xa,Cv,{[ou]:[Iv,!0],[cu]:[[Lv,Bv]],[uu]:[Nv,!0]}),t(wl,void 0,{[lu]:[""]})}const No={},zn={},ti={};function du(e,t,s){s.onerror=()=>t(s.error),s.onblocked=()=>t(new Error("IDB blocked")),s.onsuccess=()=>e(s.result)}async function Dv(e){const t=await new Promise((s,a)=>{const n=indexedDB.open(e,xv);No[e]=n,n.onupgradeneeded=r=>{r.oldVersion<Ov&&Pv(n.result)},du(s,a,n)});return t.onclose=()=>El(e),t}function Uv(e){return zn[e]||(zn[e]=Dv(e)),zn[e]}function Zs(e,t,s,a){return new Promise((n,r)=>{const o=e.transaction(t,s,{durability:"relaxed"}),u=typeof t=="string"?o.objectStore(t):t.map(l=>o.objectStore(l));let _;a(u,o,l=>{_=l}),o.oncomplete=()=>n(_),o.onerror=()=>r(o.error)})}function El(e){const t=No[e],s=t&&t.result;if(s){s.close();const a=ti[e];if(a)for(const n of a)n()}delete No[e],delete zn[e],delete ti[e]}function qv(e){return new Promise((t,s)=>{El(e);const a=indexedDB.deleteDatabase(e);du(t,s,a)})}function Vv(e,t){let s=ti[e];s||(s=ti[e]=[]),s.push(t)}const zv=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function nr(e){return e.split(/[\s_]+/).map(t=>!t.match(/\w/)||zv.has(t)?t.toLowerCase():t.replace(/[)(:,]/g,"").replace(/’/g,"'").toLowerCase()).filter(Boolean)}const Yv=2;function mu(e){return e.filter(Boolean).map(t=>t.toLowerCase()).filter(t=>t.length>=Yv)}function Xv(e){return e.map(({annotation:s,emoticon:a,group:n,order:r,shortcodes:o,skins:u,tags:_,emoji:l,version:v})=>{const c=[...new Set(mu([...(o||[]).map(nr).flat(),..._.map(nr).flat(),...nr(s),a]))].sort(),b={annotation:s,group:n,order:r,tags:_,tokens:c,unicode:l,version:v};if(a&&(b.emoticon=a),o&&(b.shortcodes=o),u){b.skinTones=[],b.skinUnicodes=[],b.skinVersions=[];for(const{tone:w,emoji:i,version:F}of u)b.skinTones.push(w),b.skinUnicodes.push(i),b.skinVersions.push(F)}return b})}function fu(e,t,s,a){e[t](s).onsuccess=n=>a&&a(n.target.result)}function za(e,t,s){fu(e,"get",t,s)}function hu(e,t,s){fu(e,"getAll",t,s)}function Ml(e){e.commit&&e.commit()}function Kv(e,t){let s=e[0];for(let a=1;a<e.length;a++){const n=e[a];t(s)>t(n)&&(s=n)}return s}function vu(e,t){const s=Kv(e,n=>n.length),a=[];for(const n of s)e.some(r=>r.findIndex(o=>t(o)===t(n))===-1)||a.push(n);return a}async function Gv(e){return!await Al(e,ur,ei)}async function Wv(e,t,s){const[a,n]=await Promise.all([Bo,ei].map(r=>Al(e,ur,r)));return a===s&&n===t}async function Zv(e,t){return Zs(e,Xa,_r,(a,n,r)=>{let o;const u=()=>{a.getAll(o&&IDBKeyRange.lowerBound(o,!0),50).onsuccess=_=>{const l=_.target.result;for(const v of l)if(o=v.unicode,t(v))return r(v);if(l.length<50)return r();u()}};u()})}async function _u(e,t,s,a){try{const n=Xv(t);await Zs(e,[Xa,ur],Sl,([r,o],u)=>{let _,l,v=0;function c(){++v===2&&b()}function b(){if(!(_===a&&l===s)){r.clear();for(const w of n)r.put(w);o.put(a,Bo),o.put(s,ei),Ml(u)}}za(o,Bo,w=>{_=w,c()}),za(o,ei,w=>{l=w,c()})})}finally{}}async function Qv(e,t){return Zs(e,Xa,_r,(s,a,n)=>{const r=IDBKeyRange.bound([t,0],[t+1,0],!1,!0);hu(s.index(cu),r,n)})}async function pu(e,t){const s=mu(nr(t));return s.length?Zs(e,Xa,_r,(a,n,r)=>{const o=[],u=()=>{o.length===s.length&&_()},_=()=>{const l=vu(o,v=>v.unicode);r(l.sort((v,c)=>v.order<c.order?-1:1))};for(let l=0;l<s.length;l++){const v=s[l],c=l===s.length-1?IDBKeyRange.bound(v,v+"￿",!1,!0):IDBKeyRange.only(v);hu(a.index(ou),c,b=>{o.push(b),u()})}}):[]}async function Jv(e,t){const s=await pu(e,t);return s.length?s.filter(a=>(a.shortcodes||[]).map(r=>r.toLowerCase()).includes(t.toLowerCase()))[0]||null:await Zv(e,n=>(n.shortcodes||[]).includes(t.toLowerCase()))||null}async function $v(e,t){return Zs(e,Xa,_r,(s,a,n)=>za(s,t,r=>{if(r)return n(r);za(s.index(uu),t,o=>n(o||null))}))}function Al(e,t,s){return Zs(e,t,_r,(a,n,r)=>za(a,s,r))}function e_(e,t,s,a){return Zs(e,t,Sl,(n,r)=>{n.put(a,s),Ml(r)})}function t_(e,t){return Zs(e,wl,Sl,(s,a)=>za(s,t,n=>{s.put((n||0)+1,t),Ml(a)}))}function s_(e,t,s){return s===0?[]:Zs(e,[wl,Xa],_r,([a,n],r,o)=>{const u=[];a.index(lu).openCursor(void 0,"prev").onsuccess=_=>{const l=_.target.result;if(!l)return o(u);function v(w){if(u.push(w),u.length===s)return o(u);l.continue()}const c=l.primaryKey,b=t.byName(c);if(b)return v(b);za(n,c,w=>{if(w)return v(w);l.continue()})}})}const On="";function a_(e,t){const s=new Map;for(const n of e){const r=t(n);for(const o of r){let u=s;for(let l=0;l<o.length;l++){const v=o.charAt(l);let c=u.get(v);c||(c=new Map,u.set(v,c)),u=c}let _=u.get(On);_||(_=[],u.set(On,_)),_.push(n)}}return(n,r)=>{let o=s;for(let l=0;l<n.length;l++){const v=n.charAt(l),c=o.get(v);if(c)o=c;else return[]}if(r)return o.get(On)||[];const u=[],_=[o];for(;_.length;){const v=[..._.shift().entries()].sort((c,b)=>c[0]<b[0]?-1:1);for(const[c,b]of v)c===On?u.push(...b):_.push(b)}return u}}const r_=["name","url"];function n_(e){const t=e&&Array.isArray(e),s=t&&e.length&&(!e[0]||r_.some(a=>!(a in e[0])));if(!t||s)throw new Error("Custom emojis are in the wrong format")}function xc(e){n_(e);const t=(b,w)=>b.name.toLowerCase()<w.name.toLowerCase()?-1:1,s=e.sort(t),n=a_(e,b=>[...new Set((b.shortcodes||[]).map(w=>nr(w)).flat())]),r=b=>n(b,!0),o=b=>n(b,!1),u=b=>{const w=nr(b),i=w.map((F,B)=>(B<w.length-1?r:o)(F));return vu(i,F=>F.name).sort(t)},_=new Map,l=new Map;for(const b of e){l.set(b.name.toLowerCase(),b);for(const w of b.shortcodes||[])_.set(w.toLowerCase(),b)}return{all:s,search:u,byShortcode:b=>_.get(b.toLowerCase()),byName:b=>l.get(b.toLowerCase())}}function Er(e){if(!e)return e;if(delete e.tokens,e.skinTones){const t=e.skinTones.length;e.skins=Array(t);for(let s=0;s<t;s++)e.skins[s]={tone:e.skinTones[s],unicode:e.skinUnicodes[s],version:e.skinVersions[s]};delete e.skinTones,delete e.skinUnicodes,delete e.skinVersions}return e}function gu(e){e||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const i_=["annotation","emoji","group","order","tags","version"];function o_(e){if(!e||!Array.isArray(e)||!e[0]||typeof e[0]!="object"||i_.some(t=>!(t in e[0])))throw new Error("Emoji data is in the wrong format")}function bu(e,t){if(Math.floor(e.status/100)!==2)throw new Error("Failed to fetch: "+t+":  "+e.status)}async function l_(e){const t=await fetch(e,{method:"HEAD"});bu(t,e);const s=t.headers.get("etag");return gu(s),s}async function jo(e){const t=await fetch(e);bu(t,e);const s=t.headers.get("etag");gu(s);const a=await t.json();return o_(a),[s,a]}function c_(e){for(var t="",s=new Uint8Array(e),a=s.byteLength,n=-1;++n<a;)t+=String.fromCharCode(s[n]);return t}function u_(e){for(var t=e.length,s=new ArrayBuffer(t),a=new Uint8Array(s),n=-1;++n<t;)a[n]=e.charCodeAt(n);return s}async function yu(e){const t=JSON.stringify(e),s=u_(t),a=await crypto.subtle.digest("SHA-1",s),n=c_(a);return btoa(n)}async function d_(e,t){let s,a=await l_(t);if(!a){const n=await jo(t);a=n[0],s=n[1],a||(a=await yu(s))}await Wv(e,t,a)||(s||(s=(await jo(t))[1]),await _u(e,s,t,a))}async function m_(e,t){let[s,a]=await jo(t);s||(s=await yu(a)),await _u(e,a,t,s)}class wu{constructor({dataSource:t=jv,locale:s=Fv,customEmoji:a=[]}={}){this.dataSource=t,this.locale=s,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=xc(a),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const t=this._db=await Uv(this._dbName);Vv(this._dbName,this._clear);const s=this.dataSource;await Gv(t)?await m_(t,s):this._lazyUpdate=d_(t,s)}async ready(){const t=async()=>(this._ready||(this._ready=this._init()),this._ready);await t(),this._db||await t()}async getEmojiByGroup(t){return $i(t),await this.ready(),Rc(await Qv(this._db,t)).map(Er)}async getEmojiBySearchQuery(t){xn(t),await this.ready();const s=this._custom.search(t),a=Rc(await pu(this._db,t)).map(Er);return[...s,...a]}async getEmojiByShortcode(t){xn(t),await this.ready();const s=this._custom.byShortcode(t);return s||Er(await Jv(this._db,t))}async getEmojiByUnicodeOrName(t){xn(t),await this.ready();const s=this._custom.byName(t);return s||Er(await $v(this._db,t))}async getPreferredSkinTone(){return await this.ready(),await Al(this._db,ur,kc)||0}async setPreferredSkinTone(t){return $i(t),await this.ready(),e_(this._db,ur,kc,t)}async incrementFavoriteEmojiCount(t){return xn(t),await this.ready(),t_(this._db,t)}async getTopFavoriteEmoji(t){return $i(t),await this.ready(),(await s_(this._db,this._custom,t)).map(Er)}set customEmoji(t){this._custom=xc(t)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch{}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await El(this._dbName)}async delete(){await this._shutdown(),await qv(this._dbName)}}function an(){}function Su(e){return e()}function Oc(){return Object.create(null)}function pn(e){e.forEach(Su)}function Eu(e){return typeof e=="function"}function f_(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let In;function si(e,t){return In||(In=document.createElement("a")),In.href=t,e===In.href}function h_(e){return Object.keys(e).length===0}function v_(e){return e&&Eu(e.destroy)?e.destroy:an}function Et(e,t){e.appendChild(t)}function xs(e,t,s){e.insertBefore(t,s||null)}function Os(e){e.parentNode.removeChild(e)}function gt(e){return document.createElement(e)}function Fs(e){return document.createTextNode(e)}function Ts(e,t,s,a){return e.addEventListener(t,s,a),()=>e.removeEventListener(t,s,a)}function re(e,t,s){s==null?e.removeAttribute(t):e.getAttribute(t)!==s&&e.setAttribute(t,s)}function Hs(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function Ic(e,t){e.value=t??""}function $s(e,t,s,a){s===null?e.style.removeProperty(t):e.style.setProperty(t,s,"")}let Tl;function Ur(e){Tl=e}const Or=[],er=[],Yn=[],Cc=[],Mu=Promise.resolve();let Fo=!1;function Au(){Fo||(Fo=!0,Mu.then(Tu))}function __(){return Au(),Mu}function Ho(e){Yn.push(e)}const eo=new Set;let Cn=0;function Tu(){const e=Tl;do{for(;Cn<Or.length;){const t=Or[Cn];Cn++,Ur(t),p_(t.$$)}for(Ur(null),Or.length=0,Cn=0;er.length;)er.pop()();for(let t=0;t<Yn.length;t+=1){const s=Yn[t];eo.has(s)||(eo.add(s),s())}Yn.length=0}while(Or.length);for(;Cc.length;)Cc.pop()();Fo=!1,eo.clear(),Ur(e)}function p_(e){if(e.fragment!==null){e.update(),pn(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ho)}}const g_=new Set;function b_(e,t){e&&e.i&&(g_.delete(e),e.i(t))}const y_=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ir(e,t){e.d(1),t.delete(e.key)}function Cr(e,t,s,a,n,r,o,u,_,l,v,c){let b=e.length,w=r.length,i=b;const F={};for(;i--;)F[e[i].key]=i;const B=[],N=new Map,f=new Map;for(i=w;i--;){const L=c(n,r,i),m=s(L);let T=o.get(m);T?T.p(L,t):(T=l(m,L),T.c()),N.set(m,B[i]=T),m in F&&f.set(m,Math.abs(i-F[m]))}const R=new Set,C=new Set;function k(L){b_(L,1),L.m(u,v),o.set(L.key,L),v=L.first,w--}for(;b&&w;){const L=B[w-1],m=e[b-1],T=L.key,E=m.key;L===m?(v=L.first,b--,w--):N.has(E)?!o.has(T)||R.has(T)?k(L):C.has(E)?b--:f.get(T)>f.get(E)?(C.add(T),k(L)):(R.add(E),b--):(_(m,o),b--)}for(;b--;){const L=e[b];N.has(L.key)||_(L,o)}for(;w;)k(B[w-1]);return B}function w_(e,t,s,a){const{fragment:n,on_mount:r,on_destroy:o,after_update:u}=e.$$;n&&n.m(t,s),Ho(()=>{const _=r.map(Su).filter(Eu);o?o.push(..._):pn(_),e.$$.on_mount=[]}),u.forEach(Ho)}function S_(e,t){const s=e.$$;s.fragment!==null&&(pn(s.on_destroy),s.fragment&&s.fragment.d(t),s.on_destroy=s.fragment=null,s.ctx=[])}function E_(e,t){e.$$.dirty[0]===-1&&(Or.push(e),Au(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function M_(e,t,s,a,n,r,o,u=[-1]){const _=Tl;Ur(e);const l=e.$$={fragment:null,ctx:null,props:r,update:an,not_equal:n,bound:Oc(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(_?_.$$.context:[]),callbacks:Oc(),dirty:u,skip_bound:!1,root:t.target||_.$$.root};let v=!1;l.ctx=s?s(e,t.props||{},(c,b,...w)=>{const i=w.length?w[0]:b;return l.ctx&&n(l.ctx[c],l.ctx[c]=i)&&(!l.skip_bound&&l.bound[c]&&l.bound[c](i),v&&E_(e,c)),b}):[],l.update(),v=!0,pn(l.before_update),l.fragment=a?a(l.ctx):!1,t.target&&(l.fragment&&l.fragment.c(),w_(e,t.target,void 0),Tu()),Ur(_)}class A_{$destroy(){S_(this,1),this.$destroy=an}$on(t,s){const a=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return a.push(s),()=>{const n=a.indexOf(s);n!==-1&&a.splice(n,1)}}$set(t){this.$$set&&!h_(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const ku=[[-1,"✨","custom"],[0,"😀","smileys-emotion"],[1,"👋","people-body"],[3,"🐱","animals-nature"],[4,"🍎","food-drink"],[5,"🏠️","travel-places"],[6,"⚽","activities"],[7,"📝","objects"],[8,"⛔️","symbols"],[9,"🏁","flags"]].map(([e,t,s])=>({id:e,emoji:t,name:s})),Ln=ku.slice(1),T_=ku[0],k_=2,Lc=6,Ru=typeof requestIdleCallback=="function"?requestIdleCallback:setTimeout;function Bc(e){return e.unicode.includes("‍")}const R_={"🫠":14,"🥲":13.1,"🥻":12.1,"🥰":11,"🤩":5,"👱‍♀️":4,"🤣":3,"👁️‍🗨️":2,"😀":1,"😐️":.7,"😃":.6},x_=1e3,O_="🖐️",I_=8,C_=["😊","😒","♥️","👍️","😍","😂","😭","☺️","😔","😩","😏","💕","🙌","😘"],xu='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',L_=(e,t)=>e<t?-1:e>t?1:0,Nc=(e,t)=>{const s=document.createElement("canvas");s.width=s.height=1;const a=s.getContext("2d");return a.textBaseline="top",a.font=`100px ${xu}`,a.fillStyle=t,a.scale(.01,.01),a.fillText(e,0,0),a.getImageData(0,0,1,1).data},B_=(e,t)=>{const s=[...e].join(","),a=[...t].join(",");return s===a&&!s.startsWith("0,0,0,")};function N_(e){const t=Nc(e,"#000"),s=Nc(e,"#fff");return t&&s&&B_(t,s)}function j_(){const e=Object.entries(R_);try{for(const[t,s]of e)if(N_(t))return s}catch{}finally{}return e[0][1]}const to=new Promise(e=>Ru(()=>e(j_()))),Po=new Map,F_="️",H_="\uD83C",P_="‍",D_=127995,U_=57339;function q_(e,t){if(t===0)return e;const s=e.indexOf(P_);return s!==-1?e.substring(0,s)+String.fromCodePoint(D_+t-1)+e.substring(s):(e.endsWith(F_)&&(e=e.substring(0,e.length-1)),e+H_+String.fromCodePoint(U_+t-1))}function ea(e){e.preventDefault(),e.stopPropagation()}function so(e,t,s){return t+=e?-1:1,t<0?t=s.length-1:t>=s.length&&(t=0),t}function Ou(e,t){const s=new Set,a=[];for(const n of e){const r=t(n);s.has(r)||(s.add(r),a.push(n))}return a}function V_(e,t){const s=a=>{const n={};for(const r of a)typeof r.tone=="number"&&r.version<=t&&(n[r.tone]=r.unicode);return n};return e.map(({unicode:a,skins:n,shortcodes:r,url:o,name:u,category:_})=>({unicode:a,name:u,shortcodes:r,url:o,category:_,id:a||u,skins:n&&s(n),title:(r||[]).join(", ")}))}const Xn=requestAnimationFrame;let z_=typeof ResizeObserver=="function";function Y_(e,t){let s;return z_?(s=new ResizeObserver(a=>t(a[0].contentRect.width)),s.observe(e)):Xn(()=>t(e.getBoundingClientRect().width)),{destroy(){s&&s.disconnect()}}}function jc(e){{const t=document.createRange();return t.selectNode(e.firstChild),t.getBoundingClientRect().width}}let ao;function X_(e,t,s){for(const a of e){const n=s(a),r=jc(n);typeof ao>"u"&&(ao=jc(t));const o=r/1.8<ao;Po.set(a.unicode,o)}}function K_(e){return Ou(e,t=>t)}const{Map:Lr}=y_;function Fc(e,t,s){const a=e.slice();return a[63]=t[s],a[65]=s,a}function Hc(e,t,s){const a=e.slice();return a[66]=t[s],a[65]=s,a}function Pc(e,t,s){const a=e.slice();return a[63]=t[s],a[65]=s,a}function Dc(e,t,s){const a=e.slice();return a[69]=t[s],a}function Uc(e,t,s){const a=e.slice();return a[72]=t[s],a[65]=s,a}function qc(e,t){let s,a=t[72]+"",n,r,o,u,_,l;return{key:e,first:null,c(){s=gt("div"),n=Fs(a),re(s,"id",r="skintone-"+t[65]),re(s,"class",o="emoji hide-focus "+(t[65]===t[20]?"active":"")),re(s,"aria-selected",u=t[65]===t[20]),re(s,"role","option"),re(s,"title",_=t[0].skinTones[t[65]]),re(s,"tabindex","-1"),re(s,"aria-label",l=t[0].skinTones[t[65]]),this.first=s},m(v,c){xs(v,s,c),Et(s,n)},p(v,c){t=v,c[0]&512&&a!==(a=t[72]+"")&&Hs(n,a),c[0]&512&&r!==(r="skintone-"+t[65])&&re(s,"id",r),c[0]&1049088&&o!==(o="emoji hide-focus "+(t[65]===t[20]?"active":""))&&re(s,"class",o),c[0]&1049088&&u!==(u=t[65]===t[20])&&re(s,"aria-selected",u),c[0]&513&&_!==(_=t[0].skinTones[t[65]])&&re(s,"title",_),c[0]&513&&l!==(l=t[0].skinTones[t[65]])&&re(s,"aria-label",l)},d(v){v&&Os(s)}}}function Vc(e,t){let s,a,n=t[69].emoji+"",r,o,u,_,l,v,c;function b(){return t[49](t[69])}return{key:e,first:null,c(){s=gt("button"),a=gt("div"),r=Fs(n),re(a,"class","nav-emoji emoji"),re(s,"role","tab"),re(s,"class","nav-button"),re(s,"aria-controls",o="tab-"+t[69].id),re(s,"aria-label",u=t[0].categories[t[69].name]),re(s,"aria-selected",_=!t[4]&&t[13].id===t[69].id),re(s,"title",l=t[0].categories[t[69].name]),this.first=s},m(w,i){xs(w,s,i),Et(s,a),Et(a,r),v||(c=Ts(s,"click",b),v=!0)},p(w,i){t=w,i[0]&4096&&n!==(n=t[69].emoji+"")&&Hs(r,n),i[0]&4096&&o!==(o="tab-"+t[69].id)&&re(s,"aria-controls",o),i[0]&4097&&u!==(u=t[0].categories[t[69].name])&&re(s,"aria-label",u),i[0]&12304&&_!==(_=!t[4]&&t[13].id===t[69].id)&&re(s,"aria-selected",_),i[0]&4097&&l!==(l=t[0].categories[t[69].name])&&re(s,"title",l)},d(w){w&&Os(s),v=!1,c()}}}function G_(e){let t,s;return{c(){t=gt("img"),re(t,"class","custom-emoji"),si(t.src,s=e[63].url)||re(t,"src",s),re(t,"alt",""),re(t,"loading","lazy")},m(a,n){xs(a,t,n)},p(a,n){n[0]&32768&&!si(t.src,s=a[63].url)&&re(t,"src",s)},d(a){a&&Os(t)}}}function W_(e){let t=e[27](e[63],e[8])+"",s;return{c(){s=Fs(t)},m(a,n){xs(a,s,n)},p(a,n){n[0]&33024&&t!==(t=a[27](a[63],a[8])+"")&&Hs(s,t)},d(a){a&&Os(s)}}}function zc(e,t){let s,a,n,r,o,u,_;function l(b,w){return b[63].unicode?W_:G_}let v=l(t),c=v(t);return{key:e,first:null,c(){s=gt("button"),c.c(),re(s,"role",a=t[4]?"option":"menuitem"),re(s,"aria-selected",n=t[4]?t[65]==t[5]:""),re(s,"aria-label",r=t[28](t[63],t[8])),re(s,"title",o=t[63].title),re(s,"class",u="emoji "+(t[4]&&t[65]===t[5]?"active":"")),re(s,"id",_="emo-"+t[63].id),this.first=s},m(b,w){xs(b,s,w),c.m(s,null)},p(b,w){t=b,v===(v=l(t))&&c?c.p(t,w):(c.d(1),c=v(t),c&&(c.c(),c.m(s,null))),w[0]&16&&a!==(a=t[4]?"option":"menuitem")&&re(s,"role",a),w[0]&32816&&n!==(n=t[4]?t[65]==t[5]:"")&&re(s,"aria-selected",n),w[0]&33024&&r!==(r=t[28](t[63],t[8]))&&re(s,"aria-label",r),w[0]&32768&&o!==(o=t[63].title)&&re(s,"title",o),w[0]&32816&&u!==(u="emoji "+(t[4]&&t[65]===t[5]?"active":""))&&re(s,"class",u),w[0]&32768&&_!==(_="emo-"+t[63].id)&&re(s,"id",_)},d(b){b&&Os(s),c.d()}}}function Yc(e,t){let s,a=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"",n,r,o,u,_=[],l=new Lr,v,c,b,w=t[66].emojis;const i=F=>F[63].id;for(let F=0;F<w.length;F+=1){let B=Pc(t,w,F),N=i(B);l.set(N,_[F]=zc(N,B))}return{key:e,first:null,c(){s=gt("div"),n=Fs(a),u=gt("div");for(let F=0;F<_.length;F+=1)_[F].c();re(s,"id",r="menu-label-"+t[65]),re(s,"class",o="category "+(t[15].length===1&&t[15][0].category===""?"gone":"")),re(s,"aria-hidden","true"),re(u,"class","emoji-menu"),re(u,"role",v=t[4]?"listbox":"menu"),re(u,"aria-labelledby",c="menu-label-"+t[65]),re(u,"id",b=t[4]?"search-results":""),this.first=s},m(F,B){xs(F,s,B),Et(s,n),xs(F,u,B);for(let N=0;N<_.length;N+=1)_[N].m(u,null)},p(F,B){t=F,B[0]&40977&&a!==(a=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"")&&Hs(n,a),B[0]&32768&&r!==(r="menu-label-"+t[65])&&re(s,"id",r),B[0]&32768&&o!==(o="category "+(t[15].length===1&&t[15][0].category===""?"gone":""))&&re(s,"class",o),B[0]&402686256&&(w=t[66].emojis,_=Cr(_,B,i,1,t,w,l,u,Ir,zc,null,Pc)),B[0]&16&&v!==(v=t[4]?"listbox":"menu")&&re(u,"role",v),B[0]&32768&&c!==(c="menu-label-"+t[65])&&re(u,"aria-labelledby",c),B[0]&16&&b!==(b=t[4]?"search-results":"")&&re(u,"id",b)},d(F){F&&Os(s),F&&Os(u);for(let B=0;B<_.length;B+=1)_[B].d()}}}function Z_(e){let t,s;return{c(){t=gt("img"),re(t,"class","custom-emoji"),si(t.src,s=e[63].url)||re(t,"src",s),re(t,"alt",""),re(t,"loading","lazy")},m(a,n){xs(a,t,n)},p(a,n){n[0]&1024&&!si(t.src,s=a[63].url)&&re(t,"src",s)},d(a){a&&Os(t)}}}function Q_(e){let t=e[27](e[63],e[8])+"",s;return{c(){s=Fs(t)},m(a,n){xs(a,s,n)},p(a,n){n[0]&1280&&t!==(t=a[27](a[63],a[8])+"")&&Hs(s,t)},d(a){a&&Os(s)}}}function Xc(e,t){let s,a,n,r;function o(l,v){return l[63].unicode?Q_:Z_}let u=o(t),_=u(t);return{key:e,first:null,c(){s=gt("button"),_.c(),re(s,"role","menuitem"),re(s,"aria-label",a=t[28](t[63],t[8])),re(s,"title",n=t[63].title),re(s,"class","emoji"),re(s,"id",r="fav-"+t[63].id),this.first=s},m(l,v){xs(l,s,v),_.m(s,null)},p(l,v){t=l,u===(u=o(t))&&_?_.p(t,v):(_.d(1),_=u(t),_&&(_.c(),_.m(s,null))),v[0]&1280&&a!==(a=t[28](t[63],t[8]))&&re(s,"aria-label",a),v[0]&1024&&n!==(n=t[63].title)&&re(s,"title",n),v[0]&1024&&r!==(r="fav-"+t[63].id)&&re(s,"id",r)},d(l){l&&Os(s),_.d()}}}function J_(e){let t,s,a,n,r,o,u,_,l,v=e[0].searchLabel+"",c,b,w=e[0].searchDescription+"",i,F,B,N,f,R,C,k=e[0].skinToneDescription+"",L,m,T=[],E=new Lr,h,y,g,p,M,S=[],j=new Lr,X,D,V,d,A,W,Q,ve,Me=[],Te=new Lr,Y,ie,ae,le,Ue,Ze=[],H=new Lr,z,ee,me,he,Ee,Re,we=e[9];const ke=fe=>fe[72];for(let fe=0;fe<we.length;fe+=1){let Se=Uc(e,we,fe),te=ke(Se);E.set(te,T[fe]=qc(te,Se))}let _e=e[12];const Pe=fe=>fe[69].id;for(let fe=0;fe<_e.length;fe+=1){let Se=Dc(e,_e,fe),te=Pe(Se);j.set(te,S[fe]=Vc(te,Se))}let je=e[15];const De=fe=>fe[66].category;for(let fe=0;fe<je.length;fe+=1){let Se=Hc(e,je,fe),te=De(Se);Te.set(te,Me[fe]=Yc(te,Se))}let qe=e[10];const We=fe=>fe[63].id;for(let fe=0;fe<qe.length;fe+=1){let Se=Fc(e,qe,fe),te=We(Se);H.set(te,Ze[fe]=Xc(te,Se))}return{c(){t=gt("section"),s=gt("div"),a=gt("div"),n=gt("div"),r=gt("input"),l=gt("label"),c=Fs(v),b=gt("span"),i=Fs(w),F=gt("div"),B=gt("button"),N=Fs(e[21]),C=gt("span"),L=Fs(k),m=gt("div");for(let fe=0;fe<T.length;fe+=1)T[fe].c();M=gt("div");for(let fe=0;fe<S.length;fe+=1)S[fe].c();D=gt("div"),V=gt("div"),d=gt("div"),A=Fs(e[18]),Q=gt("div"),ve=gt("div");for(let fe=0;fe<Me.length;fe+=1)Me[fe].c();Ue=gt("div");for(let fe=0;fe<Ze.length;fe+=1)Ze[fe].c();me=gt("button"),me.textContent="😀",re(s,"class","pad-top"),re(r,"id","search"),re(r,"class","search"),re(r,"type","search"),re(r,"role","combobox"),re(r,"enterkeyhint","search"),re(r,"placeholder",o=e[0].searchLabel),re(r,"autocapitalize","none"),re(r,"autocomplete","off"),re(r,"spellcheck","true"),re(r,"aria-expanded",u=!!(e[4]&&e[1].length)),re(r,"aria-controls","search-results"),re(r,"aria-describedby","search-description"),re(r,"aria-autocomplete","list"),re(r,"aria-activedescendant",_=e[26]?`emo-${e[26]}`:""),re(l,"class","sr-only"),re(l,"for","search"),re(b,"id","search-description"),re(b,"class","sr-only"),re(n,"class","search-wrapper"),re(B,"id","skintone-button"),re(B,"class",f="emoji "+(e[6]?"hide-focus":"")),re(B,"aria-label",e[23]),re(B,"title",e[23]),re(B,"aria-describedby","skintone-description"),re(B,"aria-haspopup","listbox"),re(B,"aria-expanded",e[6]),re(B,"aria-controls","skintone-list"),re(F,"class",R="skintone-button-wrapper "+(e[19]?"expanded":"")),re(C,"id","skintone-description"),re(C,"class","sr-only"),re(m,"id","skintone-list"),re(m,"class",h="skintone-list "+(e[6]?"":"hidden no-animate")),$s(m,"transform","translateY("+(e[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),re(m,"role","listbox"),re(m,"aria-label",y=e[0].skinTonesLabel),re(m,"aria-activedescendant",g="skintone-"+e[20]),re(m,"aria-hidden",p=!e[6]),re(a,"class","search-row"),re(M,"class","nav"),re(M,"role","tablist"),$s(M,"grid-template-columns","repeat("+e[12].length+", 1fr)"),re(M,"aria-label",X=e[0].categoriesLabel),re(V,"class","indicator"),$s(V,"transform","translateX("+(e[24]?-1:1)*e[11]*100+"%)"),re(D,"class","indicator-wrapper"),re(d,"class",W="message "+(e[18]?"":"gone")),re(d,"role","alert"),re(d,"aria-live","polite"),re(Q,"class",Y="tabpanel "+(!e[14]||e[18]?"gone":"")),re(Q,"role",ie=e[4]?"region":"tabpanel"),re(Q,"aria-label",ae=e[4]?e[0].searchResultsLabel:e[0].categories[e[13].name]),re(Q,"id",le=e[4]?"":`tab-${e[13].id}`),re(Q,"tabindex","0"),re(Ue,"class",z="favorites emoji-menu "+(e[18]?"gone":"")),re(Ue,"role","menu"),re(Ue,"aria-label",ee=e[0].favoritesLabel),$s(Ue,"padding-inline-end",e[25]+"px"),re(me,"aria-hidden","true"),re(me,"tabindex","-1"),re(me,"class","abs-pos hidden emoji"),re(t,"class","picker"),re(t,"aria-label",he=e[0].regionLabel),re(t,"style",e[22])},m(fe,Se){xs(fe,t,Se),Et(t,s),Et(t,a),Et(a,n),Et(n,r),Ic(r,e[2]),Et(n,l),Et(l,c),Et(n,b),Et(b,i),Et(a,F),Et(F,B),Et(B,N),Et(a,C),Et(C,L),Et(a,m);for(let te=0;te<T.length;te+=1)T[te].m(m,null);e[48](m),Et(t,M);for(let te=0;te<S.length;te+=1)S[te].m(M,null);Et(t,D),Et(D,V),Et(t,d),Et(d,A),Et(t,Q),Et(Q,ve);for(let te=0;te<Me.length;te+=1)Me[te].m(ve,null);e[50](Q),Et(t,Ue);for(let te=0;te<Ze.length;te+=1)Ze[te].m(Ue,null);Et(t,me),e[51](me),e[52](t),Ee||(Re=[Ts(r,"input",e[47]),Ts(r,"keydown",e[30]),Ts(B,"click",e[35]),Ts(m,"focusout",e[38]),Ts(m,"click",e[34]),Ts(m,"keydown",e[36]),Ts(m,"keyup",e[37]),Ts(M,"keydown",e[32]),v_(e[29].call(null,ve)),Ts(Q,"click",e[33]),Ts(Ue,"click",e[33])],Ee=!0)},p(fe,Se){Se[0]&1&&o!==(o=fe[0].searchLabel)&&re(r,"placeholder",o),Se[0]&18&&u!==(u=!!(fe[4]&&fe[1].length))&&re(r,"aria-expanded",u),Se[0]&67108864&&_!==(_=fe[26]?`emo-${fe[26]}`:"")&&re(r,"aria-activedescendant",_),Se[0]&4&&Ic(r,fe[2]),Se[0]&1&&v!==(v=fe[0].searchLabel+"")&&Hs(c,v),Se[0]&1&&w!==(w=fe[0].searchDescription+"")&&Hs(i,w),Se[0]&2097152&&Hs(N,fe[21]),Se[0]&64&&f!==(f="emoji "+(fe[6]?"hide-focus":""))&&re(B,"class",f),Se[0]&8388608&&re(B,"aria-label",fe[23]),Se[0]&8388608&&re(B,"title",fe[23]),Se[0]&64&&re(B,"aria-expanded",fe[6]),Se[0]&524288&&R!==(R="skintone-button-wrapper "+(fe[19]?"expanded":""))&&re(F,"class",R),Se[0]&1&&k!==(k=fe[0].skinToneDescription+"")&&Hs(L,k),Se[0]&1049089&&(we=fe[9],T=Cr(T,Se,ke,1,fe,we,E,m,Ir,qc,null,Uc)),Se[0]&64&&h!==(h="skintone-list "+(fe[6]?"":"hidden no-animate"))&&re(m,"class",h),Se[0]&64&&$s(m,"transform","translateY("+(fe[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),Se[0]&1&&y!==(y=fe[0].skinTonesLabel)&&re(m,"aria-label",y),Se[0]&1048576&&g!==(g="skintone-"+fe[20])&&re(m,"aria-activedescendant",g),Se[0]&64&&p!==(p=!fe[6])&&re(m,"aria-hidden",p),Se[0]&12305|Se[1]&1&&(_e=fe[12],S=Cr(S,Se,Pe,1,fe,_e,j,M,Ir,Vc,null,Dc)),Se[0]&4096&&$s(M,"grid-template-columns","repeat("+fe[12].length+", 1fr)"),Se[0]&1&&X!==(X=fe[0].categoriesLabel)&&re(M,"aria-label",X),Se[0]&16779264&&$s(V,"transform","translateX("+(fe[24]?-1:1)*fe[11]*100+"%)"),Se[0]&262144&&Hs(A,fe[18]),Se[0]&262144&&W!==(W="message "+(fe[18]?"":"gone"))&&re(d,"class",W),Se[0]&402694449&&(je=fe[15],Me=Cr(Me,Se,De,1,fe,je,Te,ve,Ir,Yc,null,Hc)),Se[0]&278528&&Y!==(Y="tabpanel "+(!fe[14]||fe[18]?"gone":""))&&re(Q,"class",Y),Se[0]&16&&ie!==(ie=fe[4]?"region":"tabpanel")&&re(Q,"role",ie),Se[0]&8209&&ae!==(ae=fe[4]?fe[0].searchResultsLabel:fe[0].categories[fe[13].name])&&re(Q,"aria-label",ae),Se[0]&8208&&le!==(le=fe[4]?"":`tab-${fe[13].id}`)&&re(Q,"id",le),Se[0]&402654464&&(qe=fe[10],Ze=Cr(Ze,Se,We,1,fe,qe,H,Ue,Ir,Xc,null,Fc)),Se[0]&262144&&z!==(z="favorites emoji-menu "+(fe[18]?"gone":""))&&re(Ue,"class",z),Se[0]&1&&ee!==(ee=fe[0].favoritesLabel)&&re(Ue,"aria-label",ee),Se[0]&33554432&&$s(Ue,"padding-inline-end",fe[25]+"px"),Se[0]&1&&he!==(he=fe[0].regionLabel)&&re(t,"aria-label",he),Se[0]&4194304&&re(t,"style",fe[22])},i:an,o:an,d(fe){fe&&Os(t);for(let Se=0;Se<T.length;Se+=1)T[Se].d();e[48](null);for(let Se=0;Se<S.length;Se+=1)S[Se].d();for(let Se=0;Se<Me.length;Se+=1)Me[Se].d();e[50](null);for(let Se=0;Se<Ze.length;Se+=1)Ze[Se].d();e[51](null),e[52](null),Ee=!1,pn(Re)}}}function $_(e,t,s){let{skinToneEmoji:a}=t,{i18n:n}=t,{database:r}=t,{customEmoji:o}=t,{customCategorySorting:u}=t,_=!0,l=[],v=[],c="",b="",w,i,F,B=!1,N=-1,f,R=!1,C=!1,k,L=0,m=0,T,E,h="",y=[],g=[],p,M=I_,S=!1,j=0,X=0,D=Ln,V,d=!1,A;const W=te=>{w.getRootNode().getElementById(te).focus()},Q=(te,Be)=>{w.dispatchEvent(new CustomEvent(te,{detail:Be,bubbles:!0,composed:!0}))},ve=(te,Be)=>Be&&te.skins&&te.skins[Be]||te.unicode,Me=(te,Be)=>K_([te.name||ve(te,Be),...te.shortcodes||[]]).join(", "),Te=te=>/^skintone-/.test(te.id);to.then(te=>{te||s(18,f=n.emojiUnsupportedMessage)});function Y(te){return Y_(te,Be=>{{const x=getComputedStyle(w),I=parseInt(x.getPropertyValue("--num-columns"),10),U=x.getPropertyValue("direction")==="rtl",K=te.parentElement.getBoundingClientRect().width-Be;s(46,M=I),s(25,j=K),s(24,S=U)}})}function ie(te){const Be=w.getRootNode();X_(te,i,I=>Be.getElementById(`emo-${I.id}`)),s(1,l=l)}function ae(te){return!te.unicode||!Bc(te)||Po.get(te.unicode)}async function le(te){const Be=await to;return te.filter(({version:x})=>!x||x<=Be)}async function Ue(te){return V_(te,await to)}async function Ze(te){if(typeof te>"u")return[];const Be=te===-1?o:await r.getEmojiByGroup(te);return Ue(await le(Be))}async function H(te){return Ue(await le(await r.getEmojiBySearchQuery(te)))}function z(te){if(!B||!l.length)return;const Be=x=>{ea(te),s(5,N=so(x,N,l))};switch(te.key){case"ArrowDown":return Be(!1);case"ArrowUp":return Be(!0);case"Enter":if(N!==-1)return ea(te),he(l[N].id);l.length&&s(5,N=0)}}function ee(te){s(2,c=""),s(44,b=""),s(5,N=-1),s(11,X=D.findIndex(Be=>Be.id===te.id))}function me(te){const{target:Be,key:x}=te,I=U=>{U&&(ea(te),U.focus())};switch(x){case"ArrowLeft":return I(Be.previousSibling);case"ArrowRight":return I(Be.nextSibling);case"Home":return I(Be.parentElement.firstChild);case"End":return I(Be.parentElement.lastChild)}}async function he(te){const Be=await r.getEmojiByUnicodeOrName(te),x=[...l,...g].find(U=>U.id===te),I=x.unicode&&ve(x,L);await r.incrementFavoriteEmojiCount(te),Q("emoji-click",{emoji:Be,skinTone:L,...I&&{unicode:I},...x.name&&{name:x.name}})}async function Ee(te){const{target:Be}=te;if(!Be.classList.contains("emoji"))return;ea(te);const x=Be.id.substring(4);he(x)}async function Re(te){const{target:Be}=te;if(!Te(Be))return;ea(te);const x=parseInt(Be.id.slice(9),10);s(8,L=x),s(6,R=!1),W("skintone-button"),Q("skin-tone-change",{skinTone:x}),r.setPreferredSkinTone(x)}async function we(te){s(6,R=!R),s(20,m=L),R&&(ea(te),Xn(()=>W(`skintone-${m}`)))}function ke(te){if(!R)return;const Be=async x=>{ea(te),s(20,m=x),await __(),W(`skintone-${m}`)};switch(te.key){case"ArrowUp":return Be(so(!0,m,y));case"ArrowDown":return Be(so(!1,m,y));case"Home":return Be(0);case"End":return Be(y.length-1);case"Enter":return Re(te);case"Escape":return ea(te),s(6,R=!1),W("skintone-button")}}function _e(te){if(R)switch(te.key){case" ":return Re(te)}}async function Pe(te){const{relatedTarget:Be}=te;(!Be||!Te(Be))&&s(6,R=!1)}function je(){c=this.value,s(2,c)}function De(te){er[te?"unshift":"push"](()=>{k=te,s(7,k)})}const qe=te=>ee(te);function We(te){er[te?"unshift":"push"](()=>{F=te,s(3,F)})}function fe(te){er[te?"unshift":"push"](()=>{i=te,s(17,i)})}function Se(te){er[te?"unshift":"push"](()=>{w=te,s(16,w)})}return e.$$set=te=>{"skinToneEmoji"in te&&s(40,a=te.skinToneEmoji),"i18n"in te&&s(0,n=te.i18n),"database"in te&&s(39,r=te.database),"customEmoji"in te&&s(41,o=te.customEmoji),"customCategorySorting"in te&&s(42,u=te.customCategorySorting)},e.$$.update=()=>{if(e.$$.dirty[1]&1280&&o&&r&&s(39,r.customEmoji=o,r),e.$$.dirty[0]&1|e.$$.dirty[1]&256){async function te(){let Be=!1;const x=setTimeout(()=>{Be=!0,s(18,f=n.loadingMessage)},x_);try{await r.ready(),s(14,d=!0)}catch(I){console.error(I),s(18,f=n.networkErrorMessage)}finally{clearTimeout(x),Be&&(Be=!1,s(18,f=""))}}r&&te()}if(e.$$.dirty[0]&6144|e.$$.dirty[1]&1024&&(o&&o.length?s(12,D=[T_,...Ln]):D!==Ln&&(X&&s(11,X--,X),s(12,D=Ln))),e.$$.dirty[0]&4&&Ru(()=>{s(44,b=(c||"").trim()),s(5,N=-1)}),e.$$.dirty[0]&6144&&s(13,V=D[X]),e.$$.dirty[0]&24576|e.$$.dirty[1]&8192){async function te(){if(!d)s(1,l=[]),s(4,B=!1);else if(b.length>=k_){const Be=b,x=await H(Be);Be===b&&(s(1,l=x),s(4,B=!0))}else if(V){const Be=V.id,x=await Ze(Be);Be===V.id&&(s(1,l=x),s(4,B=!1))}}te()}if(e.$$.dirty[0]&4112&&s(22,E=`
  --font-family: ${xu};
  --num-groups: ${D.length}; 
  --indicator-opacity: ${B?0:1}; 
  --num-skintones: ${Lc};`),e.$$.dirty[0]&16384|e.$$.dirty[1]&256){async function te(){d&&s(8,L=await r.getPreferredSkinTone())}te()}if(e.$$.dirty[1]&512&&s(9,y=Array(Lc).fill().map((te,Be)=>q_(a,Be))),e.$$.dirty[0]&768&&s(21,T=y[L]),e.$$.dirty[0]&257&&s(23,h=n.skinToneLabel.replace("{skinTone}",n.skinTones[L])),e.$$.dirty[0]&16384|e.$$.dirty[1]&256){async function te(){s(45,p=(await Promise.all(C_.map(Be=>r.getEmojiByUnicodeOrName(Be)))).filter(Boolean))}d&&te()}if(e.$$.dirty[0]&16384|e.$$.dirty[1]&49408){async function te(){const Be=await r.getTopFavoriteEmoji(M),x=await Ue(Ou([...Be,...p],I=>I.unicode||I.name).slice(0,M));s(10,g=x)}d&&p&&te()}if(e.$$.dirty[0]&10){const te=l.filter(Be=>Be.unicode).filter(Be=>Bc(Be)&&!Po.has(Be.unicode));te.length?Xn(()=>ie(te)):(s(1,l=l.filter(ae)),Xn(()=>{(F||{}).scrollTop=0}))}e.$$.dirty[0]&1026|e.$$.dirty[1]&4096,e.$$.dirty[0]&18|e.$$.dirty[1]&2048&&s(15,v=function(){if(B)return[{category:"",emojis:l}];const Be=new Map;for(const x of l){const I=x.category||"";let U=Be.get(I);U||(U=[],Be.set(I,U)),U.push(x)}return[...Be.entries()].map(([x,I])=>({category:x,emojis:I})).sort((x,I)=>u(x.category,I.category))}()),e.$$.dirty[0]&34&&s(26,A=N!==-1&&l[N].id),e.$$.dirty[0]&192&&(R?k.addEventListener("transitionend",()=>{s(19,C=!0)},{once:!0}):s(19,C=!1))},[n,l,c,F,B,N,R,k,L,y,g,X,D,V,d,v,w,i,f,C,m,T,E,h,S,j,A,ve,Me,Y,z,ee,me,Ee,Re,we,ke,_e,Pe,r,a,o,u,_,b,p,M,je,De,qe,We,fe,Se]}class ep extends A_{constructor(t){super(),M_(this,t,$_,J_,f_,{skinToneEmoji:40,i18n:0,database:39,customEmoji:41,customCategorySorting:42},null,[-1,-1,-1])}}const tp="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",sp="en";var ap={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading…",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}};const Iu=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji"];class Cu extends HTMLElement{constructor(t){super(),this.attachShadow({mode:"open"});const s=document.createElement("style");s.textContent=":host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.custom-emoji,.emoji,button.emoji{height:var(--total-emoji-size);width:var(--total-emoji-size)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;line-height:1;overflow:hidden;font-family:var(--font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.custom-emoji{padding:var(--emoji-padding);object-fit:contain;pointer-events:none;background-repeat:no-repeat;background-position:center center;background-size:var(--emoji-size) var(--emoji-size)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}",this.shadowRoot.appendChild(s),this._ctx={locale:sp,dataSource:tp,skinToneEmoji:O_,customCategorySorting:L_,customEmoji:null,i18n:ap,...t};for(const a of Iu)a!=="database"&&Object.prototype.hasOwnProperty.call(this,a)&&(this._ctx[a]=this[a],delete this[a]);this._dbFlush()}connectedCallback(){this._cmp=new ep({target:this.shadowRoot,props:this._ctx})}disconnectedCallback(){this._cmp.$destroy(),this._cmp=void 0;const{database:t}=this._ctx;t&&t.close().catch(s=>console.error(s))}static get observedAttributes(){return["locale","data-source","skin-tone-emoji"]}attributeChangedCallback(t,s,a){this._set(t.replace(/-([a-z])/g,(n,r)=>r.toUpperCase()),a)}_set(t,s){this._ctx[t]=s,this._cmp&&this._cmp.$set({[t]:s}),["locale","dataSource"].includes(t)&&this._dbFlush()}_dbCreate(){const{locale:t,dataSource:s,database:a}=this._ctx;(!a||a.locale!==t||a.dataSource!==s)&&this._set("database",new wu({locale:t,dataSource:s}))}_dbFlush(){Promise.resolve().then(()=>this._dbCreate())}}const Lu={};for(const e of Iu)Lu[e]={get(){return e==="database"&&this._dbCreate(),this._ctx[e]},set(t){if(e==="database")throw new Error("database is read-only");this._set(e,t)}};Object.defineProperties(Cu.prototype,Lu);customElements.get("emoji-picker")||customElements.define("emoji-picker",Cu);function Bu(e,t){for(;e&&!e.querySelector(t);){e=e.parentNode;const s=e.querySelector(t);if(s)return s}return null}var Kc;const kl=typeof window<"u",Nu=e=>typeof e=="string",Rl=()=>{},Do=kl&&((Kc=window?.navigator)==null?void 0:Kc.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function dr(e){return typeof e=="function"?e():z1(e)}function rp(e){return e}function xl(e){return Ld()?(Bd(e),!0):!1}function np(e){return typeof e=="function"?cl(e):ui(e)}function Br(e){var t;const s=dr(e);return(t=s?.$el)!=null?t:s}const ju=kl?window:void 0;function ro(...e){let t,s,a,n;if(Nu(e[0])||Array.isArray(e[0])?([s,a,n]=e,t=ju):[t,s,a,n]=e,!t)return Rl;Array.isArray(s)||(s=[s]),Array.isArray(a)||(a=[a]);const r=[],o=()=>{r.forEach(v=>v()),r.length=0},u=(v,c,b,w)=>(v.addEventListener(c,b,w),()=>v.removeEventListener(c,b,w)),_=Ha(()=>[Br(t),dr(n)],([v,c])=>{o(),v&&r.push(...s.flatMap(b=>a.map(w=>u(v,b,w,c))))},{immediate:!0,flush:"post"}),l=()=>{_(),o()};return xl(l),l}let Gc=!1;function ip(e,t,s={}){const{window:a=ju,ignore:n=[],capture:r=!0,detectIframe:o=!1}=s;if(!a)return;Do&&!Gc&&(Gc=!0,Array.from(a.document.body.children).forEach(b=>b.addEventListener("click",Rl)));let u=!0;const _=b=>n.some(w=>{if(typeof w=="string")return Array.from(a.document.querySelectorAll(w)).some(i=>i===b.target||b.composedPath().includes(i));{const i=Br(w);return i&&(b.target===i||b.composedPath().includes(i))}}),v=[ro(a,"click",b=>{const w=Br(e);if(!(!w||w===b.target||b.composedPath().includes(w))){if(b.detail===0&&(u=!_(b)),!u){u=!0;return}t(b)}},{passive:!0,capture:r}),ro(a,"pointerdown",b=>{const w=Br(e);w&&(u=!b.composedPath().includes(w)&&!_(b))},{passive:!0}),o&&ro(a,"blur",b=>{var w;const i=Br(e);((w=a.document.activeElement)==null?void 0:w.tagName)==="IFRAME"&&!i?.contains(a.document.activeElement)&&t(b)})].filter(Boolean);return()=>v.forEach(b=>b())}const Wc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Zc="__vueuse_ssr_handlers__";Wc[Zc]=Wc[Zc]||{};var Qc;(function(e){e.UP="UP",e.RIGHT="RIGHT",e.DOWN="DOWN",e.LEFT="LEFT",e.NONE="NONE"})(Qc||(Qc={}));var op=Object.defineProperty,Jc=Object.getOwnPropertySymbols,lp=Object.prototype.hasOwnProperty,cp=Object.prototype.propertyIsEnumerable,$c=(e,t,s)=>t in e?op(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,up=(e,t)=>{for(var s in t||(t={}))lp.call(t,s)&&$c(e,s,t[s]);if(Jc)for(var s of Jc(t))cp.call(t,s)&&$c(e,s,t[s]);return e};const dp={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};up({linear:rp},dp);const mp=i0({name:"OnClickOutside",props:["as","options"],emits:["trigger"],setup(e,{slots:t,emit:s}){const a=ui();return ip(a,n=>{s("trigger",n)},e.options),()=>{if(t.default)return k0(e.as||"div",{ref:a},t.default())}}});function fp(e){var t;const s=dr(e);return(t=s?.$el)!=null?t:s}const hp=kl?window:void 0;function vp(...e){let t,s,a,n;if(Nu(e[0])||Array.isArray(e[0])?([s,a,n]=e,t=hp):[t,s,a,n]=e,!t)return Rl;Array.isArray(s)||(s=[s]),Array.isArray(a)||(a=[a]);const r=[],o=()=>{r.forEach(v=>v()),r.length=0},u=(v,c,b,w)=>(v.addEventListener(c,b,w),()=>v.removeEventListener(c,b,w)),_=Ha(()=>[fp(t),dr(n)],([v,c])=>{o(),v&&r.push(...s.flatMap(b=>a.map(w=>u(v,b,w,c))))},{immediate:!0,flush:"post"}),l=()=>{_(),o()};return xl(l),l}const e1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t1="__vueuse_ssr_handlers__";e1[t1]=e1[t1]||{};function Fu(e){const t=window.getComputedStyle(e);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&e.clientHeight<e.scrollHeight||t.overflowY==="auto"&&e.clientWidth<e.scrollWidth)return!0;{const s=e.parentNode;return!s||s.tagName==="BODY"?!1:Fu(s)}}function _p(e){const t=e||window.event,s=t.target;return Fu(s)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}function pp(e,t=!1){const s=ui(t);let a=null,n;Ha(np(e),u=>{if(u){const _=u;n=_.style.overflow,s.value&&(_.style.overflow="hidden")}},{immediate:!0});const r=()=>{const u=dr(e);!u||s.value||(Do&&(a=vp(u,"touchmove",_=>{_p(_)},{passive:!1})),u.style.overflow="hidden",s.value=!0)},o=()=>{const u=dr(e);!u||!s.value||(Do&&a?.(),u.style.overflow=n,s.value=!1)};return xl(o),cl({get(){return s.value},set(u){u?r():o()}})}const gp=()=>{let e=!1;const t=ui(!1);return(s,a)=>{if(t.value=a.value,e)return;e=!0;const n=pp(s,a.value);Ha(t,r=>n.value=r)}};gp();const bp={name:"EmojiPickerContainer",components:{SvgIcon:zt,OnClickOutside:mp},props:{emojiOpened:{type:Boolean,default:!1},emojiReaction:{type:Boolean,default:!1},positionTop:{type:Boolean,default:!1},positionRight:{type:Boolean,default:!1},messageId:{type:String,default:""},emojiDataSource:{type:String,default:void 0},teleportTarget:{type:Object,default:void 0}},emits:["add-emoji","open-emoji","close-emoji"],data(){return{emojiPickerHeight:320,emojiPickerTop:0,emojiPickerRight:""}},watch:{emojiOpened(e){e&&setTimeout(()=>{this.addCustomStyling(),this.$refs.emojiPicker.shadowRoot.addEventListener("emoji-click",({detail:t})=>{this.$emit("add-emoji",{unicode:t.unicode})})},0)}},methods:{addCustomStyling(){const e=`.picker {
				border: none;
			}`,t=`.nav {
				overflow-x: auto;
			}`,s=`.search-wrapper {
				padding-right: 2px;
				padding-left: 2px;
			}`,a=`input.search {
				height: 32px;
				font-size: 14px;
				border-radius: 10rem;
				border: var(--chat-border-style);
				padding: 5px 10px;
				outline: none;
				background: var(--chat-bg-color-input);
				color: var(--chat-color);
			}`,n=document.createElement("style");n.textContent=e+t+s+a,this.$refs.emojiPicker.shadowRoot.appendChild(n)},openEmoji(e){this.$emit("open-emoji",!this.emojiOpened),this.setEmojiPickerPosition(e.clientY,e.view.innerWidth,e.view.innerHeight)},closeEmoji(){this.$emit("open-emoji",!1)},setEmojiPickerPosition(e,t,s){const a=t<500||s<700,n=Bu(this.$el,"#room-footer");if(!n){a&&(this.emojiPickerRight="-50px");return}a?(this.emojiPickerRight=t/2-(this.positionTop?200:150)+"px",this.emojiPickerTop=100,this.emojiPickerHeight=s-200):(n.getBoundingClientRect().top-e>this.emojiPickerHeight-50?this.emojiPickerTop=e+10:this.emojiPickerTop=e-this.emojiPickerHeight-10,this.emojiPickerRight=this.positionTop?"0px":this.positionRight?"60px":"")}}},yp={class:"vac-emoji-wrapper"};function wp(e,t,s,a,n,r){const o=Ge("svg-icon"),u=Ge("emoji-picker"),_=Ge("OnClickOutside");return J(),ce("div",yp,[pe("div",{class:nt(["vac-svg-button",{"vac-emoji-reaction":s.emojiReaction}]),onClick:t[0]||(t[0]=(...l)=>r.openEmoji&&r.openEmoji(...l))},[Le(e.$slots,s.messageId?"emoji-picker-reaction-icon_"+s.messageId:"emoji-picker-icon",{},()=>[Ie(o,{name:"emoji",param:s.emojiReaction?"reaction":""},null,8,["param"])])],2),s.emojiOpened?(J(),ce(dt,{key:0},[s.teleportTarget?(J(),ft(af,{key:0,to:s.teleportTarget},[Ie(Nt,{name:"vac-slide-up",appear:""},{default:Ke(()=>[Ie(_,{onTrigger:r.closeEmoji},{default:Ke(()=>[pe("div",{class:nt(["vac-emoji-picker",{"vac-picker-reaction":s.emojiReaction}]),style:At({height:`${n.emojiPickerHeight}px`,top:s.positionTop?n.emojiPickerHeight:`${n.emojiPickerTop}px`,right:n.emojiPickerRight,display:n.emojiPickerTop||!s.emojiReaction?"initial":"none"})},[s.emojiOpened?(J(),ft(u,{key:0,ref:"emojiPicker","data-source":s.emojiDataSource},null,8,["data-source"])):xe("",!0)],6)]),_:1},8,["onTrigger"])]),_:1})],8,["to"])):(J(),ft(Nt,{key:1,name:"vac-slide-up",appear:""},{default:Ke(()=>[Ie(_,{onTrigger:r.closeEmoji},{default:Ke(()=>[pe("div",{class:nt(["vac-emoji-picker",{"vac-picker-reaction":s.emojiReaction}]),style:At({height:`${n.emojiPickerHeight}px`,top:s.positionTop?n.emojiPickerHeight:`${n.emojiPickerTop}px`,right:n.emojiPickerRight,display:n.emojiPickerTop||!s.emojiReaction?"initial":"none"})},[s.emojiOpened?(J(),ft(u,{key:0,ref:"emojiPicker","data-source":s.emojiDataSource},null,8,["data-source"])):xe("",!0)],6)]),_:1},8,["onTrigger"])]),_:1}))],64)):xe("",!0)])}var Hu=Tt(bp,[["render",wp]]);const Sp={name:"RoomFiles",components:{Loader:yi,SvgIcon:zt},props:{file:{type:Object,required:!0},index:{type:Number,required:!0}},emits:["remove-file"],computed:{isImage(){return cr(this.file)},isVideo(){return _n(this.file)}}},Ep={class:"vac-room-file-container"},Mp=["src"],Ap={class:"vac-text-ellipsis"},Tp={key:0,class:"vac-text-ellipsis vac-text-extension"};function kp(e,t,s,a,n,r){const o=Ge("loader"),u=Ge("svg-icon");return J(),ce("div",Ep,[Ie(o,{show:s.file.loading,type:"room-file"},wt({_:2},[rt(e.$slots,(_,l)=>({name:l,fn:Ke(v=>[Le(e.$slots,l,yt(pt(v)))])}))]),1032,["show"]),pe("div",{class:"vac-svg-button vac-icon-remove",onClick:t[0]||(t[0]=_=>e.$emit("remove-file",s.index))},[Le(e.$slots,"image-close-icon",{},()=>[Ie(u,{name:"close",param:"image"})])]),r.isImage?(J(),ce("div",{key:0,class:nt(["vac-message-image",{"vac-blur-loading":s.file.loading}]),style:At({"background-image":`url('${s.file.localUrl||s.file.url}')`})},null,6)):r.isVideo?(J(),ce("video",{key:1,controls:"",class:nt({"vac-blur-loading":s.file.loading})},[pe("source",{src:s.file.localUrl||s.file.url},null,8,Mp)],2)):(J(),ce("div",{key:2,class:nt(["vac-file-container",{"vac-blur-loading":s.file.loading}])},[pe("div",null,[Le(e.$slots,"file-icon",{},()=>[Ie(u,{name:"file"})])]),pe("div",Ap,et(s.file.name),1),s.file.extension?(J(),ce("div",Tp,et(s.file.extension),1)):xe("",!0)],2))])}var Rp=Tt(Sp,[["render",kp]]);const xp={name:"RoomFiles",components:{SvgIcon:zt,RoomFile:Rp},props:{files:{type:Array,required:!0}},emits:["remove-file","reset-message"],computed:{}},Op={key:0,class:"vac-room-files-container"},Ip={class:"vac-files-box"},Cp={class:"vac-icon-close"};function Lp(e,t,s,a,n,r){const o=Ge("room-file"),u=Ge("svg-icon");return J(),ft(Nt,{name:"vac-slide-up"},{default:Ke(()=>[s.files.length?(J(),ce("div",Op,[pe("div",Ip,[(J(!0),ce(dt,null,rt(s.files,(_,l)=>(J(),ce("div",{key:l},[Ie(o,{file:_,index:l,onRemoveFile:t[0]||(t[0]=v=>e.$emit("remove-file",v))},wt({_:2},[rt(e.$slots,(v,c)=>({name:c,fn:Ke(b=>[Le(e.$slots,c,yt(pt(b)))])}))]),1032,["file","index"])]))),128))]),pe("div",Cp,[pe("div",{class:"vac-svg-button",onClick:t[1]||(t[1]=_=>e.$emit("reset-message"))},[Le(e.$slots,"files-close-icon",{},()=>[Ie(u,{name:"close-outline"})])])])])):xe("",!0)]),_:3})}var Bp=Tt(xp,[["render",Lp]]);const Np={props:{percentage:{type:Number,default:0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","change-linehead"],data(){return{isMouseDown:!1}},methods:{onMouseDown(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!0;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},onMouseUp(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!1,document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove);const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},onMouseMove(e){if(this.messageSelectionEnabled)return;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},calculateLineHeadPosition(e,t){const s=t.getBoundingClientRect().width,a=t.getBoundingClientRect().left;let n=(e.clientX-a)/s;return n=n<0?0:n,n=n>1?1:n,n}}},jp={class:"vac-player-progress"},Fp={class:"vac-line-container"};function Hp(e,t,s,a,n,r){return J(),ce("div",{ref:"progress",class:"vac-player-bar",onMousedown:t[0]||(t[0]=(...o)=>r.onMouseDown&&r.onMouseDown(...o)),onMouseover:t[1]||(t[1]=o=>e.$emit("hover-audio-progress",!0)),onMouseout:t[2]||(t[2]=o=>e.$emit("hover-audio-progress",!1))},[pe("div",jp,[pe("div",Fp,[pe("div",{class:"vac-line-progress",style:At({width:`${s.percentage}%`})},null,4),pe("div",{class:nt(["vac-line-dot",{"vac-line-dot__active":n.isMouseDown}]),style:At({left:`${s.percentage}%`})},null,6)])])],544)}var Pp=Tt(Np,[["render",Hp]]);const Dp={name:"AudioPlayer",components:{SvgIcon:zt,AudioControl:Pp},props:{messageId:{type:[String,Number],default:null},src:{type:String,default:null},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","update-progress-time"],data(){return{isPlaying:!1,duration:this.convertTimeMMSS(0),playedTime:this.convertTimeMMSS(0),progress:0}},computed:{playerUniqId(){return`audio-player${this.messageId}`},audioSource(){return this.src?this.src:(this.resetProgress(),null)}},mounted(){this.player=this.$el.querySelector("#"+this.playerUniqId),this.player.addEventListener("ended",()=>{this.isPlaying=!1}),this.player.addEventListener("loadeddata",()=>{this.resetProgress(),this.duration=this.convertTimeMMSS(this.player.duration),this.updateProgressTime()}),this.player.addEventListener("timeupdate",this.onTimeUpdate)},methods:{convertTimeMMSS(e){return new Date(e*1e3).toISOString().substr(14,5)},playback(){this.messageSelectionEnabled||!this.audioSource||(this.isPlaying?this.player.pause():setTimeout(()=>this.player.play()),this.isPlaying=!this.isPlaying)},resetProgress(){this.isPlaying&&this.player.pause(),this.duration=this.convertTimeMMSS(0),this.playedTime=this.convertTimeMMSS(0),this.progress=0,this.isPlaying=!1,this.updateProgressTime()},onTimeUpdate(){this.playedTime=this.convertTimeMMSS(this.player.currentTime),this.progress=this.player.currentTime/this.player.duration*100,this.updateProgressTime()},onUpdateProgress(e){e&&(this.player.currentTime=e*this.player.duration)},updateProgressTime(){this.$emit("update-progress-time",this.progress>1?this.playedTime:this.duration)}}},Up={class:"vac-audio-player"},qp=["id","src"];function Vp(e,t,s,a,n,r){const o=Ge("svg-icon"),u=Ge("audio-control");return J(),ce("div",null,[pe("div",Up,[pe("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=(..._)=>r.playback&&r.playback(..._))},[n.isPlaying?Le(e.$slots,"audio-pause-icon_"+s.messageId,{key:0},()=>[Ie(o,{name:"audio-pause"})]):Le(e.$slots,"audio-play-icon_"+s.messageId,{key:1},()=>[Ie(o,{name:"audio-play"})])]),Ie(u,{percentage:n.progress,"message-selection-enabled":s.messageSelectionEnabled,onChangeLinehead:r.onUpdateProgress,onHoverAudioProgress:t[1]||(t[1]=_=>e.$emit("hover-audio-progress",_))},null,8,["percentage","message-selection-enabled","onChangeLinehead"]),pe("audio",{id:r.playerUniqId,src:r.audioSource},null,8,qp)])])}var Ol=Tt(Dp,[["render",Vp]]);const zp={name:"RoomMessageReply",components:{SvgIcon:zt,FormatMessage:vn,AudioPlayer:Ol},props:{room:{type:Object,required:!0},messageReply:{type:Object,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["reset-message"],computed:{firstFile(){var e,t;return(t=(e=this.messageReply)==null?void 0:e.files)!=null&&t.length?this.messageReply.files[0]:{}},isImage(){return cr(this.firstFile)},isVideo(){return _n(this.firstFile)},isAudio(){return Oi(this.firstFile)},isOtherFile(){var e,t;return((t=(e=this.messageReply)==null?void 0:e.files)==null?void 0:t.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},Yp={key:0,class:"vac-reply-container"},Xp={class:"vac-reply-box"},Kp={class:"vac-reply-info"},Gp={class:"vac-reply-username"},Wp={class:"vac-reply-content"},Zp=["src"],Qp={key:1,controls:"",class:"vac-image-reply"},Jp=["src"],$p={key:3,class:"vac-image-reply vac-file-container"},e3={class:"vac-text-ellipsis"},t3={key:0,class:"vac-text-ellipsis vac-text-extension"},s3={class:"vac-icon-reply"};function a3(e,t,s,a,n,r){const o=Ge("format-message"),u=Ge("audio-player"),_=Ge("svg-icon");return J(),ft(Nt,{name:"vac-slide-up"},{default:Ke(()=>[s.messageReply?(J(),ce("div",Yp,[pe("div",Xp,[pe("div",Kp,[pe("div",Gp,et(s.messageReply.username),1),pe("div",Wp,[Ie(o,{"message-id":s.messageReply._id,content:s.messageReply.content,users:s.room.users,"text-formatting":s.textFormatting,"link-options":s.linkOptions,reply:!0},null,8,["message-id","content","users","text-formatting","link-options"])])]),r.isImage?(J(),ce("img",{key:0,src:r.firstFile.url,class:"vac-image-reply"},null,8,Zp)):r.isVideo?(J(),ce("video",Qp,[pe("source",{src:r.firstFile.url},null,8,Jp)])):r.isAudio?(J(),ft(u,{key:2,src:r.firstFile.url,"message-selection-enabled":!1,class:"vac-audio-reply"},wt({_:2},[rt(e.$slots,(l,v)=>({name:v,fn:Ke(c=>[Le(e.$slots,v,yt(pt(c)))])}))]),1032,["src"])):r.isOtherFile?(J(),ce("div",$p,[pe("div",null,[Le(e.$slots,"file-icon",{},()=>[Ie(_,{name:"file"})])]),pe("div",e3,et(r.firstFile.name),1),r.firstFile.extension?(J(),ce("div",t3,et(r.firstFile.extension),1)):xe("",!0)])):xe("",!0)]),pe("div",s3,[pe("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=l=>e.$emit("reset-message"))},[Le(e.$slots,"reply-close-icon",{},()=>[Ie(_,{name:"close-outline"})])])])])):xe("",!0)]),_:3})}var r3=Tt(zp,[["render",a3]]);const n3={name:"RoomUsersTag",props:{filteredUsersTag:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-user-tag","activate-item"],data(){return{activeItem:null}},watch:{filteredUsersTag(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-user-tag",this.filteredUsersTag[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredUsersTag.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},i3={key:0,class:"vac-tags-container"},o3=["onMouseover","onClick"],l3={class:"vac-tags-info"},c3={class:"vac-tags-username"};function u3(e,t,s,a,n,r){return J(),ft(Nt,{name:"vac-slide-up"},{default:Ke(()=>[s.filteredUsersTag.length?(J(),ce("div",i3,[(J(!0),ce(dt,null,rt(s.filteredUsersTag,(o,u)=>(J(),ce("div",{key:o._id,class:nt(["vac-tags-box",{"vac-tags-box-active":u===n.activeItem}]),onMouseover:_=>n.activeItem=u,onClick:_=>e.$emit("select-user-tag",o)},[pe("div",l3,[o.avatar?(J(),ce("div",{key:0,class:"vac-avatar vac-tags-avatar",style:At({"background-image":`url('${o.avatar}')`})},null,4)):xe("",!0),pe("div",c3,et(o.username),1)])],42,o3))),128))])):xe("",!0)]),_:1})}var d3=Tt(n3,[["render",u3]]);const m3={name:"RoomEmojis",props:{filteredEmojis:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-emoji","activate-item"],data(){return{activeItem:null}},watch:{filteredEmojis(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-emoji",this.filteredEmojis[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredEmojis.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},f3={key:0,class:"vac-emojis-container"},h3=["onMouseover","onClick"];function v3(e,t,s,a,n,r){return J(),ft(Nt,{name:"vac-slide-up"},{default:Ke(()=>[s.filteredEmojis.length?(J(),ce("div",f3,[(J(!0),ce(dt,null,rt(s.filteredEmojis,(o,u)=>(J(),ce("div",{key:o,class:nt(["vac-emoji-element",{"vac-emoji-element-active":u===n.activeItem}]),onMouseover:_=>n.activeItem=u,onClick:_=>e.$emit("select-emoji",o)},et(o),43,h3))),128))])):xe("",!0)]),_:1})}var _3=Tt(m3,[["render",v3]]);const p3={name:"RoomTemplatesText",props:{filteredTemplatesText:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-template-text","activate-item"],data(){return{activeItem:null}},watch:{filteredTemplatesText(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-template-text",this.filteredTemplatesText[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredTemplatesText.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},g3={key:0,class:"vac-template-container vac-app-box-shadow"},b3=["onMouseover","onClick"],y3={class:"vac-template-info"},w3={class:"vac-template-tag"},S3={class:"vac-template-text"};function E3(e,t,s,a,n,r){return J(),ft(Nt,{name:"vac-slide-up"},{default:Ke(()=>[s.filteredTemplatesText.length?(J(),ce("div",g3,[(J(!0),ce(dt,null,rt(s.filteredTemplatesText,(o,u)=>(J(),ce("div",{key:u,class:nt(["vac-template-box",{"vac-template-active":u===n.activeItem}]),onMouseover:_=>n.activeItem=u,onClick:_=>e.$emit("select-template-text",o)},[pe("div",y3,[pe("div",w3," /"+et(o.tag),1),pe("div",S3,et(o.text),1)])],42,b3))),128))])):xe("",!0)]),_:1})}var M3=Tt(p3,[["render",E3]]);function A3(e){return new Int8Array(e)}function Pu(e){return new Int16Array(e)}function Du(e){return new Int32Array(e)}function Uu(e){return new Float32Array(e)}function T3(e){return new Float64Array(e)}function qu(e){if(e.length==1)return Uu(e[0]);var t=e[0];e=e.slice(1);for(var s=[],a=0;a<t;a++)s.push(qu(e));return s}function Vu(e){if(e.length==1)return Du(e[0]);var t=e[0];e=e.slice(1);for(var s=[],a=0;a<t;a++)s.push(Vu(e));return s}function zu(e){if(e.length==1)return Pu(e[0]);var t=e[0];e=e.slice(1);for(var s=[],a=0;a<t;a++)s.push(zu(e));return s}function Yu(e){if(e.length==1)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var s=[],a=0;a<t;a++)s.push(Yu(e));return s}var Xu={};Xu.fill=function(e,t,s,a){if(arguments.length==2)for(var n=0;n<e.length;n++)e[n]=arguments[1];else for(var n=t;n<s;n++)e[n]=a};var gn={};gn.arraycopy=function(e,t,s,a,n){for(var r=t+n;t<r;)s[a++]=e[t++]};gn.out={};gn.out.println=function(e){console.log(e)};gn.out.printf=function(){console.log.apply(console,arguments)};var Ii={};Ii.SQRT2=1.4142135623730951;Ii.FAST_LOG10=function(e){return Math.log10(e)};Ii.FAST_LOG10_X=function(e,t){return Math.log10(e)*t};function Gs(e){this.ordinal=e}Gs.short_block_allowed=new Gs(0);Gs.short_block_coupled=new Gs(1);Gs.short_block_dispensed=new Gs(2);Gs.short_block_forced=new Gs(3);var Ku={};Ku.MAX_VALUE=34028235e31;function hs(e){this.ordinal=e}hs.vbr_off=new hs(0);hs.vbr_mt=new hs(1);hs.vbr_rh=new hs(2);hs.vbr_abr=new hs(3);hs.vbr_mtrh=new hs(4);hs.vbr_default=hs.vbr_mtrh;var k3=function(e){},Oe={System:gn,VbrMode:hs,Float:Ku,ShortBlock:Gs,Util:Ii,Arrays:Xu,new_array_n:Yu,new_byte:A3,new_double:T3,new_float:Uu,new_float_n:qu,new_int:Du,new_int_n:Vu,new_short:Pu,new_short_n:zu,assert:k3},R3=Oe.System,Lt=Oe.Util,x3=Oe.Arrays,O3=Oe.new_float;function I3(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*Lt.SQRT2*.5/2384e-9,.017876148*Lt.SQRT2*.5/2384e-9,.003134727*Lt.SQRT2*.5/2384e-9,.002457142*Lt.SQRT2*.5/2384e-9,971317e-9*Lt.SQRT2*.5/2384e-9,218868e-9*Lt.SQRT2*.5/2384e-9,101566e-9*Lt.SQRT2*.5/2384e-9,13828e-9*Lt.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],t=12,s=36,a=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],n=a[O.SHORT_TYPE],r=a[O.SHORT_TYPE],o=a[O.SHORT_TYPE],u=a[O.SHORT_TYPE],_=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function l(b,w,i){for(var F=10,B=w+238-14-286,N=-15;N<0;N++){var f,R,C;f=e[F+-10],R=b[B+-224]*f,C=b[w+224]*f,f=e[F+-9],R+=b[B+-160]*f,C+=b[w+160]*f,f=e[F+-8],R+=b[B+-96]*f,C+=b[w+96]*f,f=e[F+-7],R+=b[B+-32]*f,C+=b[w+32]*f,f=e[F+-6],R+=b[B+32]*f,C+=b[w+-32]*f,f=e[F+-5],R+=b[B+96]*f,C+=b[w+-96]*f,f=e[F+-4],R+=b[B+160]*f,C+=b[w+-160]*f,f=e[F+-3],R+=b[B+224]*f,C+=b[w+-224]*f,f=e[F+-2],R+=b[w+-256]*f,C-=b[B+256]*f,f=e[F+-1],R+=b[w+-192]*f,C-=b[B+192]*f,f=e[F+0],R+=b[w+-128]*f,C-=b[B+128]*f,f=e[F+1],R+=b[w+-64]*f,C-=b[B+64]*f,f=e[F+2],R+=b[w+0]*f,C-=b[B+0]*f,f=e[F+3],R+=b[w+64]*f,C-=b[B+-64]*f,f=e[F+4],R+=b[w+128]*f,C-=b[B+-128]*f,f=e[F+5],R+=b[w+192]*f,C-=b[B+-192]*f,R*=e[F+6],f=C-R,i[30+N*2]=C+R,i[31+N*2]=e[F+7]*f,F+=18,w--,B++}{var R,C,k,L;C=b[w+-16]*e[F+-10],R=b[w+-32]*e[F+-2],C+=(b[w+-48]-b[w+16])*e[F+-9],R+=b[w+-96]*e[F+-1],C+=(b[w+-80]+b[w+48])*e[F+-8],R+=b[w+-160]*e[F+0],C+=(b[w+-112]-b[w+80])*e[F+-7],R+=b[w+-224]*e[F+1],C+=(b[w+-144]+b[w+112])*e[F+-6],R-=b[w+32]*e[F+2],C+=(b[w+-176]-b[w+144])*e[F+-5],R-=b[w+96]*e[F+3],C+=(b[w+-208]+b[w+176])*e[F+-4],R-=b[w+160]*e[F+4],C+=(b[w+-240]-b[w+208])*e[F+-3],R-=b[w+224],k=R-C,L=R+C,C=i[14],R=i[15]-C,i[31]=L+C,i[30]=k+R,i[15]=k-R,i[14]=L-C}{var m;m=i[28]-i[0],i[0]+=i[28],i[28]=m*e[F+-2*18+7],m=i[29]-i[1],i[1]+=i[29],i[29]=m*e[F+-2*18+7],m=i[26]-i[2],i[2]+=i[26],i[26]=m*e[F+-4*18+7],m=i[27]-i[3],i[3]+=i[27],i[27]=m*e[F+-4*18+7],m=i[24]-i[4],i[4]+=i[24],i[24]=m*e[F+-6*18+7],m=i[25]-i[5],i[5]+=i[25],i[25]=m*e[F+-6*18+7],m=i[22]-i[6],i[6]+=i[22],i[22]=m*Lt.SQRT2,m=i[23]-i[7],i[7]+=i[23],i[23]=m*Lt.SQRT2-i[7],i[7]-=i[6],i[22]-=i[7],i[23]-=i[22],m=i[6],i[6]=i[31]-m,i[31]=i[31]+m,m=i[7],i[7]=i[30]-m,i[30]=i[30]+m,m=i[22],i[22]=i[15]-m,i[15]=i[15]+m,m=i[23],i[23]=i[14]-m,i[14]=i[14]+m,m=i[20]-i[8],i[8]+=i[20],i[20]=m*e[F+-10*18+7],m=i[21]-i[9],i[9]+=i[21],i[21]=m*e[F+-10*18+7],m=i[18]-i[10],i[10]+=i[18],i[18]=m*e[F+-12*18+7],m=i[19]-i[11],i[11]+=i[19],i[19]=m*e[F+-12*18+7],m=i[16]-i[12],i[12]+=i[16],i[16]=m*e[F+-14*18+7],m=i[17]-i[13],i[13]+=i[17],i[17]=m*e[F+-14*18+7],m=-i[20]+i[24],i[20]+=i[24],i[24]=m*e[F+-12*18+7],m=-i[21]+i[25],i[21]+=i[25],i[25]=m*e[F+-12*18+7],m=i[4]-i[8],i[4]+=i[8],i[8]=m*e[F+-12*18+7],m=i[5]-i[9],i[5]+=i[9],i[9]=m*e[F+-12*18+7],m=i[0]-i[12],i[0]+=i[12],i[12]=m*e[F+-4*18+7],m=i[1]-i[13],i[1]+=i[13],i[13]=m*e[F+-4*18+7],m=i[16]-i[28],i[16]+=i[28],i[28]=m*e[F+-4*18+7],m=-i[17]+i[29],i[17]+=i[29],i[29]=m*e[F+-4*18+7],m=Lt.SQRT2*(i[2]-i[10]),i[2]+=i[10],i[10]=m,m=Lt.SQRT2*(i[3]-i[11]),i[3]+=i[11],i[11]=m,m=Lt.SQRT2*(-i[18]+i[26]),i[18]+=i[26],i[26]=m-i[18],m=Lt.SQRT2*(-i[19]+i[27]),i[19]+=i[27],i[27]=m-i[19],m=i[2],i[19]-=i[3],i[3]-=m,i[2]=i[31]-m,i[31]+=m,m=i[3],i[11]-=i[19],i[18]-=m,i[3]=i[30]-m,i[30]+=m,m=i[18],i[27]-=i[11],i[19]-=m,i[18]=i[15]-m,i[15]+=m,m=i[19],i[10]-=m,i[19]=i[14]-m,i[14]+=m,m=i[10],i[11]-=m,i[10]=i[23]-m,i[23]+=m,m=i[11],i[26]-=m,i[11]=i[22]-m,i[22]+=m,m=i[26],i[27]-=m,i[26]=i[7]-m,i[7]+=m,m=i[27],i[27]=i[6]-m,i[6]+=m,m=Lt.SQRT2*(i[0]-i[4]),i[0]+=i[4],i[4]=m,m=Lt.SQRT2*(i[1]-i[5]),i[1]+=i[5],i[5]=m,m=Lt.SQRT2*(i[16]-i[20]),i[16]+=i[20],i[20]=m,m=Lt.SQRT2*(i[17]-i[21]),i[17]+=i[21],i[21]=m,m=-Lt.SQRT2*(i[8]-i[12]),i[8]+=i[12],i[12]=m-i[8],m=-Lt.SQRT2*(i[9]-i[13]),i[9]+=i[13],i[13]=m-i[9],m=-Lt.SQRT2*(i[25]-i[29]),i[25]+=i[29],i[29]=m-i[25],m=-Lt.SQRT2*(i[24]+i[28]),i[24]-=i[28],i[28]=m-i[24],m=i[24]-i[16],i[24]=m,m=i[20]-m,i[20]=m,m=i[28]-m,i[28]=m,m=i[25]-i[17],i[25]=m,m=i[21]-m,i[21]=m,m=i[29]-m,i[29]=m,m=i[17]-i[1],i[17]=m,m=i[9]-m,i[9]=m,m=i[25]-m,i[25]=m,m=i[5]-m,i[5]=m,m=i[21]-m,i[21]=m,m=i[13]-m,i[13]=m,m=i[29]-m,i[29]=m,m=i[1]-i[0],i[1]=m,m=i[16]-m,i[16]=m,m=i[17]-m,i[17]=m,m=i[8]-m,i[8]=m,m=i[9]-m,i[9]=m,m=i[24]-m,i[24]=m,m=i[25]-m,i[25]=m,m=i[4]-m,i[4]=m,m=i[5]-m,i[5]=m,m=i[20]-m,i[20]=m,m=i[21]-m,i[21]=m,m=i[12]-m,i[12]=m,m=i[13]-m,i[13]=m,m=i[28]-m,i[28]=m,m=i[29]-m,i[29]=m,m=i[0],i[0]+=i[31],i[31]-=m,m=i[1],i[1]+=i[30],i[30]-=m,m=i[16],i[16]+=i[15],i[15]-=m,m=i[17],i[17]+=i[14],i[14]-=m,m=i[8],i[8]+=i[23],i[23]-=m,m=i[9],i[9]+=i[22],i[22]-=m,m=i[24],i[24]+=i[7],i[7]-=m,m=i[25],i[25]+=i[6],i[6]-=m,m=i[4],i[4]+=i[27],i[27]-=m,m=i[5],i[5]+=i[26],i[26]-=m,m=i[20],i[20]+=i[11],i[11]-=m,m=i[21],i[21]+=i[10],i[10]-=m,m=i[12],i[12]+=i[19],i[19]-=m,m=i[13],i[13]+=i[18],i[18]-=m,m=i[28],i[28]+=i[3],i[3]-=m,m=i[29],i[29]+=i[2],i[2]-=m}}function v(b,w){for(var i=0;i<3;i++){var F,B,N,f,R,C;f=b[w+2*3]*a[O.SHORT_TYPE][0]-b[w+5*3],F=b[w+0*3]*a[O.SHORT_TYPE][2]-b[w+3*3],B=f+F,N=f-F,f=b[w+5*3]*a[O.SHORT_TYPE][0]+b[w+2*3],F=b[w+3*3]*a[O.SHORT_TYPE][2]+b[w+0*3],R=f+F,C=-f+F,F=(b[w+1*3]*a[O.SHORT_TYPE][1]-b[w+4*3])*2069978111953089e-26,f=(b[w+4*3]*a[O.SHORT_TYPE][1]+b[w+1*3])*2069978111953089e-26,b[w+3*0]=B*190752519173728e-25+F,b[w+3*5]=-R*190752519173728e-25+f,N=N*.8660254037844387*1907525191737281e-26,R=R*.5*1907525191737281e-26+f,b[w+3*1]=N-R,b[w+3*2]=N+R,B=B*.5*1907525191737281e-26-F,C=C*.8660254037844387*1907525191737281e-26,b[w+3*3]=B+C,b[w+3*4]=B-C,w++}}function c(b,w,i){var F,B;{var N,f,R,C,k,L,m,T;N=i[17]-i[9],R=i[15]-i[11],C=i[14]-i[12],k=i[0]+i[8],L=i[1]+i[7],m=i[2]+i[6],T=i[3]+i[5],b[w+17]=k+m-T-(L-i[4]),B=(k+m-T)*r[19]+(L-i[4]),F=(N-R-C)*r[18],b[w+5]=F+B,b[w+6]=F-B,f=(i[16]-i[10])*r[18],L=L*r[19]+i[4],F=N*r[12]+f+R*r[13]+C*r[14],B=-k*r[16]+L-m*r[17]+T*r[15],b[w+1]=F+B,b[w+2]=F-B,F=N*r[13]-f-R*r[14]+C*r[12],B=-k*r[17]+L-m*r[15]+T*r[16],b[w+9]=F+B,b[w+10]=F-B,F=N*r[14]-f+R*r[12]-C*r[13],B=k*r[15]-L+m*r[16]-T*r[17],b[w+13]=F+B,b[w+14]=F-B}{var E,h,y,g,p,M,S,j;E=i[8]-i[0],y=i[6]-i[2],g=i[5]-i[3],p=i[17]+i[9],M=i[16]+i[10],S=i[15]+i[11],j=i[14]+i[12],b[w+0]=p+S+j+(M+i[13]),F=(p+S+j)*r[19]-(M+i[13]),B=(E-y+g)*r[18],b[w+11]=F+B,b[w+12]=F-B,h=(i[7]-i[1])*r[18],M=i[13]-M*r[19],F=p*r[15]-M+S*r[16]+j*r[17],B=E*r[14]+h+y*r[12]+g*r[13],b[w+3]=F+B,b[w+4]=F-B,F=-p*r[17]+M-S*r[15]-j*r[16],B=E*r[13]+h-y*r[14]-g*r[12],b[w+7]=F+B,b[w+8]=F-B,F=-p*r[16]+M-S*r[17]-j*r[15],B=E*r[12]-h+y*r[13]-g*r[14],b[w+15]=F+B,b[w+16]=F-B}}this.mdct_sub48=function(b,w,i){for(var F=w,B=286,N=0;N<b.channels_out;N++){for(var f=0;f<b.mode_gr;f++){for(var R,C=b.l3_side.tt[f][N],k=C.xr,L=0,m=b.sb_sample[N][1-f],T=0,E=0;E<18/2;E++)for(l(F,B,m[T]),l(F,B+32,m[T+1]),T+=2,B+=64,R=1;R<32;R+=2)m[T-1][R]*=-1;for(R=0;R<32;R++,L+=18){var h=C.block_type,y=b.sb_sample[N][f],g=b.sb_sample[N][1-f];if(C.mixed_block_flag!=0&&R<2&&(h=0),b.amp_filter[R]<1e-12)x3.fill(k,L+0,L+18,0);else{if(b.amp_filter[R]<1)for(var E=0;E<18;E++)g[E][_[R]]*=b.amp_filter[R];if(h==O.SHORT_TYPE){for(var E=-t/4;E<0;E++){var p=a[O.SHORT_TYPE][E+3];k[L+E*3+9]=y[9+E][_[R]]*p-y[8-E][_[R]],k[L+E*3+18]=y[14-E][_[R]]*p+y[15+E][_[R]],k[L+E*3+10]=y[15+E][_[R]]*p-y[14-E][_[R]],k[L+E*3+19]=g[2-E][_[R]]*p+g[3+E][_[R]],k[L+E*3+11]=g[3+E][_[R]]*p-g[2-E][_[R]],k[L+E*3+20]=g[8-E][_[R]]*p+g[9+E][_[R]]}v(k,L)}else{for(var M=O3(18),E=-s/4;E<0;E++){var S,j;S=a[h][E+27]*g[E+9][_[R]]+a[h][E+36]*g[8-E][_[R]],j=a[h][E+9]*y[E+9][_[R]]-a[h][E+18]*y[8-E][_[R]],M[E+9]=S-j*n[3+E+9],M[E+18]=S*n[3+E+9]+j}c(k,L,M)}}if(h!=O.SHORT_TYPE&&R!=0)for(var E=7;E>=0;--E){var X,D;X=k[L+E]*o[20+E]+k[L+-1-E]*u[28+E],D=k[L+E]*u[28+E]-k[L+-1-E]*o[20+E],k[L+-1-E]=X,k[L+E]=D}}}if(F=i,B=286,b.mode_gr==1)for(var V=0;V<18;V++)R3.arraycopy(b.sb_sample[N][1][V],0,b.sb_sample[N][0][V],0,32)}}}var C3=Oe.System,L3=Oe.new_float,B3=Oe.new_float_n;function ai(){this.l=L3(O.SBMAX_l),this.s=B3([O.SBMAX_s,3]);var e=this;this.assign=function(t){C3.arraycopy(t.l,0,e.l,0,O.SBMAX_l);for(var s=0;s<O.SBMAX_s;s++)for(var a=0;a<3;a++)e.s[s][a]=t.s[s][a]}}function ta(){this.thm=new ai,this.en=new ai}function vt(e){var t=e;this.ordinal=function(){return t}}vt.STEREO=new vt(0);vt.JOINT_STEREO=new vt(1);vt.DUAL_CHANNEL=new vt(2);vt.MONO=new vt(3);vt.NOT_SET=new vt(4);var s1=Oe.System,Bn=Oe.VbrMode,a1=Oe.new_array_n,r1=Oe.new_float,N3=Oe.new_float_n,j3=Oe.new_int,Nn=Oe.assert;O.ENCDELAY=576;O.POSTDELAY=1152;O.MDCTDELAY=48;O.FFTOFFSET=224+O.MDCTDELAY;O.DECDELAY=528;O.SBLIMIT=32;O.CBANDS=64;O.SBPSY_l=21;O.SBPSY_s=12;O.SBMAX_l=22;O.SBMAX_s=13;O.PSFB21=6;O.PSFB12=6;O.BLKSIZE=1024;O.HBLKSIZE=O.BLKSIZE/2+1;O.BLKSIZE_s=256;O.HBLKSIZE_s=O.BLKSIZE_s/2+1;O.NORM_TYPE=0;O.START_TYPE=1;O.SHORT_TYPE=2;O.STOP_TYPE=3;O.MPG_MD_LR_LR=0;O.MPG_MD_LR_I=1;O.MPG_MD_MS_LR=2;O.MPG_MD_MS_I=3;O.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function O(){var e=O.FFTOFFSET,t=O.MPG_MD_MS_LR,s=null;this.psy=null;var a=null,n=null,r=null;this.setModules=function(v,c,b,w){s=v,this.psy=c,a=c,n=w,r=b};var o=new I3;function u(v){var c,b;if(v.ATH.useAdjust==0){v.ATH.adjust=1;return}if(b=v.loudness_sq[0][0],c=v.loudness_sq[1][0],v.channels_out==2?(b+=v.loudness_sq[0][1],c+=v.loudness_sq[1][1]):(b+=b,c+=c),v.mode_gr==2&&(b=Math.max(b,c)),b*=.5,b*=v.ATH.aaSensitivityP,b>.03125)v.ATH.adjust>=1?v.ATH.adjust=1:v.ATH.adjust<v.ATH.adjustLimit&&(v.ATH.adjust=v.ATH.adjustLimit),v.ATH.adjustLimit=1;else{var w=31.98*b+625e-6;v.ATH.adjust>=w?(v.ATH.adjust*=w*.075+.925,v.ATH.adjust<w&&(v.ATH.adjust=w)):v.ATH.adjustLimit>=w?v.ATH.adjust=w:v.ATH.adjust<v.ATH.adjustLimit&&(v.ATH.adjust=v.ATH.adjustLimit),v.ATH.adjustLimit=w}}function _(v){var c,b;for(Nn(v.bitrate_index>=0&&v.bitrate_index<16),Nn(v.mode_ext>=0&&v.mode_ext<4),v.bitrate_stereoMode_Hist[v.bitrate_index][4]++,v.bitrate_stereoMode_Hist[15][4]++,v.channels_out==2&&(v.bitrate_stereoMode_Hist[v.bitrate_index][v.mode_ext]++,v.bitrate_stereoMode_Hist[15][v.mode_ext]++),c=0;c<v.mode_gr;++c)for(b=0;b<v.channels_out;++b){var w=v.l3_side.tt[c][b].block_type|0;v.l3_side.tt[c][b].mixed_block_flag!=0&&(w=4),v.bitrate_blockType_Hist[v.bitrate_index][w]++,v.bitrate_blockType_Hist[v.bitrate_index][5]++,v.bitrate_blockType_Hist[15][w]++,v.bitrate_blockType_Hist[15][5]++}}function l(v,c){var b=v.internal_flags,w,i;if(b.lame_encode_frame_init==0){var F,B,N=r1(2014),f=r1(2014);for(b.lame_encode_frame_init=1,F=0,B=0;F<286+576*(1+b.mode_gr);++F)F<576*b.mode_gr?(N[F]=0,b.channels_out==2&&(f[F]=0)):(N[F]=c[0][B],b.channels_out==2&&(f[F]=c[1][B]),++B);for(i=0;i<b.mode_gr;i++)for(w=0;w<b.channels_out;w++)b.l3_side.tt[i][w].block_type=O.SHORT_TYPE;o.mdct_sub48(b,N,f),Nn(b.mf_size>=O.BLKSIZE+v.framesize-O.FFTOFFSET),Nn(b.mf_size>=512+v.framesize-32)}}this.lame_encode_mp3_frame=function(v,c,b,w,i,F){var B,N=a1([2,2]);N[0][0]=new ta,N[0][1]=new ta,N[1][0]=new ta,N[1][1]=new ta;var f=a1([2,2]);f[0][0]=new ta,f[0][1]=new ta,f[1][0]=new ta,f[1][1]=new ta;var R,C=[null,null],k=v.internal_flags,L=N3([2,4]),m=[.5,.5],T=[[0,0],[0,0]],E=[[0,0],[0,0]],h,y,g;if(C[0]=c,C[1]=b,k.lame_encode_frame_init==0&&l(v,C),k.padding=0,(k.slot_lag-=k.frac_SpF)<0&&(k.slot_lag+=v.out_samplerate,k.padding=1),k.psymodel!=0){var p,M=[null,null],S=0,j=j3(2);for(g=0;g<k.mode_gr;g++){for(y=0;y<k.channels_out;y++)M[y]=C[y],S=576+g*576-O.FFTOFFSET;if(v.VBR==Bn.vbr_mtrh||v.VBR==Bn.vbr_mt?p=a.L3psycho_anal_vbr(v,M,S,g,N,f,T[g],E[g],L[g],j):p=a.L3psycho_anal_ns(v,M,S,g,N,f,T[g],E[g],L[g],j),p!=0)return-4;for(v.mode==vt.JOINT_STEREO&&(m[g]=L[g][2]+L[g][3],m[g]>0&&(m[g]=L[g][3]/m[g])),y=0;y<k.channels_out;y++){var X=k.l3_side.tt[g][y];X.block_type=j[y],X.mixed_block_flag=0}}}else for(g=0;g<k.mode_gr;g++)for(y=0;y<k.channels_out;y++)k.l3_side.tt[g][y].block_type=O.NORM_TYPE,k.l3_side.tt[g][y].mixed_block_flag=0,E[g][y]=T[g][y]=700;if(u(k),o.mdct_sub48(k,C[0],C[1]),k.mode_ext=O.MPG_MD_LR_LR,v.force_ms)k.mode_ext=O.MPG_MD_MS_LR;else if(v.mode==vt.JOINT_STEREO){var D=0,V=0;for(g=0;g<k.mode_gr;g++)for(y=0;y<k.channels_out;y++)D+=E[g][y],V+=T[g][y];if(D<=1*V){var d=k.l3_side.tt[0],A=k.l3_side.tt[k.mode_gr-1];d[0].block_type==d[1].block_type&&A[0].block_type==A[1].block_type&&(k.mode_ext=O.MPG_MD_MS_LR)}}if(k.mode_ext==t?(R=f,h=E):(R=N,h=T),v.analysis&&k.pinfo!=null)for(g=0;g<k.mode_gr;g++)for(y=0;y<k.channels_out;y++)k.pinfo.ms_ratio[g]=k.ms_ratio[g],k.pinfo.ms_ener_ratio[g]=m[g],k.pinfo.blocktype[g][y]=k.l3_side.tt[g][y].block_type,k.pinfo.pe[g][y]=h[g][y],s1.arraycopy(k.l3_side.tt[g][y].xr,0,k.pinfo.xr[g][y],0,576),k.mode_ext==t&&(k.pinfo.ers[g][y]=k.pinfo.ers[g][y+2],s1.arraycopy(k.pinfo.energy[g][y+2],0,k.pinfo.energy[g][y],0,k.pinfo.energy[g][y].length));if(v.VBR==Bn.vbr_off||v.VBR==Bn.vbr_abr){var W,Q;for(W=0;W<18;W++)k.nsPsy.pefirbuf[W]=k.nsPsy.pefirbuf[W+1];for(Q=0,g=0;g<k.mode_gr;g++)for(y=0;y<k.channels_out;y++)Q+=h[g][y];for(k.nsPsy.pefirbuf[18]=Q,Q=k.nsPsy.pefirbuf[9],W=0;W<9;W++)Q+=(k.nsPsy.pefirbuf[W]+k.nsPsy.pefirbuf[18-W])*O.fircoef[W];for(Q=670*5*k.mode_gr*k.channels_out/Q,g=0;g<k.mode_gr;g++)for(y=0;y<k.channels_out;y++)h[g][y]*=Q}if(k.iteration_loop.iteration_loop(v,h,m,R),s.format_bitstream(v),B=s.copy_buffer(k,w,i,F,1),v.bWriteVbrTag&&n.addVbrFrame(v),v.analysis&&k.pinfo!=null){for(y=0;y<k.channels_out;y++){var ve;for(ve=0;ve<e;ve++)k.pinfo.pcmdata[y][ve]=k.pinfo.pcmdata[y][ve+v.framesize];for(ve=e;ve<1600;ve++)k.pinfo.pcmdata[y][ve]=C[y][ve-e]}r.set_frame_pinfo(v,R)}return _(k),B}}var n1=Oe.Util,i1=Oe.new_float;function F3(){var e=i1(O.BLKSIZE),t=i1(O.BLKSIZE_s/2),s=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function a(r,o,u){var _=0,l,v,c;u<<=1;var b=o+u;l=4;do{var w,i,F,B,N,f,R;R=l>>1,B=l,N=l<<1,f=N+B,l=N<<1,v=o,c=v+R;do{var C,k,L,m;k=r[v+0]-r[v+B],C=r[v+0]+r[v+B],m=r[v+N]-r[v+f],L=r[v+N]+r[v+f],r[v+N]=C-L,r[v+0]=C+L,r[v+f]=k-m,r[v+B]=k+m,k=r[c+0]-r[c+B],C=r[c+0]+r[c+B],m=n1.SQRT2*r[c+f],L=n1.SQRT2*r[c+N],r[c+N]=C-L,r[c+0]=C+L,r[c+f]=k-m,r[c+B]=k+m,c+=l,v+=l}while(v<b);for(i=s[_+0],w=s[_+1],F=1;F<R;F++){var T,E;T=1-2*w*w,E=2*w*i,v=o+F,c=o+B-F;do{var h,y,g,C,k,p,L,M,m,S;y=E*r[v+B]-T*r[c+B],h=T*r[v+B]+E*r[c+B],k=r[v+0]-h,C=r[v+0]+h,p=r[c+0]-y,g=r[c+0]+y,y=E*r[v+f]-T*r[c+f],h=T*r[v+f]+E*r[c+f],m=r[v+N]-h,L=r[v+N]+h,S=r[c+N]-y,M=r[c+N]+y,y=w*L-i*S,h=i*L+w*S,r[v+N]=C-h,r[v+0]=C+h,r[c+f]=p-y,r[c+B]=p+y,y=i*M-w*m,h=w*M+i*m,r[c+N]=g-h,r[c+0]=g+h,r[v+f]=k-y,r[v+B]=k+y,c+=l,v+=l}while(v<b);T=i,i=T*s[_+0]-w*s[_+1],w=T*s[_+1]+w*s[_+0]}_+=2}while(l<u)}var n=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(r,o,u,_,l){for(var v=0;v<3;v++){var c=O.BLKSIZE_s/2,b=65535&576/3*(v+1),w=O.BLKSIZE_s/8-1;do{var i,F,B,N,f,R=n[w<<2]&255;i=t[R]*_[u][l+R+b],f=t[127-R]*_[u][l+R+b+128],F=i-f,i=i+f,B=t[R+64]*_[u][l+R+b+64],f=t[63-R]*_[u][l+R+b+192],N=B-f,B=B+f,c-=4,o[v][c+0]=i+B,o[v][c+2]=i-B,o[v][c+1]=F+N,o[v][c+3]=F-N,i=t[R+1]*_[u][l+R+b+1],f=t[126-R]*_[u][l+R+b+129],F=i-f,i=i+f,B=t[R+65]*_[u][l+R+b+65],f=t[62-R]*_[u][l+R+b+193],N=B-f,B=B+f,o[v][c+O.BLKSIZE_s/2+0]=i+B,o[v][c+O.BLKSIZE_s/2+2]=i-B,o[v][c+O.BLKSIZE_s/2+1]=F+N,o[v][c+O.BLKSIZE_s/2+3]=F-N}while(--w>=0);a(o[v],c,O.BLKSIZE_s/2)}},this.fft_long=function(r,o,u,_,l){var v=O.BLKSIZE/8-1,c=O.BLKSIZE/2;do{var b,w,i,F,B,N=n[v]&255;b=e[N]*_[u][l+N],B=e[N+512]*_[u][l+N+512],w=b-B,b=b+B,i=e[N+256]*_[u][l+N+256],B=e[N+768]*_[u][l+N+768],F=i-B,i=i+B,c-=4,o[c+0]=b+i,o[c+2]=b-i,o[c+1]=w+F,o[c+3]=w-F,b=e[N+1]*_[u][l+N+1],B=e[N+513]*_[u][l+N+513],w=b-B,b=b+B,i=e[N+257]*_[u][l+N+257],B=e[N+769]*_[u][l+N+769],F=i-B,i=i+B,o[c+O.BLKSIZE/2+0]=b+i,o[c+O.BLKSIZE/2+2]=b-i,o[c+O.BLKSIZE/2+1]=w+F,o[c+O.BLKSIZE/2+3]=w-F}while(--v>=0);a(o,c,O.BLKSIZE/2)},this.init_fft=function(r){for(var o=0;o<O.BLKSIZE;o++)e[o]=.42-.5*Math.cos(2*Math.PI*(o+.5)/O.BLKSIZE)+.08*Math.cos(4*Math.PI*(o+.5)/O.BLKSIZE);for(var o=0;o<O.BLKSIZE_s/2;o++)t[o]=.5*(1-Math.cos(2*Math.PI*(o+.5)/O.BLKSIZE_s))}}var Ga=Oe.VbrMode,o1=Oe.Float,Wa=Oe.ShortBlock,ss=Oe.Util,H3=Oe.Arrays,Ft=Oe.new_float,_s=Oe.new_float_n,Ea=Oe.new_int,st=Oe.assert;function no(){var e=new F3,t=2.302585092994046,s=2,a=16,n=2,r=16,o=.34,u=1/(14752*14752)/(O.BLKSIZE/2),_=.01,l=.8,v=.6,c=.3,b=3.5,w=21,i=.2302585093;function F(x){return x}function B(x,I){for(var U=0,q=0;q<O.BLKSIZE/2;++q)U+=x[q]*I.ATH.eql_w[q];return U*=u,U}function N(x,I,U,q,K,P,Z,$,G,ue,se){var de=x.internal_flags;if(G<2)e.fft_long(de,q[K],G,ue,se),e.fft_short(de,P[Z],G,ue,se);else if(G==2){for(var Ce=O.BLKSIZE-1;Ce>=0;--Ce){var Ye=q[K+0][Ce],ge=q[K+1][Ce];q[K+0][Ce]=(Ye+ge)*ss.SQRT2*.5,q[K+1][Ce]=(Ye-ge)*ss.SQRT2*.5}for(var Ve=2;Ve>=0;--Ve)for(var Ce=O.BLKSIZE_s-1;Ce>=0;--Ce){var Ye=P[Z+0][Ve][Ce],ge=P[Z+1][Ve][Ce];P[Z+0][Ve][Ce]=(Ye+ge)*ss.SQRT2*.5,P[Z+1][Ve][Ce]=(Ye-ge)*ss.SQRT2*.5}}I[0]=q[K+0][0],I[0]*=I[0];for(var Ce=O.BLKSIZE/2-1;Ce>=0;--Ce){var ne=q[K+0][O.BLKSIZE/2-Ce],Fe=q[K+0][O.BLKSIZE/2+Ce];I[O.BLKSIZE/2-Ce]=(ne*ne+Fe*Fe)*.5}for(var Ve=2;Ve>=0;--Ve){U[Ve][0]=P[Z+0][Ve][0],U[Ve][0]*=U[Ve][0];for(var Ce=O.BLKSIZE_s/2-1;Ce>=0;--Ce){var ne=P[Z+0][Ve][O.BLKSIZE_s/2-Ce],Fe=P[Z+0][Ve][O.BLKSIZE_s/2+Ce];U[Ve][O.BLKSIZE_s/2-Ce]=(ne*ne+Fe*Fe)*.5}}{for(var tt=0,Ce=11;Ce<O.HBLKSIZE;Ce++)tt+=I[Ce];de.tot_ener[G]=tt}if(x.analysis){for(var Ce=0;Ce<O.HBLKSIZE;Ce++)de.pinfo.energy[$][G][Ce]=de.pinfo.energy_save[G][Ce],de.pinfo.energy_save[G][Ce]=I[Ce];de.pinfo.pe[$][G]=de.pe[G]}x.athaa_loudapprox==2&&G<2&&(de.loudness_sq[$][G]=de.loudness_sq_save[G],de.loudness_sq_save[G]=B(I,de))}var f=8,R=23,C=15,k,L,m,T=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function E(){k=Math.pow(10,(f+1)/16),L=Math.pow(10,(R+1)/16),m=Math.pow(10,C/10)}var h=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],y=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],g=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function p(x,I,U,q,K,P){var Z;if(I>x)if(I<x*L)Z=I/x;else return x+I;else{if(x>=I*L)return x+I;Z=x/I}if(x+=I,q+3<=6){if(Z>=k)return x;var $=0|ss.FAST_LOG10_X(Z,16);return x*y[$]}var $=0|ss.FAST_LOG10_X(Z,16);if(I=K.ATH.cb_l[U]*K.ATH.adjust,x<m*I){if(x>I){var G,ue;return G=1,$<=13&&(G=g[$]),ue=ss.FAST_LOG10_X(x/I,10/15),x*((h[$]-G)*ue+G)}return $>13?x:x*g[$]}return x*h[$]}var M=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function S(x,I,U){var q;if(x<0&&(x=0),I<0&&(I=0),x<=0)return I;if(I<=0)return x;if(I>x?q=I/x:q=x/I,U>=-2&&U<=2){if(q>=k)return x+I;var K=0|ss.FAST_LOG10_X(q,16);return(x+I)*M[K]}return q<L?x+I:(x<I&&(x=I),x)}function j(x,I){var U=x.internal_flags;if(U.channels_out>1){for(var q=0;q<O.SBMAX_l;q++){var K=U.thm[0].l[q],P=U.thm[1].l[q];U.thm[0].l[q]+=P*I,U.thm[1].l[q]+=K*I}for(var q=0;q<O.SBMAX_s;q++)for(var Z=0;Z<3;Z++){var K=U.thm[0].s[q][Z],P=U.thm[1].s[q][Z];U.thm[0].s[q][Z]+=P*I,U.thm[1].s[q][Z]+=K*I}}}function X(x){for(var I=0;I<O.SBMAX_l;I++)if(!(x.thm[0].l[I]>1.58*x.thm[1].l[I]||x.thm[1].l[I]>1.58*x.thm[0].l[I])){var U=x.mld_l[I]*x.en[3].l[I],q=Math.max(x.thm[2].l[I],Math.min(x.thm[3].l[I],U));U=x.mld_l[I]*x.en[2].l[I];var K=Math.max(x.thm[3].l[I],Math.min(x.thm[2].l[I],U));x.thm[2].l[I]=q,x.thm[3].l[I]=K}for(var I=0;I<O.SBMAX_s;I++)for(var P=0;P<3;P++)if(!(x.thm[0].s[I][P]>1.58*x.thm[1].s[I][P]||x.thm[1].s[I][P]>1.58*x.thm[0].s[I][P])){var U=x.mld_s[I]*x.en[3].s[I][P],q=Math.max(x.thm[2].s[I][P],Math.min(x.thm[3].s[I][P],U));U=x.mld_s[I]*x.en[2].s[I][P];var K=Math.max(x.thm[3].s[I][P],Math.min(x.thm[2].s[I][P],U));x.thm[2].s[I][P]=q,x.thm[3].s[I][P]=K}}function D(x,I,U){var q=I,K=Math.pow(10,U);I*=2,q*=2;for(var P=0;P<O.SBMAX_l;P++){var Z,$,G,ue;if(ue=x.ATH.cb_l[x.bm_l[P]]*K,Z=Math.min(Math.max(x.thm[0].l[P],ue),Math.max(x.thm[1].l[P],ue)),$=Math.max(x.thm[2].l[P],ue),G=Math.max(x.thm[3].l[P],ue),Z*I<$+G){var se=Z*q/($+G);$*=se,G*=se}x.thm[2].l[P]=Math.min($,x.thm[2].l[P]),x.thm[3].l[P]=Math.min(G,x.thm[3].l[P])}K*=O.BLKSIZE_s/O.BLKSIZE;for(var P=0;P<O.SBMAX_s;P++)for(var de=0;de<3;de++){var Z,$,G,ue;if(ue=x.ATH.cb_s[x.bm_s[P]]*K,Z=Math.min(Math.max(x.thm[0].s[P][de],ue),Math.max(x.thm[1].s[P][de],ue)),$=Math.max(x.thm[2].s[P][de],ue),G=Math.max(x.thm[3].s[P][de],ue),Z*I<$+G){var se=Z*I/($+G);$*=se,G*=se}x.thm[2].s[P][de]=Math.min(x.thm[2].s[P][de],$),x.thm[3].s[P][de]=Math.min(x.thm[3].s[P][de],G)}}function V(x,I,U,q,K){var P,Z,$=0,G=0;for(P=Z=0;P<O.SBMAX_s;++Z,++P){for(var ue=x.bo_s[P],se=x.npart_s,de=ue<se?ue:se;Z<de;)st(I[Z]>=0),st(U[Z]>=0),$+=I[Z],G+=U[Z],Z++;if(x.en[q].s[P][K]=$,x.thm[q].s[P][K]=G,Z>=se){++P;break}st(I[Z]>=0),st(U[Z]>=0);{var Ce=x.PSY.bo_s_weight[P],Ye=1-Ce;$=Ce*I[Z],G=Ce*U[Z],x.en[q].s[P][K]+=$,x.thm[q].s[P][K]+=G,$=Ye*I[Z],G=Ye*U[Z]}}for(;P<O.SBMAX_s;++P)x.en[q].s[P][K]=0,x.thm[q].s[P][K]=0}function d(x,I,U,q){var K,P,Z=0,$=0;for(K=P=0;K<O.SBMAX_l;++P,++K){for(var G=x.bo_l[K],ue=x.npart_l,se=G<ue?G:ue;P<se;)st(I[P]>=0),st(U[P]>=0),Z+=I[P],$+=U[P],P++;if(x.en[q].l[K]=Z,x.thm[q].l[K]=$,P>=ue){++K;break}st(I[P]>=0),st(U[P]>=0);{var de=x.PSY.bo_l_weight[K],Ce=1-de;Z=de*I[P],$=de*U[P],x.en[q].l[K]+=Z,x.thm[q].l[K]+=$,Z=Ce*I[P],$=Ce*U[P]}}for(;K<O.SBMAX_l;++K)x.en[q].l[K]=0,x.thm[q].l[K]=0}function A(x,I,U,q,K,P){var Z=x.internal_flags,$,G;for(G=$=0;G<Z.npart_s;++G){for(var ue=0,se=Z.numlines_s[G],de=0;de<se;++de,++$){var Ce=I[P][$];ue+=Ce}U[G]=ue}for(st(G==Z.npart_s),$=G=0;G<Z.npart_s;G++){var Ye=Z.s3ind_s[G][0],ge=Z.s3_ss[$++]*U[Ye];for(++Ye;Ye<=Z.s3ind_s[G][1];)ge+=Z.s3_ss[$]*U[Ye],++$,++Ye;{var Ve=n*Z.nb_s1[K][G];q[G]=Math.min(ge,Ve)}if(Z.blocktype_old[K&1]==O.SHORT_TYPE){var Ve=r*Z.nb_s2[K][G],ne=q[G];q[G]=Math.min(Ve,ne)}Z.nb_s2[K][G]=Z.nb_s1[K][G],Z.nb_s1[K][G]=ge,st(q[G]>=0)}for(;G<=O.CBANDS;++G)U[G]=0,q[G]=0}function W(x,I,U,q){var K=x.internal_flags;x.short_blocks==Wa.short_block_coupled&&!(I[0]!=0&&I[1]!=0)&&(I[0]=I[1]=0);for(var P=0;P<K.channels_out;P++)q[P]=O.NORM_TYPE,x.short_blocks==Wa.short_block_dispensed&&(I[P]=1),x.short_blocks==Wa.short_block_forced&&(I[P]=0),I[P]!=0?(st(K.blocktype_old[P]!=O.START_TYPE),K.blocktype_old[P]==O.SHORT_TYPE&&(q[P]=O.STOP_TYPE)):(q[P]=O.SHORT_TYPE,K.blocktype_old[P]==O.NORM_TYPE&&(K.blocktype_old[P]=O.START_TYPE),K.blocktype_old[P]==O.STOP_TYPE&&(K.blocktype_old[P]=O.SHORT_TYPE)),U[P]=K.blocktype_old[P],K.blocktype_old[P]=q[P]}function Q(x,I,U){return U>=1?x:U<=0?I:I>0?Math.pow(x/I,U)*I:0}var ve=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function Me(x,I){for(var U=309.07,q=0;q<O.SBMAX_s-1;q++)for(var K=0;K<3;K++){var P=x.thm.s[q][K];if(P>0){var Z=P*I,$=x.en.s[q][K];$>Z&&($>Z*1e10?U+=ve[q]*(10*t):U+=ve[q]*ss.FAST_LOG10($/Z))}}return U}var Te=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function Y(x,I){for(var U=281.0575,q=0;q<O.SBMAX_l-1;q++){var K=x.thm.l[q];if(K>0){var P=K*I,Z=x.en.l[q];Z>P&&(Z>P*1e10?U+=Te[q]*(10*t):U+=Te[q]*ss.FAST_LOG10(Z/P))}}return U}function ie(x,I,U,q,K){var P,Z;for(P=Z=0;P<x.npart_l;++P){var $=0,G=0,ue;for(ue=0;ue<x.numlines_l[P];++ue,++Z){var se=I[Z];$+=se,G<se&&(G=se)}U[P]=$,q[P]=G,K[P]=$*x.rnumlines_l[P],st(x.rnumlines_l[P]>=0),st(U[P]>=0),st(q[P]>=0),st(K[P]>=0)}}function ae(x,I,U,q){var K=T.length-1,P=0,Z=U[P]+U[P+1];if(Z>0){var $=I[P];$<I[P+1]&&($=I[P+1]),st(x.numlines_l[P]+x.numlines_l[P+1]-1>0),Z=20*($*2-Z)/(Z*(x.numlines_l[P]+x.numlines_l[P+1]-1));var G=0|Z;G>K&&(G=K),q[P]=G}else q[P]=0;for(P=1;P<x.npart_l-1;P++)if(Z=U[P-1]+U[P]+U[P+1],Z>0){var $=I[P-1];$<I[P]&&($=I[P]),$<I[P+1]&&($=I[P+1]),st(x.numlines_l[P-1]+x.numlines_l[P]+x.numlines_l[P+1]-1>0),Z=20*($*3-Z)/(Z*(x.numlines_l[P-1]+x.numlines_l[P]+x.numlines_l[P+1]-1));var G=0|Z;G>K&&(G=K),q[P]=G}else q[P]=0;if(st(P==x.npart_l-1),Z=U[P-1]+U[P],Z>0){var $=I[P-1];$<I[P]&&($=I[P]),st(x.numlines_l[P-1]+x.numlines_l[P]-1>0),Z=20*($*2-Z)/(Z*(x.numlines_l[P-1]+x.numlines_l[P]-1));var G=0|Z;G>K&&(G=K),q[P]=G}else q[P]=0;st(P==x.npart_l-1)}var le=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(x,I,U,q,K,P,Z,$,G,ue){var se=x.internal_flags,de=_s([2,O.BLKSIZE]),Ce=_s([2,3,O.BLKSIZE_s]),Ye=Ft(O.CBANDS+1),ge=Ft(O.CBANDS+1),Ve=Ft(O.CBANDS+2),ne=Ea(2),Fe=Ea(2),tt,be,He,ye,Xe,Rt,Ne,Qe,at=_s([2,576]),xt,os=Ea(O.CBANDS+2),jt=Ea(O.CBANDS+2);for(H3.fill(jt,0),tt=se.channels_out,x.mode==vt.JOINT_STEREO&&(tt=4),x.VBR==Ga.vbr_off?xt=se.ResvMax==0?0:se.ResvSize/se.ResvMax*.5:x.VBR==Ga.vbr_rh||x.VBR==Ga.vbr_mtrh||x.VBR==Ga.vbr_mt?xt=.6:xt=1,be=0;be<se.channels_out;be++){var Ot=I[be],es=U+576-350-w+192;for(ye=0;ye<576;ye++){var ls,cs;for(ls=Ot[es+ye+10],cs=0,Xe=0;Xe<(w-1)/2-1;Xe+=2)ls+=le[Xe]*(Ot[es+ye+Xe]+Ot[es+ye+w-Xe]),cs+=le[Xe+1]*(Ot[es+ye+Xe+1]+Ot[es+ye+w-Xe-1]);at[be][ye]=ls+cs}K[q][be].en.assign(se.en[be]),K[q][be].thm.assign(se.thm[be]),tt>2&&(P[q][be].en.assign(se.en[be+2]),P[q][be].thm.assign(se.thm[be+2]))}for(be=0;be<tt;be++){var Es,Ms,Yt=Ft(12),Is=[0,0,0,0],Ka=Ft(12),Li=1,Ll,Bl=Ft(O.CBANDS),Nl=Ft(O.CBANDS),It=[0,0,0,0],jl=Ft(O.HBLKSIZE),Fl=_s([3,O.HBLKSIZE_s]);for(st(se.npart_s<=O.CBANDS),st(se.npart_l<=O.CBANDS),ye=0;ye<3;ye++)Yt[ye]=se.nsPsy.last_en_subshort[be][ye+6],st(se.nsPsy.last_en_subshort[be][ye+4]>0),Ka[ye]=Yt[ye]/se.nsPsy.last_en_subshort[be][ye+4],Is[0]+=Yt[ye];if(be==2)for(ye=0;ye<576;ye++){var Bi,Ni;Bi=at[0][ye],Ni=at[1][ye],at[0][ye]=Bi+Ni,at[1][ye]=Bi-Ni}{var Hl=at[be&1],pr=0;for(ye=0;ye<9;ye++){for(var Zu=pr+64,qt=1;pr<Zu;pr++)qt<Math.abs(Hl[pr])&&(qt=Math.abs(Hl[pr]));se.nsPsy.last_en_subshort[be][ye]=Yt[ye+3]=qt,Is[1+ye/3]+=qt,qt>Yt[ye+3-2]?(st(Yt[ye+3-2]>0),qt=qt/Yt[ye+3-2]):Yt[ye+3-2]>qt*10?qt=Yt[ye+3-2]/(qt*10):qt=0,Ka[ye+3]=qt}}if(x.analysis){var ji=Ka[0];for(ye=1;ye<12;ye++)ji<Ka[ye]&&(ji=Ka[ye]);se.pinfo.ers[q][be]=se.pinfo.ers_save[be],se.pinfo.ers_save[be]=ji}for(Ll=be==3?se.nsPsy.attackthre_s:se.nsPsy.attackthre,ye=0;ye<12;ye++)It[ye/3]==0&&Ka[ye]>Ll&&(It[ye/3]=ye%3+1);for(ye=1;ye<4;ye++){var Fi;Is[ye-1]>Is[ye]?(st(Is[ye]>0),Fi=Is[ye-1]/Is[ye]):(st(Is[ye-1]>0),Fi=Is[ye]/Is[ye-1]),Fi<1.7&&(It[ye]=0,ye==1&&(It[0]=0))}for(It[0]!=0&&se.nsPsy.lastAttacks[be]!=0&&(It[0]=0),(se.nsPsy.lastAttacks[be]==3||It[0]+It[1]+It[2]+It[3]!=0)&&(Li=0,It[1]!=0&&It[0]!=0&&(It[1]=0),It[2]!=0&&It[1]!=0&&(It[2]=0),It[3]!=0&&It[2]!=0&&(It[3]=0)),be<2?Fe[be]=Li:Li==0&&(Fe[0]=Fe[1]=0),G[be]=se.tot_ener[be],Ms=Ce,Es=de,N(x,jl,Fl,Es,be&1,Ms,be&1,q,be,I,U),ie(se,jl,Ye,Bl,Nl),ae(se,Bl,Nl,os),Qe=0;Qe<3;Qe++){var Hi,ts;for(A(x,Fl,ge,Ve,be,Qe),V(se,ge,Ve,be,Qe),Ne=0;Ne<O.SBMAX_s;Ne++){if(ts=se.thm[be].s[Ne][Qe],ts*=l,It[Qe]>=2||It[Qe+1]==1){var gr=Qe!=0?Qe-1:2,qt=Q(se.thm[be].s[Ne][gr],ts,v*xt);ts=Math.min(ts,qt)}if(It[Qe]==1){var gr=Qe!=0?Qe-1:2,qt=Q(se.thm[be].s[Ne][gr],ts,c*xt);ts=Math.min(ts,qt)}else if(Qe!=0&&It[Qe-1]==3||Qe==0&&se.nsPsy.lastAttacks[be]==3){var gr=Qe!=2?Qe+1:0,qt=Q(se.thm[be].s[Ne][gr],ts,c*xt);ts=Math.min(ts,qt)}Hi=Yt[Qe*3+3]+Yt[Qe*3+4]+Yt[Qe*3+5],Yt[Qe*3+5]*6<Hi&&(ts*=.5,Yt[Qe*3+4]*6<Hi&&(ts*=.5)),se.thm[be].s[Ne][Qe]=ts}}for(se.nsPsy.lastAttacks[be]=It[2],Rt=0,He=0;He<se.npart_l;He++){for(var _a=se.s3ind[He][0],Pi=Ye[_a]*T[os[_a]],pa=se.s3_ll[Rt++]*Pi;++_a<=se.s3ind[He][1];)Pi=Ye[_a]*T[os[_a]],pa=p(pa,se.s3_ll[Rt++]*Pi,_a,_a-He,se);pa*=.158489319246111,se.blocktype_old[be&1]==O.SHORT_TYPE?Ve[He]=pa:Ve[He]=Q(Math.min(pa,Math.min(s*se.nb_1[be][He],a*se.nb_2[be][He])),pa,xt),se.nb_2[be][He]=se.nb_1[be][He],se.nb_1[be][He]=pa}for(;He<=O.CBANDS;++He)Ye[He]=0,Ve[He]=0;d(se,Ye,Ve,be)}if((x.mode==vt.STEREO||x.mode==vt.JOINT_STEREO)&&x.interChRatio>0&&j(x,x.interChRatio),x.mode==vt.JOINT_STEREO){var Di;X(se),Di=x.msfix,Math.abs(Di)>0&&D(se,Di,x.ATHlower*se.ATH.adjust)}for(W(x,Fe,ue,ne),be=0;be<tt;be++){var br,yr=0,bn,yn;be>1?(br=$,yr=-2,bn=O.NORM_TYPE,(ue[0]==O.SHORT_TYPE||ue[1]==O.SHORT_TYPE)&&(bn=O.SHORT_TYPE),yn=P[q][be-2]):(br=Z,yr=0,bn=ue[be],yn=K[q][be]),bn==O.SHORT_TYPE?br[yr+be]=Me(yn,se.masking_lower):br[yr+be]=Y(yn,se.masking_lower),x.analysis&&(se.pinfo.pe[q][be]=br[yr+be])}return 0};function Ue(x,I,U,q,K,P,Z,$){var G=x.internal_flags;if(q<2)e.fft_long(G,Z[$],q,I,U);else if(q==2)for(var ue=O.BLKSIZE-1;ue>=0;--ue){var se=Z[$+0][ue],de=Z[$+1][ue];Z[$+0][ue]=(se+de)*ss.SQRT2*.5,Z[$+1][ue]=(se-de)*ss.SQRT2*.5}P[0]=Z[$+0][0],P[0]*=P[0];for(var ue=O.BLKSIZE/2-1;ue>=0;--ue){var Ce=Z[$+0][O.BLKSIZE/2-ue],Ye=Z[$+0][O.BLKSIZE/2+ue];P[O.BLKSIZE/2-ue]=(Ce*Ce+Ye*Ye)*.5}{for(var ge=0,ue=11;ue<O.HBLKSIZE;ue++)ge+=P[ue];G.tot_ener[q]=ge}if(x.analysis){for(var ue=0;ue<O.HBLKSIZE;ue++)G.pinfo.energy[K][q][ue]=G.pinfo.energy_save[q][ue],G.pinfo.energy_save[q][ue]=P[ue];G.pinfo.pe[K][q]=G.pe[q]}}function Ze(x,I,U,q,K,P,Z,$){var G=x.internal_flags;if(K==0&&q<2&&e.fft_short(G,Z[$],q,I,U),q==2)for(var ue=O.BLKSIZE_s-1;ue>=0;--ue){var se=Z[$+0][K][ue],de=Z[$+1][K][ue];Z[$+0][K][ue]=(se+de)*ss.SQRT2*.5,Z[$+1][K][ue]=(se-de)*ss.SQRT2*.5}P[K][0]=Z[$+0][K][0],P[K][0]*=P[K][0];for(var ue=O.BLKSIZE_s/2-1;ue>=0;--ue){var Ce=Z[$+0][K][O.BLKSIZE_s/2-ue],Ye=Z[$+0][K][O.BLKSIZE_s/2+ue];P[K][O.BLKSIZE_s/2-ue]=(Ce*Ce+Ye*Ye)*.5}}function H(x,I,U,q){var K=x.internal_flags;x.athaa_loudapprox==2&&U<2&&(K.loudness_sq[I][U]=K.loudness_sq_save[U],K.loudness_sq_save[U]=B(q,K))}var z=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function ee(x,I,U,q,K,P,Z,$,G,ue){for(var se=_s([2,576]),de=x.internal_flags,Ce=de.channels_out,Ye=x.mode==vt.JOINT_STEREO?4:Ce,ge=0;ge<Ce;ge++){firbuf=I[ge];for(var Ve=U+576-350-w+192,ne=0;ne<576;ne++){var Fe,tt;Fe=firbuf[Ve+ne+10],tt=0;for(var be=0;be<(w-1)/2-1;be+=2)Fe+=z[be]*(firbuf[Ve+ne+be]+firbuf[Ve+ne+w-be]),tt+=z[be+1]*(firbuf[Ve+ne+be+1]+firbuf[Ve+ne+w-be-1]);se[ge][ne]=Fe+tt}K[q][ge].en.assign(de.en[ge]),K[q][ge].thm.assign(de.thm[ge]),Ye>2&&(P[q][ge].en.assign(de.en[ge+2]),P[q][ge].thm.assign(de.thm[ge+2]))}for(var ge=0;ge<Ye;ge++){var He=Ft(12),ye=Ft(12),Xe=[0,0,0,0],Rt=se[ge&1],Ne=0,Qe=ge==3?de.nsPsy.attackthre_s:de.nsPsy.attackthre,at=1;if(ge==2)for(var ne=0,be=576;be>0;++ne,--be){var xt=se[0][ne],os=se[1][ne];se[0][ne]=xt+os,se[1][ne]=xt-os}for(var ne=0;ne<3;ne++)ye[ne]=de.nsPsy.last_en_subshort[ge][ne+6],st(de.nsPsy.last_en_subshort[ge][ne+4]>0),He[ne]=ye[ne]/de.nsPsy.last_en_subshort[ge][ne+4],Xe[0]+=ye[ne];for(var ne=0;ne<9;ne++){for(var jt=Ne+64,Ot=1;Ne<jt;Ne++)Ot<Math.abs(Rt[Ne])&&(Ot=Math.abs(Rt[Ne]));de.nsPsy.last_en_subshort[ge][ne]=ye[ne+3]=Ot,Xe[1+ne/3]+=Ot,Ot>ye[ne+3-2]?(st(ye[ne+3-2]>0),Ot=Ot/ye[ne+3-2]):ye[ne+3-2]>Ot*10?Ot=ye[ne+3-2]/(Ot*10):Ot=0,He[ne+3]=Ot}for(var ne=0;ne<3;++ne){var es=ye[ne*3+3]+ye[ne*3+4]+ye[ne*3+5],ls=1;ye[ne*3+5]*6<es&&(ls*=.5,ye[ne*3+4]*6<es&&(ls*=.5)),$[ge][ne]=ls}if(x.analysis){for(var cs=He[0],ne=1;ne<12;ne++)cs<He[ne]&&(cs=He[ne]);de.pinfo.ers[q][ge]=de.pinfo.ers_save[ge],de.pinfo.ers_save[ge]=cs}for(var ne=0;ne<12;ne++)G[ge][ne/3]==0&&He[ne]>Qe&&(G[ge][ne/3]=ne%3+1);for(var ne=1;ne<4;ne++){var Es=Xe[ne-1],Ms=Xe[ne],Yt=Math.max(Es,Ms);Yt<4e4&&Es<1.7*Ms&&Ms<1.7*Es&&(ne==1&&G[ge][0]<=G[ge][ne]&&(G[ge][0]=0),G[ge][ne]=0)}G[ge][0]<=de.nsPsy.lastAttacks[ge]&&(G[ge][0]=0),(de.nsPsy.lastAttacks[ge]==3||G[ge][0]+G[ge][1]+G[ge][2]+G[ge][3]!=0)&&(at=0,G[ge][1]!=0&&G[ge][0]!=0&&(G[ge][1]=0),G[ge][2]!=0&&G[ge][1]!=0&&(G[ge][2]=0),G[ge][3]!=0&&G[ge][2]!=0&&(G[ge][3]=0)),ge<2?ue[ge]=at:at==0&&(ue[0]=ue[1]=0),Z[ge]=de.tot_ener[ge]}}function me(x,I,U){if(U==0)for(var q=0;q<x.npart_s;q++)x.nb_s2[I][q]=x.nb_s1[I][q],x.nb_s1[I][q]=0}function he(x,I){for(var U=0;U<x.npart_l;U++)x.nb_2[I][U]=x.nb_1[I][U],x.nb_1[I][U]=0}function Ee(x,I,U,q){var K=T.length-1,P=0,Z=U[P]+U[P+1];if(Z>0){var $=I[P];$<I[P+1]&&($=I[P+1]),st(x.numlines_s[P]+x.numlines_s[P+1]-1>0),Z=20*($*2-Z)/(Z*(x.numlines_s[P]+x.numlines_s[P+1]-1));var G=0|Z;G>K&&(G=K),q[P]=G}else q[P]=0;for(P=1;P<x.npart_s-1;P++)if(Z=U[P-1]+U[P]+U[P+1],st(P+1<x.npart_s),Z>0){var $=I[P-1];$<I[P]&&($=I[P]),$<I[P+1]&&($=I[P+1]),st(x.numlines_s[P-1]+x.numlines_s[P]+x.numlines_s[P+1]-1>0),Z=20*($*3-Z)/(Z*(x.numlines_s[P-1]+x.numlines_s[P]+x.numlines_s[P+1]-1));var G=0|Z;G>K&&(G=K),q[P]=G}else q[P]=0;if(st(P==x.npart_s-1),Z=U[P-1]+U[P],Z>0){var $=I[P-1];$<I[P]&&($=I[P]),st(x.numlines_s[P-1]+x.numlines_s[P]-1>0),Z=20*($*2-Z)/(Z*(x.numlines_s[P-1]+x.numlines_s[P]-1));var G=0|Z;G>K&&(G=K),q[P]=G}else q[P]=0;st(P==x.npart_s-1)}function Re(x,I,U,q,K,P){var Z=x.internal_flags,$=new float[O.CBANDS],G=Ft(O.CBANDS),ue,se,de,Ce=new int[O.CBANDS];for(de=se=0;de<Z.npart_s;++de){var Ye=0,ge=0,Ve=Z.numlines_s[de];for(ue=0;ue<Ve;++ue,++se){var ne=I[P][se];Ye+=ne,ge<ne&&(ge=ne)}U[de]=Ye,$[de]=ge,G[de]=Ye/Ve,st(G[de]>=0)}for(st(de==Z.npart_s);de<O.CBANDS;++de)$[de]=0,G[de]=0;for(Ee(Z,$,G,Ce),se=de=0;de<Z.npart_s;de++){var Fe=Z.s3ind_s[de][0],tt=Z.s3ind_s[de][1],be,He,ye,Xe,Rt;for(be=Ce[Fe],He=1,Xe=Z.s3_ss[se]*U[Fe]*T[Ce[Fe]],++se,++Fe;Fe<=tt;)be+=Ce[Fe],He+=1,ye=Z.s3_ss[se]*U[Fe]*T[Ce[Fe]],Xe=S(Xe,ye,Fe-de),++se,++Fe;be=(1+2*be)/(2*He),Rt=T[be]*.5,Xe*=Rt,q[de]=Xe,Z.nb_s2[K][de]=Z.nb_s1[K][de],Z.nb_s1[K][de]=Xe,ye=$[de],ye*=Z.minval_s[de],ye*=Rt,q[de]>ye&&(q[de]=ye),Z.masking_lower>1&&(q[de]*=Z.masking_lower),q[de]>U[de]&&(q[de]=U[de]),Z.masking_lower<1&&(q[de]*=Z.masking_lower),st(q[de]>=0)}for(;de<O.CBANDS;++de)U[de]=0,q[de]=0}function we(x,I,U,q,K){var P=Ft(O.CBANDS),Z=Ft(O.CBANDS),$=Ea(O.CBANDS+2),G;ie(x,I,U,P,Z),ae(x,P,Z,$);var ue=0;for(G=0;G<x.npart_l;G++){var se,de,Ce,Ye,ge=x.s3ind[G][0],Ve=x.s3ind[G][1],ne=0,Fe=0;for(ne=$[ge],Fe+=1,de=x.s3_ll[ue]*U[ge]*T[$[ge]],++ue,++ge;ge<=Ve;)ne+=$[ge],Fe+=1,se=x.s3_ll[ue]*U[ge]*T[$[ge]],Ye=S(de,se,ge-G),de=Ye,++ue,++ge;if(ne=(1+2*ne)/(2*Fe),Ce=T[ne]*.5,de*=Ce,x.blocktype_old[K&1]==O.SHORT_TYPE){var tt=s*x.nb_1[K][G];tt>0?q[G]=Math.min(de,tt):q[G]=Math.min(de,U[G]*c)}else{var be=a*x.nb_2[K][G],He=s*x.nb_1[K][G],tt;be<=0&&(be=de),He<=0&&(He=de),x.blocktype_old[K&1]==O.NORM_TYPE?tt=Math.min(He,be):tt=He,q[G]=Math.min(de,tt)}x.nb_2[K][G]=x.nb_1[K][G],x.nb_1[K][G]=de,se=P[G],se*=x.minval_l[G],se*=Ce,q[G]>se&&(q[G]=se),x.masking_lower>1&&(q[G]*=x.masking_lower),q[G]>U[G]&&(q[G]=U[G]),x.masking_lower<1&&(q[G]*=x.masking_lower),st(q[G]>=0)}for(;G<O.CBANDS;++G)U[G]=0,q[G]=0}function ke(x,I){var U=x.internal_flags;x.short_blocks==Wa.short_block_coupled&&!(I[0]!=0&&I[1]!=0)&&(I[0]=I[1]=0);for(var q=0;q<U.channels_out;q++)x.short_blocks==Wa.short_block_dispensed&&(I[q]=1),x.short_blocks==Wa.short_block_forced&&(I[q]=0)}function _e(x,I,U){for(var q=x.internal_flags,K=0;K<q.channels_out;K++){var P=O.NORM_TYPE;I[K]!=0?(st(q.blocktype_old[K]!=O.START_TYPE),q.blocktype_old[K]==O.SHORT_TYPE&&(P=O.STOP_TYPE)):(P=O.SHORT_TYPE,q.blocktype_old[K]==O.NORM_TYPE&&(q.blocktype_old[K]=O.START_TYPE),q.blocktype_old[K]==O.STOP_TYPE&&(q.blocktype_old[K]=O.SHORT_TYPE)),U[K]=q.blocktype_old[K],q.blocktype_old[K]=P}}function Pe(x,I,U,q,K,P,Z){for(var $=P*2,G=P>0?Math.pow(10,K):1,ue,se,de=0;de<Z;++de){var Ce=x[2][de],Ye=x[3][de],ge=I[0][de],Ve=I[1][de],ne=I[2][de],Fe=I[3][de];if(ge<=1.58*Ve&&Ve<=1.58*ge){var tt=U[de]*Ye,be=U[de]*Ce;se=Math.max(ne,Math.min(Fe,tt)),ue=Math.max(Fe,Math.min(ne,be))}else se=ne,ue=Fe;if(P>0){var He,ye,Xe=q[de]*G;if(He=Math.min(Math.max(ge,Xe),Math.max(Ve,Xe)),ne=Math.max(se,Xe),Fe=Math.max(ue,Xe),ye=ne+Fe,ye>0&&He*$<ye){var Rt=He*$/ye;ne*=Rt,Fe*=Rt}se=Math.min(ne,se),ue=Math.min(Fe,ue)}se>Ce&&(se=Ce),ue>Ye&&(ue=Ye),I[2][de]=se,I[3][de]=ue}}this.L3psycho_anal_vbr=function(x,I,U,q,K,P,Z,$,G,ue){var se=x.internal_flags,de,Ce,Ye=Ft(O.HBLKSIZE),ge=_s([3,O.HBLKSIZE_s]),Ve=_s([2,O.BLKSIZE]),ne=_s([2,3,O.BLKSIZE_s]),Fe=_s([4,O.CBANDS]),tt=_s([4,O.CBANDS]),be=_s([4,3]),He=.6,ye=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Xe=Ea(2),Rt=x.mode==vt.JOINT_STEREO?4:se.channels_out;ee(x,I,U,q,K,P,G,be,ye,Xe),ke(x,Xe);{for(var Ne=0;Ne<Rt;Ne++){var Qe=Ne&1;de=Ve,Ue(x,I,U,Ne,q,Ye,de,Qe),H(x,q,Ne,Ye),Xe[Qe]!=0?we(se,Ye,Fe[Ne],tt[Ne],Ne):he(se,Ne)}Xe[0]+Xe[1]==2&&x.mode==vt.JOINT_STEREO&&Pe(Fe,tt,se.mld_cb_l,se.ATH.cb_l,x.ATHlower*se.ATH.adjust,x.msfix,se.npart_l);for(var Ne=0;Ne<Rt;Ne++){var Qe=Ne&1;Xe[Qe]!=0&&d(se,Fe[Ne],tt[Ne],Ne)}}{for(var at=0;at<3;at++){for(var Ne=0;Ne<Rt;++Ne){var Qe=Ne&1;Xe[Qe]!=0?me(se,Ne,at):(Ce=ne,Ze(x,I,U,Ne,at,ge,Ce,Qe),Re(x,ge,Fe[Ne],tt[Ne],Ne,at))}Xe[0]+Xe[1]==0&&x.mode==vt.JOINT_STEREO&&Pe(Fe,tt,se.mld_cb_s,se.ATH.cb_s,x.ATHlower*se.ATH.adjust,x.msfix,se.npart_s);for(var Ne=0;Ne<Rt;++Ne){var Qe=Ne&1;Xe[Qe]==0&&V(se,Fe[Ne],tt[Ne],Ne,at)}}for(var Ne=0;Ne<Rt;Ne++){var Qe=Ne&1;if(Xe[Qe]==0)for(var xt=0;xt<O.SBMAX_s;xt++){for(var os=Ft(3),at=0;at<3;at++){var jt=se.thm[Ne].s[xt][at];if(jt*=l,ye[Ne][at]>=2||ye[Ne][at+1]==1){var Ot=at!=0?at-1:2,es=Q(se.thm[Ne].s[xt][Ot],jt,v*He);jt=Math.min(jt,es)}else if(ye[Ne][at]==1){var Ot=at!=0?at-1:2,es=Q(se.thm[Ne].s[xt][Ot],jt,c*He);jt=Math.min(jt,es)}else if(at!=0&&ye[Ne][at-1]==3||at==0&&se.nsPsy.lastAttacks[Ne]==3){var Ot=at!=2?at+1:0,es=Q(se.thm[Ne].s[xt][Ot],jt,c*He);jt=Math.min(jt,es)}jt*=be[Ne][at],os[at]=jt}for(var at=0;at<3;at++)se.thm[Ne].s[xt][at]=os[at]}}}for(var Ne=0;Ne<Rt;Ne++)se.nsPsy.lastAttacks[Ne]=ye[Ne][2];_e(x,Xe,ue);for(var Ne=0;Ne<Rt;Ne++){var ls,cs,Es,Ms;Ne>1?(ls=$,cs=-2,Es=O.NORM_TYPE,(ue[0]==O.SHORT_TYPE||ue[1]==O.SHORT_TYPE)&&(Es=O.SHORT_TYPE),Ms=P[q][Ne-2]):(ls=Z,cs=0,Es=ue[Ne],Ms=K[q][Ne]),Es==O.SHORT_TYPE?ls[cs+Ne]=Me(Ms,se.masking_lower):ls[cs+Ne]=Y(Ms,se.masking_lower),x.analysis&&(se.pinfo.pe[q][Ne]=ls[cs+Ne])}return 0};function je(x,I){var U=x,q;return U>=0?q=-U*27:q=U*I,q<=-72?0:Math.exp(q*i)}function De(x){var I=0,U=0;{var q=0,K,P;for(q=0;je(q,x)>1e-20;q-=1);for(K=q,P=0;Math.abs(P-K)>1e-12;)q=(P+K)/2,je(q,x)>0?P=q:K=q;I=K}{var q=0,K,P;for(q=0;je(q,x)>1e-20;q+=1);for(K=0,P=q;Math.abs(P-K)>1e-12;)q=(P+K)/2,je(q,x)>0?K=q:P=q;U=P}{var Z=0,$=1e3,G;for(G=0;G<=$;++G){var q=I+G*(U-I)/$,ue=je(q,x);Z+=ue}{var se=($+1)/(Z*(U-I));return se}}}function qe(x){var I,U,q,K;return I=x,I>=0?I*=3:I*=1.5,I>=.5&&I<=2.5?(K=I-.5,U=8*(K*K-2*K)):U=0,I+=.474,q=15.811389+7.5*I-17.5*Math.sqrt(1+I*I),q<=-60?0:(I=Math.exp((U+q)*i),I/=.6609193,I)}function We(x){return x<0&&(x=0),x=x*.001,13*Math.atan(.76*x)+3.5*Math.atan(x*x/(7.5*7.5))}function fe(x,I,U,q,K,P,Z,$,G,ue,se,de){var Ce=Ft(O.CBANDS+1),Ye=$/(de>15?2*576:2*192),ge=Ea(O.HBLKSIZE),Ve;$/=G;var ne=0,Fe=0;for(Ve=0;Ve<O.CBANDS;Ve++){var tt,be;for(tt=We($*ne),Ce[Ve]=$*ne,be=ne;We($*be)-tt<o&&be<=G/2;be++);for(x[Ve]=be-ne,Fe=Ve+1;ne<be;)ge[ne++]=Ve;if(ne>G/2){ne=G/2,++Ve;break}}Ce[Ve]=$*ne;for(var He=0;He<de;He++){var ye,Xe,Rt,Ne,Qe;Rt=ue[He],Ne=ue[He+1],ye=0|Math.floor(.5+se*(Rt-.5)),ye<0&&(ye=0),Xe=0|Math.floor(.5+se*(Ne-.5)),Xe>G/2&&(Xe=G/2),U[He]=(ge[ye]+ge[Xe])/2,I[He]=ge[Xe];var at=Ye*Ne;Z[He]=(at-Ce[I[He]])/(Ce[I[He]+1]-Ce[I[He]]),Z[He]<0?Z[He]=0:Z[He]>1&&(Z[He]=1),Qe=We($*ue[He]*se),Qe=Math.min(Qe,15.5)/15.5,P[He]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Qe))-2.5)}ne=0;for(var xt=0;xt<Fe;xt++){var os=x[xt],tt,jt;tt=We($*ne),jt=We($*(ne+os-1)),q[xt]=.5*(tt+jt),tt=We($*(ne-.5)),jt=We($*(ne+os-.5)),K[xt]=jt-tt,ne+=os}return Fe}function Se(x,I,U,q,K,P){var Z=_s([O.CBANDS,O.CBANDS]),$,G=0;if(P)for(var ue=0;ue<I;ue++)for($=0;$<I;$++){var se=qe(U[ue]-U[$])*q[$];Z[ue][$]=se*K[ue]}else for($=0;$<I;$++)for(var de=15+Math.min(21/U[$],12),Ce=De(de),ue=0;ue<I;ue++){var se=Ce*je(U[ue]-U[$],de)*q[$];Z[ue][$]=se*K[ue]}for(var ue=0;ue<I;ue++){for($=0;$<I&&!(Z[ue][$]>0);$++);for(x[ue][0]=$,$=I-1;$>0&&!(Z[ue][$]>0);$--);x[ue][1]=$,G+=x[ue][1]-x[ue][0]+1}for(var Ye=Ft(G),ge=0,ue=0;ue<I;ue++)for($=x[ue][0];$<=x[ue][1];$++)Ye[ge++]=Z[ue][$];return Ye}function te(x){var I=We(x);return I=Math.min(I,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*I))-2.5)}this.psymodel_init=function(x){var I=x.internal_flags,U,q=!0,K=13,P=24,Z=0,$=0,G=-8.25,ue=-4.5,se=Ft(O.CBANDS),de=Ft(O.CBANDS),Ce=Ft(O.CBANDS),Ye=x.out_samplerate;switch(x.experimentalZ){default:case 0:q=!0;break;case 1:q=!(x.VBR==Ga.vbr_mtrh||x.VBR==Ga.vbr_mt);break;case 2:q=!1;break;case 3:K=8,Z=-1.75,$=-.0125,G=-8.25,ue=-2.25;break}for(I.ms_ener_ratio_old=.25,I.blocktype_old[0]=I.blocktype_old[1]=O.NORM_TYPE,U=0;U<4;++U){for(var ne=0;ne<O.CBANDS;++ne)I.nb_1[U][ne]=1e20,I.nb_2[U][ne]=1e20,I.nb_s1[U][ne]=I.nb_s2[U][ne]=1;for(var ge=0;ge<O.SBMAX_l;ge++)I.en[U].l[ge]=1e20,I.thm[U].l[ge]=1e20;for(var ne=0;ne<3;++ne){for(var ge=0;ge<O.SBMAX_s;ge++)I.en[U].s[ge][ne]=1e20,I.thm[U].s[ge][ne]=1e20;I.nsPsy.lastAttacks[U]=0}for(var ne=0;ne<9;ne++)I.nsPsy.last_en_subshort[U][ne]=10}for(I.loudness_sq_save[0]=I.loudness_sq_save[1]=0,I.npart_l=fe(I.numlines_l,I.bo_l,I.bm_l,se,de,I.mld_l,I.PSY.bo_l_weight,Ye,O.BLKSIZE,I.scalefac_band.l,O.BLKSIZE/(2*576),O.SBMAX_l),st(I.npart_l<O.CBANDS),U=0;U<I.npart_l;U++){var Ve=Z;se[U]>=K&&(Ve=$*(se[U]-K)/(P-K)+Z*(P-se[U])/(P-K)),Ce[U]=Math.pow(10,Ve/10),I.numlines_l[U]>0?I.rnumlines_l[U]=1/I.numlines_l[U]:I.rnumlines_l[U]=0}I.s3_ll=Se(I.s3ind,I.npart_l,se,de,Ce,q);var ne=0;for(U=0;U<I.npart_l;U++){var Fe;Fe=o1.MAX_VALUE;for(var tt=0;tt<I.numlines_l[U];tt++,ne++){var be=Ye*ne/(1e3*O.BLKSIZE),He;He=this.ATHformula(be*1e3,x)-20,He=Math.pow(10,.1*He),He*=I.numlines_l[U],Fe>He&&(Fe=He)}I.ATH.cb_l[U]=Fe,Fe=-20+se[U]*20/10,Fe>6&&(Fe=100),Fe<-15&&(Fe=-15),Fe-=8,I.minval_l[U]=Math.pow(10,Fe/10)*I.numlines_l[U]}for(I.npart_s=fe(I.numlines_s,I.bo_s,I.bm_s,se,de,I.mld_s,I.PSY.bo_s_weight,Ye,O.BLKSIZE_s,I.scalefac_band.s,O.BLKSIZE_s/(2*192),O.SBMAX_s),st(I.npart_s<O.CBANDS),ne=0,U=0;U<I.npart_s;U++){var Fe,Ve=G;se[U]>=K&&(Ve=ue*(se[U]-K)/(P-K)+G*(P-se[U])/(P-K)),Ce[U]=Math.pow(10,Ve/10),Fe=o1.MAX_VALUE;for(var tt=0;tt<I.numlines_s[U];tt++,ne++){var be=Ye*ne/(1e3*O.BLKSIZE_s),He;He=this.ATHformula(be*1e3,x)-20,He=Math.pow(10,.1*He),He*=I.numlines_s[U],Fe>He&&(Fe=He)}I.ATH.cb_s[U]=Fe,Fe=-7+se[U]*7/12,se[U]>12&&(Fe*=1+Math.log(1+Fe)*3.1),se[U]<12&&(Fe*=1+Math.log(1-Fe)*2.3),Fe<-15&&(Fe=-15),Fe-=8,I.minval_s[U]=Math.pow(10,Fe/10)*I.numlines_s[U]}I.s3_ss=Se(I.s3ind_s,I.npart_s,se,de,Ce,q),E(),e.init_fft(I),I.decay=Math.exp(-1*t/(_*Ye/192));{var ye;ye=b,x.exp_nspsytune&2&&(ye=1),Math.abs(x.msfix)>0&&(ye=x.msfix),x.msfix=ye;for(var Xe=0;Xe<I.npart_l;Xe++)I.s3ind[Xe][1]>I.npart_l-1&&(I.s3ind[Xe][1]=I.npart_l-1)}var Rt=576*I.mode_gr/Ye;if(I.ATH.decay=Math.pow(10,-12/10*Rt),I.ATH.adjust=.01,I.ATH.adjustLimit=1,st(I.bo_l[O.SBMAX_l-1]<=I.npart_l),st(I.bo_s[O.SBMAX_s-1]<=I.npart_s),x.ATHtype!=-1){var be,Ne=x.out_samplerate/O.BLKSIZE,Qe=0;for(be=0,U=0;U<O.BLKSIZE/2;++U)be+=Ne,I.ATH.eql_w[U]=1/Math.pow(10,this.ATHformula(be,x)/10),Qe+=I.ATH.eql_w[U];for(Qe=1/Qe,U=O.BLKSIZE/2;--U>=0;)I.ATH.eql_w[U]*=Qe}{for(var Xe=ne=0;Xe<I.npart_s;++Xe)for(U=0;U<I.numlines_s[Xe];++U)++ne;for(var Xe=ne=0;Xe<I.npart_l;++Xe)for(U=0;U<I.numlines_l[Xe];++U)++ne}for(ne=0,U=0;U<I.npart_l;U++){var be=Ye*(ne+I.numlines_l[U]/2)/(1*O.BLKSIZE);I.mld_cb_l[U]=te(be),ne+=I.numlines_l[U]}for(;U<O.CBANDS;++U)I.mld_cb_l[U]=1;for(ne=0,U=0;U<I.npart_s;U++){var be=Ye*(ne+I.numlines_s[U]/2)/(1*O.BLKSIZE_s);I.mld_cb_s[U]=te(be),ne+=I.numlines_s[U]}for(;U<O.CBANDS;++U)I.mld_cb_s[U]=1;return 0};function Be(x,I){x<-.3&&(x=3410),x/=1e3,x=Math.max(.1,x);var U=3.64*Math.pow(x,-.8)-6.8*Math.exp(-.6*Math.pow(x-3.4,2))+6*Math.exp(-.15*Math.pow(x-8.7,2))+(.6+.04*I)*.001*Math.pow(x,4);return U}this.ATHformula=function(x,I){var U;switch(I.ATHtype){case 0:U=Be(x,9);break;case 1:U=Be(x,-1);break;case 2:U=Be(x,0);break;case 3:U=Be(x,1)+6;break;case 4:U=Be(x,I.ATHcurve);break;default:U=Be(x,0);break}return U}}function P3(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=vt.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var ua={};ua.SFBMAX=O.SBMAX_s*3;var D3=Oe.new_float,Ma=Oe.new_int;function ri(){this.xr=D3(576),this.l3_enc=Ma(576),this.scalefac=Ma(ua.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=Ma(3),this.subblock_gain=Ma(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=Ma(ua.SFBMAX),this.window=Ma(ua.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=Ma(4),this.max_nonzero_coeff=0;var e=this;function t(a){return new Int32Array(a)}function s(a){return new Float32Array(a)}this.assign=function(a){e.xr=s(a.xr),e.l3_enc=t(a.l3_enc),e.scalefac=t(a.scalefac),e.xrpow_max=a.xrpow_max,e.part2_3_length=a.part2_3_length,e.big_values=a.big_values,e.count1=a.count1,e.global_gain=a.global_gain,e.scalefac_compress=a.scalefac_compress,e.block_type=a.block_type,e.mixed_block_flag=a.mixed_block_flag,e.table_select=t(a.table_select),e.subblock_gain=t(a.subblock_gain),e.region0_count=a.region0_count,e.region1_count=a.region1_count,e.preflag=a.preflag,e.scalefac_scale=a.scalefac_scale,e.count1table_select=a.count1table_select,e.part2_length=a.part2_length,e.sfb_lmax=a.sfb_lmax,e.sfb_smin=a.sfb_smin,e.psy_lmax=a.psy_lmax,e.sfbmax=a.sfbmax,e.psymax=a.psymax,e.sfbdivide=a.sfbdivide,e.width=t(a.width),e.window=t(a.window),e.count1bits=a.count1bits,e.sfb_partition_table=a.sfb_partition_table.slice(0),e.slen=t(a.slen),e.max_nonzero_coeff=a.max_nonzero_coeff}}var l1=Oe.new_int;function U3(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[l1(4),l1(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new ri}var jn=Oe.System,Fn=Oe.new_int;function Ns(e,t,s,a){this.l=Fn(1+O.SBMAX_l),this.s=Fn(1+O.SBMAX_s),this.psfb21=Fn(1+O.PSFB21),this.psfb12=Fn(1+O.PSFB12);var n=this.l,r=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],jn.arraycopy(this.arrL,0,n,0,Math.min(this.arrL.length,this.l.length)),jn.arraycopy(this.arrS,0,r,0,Math.min(this.arrS.length,this.s.length)),jn.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),jn.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var io=Oe.new_float,q3=Oe.new_float_n,V3=Oe.new_int;function z3(){this.last_en_subshort=q3([4,9]),this.lastAttacks=V3(4),this.pefirbuf=io(19),this.longfact=io(O.SBMAX_l),this.shortfact=io(O.SBMAX_s),this.attackthre=0,this.attackthre_s=0}function Y3(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var X3=Oe.new_byte,K3=Oe.new_double,ps=Oe.new_float,Aa=Oe.new_float_n,As=Oe.new_int,Hn=Oe.new_int_n;mt.MFSIZE=3*1152+O.ENCDELAY-O.MDCTDELAY;mt.MAX_HEADER_BUF=256;mt.MAX_BITS_PER_CHANNEL=4095;mt.MAX_BITS_PER_GRANULE=7680;mt.BPC=320;function mt(){var e=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=Aa([2,mt.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new U3,this.ms_ratio=ps(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=As(2),this.CurrentStep=As(2),this.masking_lower=0,this.bv_scf=As(576),this.pseudohalf=As(ua.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*mt.BPC+1),this.itime=K3(2),this.sideinfo_len=0,this.sb_sample=Aa([2,2,18,O.SBLIMIT]),this.amp_filter=ps(32);function t(){this.write_timing=0,this.ptr=0,this.buf=X3(e)}this.header=new Array(mt.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new Ns,this.minval_l=ps(O.CBANDS),this.minval_s=ps(O.CBANDS),this.nb_1=Aa([4,O.CBANDS]),this.nb_2=Aa([4,O.CBANDS]),this.nb_s1=Aa([4,O.CBANDS]),this.nb_s2=Aa([4,O.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=ps(4),this.loudness_sq=Aa([2,2]),this.loudness_sq_save=ps(2),this.mld_l=ps(O.SBMAX_l),this.mld_s=ps(O.SBMAX_s),this.bm_l=As(O.SBMAX_l),this.bo_l=As(O.SBMAX_l),this.bm_s=As(O.SBMAX_s),this.bo_s=As(O.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Hn([O.CBANDS,2]),this.s3ind_s=Hn([O.CBANDS,2]),this.numlines_s=As(O.CBANDS),this.numlines_l=As(O.CBANDS),this.rnumlines_l=ps(O.CBANDS),this.mld_cb_l=ps(O.CBANDS),this.mld_cb_s=ps(O.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=ps(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=As(2),this.nsPsy=new z3,this.VBR_seek_table=new Y3,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Hn([16,5]),this.bitrate_blockType_Hist=Hn([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var s=0;s<this.en.length;s++)this.en[s]=new ai;for(var s=0;s<this.thm.length;s++)this.thm[s]=new ai;for(var s=0;s<this.header.length;s++)this.header[s]=new t}var Ta=Oe.new_float;function G3(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=Ta(O.SBMAX_l),this.s=Ta(O.SBMAX_s),this.psfb21=Ta(O.PSFB21),this.psfb12=Ta(O.PSFB12),this.cb_l=Ta(O.CBANDS),this.cb_s=Ta(O.CBANDS),this.eql_w=Ta(O.BLKSIZE/2)}var as=Oe.System,c1=Oe.Arrays;Bt.STEPS_per_dB=100;Bt.MAX_dB=120;Bt.GAIN_NOT_ENOUGH_SAMPLES=-24601;Bt.GAIN_ANALYSIS_ERROR=0;Bt.GAIN_ANALYSIS_OK=1;Bt.INIT_GAIN_ANALYSIS_ERROR=0;Bt.INIT_GAIN_ANALYSIS_OK=1;Bt.YULE_ORDER=10;Bt.MAX_ORDER=Bt.YULE_ORDER;Bt.MAX_SAMP_FREQ=48e3;Bt.RMS_WINDOW_TIME_NUMERATOR=1;Bt.RMS_WINDOW_TIME_DENOMINATOR=20;Bt.MAX_SAMPLES_PER_WINDOW=Bt.MAX_SAMP_FREQ*Bt.RMS_WINDOW_TIME_NUMERATOR/Bt.RMS_WINDOW_TIME_DENOMINATOR+1;function Bt(){var e=64.82,t=.95,s=Bt.RMS_WINDOW_TIME_NUMERATOR,a=Bt.RMS_WINDOW_TIME_DENOMINATOR,n=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],r=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(c,b,w,i,F,B){for(;F--!=0;)w[i]=1e-10+c[b+0]*B[0]-w[i-1]*B[1]+c[b-1]*B[2]-w[i-2]*B[3]+c[b-2]*B[4]-w[i-3]*B[5]+c[b-3]*B[6]-w[i-4]*B[7]+c[b-4]*B[8]-w[i-5]*B[9]+c[b-5]*B[10]-w[i-6]*B[11]+c[b-6]*B[12]-w[i-7]*B[13]+c[b-7]*B[14]-w[i-8]*B[15]+c[b-8]*B[16]-w[i-9]*B[17]+c[b-9]*B[18]-w[i-10]*B[19]+c[b-10]*B[20],++i,++b}function u(c,b,w,i,F,B){for(;F--!=0;)w[i]=c[b+0]*B[0]-w[i-1]*B[1]+c[b-1]*B[2]-w[i-2]*B[3]+c[b-2]*B[4],++i,++b}function _(c,b){for(var w=0;w<MAX_ORDER;w++)c.linprebuf[w]=c.lstepbuf[w]=c.loutbuf[w]=c.rinprebuf[w]=c.rstepbuf[w]=c.routbuf[w]=0;switch(0|b){case 48e3:c.reqindex=0;break;case 44100:c.reqindex=1;break;case 32e3:c.reqindex=2;break;case 24e3:c.reqindex=3;break;case 22050:c.reqindex=4;break;case 16e3:c.reqindex=5;break;case 12e3:c.reqindex=6;break;case 11025:c.reqindex=7;break;case 8e3:c.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return c.sampleWindow=0|(b*s+a-1)/a,c.lsum=0,c.rsum=0,c.totsamp=0,c1.ill(c.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(c,b){return _(c,b)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(c.linpre=MAX_ORDER,c.rinpre=MAX_ORDER,c.lstep=MAX_ORDER,c.rstep=MAX_ORDER,c.lout=MAX_ORDER,c.rout=MAX_ORDER,c1.fill(c.B,0),INIT_GAIN_ANALYSIS_OK)};function l(c){return c*c}this.AnalyzeSamples=function(c,b,w,i,F,B,N){var f,R,C,k,L,m,T;if(B==0)return GAIN_ANALYSIS_OK;switch(T=0,L=B,N){case 1:i=b,F=w;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(B<MAX_ORDER?(as.arraycopy(b,w,c.linprebuf,MAX_ORDER,B),as.arraycopy(i,F,c.rinprebuf,MAX_ORDER,B)):(as.arraycopy(b,w,c.linprebuf,MAX_ORDER,MAX_ORDER),as.arraycopy(i,F,c.rinprebuf,MAX_ORDER,MAX_ORDER));L>0;){m=L>c.sampleWindow-c.totsamp?c.sampleWindow-c.totsamp:L,T<MAX_ORDER?(f=c.linpre+T,R=c.linprebuf,C=c.rinpre+T,k=c.rinprebuf,m>MAX_ORDER-T&&(m=MAX_ORDER-T)):(f=w+T,R=b,C=F+T,k=i),o(R,f,c.lstepbuf,c.lstep+c.totsamp,m,n[c.reqindex]),o(k,C,c.rstepbuf,c.rstep+c.totsamp,m,n[c.reqindex]),u(c.lstepbuf,c.lstep+c.totsamp,c.loutbuf,c.lout+c.totsamp,m,r[c.reqindex]),u(c.rstepbuf,c.rstep+c.totsamp,c.routbuf,c.rout+c.totsamp,m,r[c.reqindex]),f=c.lout+c.totsamp,R=c.loutbuf,C=c.rout+c.totsamp,k=c.routbuf;for(var E=m%8;E--!=0;)c.lsum+=l(R[f++]),c.rsum+=l(k[C++]);for(E=m/8;E--!=0;)c.lsum+=l(R[f+0])+l(R[f+1])+l(R[f+2])+l(R[f+3])+l(R[f+4])+l(R[f+5])+l(R[f+6])+l(R[f+7]),f+=8,c.rsum+=l(k[C+0])+l(k[C+1])+l(k[C+2])+l(k[C+3])+l(k[C+4])+l(k[C+5])+l(k[C+6])+l(k[C+7]),C+=8;if(L-=m,T+=m,c.totsamp+=m,c.totsamp==c.sampleWindow){var h=Bt.STEPS_per_dB*10*Math.log10((c.lsum+c.rsum)/c.totsamp*.5+1e-37),y=h<=0?0:0|h;y>=c.A.length&&(y=c.A.length-1),c.A[y]++,c.lsum=c.rsum=0,as.arraycopy(c.loutbuf,c.totsamp,c.loutbuf,0,MAX_ORDER),as.arraycopy(c.routbuf,c.totsamp,c.routbuf,0,MAX_ORDER),as.arraycopy(c.lstepbuf,c.totsamp,c.lstepbuf,0,MAX_ORDER),as.arraycopy(c.rstepbuf,c.totsamp,c.rstepbuf,0,MAX_ORDER),c.totsamp=0}if(c.totsamp>c.sampleWindow)return GAIN_ANALYSIS_ERROR}return B<MAX_ORDER?(as.arraycopy(c.linprebuf,B,c.linprebuf,0,MAX_ORDER-B),as.arraycopy(c.rinprebuf,B,c.rinprebuf,0,MAX_ORDER-B),as.arraycopy(b,w,c.linprebuf,MAX_ORDER-B,B),as.arraycopy(i,F,c.rinprebuf,MAX_ORDER-B,B)):(as.arraycopy(b,w+B-MAX_ORDER,c.linprebuf,0,MAX_ORDER),as.arraycopy(i,F+B-MAX_ORDER,c.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function v(c,b){var w,i=0;for(w=0;w<b;w++)i+=c[w];if(i==0)return GAIN_NOT_ENOUGH_SAMPLES;var F=0|Math.ceil(i*(1-t));for(w=b;w-- >0&&!((F-=c[w])<=0););return e-w/Bt.STEPS_per_dB}this.GetTitleGain=function(c){for(var b=v(c.A,c.A.length),w=0;w<c.A.length;w++)c.B[w]+=c.A[w],c.A[w]=0;for(var w=0;w<MAX_ORDER;w++)c.linprebuf[w]=c.lstepbuf[w]=c.loutbuf[w]=c.rinprebuf[w]=c.rstepbuf[w]=c.routbuf[w]=0;return c.totsamp=0,c.lsum=c.rsum=0,b}}var Za=Oe.new_float,u1=Oe.new_int;function W3(){this.linprebuf=Za(void 0*2),this.linpre=0,this.lstepbuf=Za(void 0+void 0),this.lstep=0,this.loutbuf=Za(void 0+void 0),this.lout=0,this.rinprebuf=Za(void 0*2),this.rinpre=0,this.rstepbuf=Za(void 0+void 0),this.rstep=0,this.routbuf=Za(void 0+void 0),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=u1(0|void 0*void 0),this.B=u1(0|void 0*void 0)}function Gu(e){this.bits=e}var d1=Oe.new_float,Z3=Oe.new_int,m1=Oe.assert;function Q3(e){var t=e;this.quantize=t,this.iteration_loop=function(s,a,n,r){var o=s.internal_flags,u=d1(ua.SFBMAX),_=d1(576),l=Z3(2),v=0,c,b=o.l3_side,w=new Gu(v);this.quantize.rv.ResvFrameBegin(s,w),v=w.bits;for(var i=0;i<o.mode_gr;i++){c=this.quantize.qupvt.on_pe(s,a,l,v,i,i),o.mode_ext==O.MPG_MD_MS_LR&&(this.quantize.ms_convert(o.l3_side,i),this.quantize.qupvt.reduce_side(l,n[i],v,c));for(var F=0;F<o.channels_out;F++){var B,N,f=b.tt[i][F];f.block_type!=O.SHORT_TYPE?(B=0,N=o.PSY.mask_adjust-B):(B=0,N=o.PSY.mask_adjust_short-B),o.masking_lower=Math.pow(10,N*.1),this.quantize.init_outer_loop(o,f),this.quantize.init_xrpow(o,f,_)&&(this.quantize.qupvt.calc_xmin(s,r[i][F],f,u),this.quantize.outer_loop(s,f,u,_,F,l[F])),this.quantize.iteration_finish_one(o,i,F),m1(f.part2_3_length<=mt.MAX_BITS_PER_CHANNEL),m1(f.part2_3_length<=l[F])}}this.quantize.rv.ResvFrameEnd(o,v)}}function ct(e,t,s,a){this.xlen=e,this.linmax=t,this.table=s,this.hlen=a}var oe={};oe.t1HB=[1,1,1,0];oe.t2HB=[1,2,1,3,1,1,3,2,0];oe.t3HB=[3,2,1,1,1,1,3,2,0];oe.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];oe.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];oe.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];oe.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];oe.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];oe.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];oe.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];oe.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];oe.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];oe.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];oe.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];oe.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];oe.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];oe.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];oe.t1l=[1,4,3,5];oe.t2l=[1,4,7,4,5,7,6,7,8];oe.t3l=[2,3,7,4,4,7,6,7,8];oe.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];oe.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];oe.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];oe.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];oe.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];oe.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];oe.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];oe.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];oe.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];oe.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];oe.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];oe.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];oe.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];oe.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10];oe.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8];oe.ht=[new ct(0,0,null,null),new ct(2,0,oe.t1HB,oe.t1l),new ct(3,0,oe.t2HB,oe.t2l),new ct(3,0,oe.t3HB,oe.t3l),new ct(0,0,null,null),new ct(4,0,oe.t5HB,oe.t5l),new ct(4,0,oe.t6HB,oe.t6l),new ct(6,0,oe.t7HB,oe.t7l),new ct(6,0,oe.t8HB,oe.t8l),new ct(6,0,oe.t9HB,oe.t9l),new ct(8,0,oe.t10HB,oe.t10l),new ct(8,0,oe.t11HB,oe.t11l),new ct(8,0,oe.t12HB,oe.t12l),new ct(16,0,oe.t13HB,oe.t13l),new ct(0,0,null,oe.t16_5l),new ct(16,0,oe.t15HB,oe.t15l),new ct(1,1,oe.t16HB,oe.t16l),new ct(2,3,oe.t16HB,oe.t16l),new ct(3,7,oe.t16HB,oe.t16l),new ct(4,15,oe.t16HB,oe.t16l),new ct(6,63,oe.t16HB,oe.t16l),new ct(8,255,oe.t16HB,oe.t16l),new ct(10,1023,oe.t16HB,oe.t16l),new ct(13,8191,oe.t16HB,oe.t16l),new ct(4,15,oe.t24HB,oe.t24l),new ct(5,31,oe.t24HB,oe.t24l),new ct(6,63,oe.t24HB,oe.t24l),new ct(7,127,oe.t24HB,oe.t24l),new ct(8,255,oe.t24HB,oe.t24l),new ct(9,511,oe.t24HB,oe.t24l),new ct(11,2047,oe.t24HB,oe.t24l),new ct(13,8191,oe.t24HB,oe.t24l),new ct(0,0,oe.t32HB,oe.t32l),new ct(0,0,oe.t33HB,oe.t33l)];oe.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];oe.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];oe.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];oe.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];oe.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];oe.scfsi_band=[0,6,11,16,21];var ka=Oe.VbrMode,Pn=Oe.Float,oo=Oe.Util,Ra=Oe.new_float,J3=Oe.new_int,Mr=Oe.assert;Kt.Q_MAX=257;Kt.Q_MAX2=116;Kt.LARGE_BITS=1e5;Kt.IXMAX_VAL=8206;function Kt(){var e=null,t=null,s=null;this.setModules=function(f,R,C){e=f,t=R,s=C};function a(f){return c[f+Kt.Q_MAX2]}this.IPOW20=function(f){return b[f]};var n=2220446049250313e-31,r=Kt.IXMAX_VAL,o=r+2,u=Kt.Q_MAX,_=Kt.Q_MAX2,l=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var v=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=v,this.sfBandIndex=[new Ns([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Ns([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Ns([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Ns([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Ns([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Ns([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Ns([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Ns([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Ns([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var c=Ra(u+_+1),b=Ra(u),w=Ra(o),i=Ra(o);this.adj43=i;function F(f,R){var C=s.ATHformula(R,f);return C-=l,C=Math.pow(10,C/10+f.ATHlower),C}function B(f){for(var R=f.internal_flags.ATH.l,C=f.internal_flags.ATH.psfb21,k=f.internal_flags.ATH.s,L=f.internal_flags.ATH.psfb12,m=f.internal_flags,T=f.out_samplerate,E=0;E<O.SBMAX_l;E++){var h=m.scalefac_band.l[E],y=m.scalefac_band.l[E+1];R[E]=Pn.MAX_VALUE;for(var g=h;g<y;g++){var p=g*T/1152,M=F(f,p);R[E]=Math.min(R[E],M)}}for(var E=0;E<O.PSFB21;E++){var h=m.scalefac_band.psfb21[E],y=m.scalefac_band.psfb21[E+1];C[E]=Pn.MAX_VALUE;for(var g=h;g<y;g++){var p=g*T/1152,M=F(f,p);C[E]=Math.min(C[E],M)}}for(var E=0;E<O.SBMAX_s;E++){var h=m.scalefac_band.s[E],y=m.scalefac_band.s[E+1];k[E]=Pn.MAX_VALUE;for(var g=h;g<y;g++){var p=g*T/384,M=F(f,p);k[E]=Math.min(k[E],M)}k[E]*=m.scalefac_band.s[E+1]-m.scalefac_band.s[E]}for(var E=0;E<O.PSFB12;E++){var h=m.scalefac_band.psfb12[E],y=m.scalefac_band.psfb12[E+1];L[E]=Pn.MAX_VALUE;for(var g=h;g<y;g++){var p=g*T/384,M=F(f,p);L[E]=Math.min(L[E],M)}L[E]*=m.scalefac_band.s[13]-m.scalefac_band.s[12]}if(f.noATH){for(var E=0;E<O.SBMAX_l;E++)R[E]=1e-20;for(var E=0;E<O.PSFB21;E++)C[E]=1e-20;for(var E=0;E<O.SBMAX_s;E++)k[E]=1e-20;for(var E=0;E<O.PSFB12;E++)L[E]=1e-20}m.ATH.floor=10*Math.log10(F(f,-1))}this.iteration_init=function(f){var R=f.internal_flags,C=R.l3_side,k;if(R.iteration_init_init==0){for(R.iteration_init_init=1,C.main_data_begin=0,B(f),w[0]=0,k=1;k<o;k++)w[k]=Math.pow(k,4/3);for(k=0;k<o-1;k++)i[k]=k+1-Math.pow(.5*(w[k]+w[k+1]),.75);for(i[k]=.5,k=0;k<u;k++)b[k]=Math.pow(2,(k-210)*-.1875);for(k=0;k<=u+_;k++)c[k]=Math.pow(2,(k-210-_)*.25);e.huffman_init(R);{var L,m,T,E;for(k=f.exp_nspsytune>>2&63,k>=32&&(k-=64),L=Math.pow(10,k/4/10),k=f.exp_nspsytune>>8&63,k>=32&&(k-=64),m=Math.pow(10,k/4/10),k=f.exp_nspsytune>>14&63,k>=32&&(k-=64),T=Math.pow(10,k/4/10),k=f.exp_nspsytune>>20&63,k>=32&&(k-=64),E=T*Math.pow(10,k/4/10),k=0;k<O.SBMAX_l;k++){var h;k<=6?h=L:k<=13?h=m:k<=20?h=T:h=E,R.nsPsy.longfact[k]=h}for(k=0;k<O.SBMAX_s;k++){var h;k<=5?h=L:k<=10?h=m:k<=11?h=T:h=E,R.nsPsy.shortfact[k]=h}}}},this.on_pe=function(f,R,C,k,L,m){var T=f.internal_flags,E=0,h,y=J3(2),g,p=new Gu(E),M=t.ResvMaxBits(f,k,p,m);E=p.bits;var S=E+M;for(S>mt.MAX_BITS_PER_GRANULE&&(S=mt.MAX_BITS_PER_GRANULE),h=0,g=0;g<T.channels_out;++g)C[g]=Math.min(mt.MAX_BITS_PER_CHANNEL,E/T.channels_out),y[g]=0|C[g]*R[L][g]/700-C[g],y[g]>k*3/4&&(y[g]=k*3/4),y[g]<0&&(y[g]=0),y[g]+C[g]>mt.MAX_BITS_PER_CHANNEL&&(y[g]=Math.max(0,mt.MAX_BITS_PER_CHANNEL-C[g])),h+=y[g];if(h>M)for(g=0;g<T.channels_out;++g)y[g]=M*y[g]/h;for(g=0;g<T.channels_out;++g)C[g]+=y[g],M-=y[g];for(h=0,g=0;g<T.channels_out;++g)h+=C[g];if(h>mt.MAX_BITS_PER_GRANULE){var j=0;for(g=0;g<T.channels_out;++g)C[g]*=mt.MAX_BITS_PER_GRANULE,C[g]/=h,j+=C[g]}return S},this.reduce_side=function(f,R,C,k){Mr(f[0]+f[1]<=mt.MAX_BITS_PER_GRANULE);var L=.33*(.5-R)/.5;L<0&&(L=0),L>.5&&(L=.5);var m=0|L*.5*(f[0]+f[1]);m>mt.MAX_BITS_PER_CHANNEL-f[0]&&(m=mt.MAX_BITS_PER_CHANNEL-f[0]),m<0&&(m=0),f[1]>=125&&(f[1]-m>125?(f[0]<C&&(f[0]+=m),f[1]-=m):(f[0]+=f[1]-125,f[1]=125)),m=f[0]+f[1],m>k&&(f[0]=k*f[0]/m,f[1]=k*f[1]/m),Mr(f[0]<=mt.MAX_BITS_PER_CHANNEL),Mr(f[1]<=mt.MAX_BITS_PER_CHANNEL),Mr(f[0]+f[1]<=mt.MAX_BITS_PER_GRANULE)},this.athAdjust=function(f,R,C){var k=90.30873362,L=94.82444863,m=oo.FAST_LOG10_X(R,10),T=f*f,E=0;return m-=C,T>1e-20&&(E=1+oo.FAST_LOG10_X(T,10/k)),E<0&&(E=0),m*=E,m+=C+k-L,Math.pow(10,.1*m)},this.calc_xmin=function(f,R,C,k){var L=0,m=f.internal_flags,T,E=0,h=0,y=m.ATH,g=C.xr,p=f.VBR==ka.vbr_mtrh?1:0,M=m.masking_lower;for((f.VBR==ka.vbr_mtrh||f.VBR==ka.vbr_mt)&&(M=1),T=0;T<C.psy_lmax;T++){var S,j,X,D,V,d;f.VBR==ka.vbr_rh||f.VBR==ka.vbr_mtrh?j=athAdjust(y.adjust,y.l[T],y.floor):j=y.adjust*y.l[T],V=C.width[T],X=j/V,D=n,d=V>>1,S=0;do{var A,W;A=g[E]*g[E],S+=A,D+=A<X?A:X,E++,W=g[E]*g[E],S+=W,D+=W<X?W:X,E++}while(--d>0);if(S>j&&h++,T==O.SBPSY_l){var Q=j*m.nsPsy.longfact[T];D<Q&&(D=Q)}if(p!=0&&(j=D),!f.ATHonly){var ve=R.en.l[T];if(ve>0){var Q;Q=S*R.thm.l[T]*M/ve,p!=0&&(Q*=m.nsPsy.longfact[T]),j<Q&&(j=Q)}}p!=0?k[L++]=j:k[L++]=j*m.nsPsy.longfact[T]}var Me=575;if(C.block_type!=O.SHORT_TYPE)for(var Te=576;Te--!=0&&gs.EQ(g[Te],0);)Me=Te;C.max_nonzero_coeff=Me;for(var Y=C.sfb_smin;T<C.psymax;Y++,T+=3){var V,ie,ae;for(f.VBR==ka.vbr_rh||f.VBR==ka.vbr_mtrh?ae=athAdjust(y.adjust,y.s[Y],y.floor):ae=y.adjust*y.s[Y],V=C.width[T],ie=0;ie<3;ie++){var S=0,j,X,D,d=V>>1;X=ae/V,D=n;do{var A,W;A=g[E]*g[E],S+=A,D+=A<X?A:X,E++,W=g[E]*g[E],S+=W,D+=W<X?W:X,E++}while(--d>0);if(S>ae&&h++,Y==O.SBPSY_s){var Q=ae*m.nsPsy.shortfact[Y];D<Q&&(D=Q)}if(p!=0?j=D:j=ae,!f.ATHonly&&!f.ATHshort){var ve=R.en.s[Y][ie];if(ve>0){var Q;Q=S*R.thm.s[Y][ie]*M/ve,p!=0&&(Q*=m.nsPsy.shortfact[Y]),j<Q&&(j=Q)}}p!=0?k[L++]=j:k[L++]=j*m.nsPsy.shortfact[Y]}f.useTemporal&&(k[L-3]>k[L-3+1]&&(k[L-3+1]+=(k[L-3]-k[L-3+1])*m.decay),k[L-3+1]>k[L-3+2]&&(k[L-3+2]+=(k[L-3+1]-k[L-3+2])*m.decay))}return h};function N(f){this.s=f}this.calc_noise_core=function(f,R,C,k){var L=0,m=R.s,T=f.l3_enc;if(m>f.count1)for(;C--!=0;){var E;E=f.xr[m],m++,L+=E*E,E=f.xr[m],m++,L+=E*E}else if(m>f.big_values){var h=Ra(2);for(h[0]=0,h[1]=k;C--!=0;){var E;E=Math.abs(f.xr[m])-h[T[m]],m++,L+=E*E,E=Math.abs(f.xr[m])-h[T[m]],m++,L+=E*E}}else for(;C--!=0;){var E;E=Math.abs(f.xr[m])-w[T[m]]*k,m++,L+=E*E,E=Math.abs(f.xr[m])-w[T[m]]*k,m++,L+=E*E}return R.s=m,L},this.calc_noise=function(f,R,C,k,L){var m=0,T=0,E,h,y=0,g=0,p=0,M=-20,S=0,j=f.scalefac,X=0;for(k.over_SSD=0,E=0;E<f.psymax;E++){var D=f.global_gain-(j[X++]+(f.preflag!=0?v[E]:0)<<f.scalefac_scale+1)-f.subblock_gain[f.window[E]]*8,V=0;if(L!=null&&L.step[E]==D)V=L.noise[E],S+=f.width[E],C[m++]=V/R[T++],V=L.noise_log[E];else{var d=a(D);if(h=f.width[E]>>1,S+f.width[E]>f.max_nonzero_coeff){var A;A=f.max_nonzero_coeff-S+1,A>0?h=A>>1:h=0}var W=new N(S);V=this.calc_noise_core(f,W,h,d),S=W.s,L!=null&&(L.step[E]=D,L.noise[E]=V),V=C[m++]=V/R[T++],V=oo.FAST_LOG10(Math.max(V,1e-20)),L!=null&&(L.noise_log[E]=V)}if(L!=null&&(L.global_gain=f.global_gain),p+=V,V>0){var Q;Q=Math.max(0|V*10+.5,1),k.over_SSD+=Q*Q,y++,g+=V}M=Math.max(M,V)}return k.over_count=y,k.tot_noise=p,k.over_noise=g,k.max_noise=M,y},this.set_pinfo=function(f,R,C,k,L){var m=f.internal_flags,T,E,h,y,g,p=R.scalefac_scale==0?.5:1,M=R.scalefac,S=Ra(L3Side.SFBMAX),j=Ra(L3Side.SFBMAX),X=new CalcNoiseResult;calc_xmin(f,C,R,S),calc_noise(R,S,j,X,null);var D=0;for(E=R.sfb_lmax,R.block_type!=O.SHORT_TYPE&&R.mixed_block_flag==0&&(E=22),T=0;T<E;T++){var V=m.scalefac_band.l[T],d=m.scalefac_band.l[T+1],A=d-V;for(y=0;D<d;D++)y+=R.xr[D]*R.xr[D];y/=A,g=1e15,m.pinfo.en[k][L][T]=g*y,m.pinfo.xfsf[k][L][T]=g*S[T]*j[T]/A,C.en.l[T]>0&&!f.ATHonly?y=y/C.en.l[T]:y=0,m.pinfo.thr[k][L][T]=g*Math.max(y*C.thm.l[T],m.ATH.l[T]),m.pinfo.LAMEsfb[k][L][T]=0,R.preflag!=0&&T>=11&&(m.pinfo.LAMEsfb[k][L][T]=-p*v[T]),T<O.SBPSY_l&&(Mr(M[T]>=0),m.pinfo.LAMEsfb[k][L][T]-=p*M[T])}if(R.block_type==O.SHORT_TYPE)for(E=T,T=R.sfb_smin;T<O.SBMAX_s;T++)for(var V=m.scalefac_band.s[T],d=m.scalefac_band.s[T+1],A=d-V,W=0;W<3;W++){for(y=0,h=V;h<d;h++)y+=R.xr[D]*R.xr[D],D++;y=Math.max(y/A,1e-20),g=1e15,m.pinfo.en_s[k][L][3*T+W]=g*y,m.pinfo.xfsf_s[k][L][3*T+W]=g*S[E]*j[E]/A,C.en.s[T][W]>0?y=y/C.en.s[T][W]:y=0,(f.ATHonly||f.ATHshort)&&(y=0),m.pinfo.thr_s[k][L][3*T+W]=g*Math.max(y*C.thm.s[T][W],m.ATH.s[T]),m.pinfo.LAMEsfb_s[k][L][3*T+W]=-2*R.subblock_gain[W],T<O.SBPSY_s&&(m.pinfo.LAMEsfb_s[k][L][3*T+W]-=p*M[E]),E++}m.pinfo.LAMEqss[k][L]=R.global_gain,m.pinfo.LAMEmainbits[k][L]=R.part2_3_length+R.part2_length,m.pinfo.LAMEsfbits[k][L]=R.part2_length,m.pinfo.over[k][L]=X.over_count,m.pinfo.max_noise[k][L]=X.max_noise*10,m.pinfo.over_noise[k][L]=X.over_noise*10,m.pinfo.tot_noise[k][L]=X.tot_noise*10,m.pinfo.over_SSD[k][L]=X.over_SSD}}var $3=Oe.System,eg=Oe.Arrays,Ar=Oe.new_int,lo=Oe.assert;function rn(){var e=null;this.qupvt=null,this.setModules=function(h){this.qupvt=h,e=h};function t(h){this.bits=0|h}var s=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function a(h,y,g,p,M,S){var j=.5946/y;for(h=h>>1;h--!=0;)M[S++]=j>g[p++]?0:1,M[S++]=j>g[p++]?0:1}function n(h,y,g,p,M,S){h=h>>1;var j=h%2;for(h=h>>1;h--!=0;){var X,D,V,d,A,W,Q,ve;X=g[p++]*y,D=g[p++]*y,A=0|X,V=g[p++]*y,W=0|D,d=g[p++]*y,Q=0|V,X+=e.adj43[A],ve=0|d,D+=e.adj43[W],M[S++]=0|X,V+=e.adj43[Q],M[S++]=0|D,d+=e.adj43[ve],M[S++]=0|V,M[S++]=0|d}if(j!=0){var X,D,A,W;X=g[p++]*y,D=g[p++]*y,A=0|X,W=0|D,X+=e.adj43[A],D+=e.adj43[W],M[S++]=0|X,M[S++]=0|D}}function r(h,y,g,p,M){var S,j,X=0,D,V=0,d=0,A=0,W=y,Q=0,ve=W,Me=0,Te=h,Y=0;for(D=M!=null&&p.global_gain==M.global_gain,p.block_type==O.SHORT_TYPE?j=38:j=21,S=0;S<=j;S++){var ie=-1;if((D||p.block_type==O.NORM_TYPE)&&(ie=p.global_gain-(p.scalefac[S]+(p.preflag!=0?e.pretab[S]:0)<<p.scalefac_scale+1)-p.subblock_gain[p.window[S]]*8),lo(p.width[S]>=0),D&&M.step[S]==ie)V!=0&&(n(V,g,Te,Y,ve,Me),V=0),d!=0&&(a(d,g,Te,Y,ve,Me),d=0);else{var ae=p.width[S];if(X+p.width[S]>p.max_nonzero_coeff){var le;le=p.max_nonzero_coeff-X+1,eg.fill(y,p.max_nonzero_coeff,576,0),ae=le,ae<0&&(ae=0),S=j+1}if(V==0&&d==0&&(ve=W,Me=Q,Te=h,Y=A),M!=null&&M.sfb_count1>0&&S>=M.sfb_count1&&M.step[S]>0&&ie>=M.step[S]?(V!=0&&(n(V,g,Te,Y,ve,Me),V=0,ve=W,Me=Q,Te=h,Y=A),d+=ae):(d!=0&&(a(d,g,Te,Y,ve,Me),d=0,ve=W,Me=Q,Te=h,Y=A),V+=ae),ae<=0){d!=0&&(a(d,g,Te,Y,ve,Me),d=0),V!=0&&(n(V,g,Te,Y,ve,Me),V=0);break}}S<=j&&(Q+=p.width[S],A+=p.width[S],X+=p.width[S])}V!=0&&(n(V,g,Te,Y,ve,Me),V=0),d!=0&&(a(d,g,Te,Y,ve,Me),d=0)}function o(h,y,g){var p=0,M=0;do{var S=h[y++],j=h[y++];p<S&&(p=S),M<j&&(M=j)}while(y<g);return p<M&&(p=M),p}function u(h,y,g,p,M,S){var j=oe.ht[p].xlen*65536+oe.ht[M].xlen,X=0,D;do{var V=h[y++],d=h[y++];V!=0&&(V>14&&(V=15,X+=j),V*=16),d!=0&&(d>14&&(d=15,X+=j),V+=d),X+=oe.largetbl[V]}while(y<g);return D=X&65535,X>>=16,X>D&&(X=D,p=M),S.bits+=X,p}function _(h,y,g,p){var M=0,S=oe.ht[1].hlen;do{var j=h[y+0]*2+h[y+1];y+=2,M+=S[j]}while(y<g);return p.bits+=M,1}function l(h,y,g,p,M){var S=0,j,X=oe.ht[p].xlen,D;p==2?D=oe.table23:D=oe.table56;do{var V=h[y+0]*X+h[y+1];y+=2,S+=D[V]}while(y<g);return j=S&65535,S>>=16,S>j&&(S=j,p++),M.bits+=S,p}function v(h,y,g,p,M){var S=0,j=0,X=0,D=oe.ht[p].xlen,V=oe.ht[p].hlen,d=oe.ht[p+1].hlen,A=oe.ht[p+2].hlen;do{var W=h[y+0]*D+h[y+1];y+=2,S+=V[W],j+=d[W],X+=A[W]}while(y<g);var Q=p;return S>j&&(S=j,Q++),S>X&&(S=X,Q=p+2),M.bits+=S,Q}var c=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function b(h,y,g,p){var M=o(h,y,g);switch(M){case 0:return M;case 1:return _(h,y,g,p);case 2:case 3:return l(h,y,g,c[M-1],p);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return v(h,y,g,c[M-1],p);default:if(M>Kt.IXMAX_VAL)return p.bits=Kt.LARGE_BITS,-1;M-=15;var S;for(S=24;S<32&&!(oe.ht[S].linmax>=M);S++);var j;for(j=S-8;j<24&&!(oe.ht[j].linmax>=M);j++);return u(h,y,g,j,S,p)}}this.noquant_count_bits=function(h,y,g){var p=y.l3_enc,M=Math.min(576,y.max_nonzero_coeff+2>>1<<1);for(g!=null&&(g.sfb_count1=0);M>1&&!(p[M-1]|p[M-2]);M-=2);y.count1=M;for(var S=0,j=0;M>3;M-=4){var X;if(((p[M-1]|p[M-2]|p[M-3]|p[M-4])&2147483647)>1)break;X=((p[M-4]*2+p[M-3])*2+p[M-2])*2+p[M-1],S+=oe.t32l[X],j+=oe.t33l[X]}var D=S;if(y.count1table_select=0,S>j&&(D=j,y.count1table_select=1),y.count1bits=D,y.big_values=M,M==0)return D;if(y.block_type==O.SHORT_TYPE)S=3*h.scalefac_band.s[3],S>y.big_values&&(S=y.big_values),j=y.big_values;else if(y.block_type==O.NORM_TYPE){if(S=y.region0_count=h.bv_scf[M-2],j=y.region1_count=h.bv_scf[M-1],j=h.scalefac_band.l[S+j+2],S=h.scalefac_band.l[S+1],j<M){var V=new t(D);y.table_select[2]=b(p,j,M,V),D=V.bits}}else y.region0_count=7,y.region1_count=O.SBMAX_l-1-7-1,S=h.scalefac_band.l[8],j=M,S>j&&(S=j);if(S=Math.min(S,M),j=Math.min(j,M),S>0){var V=new t(D);y.table_select[0]=b(p,0,S,V),D=V.bits}if(S<j){var V=new t(D);y.table_select[1]=b(p,S,j,V),D=V.bits}if(h.use_best_huffman==2&&(y.part2_3_length=D,best_huffman_divide(h,y),D=y.part2_3_length),g!=null&&y.block_type==O.NORM_TYPE){for(var d=0;h.scalefac_band.l[d]<y.big_values;)d++;g.sfb_count1=d}return D},this.count_bits=function(h,y,g,p){var M=g.l3_enc,S=Kt.IXMAX_VAL/e.IPOW20(g.global_gain);if(g.xrpow_max>S)return Kt.LARGE_BITS;if(r(y,M,e.IPOW20(g.global_gain),g,p),h.substep_shaping&2)for(var j=0,X=g.global_gain+g.scalefac_scale,D=.634521682242439/e.IPOW20(X),V=0;V<g.sfbmax;V++){var d=g.width[V];if(h.pseudohalf[V]==0)j+=d;else{var A;for(A=j,j+=d;A<j;++A)M[A]=y[A]>=D?M[A]:0}}return this.noquant_count_bits(h,g,p)};function w(h,y,g,p,M,S,j){for(var X=y.big_values,D=0;D<=22;D++)p[D]=Kt.LARGE_BITS;for(var D=0;D<16;D++){var V=h.scalefac_band.l[D+1];if(V>=X)break;var d=0,A=new t(d),W=b(g,0,V,A);d=A.bits;for(var Q=0;Q<8;Q++){var ve=h.scalefac_band.l[D+Q+2];if(ve>=X)break;var Me=d;A=new t(Me);var Te=b(g,V,ve,A);Me=A.bits,p[D+Q]>Me&&(p[D+Q]=Me,M[D+Q]=D,S[D+Q]=W,j[D+Q]=Te)}}}function i(h,y,g,p,M,S,j,X){for(var D=y.big_values,V=2;V<O.SBMAX_l+1;V++){var d=h.scalefac_band.l[V];if(d>=D)break;var A=M[V-2]+y.count1bits;if(g.part2_3_length<=A)break;var W=new t(A),Q=b(p,d,D,W);A=W.bits,!(g.part2_3_length<=A)&&(g.assign(y),g.part2_3_length=A,g.region0_count=S[V-2],g.region1_count=V-2-S[V-2],g.table_select[0]=j[V-2],g.table_select[1]=X[V-2],g.table_select[2]=Q)}}this.best_huffman_divide=function(h,y){var g=new ri,p=y.l3_enc,M=Ar(23),S=Ar(23),j=Ar(23),X=Ar(23);if(!(y.block_type==O.SHORT_TYPE&&h.mode_gr==1)){g.assign(y),y.block_type==O.NORM_TYPE&&(w(h,y,p,M,S,j,X),i(h,g,y,p,M,S,j,X));var D=g.big_values;if(!(D==0||(p[D-2]|p[D-1])>1)&&(D=y.count1+2,!(D>576))){g.assign(y),g.count1=D;for(var V=0,d=0;D>g.big_values;D-=4){var A=((p[D-4]*2+p[D-3])*2+p[D-2])*2+p[D-1];V+=oe.t32l[A],d+=oe.t33l[A]}if(g.big_values=D,g.count1table_select=0,V>d&&(V=d,g.count1table_select=1),g.count1bits=V,g.block_type==O.NORM_TYPE)i(h,g,y,p,M,S,j,X);else{if(g.part2_3_length=V,V=h.scalefac_band.l[8],V>D&&(V=D),V>0){var W=new t(g.part2_3_length);g.table_select[0]=b(p,0,V,W),g.part2_3_length=W.bits}if(D>V){var W=new t(g.part2_3_length);g.table_select[1]=b(p,V,D,W),g.part2_3_length=W.bits}y.part2_3_length>g.part2_3_length&&y.assign(g)}}}};var F=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],B=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],N=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],f=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];rn.slen1_tab=N,rn.slen2_tab=f;function R(h,y){for(var g,p=y.tt[1][h],M=y.tt[0][h],S=0;S<oe.scfsi_band.length-1;S++){for(g=oe.scfsi_band[S];g<oe.scfsi_band[S+1]&&!(M.scalefac[g]!=p.scalefac[g]&&p.scalefac[g]>=0);g++);if(g==oe.scfsi_band[S+1]){for(g=oe.scfsi_band[S];g<oe.scfsi_band[S+1];g++)p.scalefac[g]=-1;y.scfsi[h][S]=1}}var j=0,X=0;for(g=0;g<11;g++)p.scalefac[g]!=-1&&(X++,j<p.scalefac[g]&&(j=p.scalefac[g]));for(var D=0,V=0;g<O.SBPSY_l;g++)p.scalefac[g]!=-1&&(V++,D<p.scalefac[g]&&(D=p.scalefac[g]));for(var S=0;S<16;S++)if(j<F[S]&&D<B[S]){var d=N[S]*X+f[S]*V;p.part2_length>d&&(p.part2_length=d,p.scalefac_compress=S)}}this.best_scalefac_store=function(h,y,g,p){var M=p.tt[y][g],S,j,X,D,V=0;for(X=0,S=0;S<M.sfbmax;S++){var d=M.width[S];for(X+=d,D=-d;D<0&&M.l3_enc[D+X]==0;D++);D==0&&(M.scalefac[S]=V=-2)}if(M.scalefac_scale==0&&M.preflag==0){var A=0;for(S=0;S<M.sfbmax;S++)M.scalefac[S]>0&&(A|=M.scalefac[S]);if(!(A&1)&&A!=0){for(S=0;S<M.sfbmax;S++)M.scalefac[S]>0&&(M.scalefac[S]>>=1);M.scalefac_scale=V=1}}if(M.preflag==0&&M.block_type!=O.SHORT_TYPE&&h.mode_gr==2){for(S=11;S<O.SBPSY_l&&!(M.scalefac[S]<e.pretab[S]&&M.scalefac[S]!=-2);S++);if(S==O.SBPSY_l){for(S=11;S<O.SBPSY_l;S++)M.scalefac[S]>0&&(M.scalefac[S]-=e.pretab[S]);M.preflag=V=1}}for(j=0;j<4;j++)p.scfsi[g][j]=0;for(h.mode_gr==2&&y==1&&p.tt[0][g].block_type!=O.SHORT_TYPE&&p.tt[1][g].block_type!=O.SHORT_TYPE&&(R(g,p),V=0),S=0;S<M.sfbmax;S++)M.scalefac[S]==-2&&(M.scalefac[S]=0);V!=0&&(h.mode_gr==2?this.scale_bitcount(M):this.scale_bitcount_lsf(h,M))};function C(h,y){for(var g=0;g<y;++g)if(h[g]<0)return!1;return!0}var k=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],L=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],m=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(h){var y,g,p=0,M=0,S,j=h.scalefac;if(lo(C(j,h.sfbmax)),h.block_type==O.SHORT_TYPE)S=k,h.mixed_block_flag!=0&&(S=L);else if(S=m,h.preflag==0){for(g=11;g<O.SBPSY_l&&!(j[g]<e.pretab[g]);g++);if(g==O.SBPSY_l)for(h.preflag=1,g=11;g<O.SBPSY_l;g++)j[g]-=e.pretab[g]}for(g=0;g<h.sfbdivide;g++)p<j[g]&&(p=j[g]);for(;g<h.sfbmax;g++)M<j[g]&&(M=j[g]);for(h.part2_length=Kt.LARGE_BITS,y=0;y<16;y++)p<F[y]&&M<B[y]&&h.part2_length>S[y]&&(h.part2_length=S[y],h.scalefac_compress=y);return h.part2_length==Kt.LARGE_BITS};var T=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(h,y){var g,p,M,S,j,X,D,V,d=Ar(4),A=y.scalefac;for(y.preflag!=0?g=2:g=0,D=0;D<4;D++)d[D]=0;if(y.block_type==O.SHORT_TYPE){p=1;var W=e.nr_of_sfb_block[g][p];for(V=0,M=0;M<4;M++)for(S=W[M]/3,D=0;D<S;D++,V++)for(j=0;j<3;j++)A[V*3+j]>d[M]&&(d[M]=A[V*3+j])}else{p=0;var W=e.nr_of_sfb_block[g][p];for(V=0,M=0;M<4;M++)for(S=W[M],D=0;D<S;D++,V++)A[V]>d[M]&&(d[M]=A[V])}for(X=!1,M=0;M<4;M++)d[M]>T[g][M]&&(X=!0);if(!X){var Q,ve,Me,Te;for(y.sfb_partition_table=e.nr_of_sfb_block[g][p],M=0;M<4;M++)y.slen[M]=E[d[M]];switch(Q=y.slen[0],ve=y.slen[1],Me=y.slen[2],Te=y.slen[3],g){case 0:y.scalefac_compress=(Q*5+ve<<4)+(Me<<2)+Te;break;case 1:y.scalefac_compress=400+(Q*5+ve<<2)+Me;break;case 2:y.scalefac_compress=500+Q*3+ve;break;default:$3.err.printf(`intensity stereo not implemented yet
`);break}}if(!X)for(lo(y.sfb_partition_table!=null),y.part2_length=0,M=0;M<4;M++)y.part2_length+=y.slen[M]*y.sfb_partition_table[M];return X};var E=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(h){for(var y=2;y<=576;y+=2){for(var g=0,p;h.scalefac_band.l[++g]<y;);for(p=s[g][0];h.scalefac_band.l[p+1]>y;)p--;for(p<0&&(p=s[g][0]),h.bv_scf[y-2]=p,p=s[g][1];h.scalefac_band.l[p+h.bv_scf[y-2]+2]>y;)p--;p<0&&(p=s[g][1]),h.bv_scf[y-1]=p}}}var Ls=Oe.System,tg=Oe.Arrays,sg=Oe.new_byte,ag=Oe.new_float_n,rg=Oe.new_int,Ht=Oe.assert;gs.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=Math.abs(e)*1e-6:Math.abs(e-t)<=Math.abs(t)*1e-6};gs.NEQ=function(e,t){return!gs.EQ(e,t)};function gs(){var e=this,t=32773,s=null,a=null,n=null,r=null;this.setModules=function(T,E,h,y){s=T,a=E,n=h,r=y};var o=null,u=0,_=0,l=0;this.getframebits=function(T){var E=T.internal_flags,h;E.bitrate_index!=0?h=oe.bitrate_table[T.version][E.bitrate_index]:h=T.brate;var y=0|(T.version+1)*72e3*h/T.out_samplerate+E.padding;return 8*y};function v(T){Ls.arraycopy(T.header[T.w_ptr].buf,0,o,_,T.sideinfo_len),_+=T.sideinfo_len,u+=T.sideinfo_len*8,T.w_ptr=T.w_ptr+1&mt.MAX_HEADER_BUF-1}function c(T,E,h){for(;h>0;){var y;l==0&&(l=8,_++,Ht(T.header[T.w_ptr].write_timing>=u),T.header[T.w_ptr].write_timing==u&&v(T),o[_]=0),y=Math.min(h,l),h-=y,l-=y,o[_]|=E>>h<<l,u+=y}}function b(T,E,h){for(;h>0;){var y;l==0&&(l=8,_++,o[_]=0),y=Math.min(h,l),h-=y,l-=y,o[_]|=E>>h<<l,u+=y}}function w(T,E){var h=T.internal_flags,y;if(E>=8&&(c(h,76,8),E-=8),E>=8&&(c(h,65,8),E-=8),E>=8&&(c(h,77,8),E-=8),E>=8&&(c(h,69,8),E-=8),E>=32){var g=n.getLameShortVersion();if(E>=32)for(y=0;y<g.length&&E>=8;++y)E-=8,c(h,g.charAt(y),8)}for(;E>=1;E-=1)c(h,h.ancillary_flag,1),h.ancillary_flag^=T.disable_reservoir?0:1}function i(T,E,h){for(var y=T.header[T.h_ptr].ptr;h>0;){var g=Math.min(h,8-(y&7));h-=g,T.header[T.h_ptr].buf[y>>3]|=E>>h<<8-(y&7)-g,y+=g}T.header[T.h_ptr].ptr=y}function F(T,E){T<<=8;for(var h=0;h<8;h++)T<<=1,E<<=1,(E^T)&65536&&(E^=t);return E}this.CRC_writeheader=function(T,E){var h=65535;h=F(E[2]&255,h),h=F(E[3]&255,h);for(var y=6;y<T.sideinfo_len;y++)h=F(E[y]&255,h);E[4]=byte(h>>8),E[5]=byte(h&255)};function B(T,E){var h=T.internal_flags,y,g,p;if(y=h.l3_side,h.header[h.h_ptr].ptr=0,tg.fill(h.header[h.h_ptr].buf,0,h.sideinfo_len,0),T.out_samplerate<16e3?i(h,4094,12):i(h,4095,12),i(h,T.version,1),i(h,1,2),i(h,T.error_protection?0:1,1),i(h,h.bitrate_index,4),i(h,h.samplerate_index,2),i(h,h.padding,1),i(h,T.extension,1),i(h,T.mode.ordinal(),2),i(h,h.mode_ext,2),i(h,T.copyright,1),i(h,T.original,1),i(h,T.emphasis,2),T.error_protection&&i(h,0,16),T.version==1){for(Ht(y.main_data_begin>=0),i(h,y.main_data_begin,9),h.channels_out==2?i(h,y.private_bits,3):i(h,y.private_bits,5),p=0;p<h.channels_out;p++){var M;for(M=0;M<4;M++)i(h,y.scfsi[p][M],1)}for(g=0;g<2;g++)for(p=0;p<h.channels_out;p++){var S=y.tt[g][p];i(h,S.part2_3_length+S.part2_length,12),i(h,S.big_values/2,9),i(h,S.global_gain,8),i(h,S.scalefac_compress,4),S.block_type!=O.NORM_TYPE?(i(h,1,1),i(h,S.block_type,2),i(h,S.mixed_block_flag,1),S.table_select[0]==14&&(S.table_select[0]=16),i(h,S.table_select[0],5),S.table_select[1]==14&&(S.table_select[1]=16),i(h,S.table_select[1],5),i(h,S.subblock_gain[0],3),i(h,S.subblock_gain[1],3),i(h,S.subblock_gain[2],3)):(i(h,0,1),S.table_select[0]==14&&(S.table_select[0]=16),i(h,S.table_select[0],5),S.table_select[1]==14&&(S.table_select[1]=16),i(h,S.table_select[1],5),S.table_select[2]==14&&(S.table_select[2]=16),i(h,S.table_select[2],5),Ht(S.region0_count>=0&&S.region0_count<16),Ht(S.region1_count>=0&&S.region1_count<8),i(h,S.region0_count,4),i(h,S.region1_count,3)),i(h,S.preflag,1),i(h,S.scalefac_scale,1),i(h,S.count1table_select,1)}}else for(Ht(y.main_data_begin>=0),i(h,y.main_data_begin,8),i(h,y.private_bits,h.channels_out),g=0,p=0;p<h.channels_out;p++){var S=y.tt[g][p];i(h,S.part2_3_length+S.part2_length,12),i(h,S.big_values/2,9),i(h,S.global_gain,8),i(h,S.scalefac_compress,9),S.block_type!=O.NORM_TYPE?(i(h,1,1),i(h,S.block_type,2),i(h,S.mixed_block_flag,1),S.table_select[0]==14&&(S.table_select[0]=16),i(h,S.table_select[0],5),S.table_select[1]==14&&(S.table_select[1]=16),i(h,S.table_select[1],5),i(h,S.subblock_gain[0],3),i(h,S.subblock_gain[1],3),i(h,S.subblock_gain[2],3)):(i(h,0,1),S.table_select[0]==14&&(S.table_select[0]=16),i(h,S.table_select[0],5),S.table_select[1]==14&&(S.table_select[1]=16),i(h,S.table_select[1],5),S.table_select[2]==14&&(S.table_select[2]=16),i(h,S.table_select[2],5),Ht(S.region0_count>=0&&S.region0_count<16),Ht(S.region1_count>=0&&S.region1_count<8),i(h,S.region0_count,4),i(h,S.region1_count,3)),i(h,S.scalefac_scale,1),i(h,S.count1table_select,1)}T.error_protection&&CRC_writeheader(h,h.header[h.h_ptr].buf);{var j=h.h_ptr;Ht(h.header[j].ptr==h.sideinfo_len*8),h.h_ptr=j+1&mt.MAX_HEADER_BUF-1,h.header[h.h_ptr].write_timing=h.header[j].write_timing+E,h.h_ptr==h.w_ptr&&Ls.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function N(T,E){var h=oe.ht[E.count1table_select+32],y,g=0,p=E.big_values,M=E.big_values;for(Ht(E.count1table_select<2),y=(E.count1-E.big_values)/4;y>0;--y){var S=0,j=0,X;X=E.l3_enc[p+0],X!=0&&(j+=8,E.xr[M+0]<0&&S++),X=E.l3_enc[p+1],X!=0&&(j+=4,S*=2,E.xr[M+1]<0&&S++),X=E.l3_enc[p+2],X!=0&&(j+=2,S*=2,E.xr[M+2]<0&&S++),X=E.l3_enc[p+3],X!=0&&(j++,S*=2,E.xr[M+3]<0&&S++),p+=4,M+=4,c(T,S+h.table[j],h.hlen[j]),g+=h.hlen[j]}return g}function f(T,E,h,y,g){var p=oe.ht[E],M=0;if(E==0)return M;for(var S=h;S<y;S+=2){var j=0,X=0,D=p.xlen,V=p.xlen,d=0,A=g.l3_enc[S],W=g.l3_enc[S+1];if(A!=0&&(g.xr[S]<0&&d++,j--),E>15){if(A>14){var Q=A-15;Ht(Q<=p.linmax),d|=Q<<1,X=D,A=15}if(W>14){var ve=W-15;Ht(ve<=p.linmax),d<<=D,d|=ve,X+=D,W=15}V=16}W!=0&&(d<<=1,g.xr[S+1]<0&&d++,j--),A=A*V+W,X-=j,j+=p.hlen[A],c(T,p.table[A],j),c(T,d,X),M+=j+X}return M}function R(T,E){var h=3*T.scalefac_band.s[3];h>E.big_values&&(h=E.big_values);var y=f(T,E.table_select[0],0,h,E);return y+=f(T,E.table_select[1],h,E.big_values,E),y}function C(T,E){var h,y,g,p;h=E.big_values;var M=E.region0_count+1;return Ht(M<T.scalefac_band.l.length),g=T.scalefac_band.l[M],M+=E.region1_count+1,Ht(M<T.scalefac_band.l.length),p=T.scalefac_band.l[M],g>h&&(g=h),p>h&&(p=h),y=f(T,E.table_select[0],0,g,E),y+=f(T,E.table_select[1],g,p,E),y+=f(T,E.table_select[2],p,h,E),y}function k(T){var E,h,y,g,p=0,M=T.internal_flags,S=M.l3_side;if(T.version==1)for(E=0;E<2;E++)for(h=0;h<M.channels_out;h++){var j=S.tt[E][h],X=rn.slen1_tab[j.scalefac_compress],D=rn.slen2_tab[j.scalefac_compress];for(g=0,y=0;y<j.sfbdivide;y++)j.scalefac[y]!=-1&&(c(M,j.scalefac[y],X),g+=X);for(;y<j.sfbmax;y++)j.scalefac[y]!=-1&&(c(M,j.scalefac[y],D),g+=D);Ht(g==j.part2_length),j.block_type==O.SHORT_TYPE?g+=R(M,j):g+=C(M,j),g+=N(M,j),Ht(g==j.part2_3_length+j.part2_length),p+=g}else for(E=0,h=0;h<M.channels_out;h++){var j=S.tt[E][h],V,d,A=0;if(Ht(j.sfb_partition_table!=null),g=0,y=0,d=0,j.block_type==O.SHORT_TYPE){for(;d<4;d++){var W=j.sfb_partition_table[d]/3,Q=j.slen[d];for(V=0;V<W;V++,y++)c(M,Math.max(j.scalefac[y*3+0],0),Q),c(M,Math.max(j.scalefac[y*3+1],0),Q),c(M,Math.max(j.scalefac[y*3+2],0),Q),A+=3*Q}g+=R(M,j)}else{for(;d<4;d++){var W=j.sfb_partition_table[d],Q=j.slen[d];for(V=0;V<W;V++,y++)c(M,Math.max(j.scalefac[y],0),Q),A+=Q}g+=C(M,j)}g+=N(M,j),Ht(g==j.part2_3_length),Ht(A==j.part2_length),p+=A+g}return p}function L(){this.total=0}function m(T,E){var h=T.internal_flags,y,g,p,M,S;return S=h.w_ptr,M=h.h_ptr-1,M==-1&&(M=mt.MAX_HEADER_BUF-1),y=h.header[M].write_timing-u,E.total=y,y>=0&&(g=1+M-S,M<S&&(g=1+M-S+mt.MAX_HEADER_BUF),y-=g*8*h.sideinfo_len),p=e.getframebits(T),y+=p,E.total+=p,E.total%8!=0?E.total=1+E.total/8:E.total=E.total/8,E.total+=_+1,y<0&&Ls.err.println(`strange error flushing buffer ... 
`),y}this.flush_bitstream=function(T){var E=T.internal_flags,h,y,g=E.h_ptr-1;if(g==-1&&(g=mt.MAX_HEADER_BUF-1),h=E.l3_side,!((y=m(T,new L))<0)){if(w(T,y),Ht(E.header[g].write_timing+this.getframebits(T)==u),E.ResvSize=0,h.main_data_begin=0,E.findReplayGain){var p=s.GetTitleGain(E.rgdata);Ht(NEQ(p,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),E.RadioGain=Math.floor(p*10+.5)|0}E.findPeakSample&&(E.noclipGainChange=Math.ceil(Math.log10(E.PeakSample/32767)*20*10)|0,E.noclipGainChange>0&&(EQ(T.scale,1)||EQ(T.scale,0))?E.noclipScale=Math.floor(32767/E.PeakSample*100)/100:E.noclipScale=-1)}},this.add_dummy_byte=function(T,E,h){for(var y=T.internal_flags,g;h-- >0;)for(b(y,E,8),g=0;g<mt.MAX_HEADER_BUF;++g)y.header[g].write_timing+=8},this.format_bitstream=function(T){var E=T.internal_flags,h;h=E.l3_side;var y=this.getframebits(T);w(T,h.resvDrain_pre),B(T,y);var g=8*E.sideinfo_len;if(g+=k(T),w(T,h.resvDrain_post),g+=h.resvDrain_post,h.main_data_begin+=(y-g)/8,m(T,new L)!=E.ResvSize&&Ls.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),h.main_data_begin*8!=E.ResvSize&&(Ls.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*h.main_data_begin,E.ResvSize,h.resvDrain_post,h.resvDrain_pre,8*E.sideinfo_len,g-h.resvDrain_post-8*E.sideinfo_len,g,g%8,y),Ls.err.println("This is a fatal error.  It has several possible causes:"),Ls.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),Ls.err.println(" 9%%  Your system is overclocked"),Ls.err.println(" 1%%  bug in LAME encoding library"),E.ResvSize=h.main_data_begin*8),u>1e9){var p;for(p=0;p<mt.MAX_HEADER_BUF;++p)E.header[p].write_timing-=u;u=0}return 0},this.copy_buffer=function(T,E,h,y,g){var p=_+1;if(p<=0)return 0;if(y!=0&&p>y)return-1;if(Ls.arraycopy(o,0,E,h,p),_=-1,l=0,g!=0){var M=rg(1);if(M[0]=T.nMusicCRC,r.updateMusicCRC(M,E,h,p),T.nMusicCRC=M[0],p>0&&(T.VBR_seek_table.nBytesWritten+=p),T.decode_on_the_fly){for(var S=ag([2,1152]),j=p,X=-1,D;X!=0;)if(X=a.hip_decode1_unclipped(T.hip,E,h,j,S[0],S[1]),j=0,X==-1&&(X=0),X>0){if(T.findPeakSample){for(D=0;D<X;D++)S[0][D]>T.PeakSample?T.PeakSample=S[0][D]:-S[0][D]>T.PeakSample&&(T.PeakSample=-S[0][D]);if(T.channels_out>1)for(D=0;D<X;D++)S[1][D]>T.PeakSample?T.PeakSample=S[1][D]:-S[1][D]>T.PeakSample&&(T.PeakSample=-S[1][D])}if(T.findReplayGain&&s.AnalyzeSamples(T.rgdata,S[0],0,S[1],0,X,T.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return p},this.init_bit_stream_w=function(T){o=sg($e.LAME_MAXMP3BUFFER),T.h_ptr=T.w_ptr=0,T.header[T.h_ptr].write_timing=0,_=-1,l=0,u=0}}var ng=Oe.System,St=Oe.VbrMode,co=Oe.ShortBlock,xa=Oe.new_float,f1=Oe.new_int_n,ig=Oe.new_short_n,sa=Oe.assert;function $e(){var e=this,t=128*1024;$e.V9=410,$e.V8=420,$e.V7=430,$e.V6=440,$e.V5=450,$e.V4=460,$e.V3=470,$e.V2=480,$e.V1=490,$e.V0=500,$e.R3MIX=1e3,$e.STANDARD=1001,$e.EXTREME=1002,$e.INSANE=1003,$e.STANDARD_FAST=1004,$e.EXTREME_FAST=1005,$e.MEDIUM=1006,$e.MEDIUM_FAST=1007;var s=16384+t;$e.LAME_MAXMP3BUFFER=s;var a,n,r,o,u,_=new no,l,v,c;this.enc=new O,this.setModules=function(d,A,W,Q,ve,Me,Te,Y,ie){a=d,n=A,r=W,o=Q,u=ve,l=Me,v=Y,c=ie,this.enc.setModules(n,_,o,l)};function b(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=xa(O.SBMAX_l),this.bo_s_weight=xa(O.SBMAX_s)}function w(){this.lowerlimit=0}function i(d,A){this.lowpass=A}var F=4294479419;function B(d){var A;return d.class_id=F,A=d.internal_flags=new mt,d.mode=vt.NOT_SET,d.original=1,d.in_samplerate=44100,d.num_channels=2,d.num_samples=-1,d.bWriteVbrTag=!0,d.quality=-1,d.short_blocks=null,A.subblock_gain=-1,d.lowpassfreq=0,d.highpassfreq=0,d.lowpasswidth=-1,d.highpasswidth=-1,d.VBR=St.vbr_off,d.VBR_q=4,d.ATHcurve=-1,d.VBR_mean_bitrate_kbps=128,d.VBR_min_bitrate_kbps=0,d.VBR_max_bitrate_kbps=0,d.VBR_hard_min=0,A.VBR_min_bitrate=1,A.VBR_max_bitrate=13,d.quant_comp=-1,d.quant_comp_short=-1,d.msfix=-1,A.resample_ratio=1,A.OldValue[0]=180,A.OldValue[1]=180,A.CurrentStep[0]=4,A.CurrentStep[1]=4,A.masking_lower=1,A.nsPsy.attackthre=-1,A.nsPsy.attackthre_s=-1,d.scale=-1,d.athaa_type=-1,d.ATHtype=-1,d.athaa_loudapprox=-1,d.athaa_sensitivity=0,d.useTemporal=null,d.interChRatio=-1,A.mf_samples_to_encode=O.ENCDELAY+O.POSTDELAY,d.encoder_padding=0,A.mf_size=O.ENCDELAY-O.MDCTDELAY,d.findReplayGain=!1,d.decode_on_the_fly=!1,A.decode_on_the_fly=!1,A.findReplayGain=!1,A.findPeakSample=!1,A.RadioGain=0,A.AudiophileGain=0,A.noclipGainChange=0,A.noclipScale=-1,d.preset=0,d.write_id3tag_automatic=!0,0}this.lame_init=function(){var d=new P3;return B(d),d.lame_allocated_gfp=1,d};function N(d){return d>1?0:d<=0?1:Math.cos(Math.PI/2*d)}this.nearestBitrateFullIndex=function(d){var A=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],W=0,Q=0,ve=0,Me=0;Me=A[16],ve=16,Q=A[16],W=16;for(var Te=0;Te<16;Te++)if(Math.max(d,A[Te+1])!=d){Me=A[Te+1],ve=Te+1,Q=A[Te],W=Te;break}return Me-d>d-Q?W:ve};function f(d,A){var W=44100;return A>=48e3?W=48e3:A>=44100?W=44100:A>=32e3?W=32e3:A>=24e3?W=24e3:A>=22050?W=22050:A>=16e3?W=16e3:A>=12e3?W=12e3:A>=11025?W=11025:A>=8e3&&(W=8e3),d==-1?W:(d<=15960&&(W=44100),d<=15250&&(W=32e3),d<=11220&&(W=24e3),d<=9970&&(W=22050),d<=7230&&(W=16e3),d<=5420&&(W=12e3),d<=4510&&(W=11025),d<=3970&&(W=8e3),A<W?A>44100?48e3:A>32e3?44100:A>24e3?32e3:A>22050?24e3:A>16e3?22050:A>12e3?16e3:A>11025?12e3:A>8e3?11025:8e3:W)}function R(d,A){switch(d){case 44100:return A.version=1,0;case 48e3:return A.version=1,1;case 32e3:return A.version=1,2;case 22050:return A.version=0,0;case 24e3:return A.version=0,1;case 16e3:return A.version=0,2;case 11025:return A.version=0,0;case 12e3:return A.version=0,1;case 8e3:return A.version=0,2;default:return A.version=0,-1}}function C(d,A,W){W<16e3&&(A=2);for(var Q=oe.bitrate_table[A][1],ve=2;ve<=14;ve++)oe.bitrate_table[A][ve]>0&&Math.abs(oe.bitrate_table[A][ve]-d)<Math.abs(Q-d)&&(Q=oe.bitrate_table[A][ve]);return Q}function k(d,A,W){W<16e3&&(A=2);for(var Q=0;Q<=14;Q++)if(oe.bitrate_table[A][Q]>0&&oe.bitrate_table[A][Q]==d)return Q;return-1}function L(d,A){var W=[new i(8,2e3),new i(16,3700),new i(24,3900),new i(32,5500),new i(40,7e3),new i(48,7500),new i(56,1e4),new i(64,11e3),new i(80,13500),new i(96,15100),new i(112,15600),new i(128,17e3),new i(160,17500),new i(192,18600),new i(224,19400),new i(256,19700),new i(320,20500)],Q=e.nearestBitrateFullIndex(A);d.lowerlimit=W[Q].lowpass}function m(d){var A=d.internal_flags,W=32,Q=-1;if(A.lowpass1>0){for(var ve=999,Me=0;Me<=31;Me++){var Te=Me/31;Te>=A.lowpass2&&(W=Math.min(W,Me)),A.lowpass1<Te&&Te<A.lowpass2&&(ve=Math.min(ve,Me))}ve==999?A.lowpass1=(W-.75)/31:A.lowpass1=(ve-.75)/31,A.lowpass2=W/31}if(A.highpass2>0&&A.highpass2<.9*(.75/31)&&(A.highpass1=0,A.highpass2=0,ng.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),A.highpass2>0){for(var Y=-1,Me=0;Me<=31;Me++){var Te=Me/31;Te<=A.highpass1&&(Q=Math.max(Q,Me)),A.highpass1<Te&&Te<A.highpass2&&(Y=Math.max(Y,Me))}A.highpass1=Q/31,Y==-1?A.highpass2=(Q+.75)/31:A.highpass2=(Y+.75)/31}for(var Me=0;Me<32;Me++){var ie,ae,Te=Me/31;A.highpass2>A.highpass1?ie=N((A.highpass2-Te)/(A.highpass2-A.highpass1+1e-20)):ie=1,A.lowpass2>A.lowpass1?ae=N((Te-A.lowpass1)/(A.lowpass2-A.lowpass1+1e-20)):ae=1,A.amp_filter[Me]=ie*ae}}function T(d){var A=d.internal_flags;switch(d.quality){default:case 9:A.psymodel=0,A.noise_shaping=0,A.noise_shaping_amp=0,A.noise_shaping_stop=0,A.use_best_huffman=0,A.full_outer_loop=0;break;case 8:d.quality=7;case 7:A.psymodel=1,A.noise_shaping=0,A.noise_shaping_amp=0,A.noise_shaping_stop=0,A.use_best_huffman=0,A.full_outer_loop=0;break;case 6:A.psymodel=1,A.noise_shaping==0&&(A.noise_shaping=1),A.noise_shaping_amp=0,A.noise_shaping_stop=0,A.subblock_gain==-1&&(A.subblock_gain=1),A.use_best_huffman=0,A.full_outer_loop=0;break;case 5:A.psymodel=1,A.noise_shaping==0&&(A.noise_shaping=1),A.noise_shaping_amp=0,A.noise_shaping_stop=0,A.subblock_gain==-1&&(A.subblock_gain=1),A.use_best_huffman=0,A.full_outer_loop=0;break;case 4:A.psymodel=1,A.noise_shaping==0&&(A.noise_shaping=1),A.noise_shaping_amp=0,A.noise_shaping_stop=0,A.subblock_gain==-1&&(A.subblock_gain=1),A.use_best_huffman=1,A.full_outer_loop=0;break;case 3:A.psymodel=1,A.noise_shaping==0&&(A.noise_shaping=1),A.noise_shaping_amp=1,A.noise_shaping_stop=1,A.subblock_gain==-1&&(A.subblock_gain=1),A.use_best_huffman=1,A.full_outer_loop=0;break;case 2:A.psymodel=1,A.noise_shaping==0&&(A.noise_shaping=1),A.substep_shaping==0&&(A.substep_shaping=2),A.noise_shaping_amp=1,A.noise_shaping_stop=1,A.subblock_gain==-1&&(A.subblock_gain=1),A.use_best_huffman=1,A.full_outer_loop=0;break;case 1:A.psymodel=1,A.noise_shaping==0&&(A.noise_shaping=1),A.substep_shaping==0&&(A.substep_shaping=2),A.noise_shaping_amp=2,A.noise_shaping_stop=1,A.subblock_gain==-1&&(A.subblock_gain=1),A.use_best_huffman=1,A.full_outer_loop=0;break;case 0:A.psymodel=1,A.noise_shaping==0&&(A.noise_shaping=1),A.substep_shaping==0&&(A.substep_shaping=2),A.noise_shaping_amp=2,A.noise_shaping_stop=1,A.subblock_gain==-1&&(A.subblock_gain=1),A.use_best_huffman=1,A.full_outer_loop=0;break}}function E(d){var A=d.internal_flags;d.frameNum=0,d.write_id3tag_automatic&&v.id3tag_write_v2(d),A.bitrate_stereoMode_Hist=f1([16,5]),A.bitrate_blockType_Hist=f1([16,6]),A.PeakSample=0,d.bWriteVbrTag&&l.InitVbrTag(d)}this.lame_init_params=function(d){var A=d.internal_flags;if(A.Class_ID=0,A.ATH==null&&(A.ATH=new G3),A.PSY==null&&(A.PSY=new b),A.rgdata==null&&(A.rgdata=new W3),A.channels_in=d.num_channels,A.channels_in==1&&(d.mode=vt.MONO),A.channels_out=d.mode==vt.MONO?1:2,A.mode_ext=O.MPG_MD_MS_LR,d.mode==vt.MONO&&(d.force_ms=!1),d.VBR==St.vbr_off&&d.VBR_mean_bitrate_kbps!=128&&d.brate==0&&(d.brate=d.VBR_mean_bitrate_kbps),d.VBR==St.vbr_off||d.VBR==St.vbr_mtrh||d.VBR==St.vbr_mt||(d.free_format=!1),d.VBR==St.vbr_off&&d.brate==0&&gs.EQ(d.compression_ratio,0)&&(d.compression_ratio=11.025),d.VBR==St.vbr_off&&d.compression_ratio>0&&(d.out_samplerate==0&&(d.out_samplerate=map2MP3Frequency(int(.97*d.in_samplerate))),d.brate=0|d.out_samplerate*16*A.channels_out/(1e3*d.compression_ratio),A.samplerate_index=R(d.out_samplerate,d),d.free_format||(d.brate=C(d.brate,d.version,d.out_samplerate))),d.out_samplerate!=0&&(d.out_samplerate<16e3?(d.VBR_mean_bitrate_kbps=Math.max(d.VBR_mean_bitrate_kbps,8),d.VBR_mean_bitrate_kbps=Math.min(d.VBR_mean_bitrate_kbps,64)):d.out_samplerate<32e3?(d.VBR_mean_bitrate_kbps=Math.max(d.VBR_mean_bitrate_kbps,8),d.VBR_mean_bitrate_kbps=Math.min(d.VBR_mean_bitrate_kbps,160)):(d.VBR_mean_bitrate_kbps=Math.max(d.VBR_mean_bitrate_kbps,32),d.VBR_mean_bitrate_kbps=Math.min(d.VBR_mean_bitrate_kbps,320))),d.lowpassfreq==0){var W=16e3;switch(d.VBR){case St.vbr_off:{var Q=new w;L(Q,d.brate),W=Q.lowerlimit;break}case St.vbr_abr:{var Q=new w;L(Q,d.VBR_mean_bitrate_kbps),W=Q.lowerlimit;break}case St.vbr_rh:{var ve=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(d.VBR_q>=0&&d.VBR_q<=9){var Me=ve[d.VBR_q],Te=ve[d.VBR_q+1],Y=d.VBR_q_frac;W=linear_int(Me,Te,Y)}else W=19500;break}default:{var ve=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(d.VBR_q>=0&&d.VBR_q<=9){var Me=ve[d.VBR_q],Te=ve[d.VBR_q+1],Y=d.VBR_q_frac;W=linear_int(Me,Te,Y)}else W=19500}}d.mode==vt.MONO&&(d.VBR==St.vbr_off||d.VBR==St.vbr_abr)&&(W*=1.5),d.lowpassfreq=W|0}if(d.out_samplerate==0&&(2*d.lowpassfreq>d.in_samplerate&&(d.lowpassfreq=d.in_samplerate/2),d.out_samplerate=f(d.lowpassfreq|0,d.in_samplerate)),d.lowpassfreq=Math.min(20500,d.lowpassfreq),d.lowpassfreq=Math.min(d.out_samplerate/2,d.lowpassfreq),d.VBR==St.vbr_off&&(d.compression_ratio=d.out_samplerate*16*A.channels_out/(1e3*d.brate)),d.VBR==St.vbr_abr&&(d.compression_ratio=d.out_samplerate*16*A.channels_out/(1e3*d.VBR_mean_bitrate_kbps)),d.bWriteVbrTag||(d.findReplayGain=!1,d.decode_on_the_fly=!1,A.findPeakSample=!1),A.findReplayGain=d.findReplayGain,A.decode_on_the_fly=d.decode_on_the_fly,A.decode_on_the_fly&&(A.findPeakSample=!0),A.findReplayGain&&a.InitGainAnalysis(A.rgdata,d.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return d.internal_flags=null,-6;switch(A.decode_on_the_fly&&!d.decode_only&&(A.hip!=null&&c.hip_decode_exit(A.hip),A.hip=c.hip_decode_init()),A.mode_gr=d.out_samplerate<=24e3?1:2,d.framesize=576*A.mode_gr,d.encoder_delay=O.ENCDELAY,A.resample_ratio=d.in_samplerate/d.out_samplerate,d.VBR){case St.vbr_mt:case St.vbr_rh:case St.vbr_mtrh:{var ie=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];d.compression_ratio=ie[d.VBR_q]}break;case St.vbr_abr:d.compression_ratio=d.out_samplerate*16*A.channels_out/(1e3*d.VBR_mean_bitrate_kbps);break;default:d.compression_ratio=d.out_samplerate*16*A.channels_out/(1e3*d.brate);break}if(d.mode==vt.NOT_SET&&(d.mode=vt.JOINT_STEREO),d.highpassfreq>0?(A.highpass1=2*d.highpassfreq,d.highpasswidth>=0?A.highpass2=2*(d.highpassfreq+d.highpasswidth):A.highpass2=1*2*d.highpassfreq,A.highpass1/=d.out_samplerate,A.highpass2/=d.out_samplerate):(A.highpass1=0,A.highpass2=0),d.lowpassfreq>0?(A.lowpass2=2*d.lowpassfreq,d.lowpasswidth>=0?(A.lowpass1=2*(d.lowpassfreq-d.lowpasswidth),A.lowpass1<0&&(A.lowpass1=0)):A.lowpass1=1*2*d.lowpassfreq,A.lowpass1/=d.out_samplerate,A.lowpass2/=d.out_samplerate):(A.lowpass1=0,A.lowpass2=0),m(d),A.samplerate_index=R(d.out_samplerate,d),A.samplerate_index<0)return d.internal_flags=null,-1;if(d.VBR==St.vbr_off){if(d.free_format)A.bitrate_index=0;else if(d.brate=C(d.brate,d.version,d.out_samplerate),A.bitrate_index=k(d.brate,d.version,d.out_samplerate),A.bitrate_index<=0)return d.internal_flags=null,-1}else A.bitrate_index=1;d.analysis&&(d.bWriteVbrTag=!1),A.pinfo!=null&&(d.bWriteVbrTag=!1),n.init_bit_stream_w(A);for(var ae=A.samplerate_index+3*d.version+6*(d.out_samplerate<16e3?1:0),le=0;le<O.SBMAX_l+1;le++)A.scalefac_band.l[le]=o.sfBandIndex[ae].l[le];for(var le=0;le<O.PSFB21+1;le++){var Ue=(A.scalefac_band.l[22]-A.scalefac_band.l[21])/O.PSFB21,Ze=A.scalefac_band.l[21]+le*Ue;A.scalefac_band.psfb21[le]=Ze}A.scalefac_band.psfb21[O.PSFB21]=576;for(var le=0;le<O.SBMAX_s+1;le++)A.scalefac_band.s[le]=o.sfBandIndex[ae].s[le];for(var le=0;le<O.PSFB12+1;le++){var Ue=(A.scalefac_band.s[13]-A.scalefac_band.s[12])/O.PSFB12,Ze=A.scalefac_band.s[12]+le*Ue;A.scalefac_band.psfb12[le]=Ze}A.scalefac_band.psfb12[O.PSFB12]=192,d.version==1?A.sideinfo_len=A.channels_out==1?21:36:A.sideinfo_len=A.channels_out==1?13:21,d.error_protection&&(A.sideinfo_len+=2),E(d),A.Class_ID=F;{var H;for(H=0;H<19;H++)A.nsPsy.pefirbuf[H]=700*A.mode_gr*A.channels_out;d.ATHtype==-1&&(d.ATHtype=4)}switch(sa(d.VBR_q<=9),sa(d.VBR_q>=0),d.VBR){case St.vbr_mt:d.VBR=St.vbr_mtrh;case St.vbr_mtrh:{d.useTemporal==null&&(d.useTemporal=!1),r.apply_preset(d,500-d.VBR_q*10,0),d.quality<0&&(d.quality=LAME_DEFAULT_QUALITY),d.quality<5&&(d.quality=0),d.quality>5&&(d.quality=5),A.PSY.mask_adjust=d.maskingadjust,A.PSY.mask_adjust_short=d.maskingadjust_short,d.experimentalY?A.sfb21_extra=!1:A.sfb21_extra=d.out_samplerate>44e3,A.iteration_loop=new VBRNewIterationLoop(u);break}case St.vbr_rh:{r.apply_preset(d,500-d.VBR_q*10,0),A.PSY.mask_adjust=d.maskingadjust,A.PSY.mask_adjust_short=d.maskingadjust_short,d.experimentalY?A.sfb21_extra=!1:A.sfb21_extra=d.out_samplerate>44e3,d.quality>6&&(d.quality=6),d.quality<0&&(d.quality=LAME_DEFAULT_QUALITY),A.iteration_loop=new VBROldIterationLoop(u);break}default:{var z;A.sfb21_extra=!1,d.quality<0&&(d.quality=LAME_DEFAULT_QUALITY),z=d.VBR,z==St.vbr_off&&(d.VBR_mean_bitrate_kbps=d.brate),r.apply_preset(d,d.VBR_mean_bitrate_kbps,0),d.VBR=z,A.PSY.mask_adjust=d.maskingadjust,A.PSY.mask_adjust_short=d.maskingadjust_short,z==St.vbr_off?A.iteration_loop=new Q3(u):A.iteration_loop=new ABRIterationLoop(u);break}}if(sa(d.scale>=0),d.VBR!=St.vbr_off){if(A.VBR_min_bitrate=1,A.VBR_max_bitrate=14,d.out_samplerate<16e3&&(A.VBR_max_bitrate=8),d.VBR_min_bitrate_kbps!=0&&(d.VBR_min_bitrate_kbps=C(d.VBR_min_bitrate_kbps,d.version,d.out_samplerate),A.VBR_min_bitrate=k(d.VBR_min_bitrate_kbps,d.version,d.out_samplerate),A.VBR_min_bitrate<0)||d.VBR_max_bitrate_kbps!=0&&(d.VBR_max_bitrate_kbps=C(d.VBR_max_bitrate_kbps,d.version,d.out_samplerate),A.VBR_max_bitrate=k(d.VBR_max_bitrate_kbps,d.version,d.out_samplerate),A.VBR_max_bitrate<0))return-1;d.VBR_min_bitrate_kbps=oe.bitrate_table[d.version][A.VBR_min_bitrate],d.VBR_max_bitrate_kbps=oe.bitrate_table[d.version][A.VBR_max_bitrate],d.VBR_mean_bitrate_kbps=Math.min(oe.bitrate_table[d.version][A.VBR_max_bitrate],d.VBR_mean_bitrate_kbps),d.VBR_mean_bitrate_kbps=Math.max(oe.bitrate_table[d.version][A.VBR_min_bitrate],d.VBR_mean_bitrate_kbps)}return d.tune&&(A.PSY.mask_adjust+=d.tune_value_a,A.PSY.mask_adjust_short+=d.tune_value_a),T(d),sa(d.scale>=0),d.athaa_type<0?A.ATH.useAdjust=3:A.ATH.useAdjust=d.athaa_type,A.ATH.aaSensitivityP=Math.pow(10,d.athaa_sensitivity/-10),d.short_blocks==null&&(d.short_blocks=co.short_block_allowed),d.short_blocks==co.short_block_allowed&&(d.mode==vt.JOINT_STEREO||d.mode==vt.STEREO)&&(d.short_blocks=co.short_block_coupled),d.quant_comp<0&&(d.quant_comp=1),d.quant_comp_short<0&&(d.quant_comp_short=0),d.msfix<0&&(d.msfix=0),d.exp_nspsytune=d.exp_nspsytune|1,d.internal_flags.nsPsy.attackthre<0&&(d.internal_flags.nsPsy.attackthre=no.NSATTACKTHRE),d.internal_flags.nsPsy.attackthre_s<0&&(d.internal_flags.nsPsy.attackthre_s=no.NSATTACKTHRE_S),sa(d.scale>=0),d.scale<0&&(d.scale=1),d.ATHtype<0&&(d.ATHtype=4),d.ATHcurve<0&&(d.ATHcurve=4),d.athaa_loudapprox<0&&(d.athaa_loudapprox=2),d.interChRatio<0&&(d.interChRatio=0),d.useTemporal==null&&(d.useTemporal=!0),A.slot_lag=A.frac_SpF=0,d.VBR==St.vbr_off&&(A.slot_lag=A.frac_SpF=(d.version+1)*72e3*d.brate%d.out_samplerate|0),o.iteration_init(d),_.psymodel_init(d),sa(d.scale>=0),0};function h(d,A){(d.in_buffer_0==null||d.in_buffer_nsamples<A)&&(d.in_buffer_0=xa(A),d.in_buffer_1=xa(A),d.in_buffer_nsamples=A)}this.lame_encode_flush=function(d,A,W,Q){var ve=d.internal_flags,Me=ig([2,1152]),Te=0,Y,ie,ae,le,Ue=ve.mf_samples_to_encode-O.POSTDELAY,Ze=y(d);if(ve.mf_samples_to_encode<1)return 0;for(Y=0,d.in_samplerate!=d.out_samplerate&&(Ue+=16*d.out_samplerate/d.in_samplerate),ae=d.framesize-Ue%d.framesize,ae<576&&(ae+=d.framesize),d.encoder_padding=ae,le=(Ue+ae)/d.framesize;le>0&&Te>=0;){var H=Ze-ve.mf_size,z=d.frameNum;H*=d.in_samplerate,H/=d.out_samplerate,H>1152&&(H=1152),H<1&&(H=1),ie=Q-Y,Q==0&&(ie=0),Te=this.lame_encode_buffer(d,Me[0],Me[1],H,A,W,ie),W+=Te,Y+=Te,le-=z!=d.frameNum?1:0}if(ve.mf_samples_to_encode=0,Te<0||(ie=Q-Y,Q==0&&(ie=0),n.flush_bitstream(d),Te=n.copy_buffer(ve,A,W,ie,1),Te<0))return Te;if(W+=Te,Y+=Te,ie=Q-Y,Q==0&&(ie=0),d.write_id3tag_automatic){if(v.id3tag_write_v1(d),Te=n.copy_buffer(ve,A,W,ie,0),Te<0)return Te;Y+=Te}return Y},this.lame_encode_buffer=function(d,A,W,Q,ve,Me,Te){var Y=d.internal_flags,ie=[null,null];if(Y.Class_ID!=F)return-3;if(Q==0)return 0;h(Y,Q),ie[0]=Y.in_buffer_0,ie[1]=Y.in_buffer_1;for(var ae=0;ae<Q;ae++)ie[0][ae]=A[ae],Y.channels_in>1&&(ie[1][ae]=W[ae]);return g(d,ie[0],ie[1],Q,ve,Me,Te)};function y(d){var A=O.BLKSIZE+d.framesize-O.FFTOFFSET;return A=Math.max(A,512+d.framesize-32),A}function g(d,A,W,Q,ve,Me,Te){var Y=d.internal_flags,ie=0,ae,le,Ue,Ze,H,z=[null,null],ee=[null,null];if(Y.Class_ID!=F)return-3;if(Q==0)return 0;if(H=n.copy_buffer(Y,ve,Me,Te,0),H<0)return H;if(Me+=H,ie+=H,ee[0]=A,ee[1]=W,gs.NEQ(d.scale,0)&&gs.NEQ(d.scale,1))for(le=0;le<Q;++le)ee[0][le]*=d.scale,Y.channels_out==2&&(ee[1][le]*=d.scale);if(gs.NEQ(d.scale_left,0)&&gs.NEQ(d.scale_left,1))for(le=0;le<Q;++le)ee[0][le]*=d.scale_left;if(gs.NEQ(d.scale_right,0)&&gs.NEQ(d.scale_right,1))for(le=0;le<Q;++le)ee[1][le]*=d.scale_right;if(d.num_channels==2&&Y.channels_out==1)for(le=0;le<Q;++le)ee[0][le]=.5*(ee[0][le]+ee[1][le]),ee[1][le]=0;Ze=y(d),z[0]=Y.mfbuf[0],z[1]=Y.mfbuf[1];for(var me=0;Q>0;){var he=[null,null],Ee=0,Re=0;he[0]=ee[0],he[1]=ee[1];var we=new M;if(V(d,z,he,me,Q,we),Ee=we.n_in,Re=we.n_out,Y.findReplayGain&&!Y.decode_on_the_fly&&a.AnalyzeSamples(Y.rgdata,z[0],Y.mf_size,z[1],Y.mf_size,Re,Y.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(Q-=Ee,me+=Ee,Y.channels_out==2,Y.mf_size+=Re,sa(Y.mf_size<=mt.MFSIZE),Y.mf_samples_to_encode<1&&(Y.mf_samples_to_encode=O.ENCDELAY+O.POSTDELAY),Y.mf_samples_to_encode+=Re,Y.mf_size>=Ze){var ke=Te-ie;if(Te==0&&(ke=0),ae=p(d,z[0],z[1],ve,Me,ke),ae<0)return ae;for(Me+=ae,ie+=ae,Y.mf_size-=d.framesize,Y.mf_samples_to_encode-=d.framesize,Ue=0;Ue<Y.channels_out;Ue++)for(le=0;le<Y.mf_size;le++)z[Ue][le]=z[Ue][le+d.framesize]}}return ie}function p(d,A,W,Q,ve,Me){var Te=e.enc.lame_encode_mp3_frame(d,A,W,Q,ve,Me);return d.frameNum++,Te}function M(){this.n_in=0,this.n_out=0}function S(){this.num_used=0}function j(d,A){return A!=0?j(A,d%A):d}function X(d,A,W){var Q=Math.PI*A;d/=W,d<0&&(d=0),d>1&&(d=1);var ve=d-.5,Me=.42-.5*Math.cos(2*d*Math.PI)+.08*Math.cos(4*d*Math.PI);return Math.abs(ve)<1e-9?Q/Math.PI:Me*Math.sin(W*Q*ve)/(Math.PI*W*ve)}function D(d,A,W,Q,ve,Me,Te,Y,ie){var ae=d.internal_flags,le,Ue=0,Ze,H=d.out_samplerate/j(d.out_samplerate,d.in_samplerate);H>mt.BPC&&(H=mt.BPC);var z=Math.abs(ae.resample_ratio-Math.floor(.5+ae.resample_ratio))<1e-4?1:0,ee=1/ae.resample_ratio;ee>1&&(ee=1);var me=31;me%2==0&&--me,me+=z;var he=me+1;if(ae.fill_buffer_resample_init==0){for(ae.inbuf_old[0]=xa(he),ae.inbuf_old[1]=xa(he),le=0;le<=2*H;++le)ae.blackfilt[le]=xa(he);for(ae.itime[0]=0,ae.itime[1]=0,Ue=0;Ue<=2*H;Ue++){var Ee=0,Re=(Ue-H)/(2*H);for(le=0;le<=me;le++)Ee+=ae.blackfilt[Ue][le]=X(le-Re,ee,me);for(le=0;le<=me;le++)ae.blackfilt[Ue][le]/=Ee}ae.fill_buffer_resample_init=1}var we=ae.inbuf_old[ie];for(Ze=0;Ze<Q;Ze++){var ke,_e;if(ke=Ze*ae.resample_ratio,Ue=0|Math.floor(ke-ae.itime[ie]),me+Ue-me/2>=Te)break;var Re=ke-ae.itime[ie]-(Ue+.5*(me%2));_e=0|Math.floor(Re*2*H+H+.5);var Pe=0;for(le=0;le<=me;++le){var je=0|le+Ue-me/2,De;De=je<0?we[he+je]:ve[Me+je],Pe+=De*ae.blackfilt[_e][le]}A[W+Ze]=Pe}if(Y.num_used=Math.min(Te,me+Ue-me/2),ae.itime[ie]+=Y.num_used-Ze*ae.resample_ratio,Y.num_used>=he)for(le=0;le<he;le++)we[le]=ve[Me+Y.num_used+le-he];else{var qe=he-Y.num_used;for(le=0;le<qe;++le)we[le]=we[le+Y.num_used];for(Ue=0;le<he;++le,++Ue)we[le]=ve[Me+Ue];sa(Ue==Y.num_used)}return Ze}function V(d,A,W,Q,ve,Me){var Te=d.internal_flags;if(Te.resample_ratio<.9999||Te.resample_ratio>1.0001)for(var Y=0;Y<Te.channels_out;Y++){var ie=new S;Me.n_out=D(d,A[Y],Te.mf_size,d.framesize,W[Y],Q,ve,ie,Y),Me.n_in=ie.num_used}else{Me.n_out=Math.min(d.framesize,ve),Me.n_in=Me.n_out;for(var ae=0;ae<Me.n_out;++ae)A[0][Te.mf_size+ae]=W[0][Q+ae],Te.channels_out==2&&(A[1][Te.mf_size+ae]=W[1][Q+ae])}}}var Bs=Oe.VbrMode;function og(){function e(l,v,c,b,w,i,F,B,N,f,R,C,k,L,m){this.vbr_q=l,this.quant_comp=v,this.quant_comp_s=c,this.expY=b,this.st_lrm=w,this.st_s=i,this.masking_adj=F,this.masking_adj_short=B,this.ath_lower=N,this.ath_curve=f,this.ath_sensitivity=R,this.interch=C,this.safejoint=k,this.sfb21mod=L,this.msfix=m}function t(l,v,c,b,w,i,F,B,N,f,R,C,k,L){this.quant_comp=v,this.quant_comp_s=c,this.safejoint=b,this.nsmsfix=w,this.st_lrm=i,this.st_s=F,this.nsbass=B,this.scale=N,this.masking_adj=f,this.ath_lower=R,this.ath_curve=C,this.interch=k,this.sfscale=L}var s;this.setModules=function(l){s=l};var a=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],n=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function r(l,v,c){var b=l.VBR==Bs.vbr_rh?a:n,w=l.VBR_q_frac,i=b[v],F=b[v+1],B=i;i.st_lrm=i.st_lrm+w*(F.st_lrm-i.st_lrm),i.st_s=i.st_s+w*(F.st_s-i.st_s),i.masking_adj=i.masking_adj+w*(F.masking_adj-i.masking_adj),i.masking_adj_short=i.masking_adj_short+w*(F.masking_adj_short-i.masking_adj_short),i.ath_lower=i.ath_lower+w*(F.ath_lower-i.ath_lower),i.ath_curve=i.ath_curve+w*(F.ath_curve-i.ath_curve),i.ath_sensitivity=i.ath_sensitivity+w*(F.ath_sensitivity-i.ath_sensitivity),i.interch=i.interch+w*(F.interch-i.interch),i.msfix=i.msfix+w*(F.msfix-i.msfix),_(l,B.vbr_q),c!=0?l.quant_comp=B.quant_comp:Math.abs(l.quant_comp- -1)>0||(l.quant_comp=B.quant_comp),c!=0?l.quant_comp_short=B.quant_comp_s:Math.abs(l.quant_comp_short- -1)>0||(l.quant_comp_short=B.quant_comp_s),B.expY!=0&&(l.experimentalY=B.expY!=0),c!=0?l.internal_flags.nsPsy.attackthre=B.st_lrm:Math.abs(l.internal_flags.nsPsy.attackthre- -1)>0||(l.internal_flags.nsPsy.attackthre=B.st_lrm),c!=0?l.internal_flags.nsPsy.attackthre_s=B.st_s:Math.abs(l.internal_flags.nsPsy.attackthre_s- -1)>0||(l.internal_flags.nsPsy.attackthre_s=B.st_s),c!=0?l.maskingadjust=B.masking_adj:Math.abs(l.maskingadjust-0)>0||(l.maskingadjust=B.masking_adj),c!=0?l.maskingadjust_short=B.masking_adj_short:Math.abs(l.maskingadjust_short-0)>0||(l.maskingadjust_short=B.masking_adj_short),c!=0?l.ATHlower=-B.ath_lower/10:Math.abs(-l.ATHlower*10-0)>0||(l.ATHlower=-B.ath_lower/10),c!=0?l.ATHcurve=B.ath_curve:Math.abs(l.ATHcurve- -1)>0||(l.ATHcurve=B.ath_curve),c!=0?l.athaa_sensitivity=B.ath_sensitivity:Math.abs(l.athaa_sensitivity- -1)>0||(l.athaa_sensitivity=B.ath_sensitivity),B.interch>0&&(c!=0?l.interChRatio=B.interch:Math.abs(l.interChRatio- -1)>0||(l.interChRatio=B.interch)),B.safejoint>0&&(l.exp_nspsytune=l.exp_nspsytune|B.safejoint),B.sfb21mod>0&&(l.exp_nspsytune=l.exp_nspsytune|B.sfb21mod<<20),c!=0?l.msfix=B.msfix:Math.abs(l.msfix- -1)>0||(l.msfix=B.msfix),c==0&&(l.VBR_q=v,l.VBR_q_frac=w)}var o=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function u(l,v,c){var b=v,w=s.nearestBitrateFullIndex(v);if(l.VBR=Bs.vbr_abr,l.VBR_mean_bitrate_kbps=b,l.VBR_mean_bitrate_kbps=Math.min(l.VBR_mean_bitrate_kbps,320),l.VBR_mean_bitrate_kbps=Math.max(l.VBR_mean_bitrate_kbps,8),l.brate=l.VBR_mean_bitrate_kbps,l.VBR_mean_bitrate_kbps>320&&(l.disable_reservoir=!0),o[w].safejoint>0&&(l.exp_nspsytune=l.exp_nspsytune|2),o[w].sfscale>0&&(l.internal_flags.noise_shaping=2),Math.abs(o[w].nsbass)>0){var i=int(o[w].nsbass*4);i<0&&(i+=64),l.exp_nspsytune=l.exp_nspsytune|i<<2}return c!=0?l.quant_comp=o[w].quant_comp:Math.abs(l.quant_comp- -1)>0||(l.quant_comp=o[w].quant_comp),c!=0?l.quant_comp_short=o[w].quant_comp_s:Math.abs(l.quant_comp_short- -1)>0||(l.quant_comp_short=o[w].quant_comp_s),c!=0?l.msfix=o[w].nsmsfix:Math.abs(l.msfix- -1)>0||(l.msfix=o[w].nsmsfix),c!=0?l.internal_flags.nsPsy.attackthre=o[w].st_lrm:Math.abs(l.internal_flags.nsPsy.attackthre- -1)>0||(l.internal_flags.nsPsy.attackthre=o[w].st_lrm),c!=0?l.internal_flags.nsPsy.attackthre_s=o[w].st_s:Math.abs(l.internal_flags.nsPsy.attackthre_s- -1)>0||(l.internal_flags.nsPsy.attackthre_s=o[w].st_s),c!=0?l.scale=o[w].scale:Math.abs(l.scale- -1)>0||(l.scale=o[w].scale),c!=0?l.maskingadjust=o[w].masking_adj:Math.abs(l.maskingadjust-0)>0||(l.maskingadjust=o[w].masking_adj),o[w].masking_adj>0?c!=0?l.maskingadjust_short=o[w].masking_adj*.9:Math.abs(l.maskingadjust_short-0)>0||(l.maskingadjust_short=o[w].masking_adj*.9):c!=0?l.maskingadjust_short=o[w].masking_adj*1.1:Math.abs(l.maskingadjust_short-0)>0||(l.maskingadjust_short=o[w].masking_adj*1.1),c!=0?l.ATHlower=-o[w].ath_lower/10:Math.abs(-l.ATHlower*10-0)>0||(l.ATHlower=-o[w].ath_lower/10),c!=0?l.ATHcurve=o[w].ath_curve:Math.abs(l.ATHcurve- -1)>0||(l.ATHcurve=o[w].ath_curve),c!=0?l.interChRatio=o[w].interch:Math.abs(l.interChRatio- -1)>0||(l.interChRatio=o[w].interch),v}this.apply_preset=function(l,v,c){switch(v){case $e.R3MIX:{v=$e.V3,l.VBR=Bs.vbr_mtrh;break}case $e.MEDIUM:{v=$e.V4,l.VBR=Bs.vbr_rh;break}case $e.MEDIUM_FAST:{v=$e.V4,l.VBR=Bs.vbr_mtrh;break}case $e.STANDARD:{v=$e.V2,l.VBR=Bs.vbr_rh;break}case $e.STANDARD_FAST:{v=$e.V2,l.VBR=Bs.vbr_mtrh;break}case $e.EXTREME:{v=$e.V0,l.VBR=Bs.vbr_rh;break}case $e.EXTREME_FAST:{v=$e.V0,l.VBR=Bs.vbr_mtrh;break}case $e.INSANE:return v=320,l.preset=v,u(l,v,c),l.VBR=Bs.vbr_off,v}switch(l.preset=v,v){case $e.V9:return r(l,9,c),v;case $e.V8:return r(l,8,c),v;case $e.V7:return r(l,7,c),v;case $e.V6:return r(l,6,c),v;case $e.V5:return r(l,5,c),v;case $e.V4:return r(l,4,c),v;case $e.V3:return r(l,3,c),v;case $e.V2:return r(l,2,c),v;case $e.V1:return r(l,1,c),v;case $e.V0:return r(l,0,c),v}return v>=8&&v<=320?u(l,v,c):(l.preset=0,v)};function _(l,v){var c=0;return v<0&&(c=-1,v=0),v>9&&(c=-1,v=9),l.VBR_q=v,l.VBR_q_frac=0,c}}function lg(){this.setModules=function(e,t){}}function uo(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var h1=Oe.new_float,cg=Oe.new_int;function ug(){this.global_gain=0,this.sfb_count1=0,this.step=cg(39),this.noise=h1(39),this.noise_log=h1(39)}var aa=Oe.System,v1=Oe.VbrMode,mo=Oe.Util,Qa=Oe.Arrays,Tr=Oe.new_float,kr=Oe.assert;function dg(){var e;this.rv=null;var t;this.qupvt=null;var s,a=new lg,n;this.setModules=function(N,f,R,C){e=N,t=f,this.rv=f,s=R,this.qupvt=R,n=C,a.setModules(s,n)},this.ms_convert=function(N,f){for(var R=0;R<576;++R){var C=N.tt[f][0].xr[R],k=N.tt[f][1].xr[R];N.tt[f][0].xr[R]=(C+k)*(mo.SQRT2*.5),N.tt[f][1].xr[R]=(C-k)*(mo.SQRT2*.5)}};function r(N,f,R,C){C=0;for(var k=0;k<=R;++k){var L=Math.abs(N.xr[k]);C+=L,f[k]=Math.sqrt(L*Math.sqrt(L)),f[k]>N.xrpow_max&&(N.xrpow_max=f[k])}return C}this.init_xrpow=function(N,f,R){var C=0,k=0|f.max_nonzero_coeff;if(f.xrpow_max=0,Qa.fill(R,k,576,0),C=r(f,R,k,C),C>1e-20){var L=0;N.substep_shaping&2&&(L=1);for(var m=0;m<f.psymax;m++)N.pseudohalf[m]=L;return!0}return Qa.fill(f.l3_enc,0,576,0),!1};function o(N,f){var R=N.ATH,C=f.xr;if(f.block_type!=O.SHORT_TYPE)for(var k=!1,L=O.PSFB21-1;L>=0&&!k;L--){var m=N.scalefac_band.psfb21[L],T=N.scalefac_band.psfb21[L+1],E=s.athAdjust(R.adjust,R.psfb21[L],R.floor);N.nsPsy.longfact[21]>1e-12&&(E*=N.nsPsy.longfact[21]);for(var h=T-1;h>=m;h--)if(Math.abs(C[h])<E)C[h]=0;else{k=!0;break}}else for(var y=0;y<3;y++)for(var k=!1,L=O.PSFB12-1;L>=0&&!k;L--){var m=N.scalefac_band.s[12]*3+(N.scalefac_band.s[13]-N.scalefac_band.s[12])*y+(N.scalefac_band.psfb12[L]-N.scalefac_band.psfb12[0]),T=m+(N.scalefac_band.psfb12[L+1]-N.scalefac_band.psfb12[L]),g=s.athAdjust(R.adjust,R.psfb12[L],R.floor);N.nsPsy.shortfact[12]>1e-12&&(g*=N.nsPsy.shortfact[12]);for(var h=T-1;h>=m;h--)if(Math.abs(C[h])<g)C[h]=0;else{k=!0;break}}}this.init_outer_loop=function(N,f){f.part2_3_length=0,f.big_values=0,f.count1=0,f.global_gain=210,f.scalefac_compress=0,f.table_select[0]=0,f.table_select[1]=0,f.table_select[2]=0,f.subblock_gain[0]=0,f.subblock_gain[1]=0,f.subblock_gain[2]=0,f.subblock_gain[3]=0,f.region0_count=0,f.region1_count=0,f.preflag=0,f.scalefac_scale=0,f.count1table_select=0,f.part2_length=0,f.sfb_lmax=O.SBPSY_l,f.sfb_smin=O.SBPSY_s,f.psy_lmax=N.sfb21_extra?O.SBMAX_l:O.SBPSY_l,f.psymax=f.psy_lmax,f.sfbmax=f.sfb_lmax,f.sfbdivide=11;for(var R=0;R<O.SBMAX_l;R++)f.width[R]=N.scalefac_band.l[R+1]-N.scalefac_band.l[R],f.window[R]=3;if(f.block_type==O.SHORT_TYPE){var C=Tr(576);f.sfb_smin=0,f.sfb_lmax=0,f.mixed_block_flag!=0&&(f.sfb_smin=3,f.sfb_lmax=N.mode_gr*2+4),f.psymax=f.sfb_lmax+3*((N.sfb21_extra?O.SBMAX_s:O.SBPSY_s)-f.sfb_smin),f.sfbmax=f.sfb_lmax+3*(O.SBPSY_s-f.sfb_smin),f.sfbdivide=f.sfbmax-18,f.psy_lmax=f.sfb_lmax;var k=N.scalefac_band.l[f.sfb_lmax];aa.arraycopy(f.xr,0,C,0,576);for(var R=f.sfb_smin;R<O.SBMAX_s;R++)for(var L=N.scalefac_band.s[R],m=N.scalefac_band.s[R+1],T=0;T<3;T++)for(var E=L;E<m;E++)f.xr[k++]=C[3*E+T];for(var h=f.sfb_lmax,R=f.sfb_smin;R<O.SBMAX_s;R++)f.width[h]=f.width[h+1]=f.width[h+2]=N.scalefac_band.s[R+1]-N.scalefac_band.s[R],f.window[h]=0,f.window[h+1]=1,f.window[h+2]=2,h+=3}f.count1bits=0,f.sfb_partition_table=s.nr_of_sfb_block[0][0],f.slen[0]=0,f.slen[1]=0,f.slen[2]=0,f.slen[3]=0,f.max_nonzero_coeff=575,Qa.fill(f.scalefac,0),o(N,f)};function u(N){this.ordinal=N}u.BINSEARCH_NONE=new u(0),u.BINSEARCH_UP=new u(1),u.BINSEARCH_DOWN=new u(2);function _(N,f,R,C,k){var L,m=N.CurrentStep[C],T=!1,E=N.OldValue[C],h=u.BINSEARCH_NONE;for(f.global_gain=E,R-=f.part2_length;;){var y;if(L=n.count_bits(N,k,f,null),m==1||L==R)break;L>R?(h==u.BINSEARCH_DOWN&&(T=!0),T&&(m/=2),h=u.BINSEARCH_UP,y=m):(h==u.BINSEARCH_UP&&(T=!0),T&&(m/=2),h=u.BINSEARCH_DOWN,y=-m),f.global_gain+=y,f.global_gain<0&&(f.global_gain=0,T=!0),f.global_gain>255&&(f.global_gain=255,T=!0)}for(kr(f.global_gain>=0),kr(f.global_gain<256);L>R&&f.global_gain<255;)f.global_gain++,L=n.count_bits(N,k,f,null);return N.CurrentStep[C]=E-f.global_gain>=4?4:2,N.OldValue[C]=f.global_gain,f.part2_3_length=L,L}this.trancate_smallspectrums=function(N,f,R,C){var k=Tr(ua.SFBMAX);if(!(!(N.substep_shaping&4)&&f.block_type==O.SHORT_TYPE||N.substep_shaping&128)){s.calc_noise(f,R,k,new uo,null);for(var m=0;m<576;m++){var L=0;f.l3_enc[m]!=0&&(L=Math.abs(f.xr[m])),C[m]=L}var m=0,T=8;f.block_type==O.SHORT_TYPE&&(T=6);do{var E,h,y,g,p=f.width[T];if(m+=p,!(k[T]>=1)&&(Qa.sort(C,m-p,p),!BitStream.EQ(C[m-1],0))){E=(1-k[T])*R[T],h=0,g=0;do{var M;for(y=1;g+y<p&&!BitStream.NEQ(C[g+m-p],C[g+m+y-p]);y++);if(M=C[g+m-p]*C[g+m-p]*y,E<M){g!=0&&(h=C[g+m-p-1]);break}E-=M,g+=y}while(g<p);if(!BitStream.EQ(h,0))do Math.abs(f.xr[m-p])<=h&&(f.l3_enc[m-p]=0);while(--p>0)}}while(++T<f.psymax);f.part2_3_length=n.noquant_count_bits(N,f,null)}};function l(N){for(var f=0;f<N.sfbmax;f++)if(N.scalefac[f]+N.subblock_gain[N.window[f]]==0)return!1;return!0}function v(N){return mo.FAST_LOG10(.368+.632*N*N*N)}function c(N,f){for(var R=1e-37,C=0;C<f.psymax;C++)R+=v(N[C]);return Math.max(1e-20,R)}function b(N,f,R,C,k){var L;switch(N){default:case 9:{f.over_count>0?(L=R.over_SSD<=f.over_SSD,R.over_SSD==f.over_SSD&&(L=R.bits<f.bits)):L=R.max_noise<0&&R.max_noise*10+R.bits<=f.max_noise*10+f.bits;break}case 0:L=R.over_count<f.over_count||R.over_count==f.over_count&&R.over_noise<f.over_noise||R.over_count==f.over_count&&BitStream.EQ(R.over_noise,f.over_noise)&&R.tot_noise<f.tot_noise;break;case 8:R.max_noise=c(k,C);case 1:L=R.max_noise<f.max_noise;break;case 2:L=R.tot_noise<f.tot_noise;break;case 3:L=R.tot_noise<f.tot_noise&&R.max_noise<f.max_noise;break;case 4:L=R.max_noise<=0&&f.max_noise>.2||R.max_noise<=0&&f.max_noise<0&&f.max_noise>R.max_noise-.2&&R.tot_noise<f.tot_noise||R.max_noise<=0&&f.max_noise>0&&f.max_noise>R.max_noise-.2&&R.tot_noise<f.tot_noise+f.over_noise||R.max_noise>0&&f.max_noise>-.05&&f.max_noise>R.max_noise-.1&&R.tot_noise+R.over_noise<f.tot_noise+f.over_noise||R.max_noise>0&&f.max_noise>-.1&&f.max_noise>R.max_noise-.15&&R.tot_noise+R.over_noise+R.over_noise<f.tot_noise+f.over_noise+f.over_noise;break;case 5:L=R.over_noise<f.over_noise||BitStream.EQ(R.over_noise,f.over_noise)&&R.tot_noise<f.tot_noise;break;case 6:L=R.over_noise<f.over_noise||BitStream.EQ(R.over_noise,f.over_noise)&&(R.max_noise<f.max_noise||BitStream.EQ(R.max_noise,f.max_noise)&&R.tot_noise<=f.tot_noise);break;case 7:L=R.over_count<f.over_count||R.over_noise<f.over_noise;break}return f.over_count==0&&(L=L&&R.bits<f.bits),L}function w(N,f,R,C,k){var L=N.internal_flags,m;f.scalefac_scale==0?m=1.2968395546510096:m=1.6817928305074292;for(var T=0,E=0;E<f.sfbmax;E++)T<R[E]&&(T=R[E]);var h=L.noise_shaping_amp;switch(h==3&&(k?h=2:h=1),h){case 2:break;case 1:T>1?T=Math.pow(T,.5):T*=.95;break;case 0:default:T>1?T=1:T*=.95;break}for(var y=0,E=0;E<f.sfbmax;E++){var g=f.width[E],p;if(y+=g,!(R[E]<T)){if(L.substep_shaping&2&&(L.pseudohalf[E]=L.pseudohalf[E]==0?1:0,L.pseudohalf[E]==0&&L.noise_shaping_amp==2))return;for(f.scalefac[E]++,p=-g;p<0;p++)C[y+p]*=m,C[y+p]>f.xrpow_max&&(f.xrpow_max=C[y+p]);if(L.noise_shaping_amp==2)return}}}function i(N,f){for(var R=1.2968395546510096,C=0,k=0;k<N.sfbmax;k++){var L=N.width[k],m=N.scalefac[k];if(N.preflag!=0&&(m+=s.pretab[k]),C+=L,m&1){m++;for(var T=-L;T<0;T++)f[C+T]*=R,f[C+T]>N.xrpow_max&&(N.xrpow_max=f[C+T])}N.scalefac[k]=m>>1}N.preflag=0,N.scalefac_scale=1}function F(N,f,R){var C,k=f.scalefac;for(C=0;C<f.sfb_lmax;C++)if(k[C]>=16)return!0;for(var L=0;L<3;L++){var m=0,T=0;for(C=f.sfb_lmax+L;C<f.sfbdivide;C+=3)m<k[C]&&(m=k[C]);for(;C<f.sfbmax;C+=3)T<k[C]&&(T=k[C]);if(!(m<16&&T<8)){if(f.subblock_gain[L]>=7)return!0;f.subblock_gain[L]++;var E=N.scalefac_band.l[f.sfb_lmax];for(C=f.sfb_lmax+L;C<f.sfbmax;C+=3){var h,y=f.width[C],g=k[C];if(g=g-(4>>f.scalefac_scale),g>=0){k[C]=g,E+=y*3;continue}k[C]=0;{var p=210+(g<<f.scalefac_scale+1);h=s.IPOW20(p)}E+=y*(L+1);for(var M=-y;M<0;M++)R[E+M]*=h,R[E+M]>f.xrpow_max&&(f.xrpow_max=R[E+M]);E+=y*(3-L-1)}{var h=s.IPOW20(202);E+=f.width[C]*(L+1);for(var M=-f.width[C];M<0;M++)R[E+M]*=h,R[E+M]>f.xrpow_max&&(f.xrpow_max=R[E+M])}}}return!1}function B(N,f,R,C,k){var L=N.internal_flags;w(N,f,R,C,k);var m=l(f);return m?!1:(L.mode_gr==2?m=n.scale_bitcount(f):m=n.scale_bitcount_lsf(L,f),m?(L.noise_shaping>1&&(Qa.fill(L.pseudohalf,0),f.scalefac_scale==0?(i(f,C),m=!1):f.block_type==O.SHORT_TYPE&&L.subblock_gain>0&&(m=F(L,f,C)||l(f))),m||(L.mode_gr==2?m=n.scale_bitcount(f):m=n.scale_bitcount_lsf(L,f)),!m):!0)}this.outer_loop=function(N,f,R,C,k,L){var m=N.internal_flags,T=new ri,E=Tr(576),h=Tr(ua.SFBMAX),y=new uo,g,p=new ug,M=9999999,S=!1,j=!1,X=0;if(_(m,f,L,k,C),m.noise_shaping==0)return 100;s.calc_noise(f,R,h,y,p),y.bits=f.part2_3_length,T.assign(f);var D=0;for(aa.arraycopy(C,0,E,0,576);!S;){do{var V=new uo,d,A=255;if(m.substep_shaping&2?d=20:d=3,m.sfb21_extra&&(h[T.sfbmax]>1||T.block_type==O.SHORT_TYPE&&(h[T.sfbmax+1]>1||h[T.sfbmax+2]>1))||!B(N,T,h,C,j))break;T.scalefac_scale!=0&&(A=254);var W=L-T.part2_length;if(W<=0)break;for(;(T.part2_3_length=n.count_bits(m,C,T,p))>W&&T.global_gain<=A;)T.global_gain++;if(T.global_gain>A)break;if(y.over_count==0){for(;(T.part2_3_length=n.count_bits(m,C,T,p))>M&&T.global_gain<=A;)T.global_gain++;if(T.global_gain>A)break}if(s.calc_noise(T,R,h,V,p),V.bits=T.part2_3_length,f.block_type!=O.SHORT_TYPE?g=N.quant_comp:g=N.quant_comp_short,g=b(g,y,V,T,h)?1:0,g!=0)M=f.part2_3_length,y=V,f.assign(T),D=0,aa.arraycopy(C,0,E,0,576);else if(m.full_outer_loop==0&&(++D>d&&y.over_count==0||m.noise_shaping_amp==3&&j&&D>30||m.noise_shaping_amp==3&&j&&T.global_gain-X>15))break}while(T.global_gain+T.scalefac_scale<255);m.noise_shaping_amp==3?j?S=!0:(T.assign(f),aa.arraycopy(E,0,C,0,576),D=0,X=T.global_gain,j=!0):S=!0}return kr(f.global_gain+f.scalefac_scale<=255),N.VBR==v1.vbr_rh||N.VBR==v1.vbr_mtrh?aa.arraycopy(E,0,C,0,576):m.substep_shaping&1&&trancate_smallspectrums(m,f,R,C),y.over_count},this.iteration_finish_one=function(N,f,R){var C=N.l3_side,k=C.tt[f][R];n.best_scalefac_store(N,f,R,C),N.use_best_huffman==1&&n.best_huffman_divide(N,k),t.ResvAdjust(N,k)},this.VBR_encode_granule=function(N,f,R,C,k,L,m){var T=N.internal_flags,E=new ri,h=Tr(576),y=m,g=m+1,p=(m+L)/2,M,S,j=0,X=T.sfb21_extra;kr(y<=LameInternalFlags.MAX_BITS_PER_CHANNEL),Qa.fill(E.l3_enc,0);do p>y-42?T.sfb21_extra=!1:T.sfb21_extra=X,S=outer_loop(N,f,R,C,k,p),S<=0?(j=1,g=f.part2_3_length,E.assign(f),aa.arraycopy(C,0,h,0,576),m=g-32,M=m-L,p=(m+L)/2):(L=p+32,M=m-L,p=(m+L)/2,j!=0&&(j=2,f.assign(E),aa.arraycopy(h,0,C,0,576)));while(M>12);T.sfb21_extra=X,j==2&&aa.arraycopy(E.l3_enc,0,f.l3_enc,0,576),kr(f.part2_3_length<=y)},this.get_framebits=function(N,f){var R=N.internal_flags;R.bitrate_index=R.VBR_min_bitrate;var C=e.getframebits(N);R.bitrate_index=1,C=e.getframebits(N);for(var k=1;k<=R.VBR_max_bitrate;k++){R.bitrate_index=k;var L=new MeanBits(C);f[k]=t.ResvFrameBegin(N,L),C=L.bits}},this.VBR_old_prepare=function(N,f,R,C,k,L,m,T,E){var h=N.internal_flags,y,g=0,p=1,M=0;h.bitrate_index=h.VBR_max_bitrate;var S=t.ResvFrameBegin(N,new MeanBits(0))/h.mode_gr;get_framebits(N,L);for(var j=0;j<h.mode_gr;j++){var X=s.on_pe(N,f,T[j],S,j,0);h.mode_ext==O.MPG_MD_MS_LR&&(ms_convert(h.l3_side,j),s.reduce_side(T[j],R[j],S,X));for(var D=0;D<h.channels_out;++D){var V=h.l3_side.tt[j][D];V.block_type!=O.SHORT_TYPE?(g=1.28/(1+Math.exp(3.5-f[j][D]/300))-.05,y=h.PSY.mask_adjust-g):(g=2.56/(1+Math.exp(3.5-f[j][D]/300))-.14,y=h.PSY.mask_adjust_short-g),h.masking_lower=Math.pow(10,y*.1),init_outer_loop(h,V),E[j][D]=s.calc_xmin(N,C[j][D],V,k[j][D]),E[j][D]!=0&&(p=0),m[j][D]=126,M+=T[j][D]}}for(var j=0;j<h.mode_gr;j++)for(var D=0;D<h.channels_out;D++)M>L[h.VBR_max_bitrate]&&(T[j][D]*=L[h.VBR_max_bitrate],T[j][D]/=M),m[j][D]>T[j][D]&&(m[j][D]=T[j][D]);return p},this.bitpressure_strategy=function(N,f,R,C){for(var k=0;k<N.mode_gr;k++)for(var L=0;L<N.channels_out;L++){for(var m=N.l3_side.tt[k][L],T=f[k][L],E=0,h=0;h<m.psy_lmax;h++)T[E++]*=1+.029*h*h/O.SBMAX_l/O.SBMAX_l;if(m.block_type==O.SHORT_TYPE)for(var h=m.sfb_smin;h<O.SBMAX_s;h++)T[E++]*=1+.029*h*h/O.SBMAX_s/O.SBMAX_s,T[E++]*=1+.029*h*h/O.SBMAX_s/O.SBMAX_s,T[E++]*=1+.029*h*h/O.SBMAX_s/O.SBMAX_s;C[k][L]=0|Math.max(R[k][L],.9*C[k][L])}},this.VBR_new_prepare=function(N,f,R,C,k,L){var m=N.internal_flags,T=1,E=0,h=0,y;if(N.free_format){m.bitrate_index=0;var g=new MeanBits(E);y=t.ResvFrameBegin(N,g),E=g.bits,k[0]=y}else{m.bitrate_index=m.VBR_max_bitrate;var g=new MeanBits(E);t.ResvFrameBegin(N,g),E=g.bits,get_framebits(N,k),y=k[m.VBR_max_bitrate]}for(var p=0;p<m.mode_gr;p++){s.on_pe(N,f,L[p],E,p,0),m.mode_ext==O.MPG_MD_MS_LR&&ms_convert(m.l3_side,p);for(var M=0;M<m.channels_out;++M){var S=m.l3_side.tt[p][M];m.masking_lower=Math.pow(10,m.PSY.mask_adjust*.1),init_outer_loop(m,S),s.calc_xmin(N,R[p][M],S,C[p][M])!=0&&(T=0),h+=L[p][M]}}for(var p=0;p<m.mode_gr;p++)for(var M=0;M<m.channels_out;M++)h>y&&(L[p][M]*=y,L[p][M]/=h);return T},this.calc_target_bits=function(N,f,R,C,k,L){var m=N.internal_flags,T=m.l3_side,E,h,y,g,p=0;m.bitrate_index=m.VBR_max_bitrate;var M=new MeanBits(p);for(L[0]=t.ResvFrameBegin(N,M),p=M.bits,m.bitrate_index=1,p=e.getframebits(N)-m.sideinfo_len*8,k[0]=p/(m.mode_gr*m.channels_out),p=N.VBR_mean_bitrate_kbps*N.framesize*1e3,m.substep_shaping&1&&(p*=1.09),p/=N.out_samplerate,p-=m.sideinfo_len*8,p/=m.mode_gr*m.channels_out,E=.93+.07*(11-N.compression_ratio)/(11-5.5),E<.9&&(E=.9),E>1&&(E=1),h=0;h<m.mode_gr;h++){var S=0;for(y=0;y<m.channels_out;y++){if(C[h][y]=int(E*p),f[h][y]>700){var j=int((f[h][y]-700)/1.4),X=T.tt[h][y];C[h][y]=int(E*p),X.block_type==O.SHORT_TYPE&&j<p/2&&(j=p/2),j>p*3/2?j=p*3/2:j<0&&(j=0),C[h][y]+=j}C[h][y]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(C[h][y]=LameInternalFlags.MAX_BITS_PER_CHANNEL),S+=C[h][y]}if(S>LameInternalFlags.MAX_BITS_PER_GRANULE)for(y=0;y<m.channels_out;++y)C[h][y]*=LameInternalFlags.MAX_BITS_PER_GRANULE,C[h][y]/=S}if(m.mode_ext==O.MPG_MD_MS_LR)for(h=0;h<m.mode_gr;h++)s.reduce_side(C[h],R[h],p*m.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(g=0,h=0;h<m.mode_gr;h++)for(y=0;y<m.channels_out;y++)C[h][y]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(C[h][y]=LameInternalFlags.MAX_BITS_PER_CHANNEL),g+=C[h][y];if(g>L[0])for(h=0;h<m.mode_gr;h++)for(y=0;y<m.channels_out;y++)C[h][y]*=L[0],C[h][y]/=g}}var _1=Oe.assert;function mg(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,s){var a=t.internal_flags,n,r=a.l3_side,o=e.getframebits(t);s.bits=(o-a.sideinfo_len*8)/a.mode_gr;var u=8*256*a.mode_gr-8;t.brate>320?n=8*int(t.brate*1e3/(t.out_samplerate/1152)/8+.5):(n=8*1440,t.strict_ISO&&(n=8*int(32e4/(t.out_samplerate/1152)/8+.5))),a.ResvMax=n-o,a.ResvMax>u&&(a.ResvMax=u),(a.ResvMax<0||t.disable_reservoir)&&(a.ResvMax=0);var _=s.bits*a.mode_gr+Math.min(a.ResvSize,a.ResvMax);return _>n&&(_=n),_1(a.ResvMax%8==0),_1(a.ResvMax>=0),r.resvDrain_pre=0,a.pinfo!=null&&(a.pinfo.mean_bits=s.bits/2,a.pinfo.resvsize=a.ResvSize),_},this.ResvMaxBits=function(t,s,a,n){var r=t.internal_flags,o,u=r.ResvSize,_=r.ResvMax;n!=0&&(u+=s),r.substep_shaping&1&&(_*=.9),a.bits=s,u*10>_*9?(o=u-_*9/10,a.bits+=o,r.substep_shaping|=128):(o=0,r.substep_shaping&=127,!t.disable_reservoir&&!(r.substep_shaping&1)&&(a.bits-=.1*s));var l=u<r.ResvMax*6/10?u:r.ResvMax*6/10;return l-=o,l<0&&(l=0),l},this.ResvAdjust=function(t,s){t.ResvSize-=s.part2_3_length+s.part2_length},this.ResvFrameEnd=function(t,s){var a,n=t.l3_side;t.ResvSize+=s*t.mode_gr;var r=0;n.resvDrain_post=0,n.resvDrain_pre=0,(a=t.ResvSize%8)!=0&&(r+=a),a=t.ResvSize-r-t.ResvMax,a>0&&(r+=a);{var o=Math.min(n.main_data_begin*8,r)/8;n.resvDrain_pre+=8*o,r-=8*o,t.ResvSize-=8*o,n.main_data_begin-=o}n.resvDrain_post+=r,t.ResvSize-=r}}function fg(){var e="http://www.mp3dev.org/",t=3,s=98,a=4,n=0,r=93;this.getLameVersion=function(){return t+"."+s+"."+a},this.getLameShortVersion=function(){return t+"."+s+"."+a},this.getLameVeryShortVersion=function(){return"LAME"+t+"."+s+"r"},this.getPsyVersion=function(){return n+"."+r},this.getLameUrl=function(){return e},this.getLameOsBitness=function(){return"32bits"}}var hg=Oe.System,fo=Oe.VbrMode,p1=Oe.ShortBlock,vg=Oe.Arrays,Dn=Oe.new_byte,_g=Oe.assert;nn.NUMTOCENTRIES=100;nn.MAXFRAMESIZE=2880;function nn(){var e,t,s;this.setModules=function(p,M,S){e=p,t=M,s=S};var a=1,n=2,r=4,o=8,u=nn.NUMTOCENTRIES,_=nn.MAXFRAMESIZE,l=u+4+4+4+4+4,v=l+9+1+1+8+1+1+3+1+1+2+4+2+2,c=128,b=64,w=32,i=null,F="Xing",B="Info",N=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function f(p,M){if(p.nVbrNumFrames++,p.sum+=M,p.seen++,!(p.seen<p.want)&&(p.pos<p.size&&(p.bag[p.pos]=p.sum,p.pos++,p.seen=0),p.pos==p.size)){for(var S=1;S<p.size;S+=2)p.bag[S/2]=p.bag[S];p.want*=2,p.pos/=2}}function R(p,M){if(!(p.pos<=0))for(var S=1;S<u;++S){var j=S/u,X,D,V=0|Math.floor(j*p.pos);V>p.pos-1&&(V=p.pos-1),X=p.bag[V],D=p.sum;var d=0|256*X/D;d>255&&(d=255),M[S]=255&d}}this.addVbrFrame=function(p){var M=p.internal_flags,S=Tables.bitrate_table[p.version][M.bitrate_index];_g(M.VBR_seek_table.bag!=null),f(M.VBR_seek_table,S)};function C(p,M){var S=p[M+0]&255;return S<<=8,S|=p[M+1]&255,S<<=8,S|=p[M+2]&255,S<<=8,S|=p[M+3]&255,S}function k(p,M,S){p[M+0]=255&(S>>24&255),p[M+1]=255&(S>>16&255),p[M+2]=255&(S>>8&255),p[M+3]=255&(S&255)}function L(p,M,S){p[M+0]=255&(S>>8&255),p[M+1]=255&(S&255)}function m(p,M){return new String(p,M,F.length(),i).equals(F)||new String(p,M,B.length(),i).equals(B)}function T(p,M,S){return 255&(p<<M|S&~(-1<<M))}function E(p,M){var S=p.internal_flags;M[0]=T(M[0],8,255),M[1]=T(M[1],3,7),M[1]=T(M[1],1,p.out_samplerate<16e3?0:1),M[1]=T(M[1],1,p.version),M[1]=T(M[1],2,1),M[1]=T(M[1],1,p.error_protection?0:1),M[2]=T(M[2],4,S.bitrate_index),M[2]=T(M[2],2,S.samplerate_index),M[2]=T(M[2],1,0),M[2]=T(M[2],1,p.extension),M[3]=T(M[3],2,p.mode.ordinal()),M[3]=T(M[3],2,S.mode_ext),M[3]=T(M[3],1,p.copyright),M[3]=T(M[3],1,p.original),M[3]=T(M[3],2,p.emphasis),M[0]=255;var j=255&(M[1]&241),X;p.version==1?X=c:p.out_samplerate<16e3?X=w:X=b,p.VBR==fo.vbr_off&&(X=p.brate);var D;p.free_format?D=0:D=255&16*e.BitrateIndex(X,p.version,p.out_samplerate),p.version==1?(M[1]=255&(j|10),j=255&(M[2]&13),M[2]=255&(D|j)):(M[1]=255&(j|2),j=255&(M[2]&13),M[2]=255&(D|j))}this.getVbrTag=function(p){var M=new VBRTagData,S=0;M.flags=0;var j=p[S+1]>>3&1,X=p[S+2]>>2&3,D=p[S+3]>>6&3,V=p[S+2]>>4&15;if(V=Tables.bitrate_table[j][V],p[S+1]>>4==14?M.samprate=Tables.samplerate_table[2][X]:M.samprate=Tables.samplerate_table[j][X],j!=0?D!=3?S+=36:S+=21:D!=3?S+=21:S+=13,!m(p,S))return null;S+=4,M.hId=j;var d=M.flags=C(p,S);if(S+=4,d&a&&(M.frames=C(p,S),S+=4),d&n&&(M.bytes=C(p,S),S+=4),d&r){if(M.toc!=null)for(var A=0;A<u;A++)M.toc[A]=p[S+A];S+=u}M.vbrScale=-1,d&o&&(M.vbrScale=C(p,S),S+=4),M.headersize=(j+1)*72e3*V/M.samprate,S+=21;var W=p[S+0]<<4;W+=p[S+1]>>4;var Q=(p[S+1]&15)<<8;return Q+=p[S+2]&255,(W<0||W>3e3)&&(W=-1),(Q<0||Q>3e3)&&(Q=-1),M.encDelay=W,M.encPadding=Q,M},this.InitVbrTag=function(p){var M=p.internal_flags,S;p.version==1?S=c:p.out_samplerate<16e3?S=w:S=b,p.VBR==fo.vbr_off&&(S=p.brate);var j=(p.version+1)*72e3*S/p.out_samplerate,X=M.sideinfo_len+v;if(M.VBR_seek_table.TotalFrameSize=j,j<X||j>_){p.bWriteVbrTag=!1;return}M.VBR_seek_table.nVbrNumFrames=0,M.VBR_seek_table.nBytesWritten=0,M.VBR_seek_table.sum=0,M.VBR_seek_table.seen=0,M.VBR_seek_table.want=1,M.VBR_seek_table.pos=0,M.VBR_seek_table.bag==null&&(M.VBR_seek_table.bag=new int[400],M.VBR_seek_table.size=400);var D=Dn(_);E(p,D);for(var V=M.VBR_seek_table.TotalFrameSize,d=0;d<V;++d)t.add_dummy_byte(p,D[d]&255,1)};function h(p,M){var S=M^p;return M=M>>8^N[S&255],M}this.updateMusicCRC=function(p,M,S,j){for(var X=0;X<j;++X)p[0]=h(M[S+X],p[0])};function y(p,M,S,j,X){var D=p.internal_flags,V=0,d=p.encoder_delay,A=p.encoder_padding,W=100-10*p.VBR_q-p.quality,Q=s.getLameVeryShortVersion(),ve,Me=0,Te,Y=[1,5,3,2,4,0,3],ie=0|(p.lowpassfreq/100+.5>255?255:p.lowpassfreq/100+.5),ae=0,le=0,Ue=0,Ze=p.internal_flags.noise_shaping,H=0,z=0,ee=0,me=0,he=0,Ee=(p.exp_nspsytune&1)!=0,Re=(p.exp_nspsytune&2)!=0,we=!1,ke=!1,_e=p.internal_flags.nogap_total,Pe=p.internal_flags.nogap_current,je=p.ATHtype,De=0,qe;switch(p.VBR){case vbr_abr:qe=p.VBR_mean_bitrate_kbps;break;case vbr_off:qe=p.brate;break;default:qe=p.VBR_min_bitrate_kbps}switch(p.VBR.ordinal()<Y.length?ve=Y[p.VBR.ordinal()]:ve=0,Te=16*Me+ve,D.findReplayGain&&(D.RadioGain>510&&(D.RadioGain=510),D.RadioGain<-510&&(D.RadioGain=-510),le=8192,le|=3072,D.RadioGain>=0?le|=D.RadioGain:(le|=512,le|=-D.RadioGain)),D.findPeakSample&&(ae=Math.abs(0|D.PeakSample/32767*Math.pow(2,23)+.5)),_e!=-1&&(Pe>0&&(ke=!0),Pe<_e-1&&(we=!0)),De=je+((Ee?1:0)<<4)+((Re?1:0)<<5)+((we?1:0)<<6)+((ke?1:0)<<7),W<0&&(W=0),p.mode){case MONO:H=0;break;case STEREO:H=1;break;case DUAL_CHANNEL:H=2;break;case JOINT_STEREO:p.force_ms?H=4:H=3;break;case NOT_SET:default:H=7;break}p.in_samplerate<=32e3?ee=0:p.in_samplerate==48e3?ee=2:p.in_samplerate>48e3?ee=3:ee=1,(p.short_blocks==p1.short_block_forced||p.short_blocks==p1.short_block_dispensed||p.lowpassfreq==-1&&p.highpassfreq==-1||p.scale_left<p.scale_right||p.scale_left>p.scale_right||p.disable_reservoir&&p.brate<320||p.noATH||p.ATHonly||je==0||p.in_samplerate<=32e3)&&(z=1),me=Ze+(H<<2)+(z<<5)+(ee<<6),he=D.nMusicCRC,k(S,j+V,W),V+=4;for(var We=0;We<9;We++)S[j+V+We]=255&Q.charAt(We);V+=9,S[j+V]=255&Te,V++,S[j+V]=255&ie,V++,k(S,j+V,ae),V+=4,L(S,j+V,le),V+=2,L(S,j+V,Ue),V+=2,S[j+V]=255&De,V++,qe>=255?S[j+V]=255:S[j+V]=255&qe,V++,S[j+V]=255&d>>4,S[j+V+1]=255&(d<<4)+(A>>8),S[j+V+2]=255&A,V+=3,S[j+V]=255&me,V++,S[j+V++]=0,L(S,j+V,p.preset),V+=2,k(S,j+V,M),V+=4,L(S,j+V,he),V+=2;for(var fe=0;fe<V;fe++)X=h(S[j+fe],X);return L(S,j+V,X),V+=2,V}function g(p){p.seek(0);var M=Dn(10);p.readFully(M);var S;return new String(M,"ISO-8859-1").startsWith("ID3")?S=0:S=((M[6]&127)<<21|(M[7]&127)<<14|(M[8]&127)<<7|M[9]&127)+M.length,S}this.getLameTagFrame=function(p,M){var S=p.internal_flags;if(!p.bWriteVbrTag||S.Class_ID!=Lame.LAME_ID||S.VBR_seek_table.pos<=0)return 0;if(M.length<S.VBR_seek_table.TotalFrameSize)return S.VBR_seek_table.TotalFrameSize;vg.fill(M,0,S.VBR_seek_table.TotalFrameSize,0),E(p,M);var j=Dn(u);if(p.free_format)for(var X=1;X<u;++X)j[X]=255&255*X/100;else R(S.VBR_seek_table,j);var D=S.sideinfo_len;p.error_protection&&(D-=2),p.VBR==fo.vbr_off?(M[D++]=255&B.charAt(0),M[D++]=255&B.charAt(1),M[D++]=255&B.charAt(2),M[D++]=255&B.charAt(3)):(M[D++]=255&F.charAt(0),M[D++]=255&F.charAt(1),M[D++]=255&F.charAt(2),M[D++]=255&F.charAt(3)),k(M,D,a+n+r+o),D+=4,k(M,D,S.VBR_seek_table.nVbrNumFrames),D+=4;var V=S.VBR_seek_table.nBytesWritten+S.VBR_seek_table.TotalFrameSize;k(M,D,0|V),D+=4,hg.arraycopy(j,0,M,D,j.length),D+=j.length,p.error_protection&&t.CRC_writeheader(S,M);for(var d=0,X=0;X<D;X++)d=h(M[X],d);return D+=y(p,V,M,D,d),S.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(p,M){var S=p.internal_flags;if(S.VBR_seek_table.pos<=0||(M.seek(M.length()),M.length()==0))return-1;var j=g(M);M.seek(j);var X=Dn(_),D=getLameTagFrame(p,X);return D>X.length?-1:(D<1||M.write(X,0,D),0)}}var g1=Oe.new_byte,pg=Oe.assert;function gg(){this.setModules=function(e,t){}}function bg(){this.setModules=function(e,t,s){}}function yg(){}function wg(){this.setModules=function(e,t){}}function Sg(e,t,s){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,s=128);var a=new $e,n=new gg,r=new Bt,o=new gs,u=new og,_=new Kt,l=new dg,v=new nn,c=new fg,b=new wg,w=new mg,i=new rn,F=new bg,B=new yg;a.setModules(r,o,u,_,l,v,c,b,B),o.setModules(r,B,c,v),b.setModules(o,c),u.setModules(a),l.setModules(o,w,_,i),_.setModules(i,w,a.enc.psy),w.setModules(o),i.setModules(_),v.setModules(a,o,c),n.setModules(F,B),F.setModules(c,b,u);var N=a.lame_init();N.num_channels=e,N.in_samplerate=t,N.brate=s,N.mode=vt.STEREO,N.quality=3,N.bWriteVbrTag=!1,N.disable_reservoir=!0,N.write_id3tag_automatic=!1,a.lame_init_params(N);var f=1152,R=0|1.25*f+7200,C=g1(R);this.encodeBuffer=function(k,L){e==1&&(L=k),pg(k.length==L.length),k.length>f&&(f=k.length,R=0|1.25*f+7200,C=g1(R));var m=a.lame_encode_buffer(N,k,L,k.length,C,0,R);return new Int8Array(C.subarray(0,m))},this.flush=function(){var k=a.lame_encode_flush(N,C,0,R);return new Int8Array(C.subarray(0,k))}}function Ci(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}Ci("RIFF");Ci("WAVE");Ci("fmt ");Ci("data");class b1{constructor(t){this.bitRate=t.bitRate,this.sampleRate=t.sampleRate,this.dataBuffer=[],this.encoder=new Sg(1,this.sampleRate,this.bitRate)}encode(t){const a=this._convertBuffer(t);let n=a.length;for(let r=0;n>=0;r+=1152){const o=a.subarray(r,r+1152),u=this.encoder.encodeBuffer(o);this.dataBuffer.push(new Int8Array(u)),n-=1152}}finish(){this.dataBuffer.push(this.encoder.flush());const t=new Blob(this.dataBuffer,{type:"audio/mp3"});return this.dataBuffer=[],{id:Date.now(),blob:t,url:URL.createObjectURL(t)}}_floatTo16BitPCM(t,s){for(let a=0;a<t.length;a++){const n=Math.max(-1,Math.min(1,t[a]));s[a]=n<0?n*32768:n*32767}}_convertBuffer(t){const s=new Float32Array(t),a=new Int16Array(t.length);return this._floatTo16BitPCM(s,a),a}}class Eg{constructor(t={}){this.beforeRecording=t.beforeRecording,this.pauseRecording=t.pauseRecording,this.afterRecording=t.afterRecording,this.micFailed=t.micFailed,this.encoderOptions={bitRate:t.bitRate,sampleRate:t.sampleRate},this.bufferSize=4096,this.records=[],this.isPause=!1,this.isRecording=!1,this.duration=0,this.volume=0,this._duration=0}start(){const t={video:!1,audio:{channelCount:1,echoCancellation:!1}};this.beforeRecording&&this.beforeRecording("start recording"),navigator.mediaDevices.getUserMedia(t).then(this._micCaptured.bind(this)).catch(this._micError.bind(this)),this.isPause=!1,this.isRecording=!0}stop(){this.stream.getTracks().forEach(s=>s.stop()),this.input.disconnect(),this.processor.disconnect(),this.context.close();let t=null;t=this.lameEncoder.finish(),t.duration=this.duration,this.records.push(t),this._duration=0,this.duration=0,this.isPause=!1,this.isRecording=!1,this.afterRecording&&this.afterRecording(t)}pause(){this.stream.getTracks().forEach(t=>t.stop()),this.input.disconnect(),this.processor.disconnect(),this._duration=this.duration,this.isPause=!0,this.pauseRecording&&this.pauseRecording("pause recording")}_micCaptured(t){this.context=new(window.AudioContext||window.webkitAudioContext),this.duration=this._duration,this.input=this.context.createMediaStreamSource(t),this.processor=this.context.createScriptProcessor(this.bufferSize,1,1),this.stream=t,t.getAudioTracks()[0].getSettings().sampleRate!==this.encoderOptions.sampleRate&&(this.encoderOptions.sampleRate=t.getAudioTracks()[0].getSettings().sampleRate,this.lameEncoder=new b1(this.encoderOptions)),this.lameEncoder||(this.lameEncoder=new b1(this.encoderOptions)),this.processor.onaudioprocess=a=>{const n=a.inputBuffer.getChannelData(0);let r=0;this.lameEncoder&&this.lameEncoder.encode(n);for(let o=0;o<n.length;++o)r+=n[o]*n[o];this.duration=parseFloat(this._duration)+parseFloat(this.context.currentTime.toFixed(2)),this.volume=Math.sqrt(r/n.length).toFixed(2)},this.input.connect(this.processor),this.processor.connect(this.context.destination)}_micError(t){this.micFailed&&this.micFailed(t)}}var y1=window.chrome,Il=window.navigator,Mg=Il.vendor,Ag=typeof window.opr<"u",Tg=Il.userAgent.indexOf("Edg")>-1,kg=Il.userAgent.match("CriOS");function Rg(){return kg?!0:y1!==null&&typeof y1<"u"&&Mg==="Google Inc."&&Ag===!1&&Tg===!1}function w1(){var e=xg(),t=e.substr(0,4);return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw(n|u)|c55\/|capi|ccwa|cdm|cell|chtm|cldc|cmd|co(mp|nd)|craw|da(it|ll|ng)|dbte|dcs|devi|dica|dmob|do(c|p)o|ds(12|d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(|_)|g1 u|g560|gene|gf5|gmo|go(\.w|od)|gr(ad|un)|haie|hcit|hd(m|p|t)|hei|hi(pt|ta)|hp( i|ip)|hsc|ht(c(| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i(20|go|ma)|i230|iac( ||\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|[a-w])|libw|lynx|m1w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|mcr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|([1-8]|c))|phil|pire|pl(ay|uc)|pn2|po(ck|rt|se)|prox|psio|ptg|qaa|qc(07|12|21|32|60|[2-7]|i)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h|oo|p)|sdk\/|se(c(|0|1)|47|mc|nd|ri)|sgh|shar|sie(|m)|sk0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h|v|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl|tdg|tel(i|m)|tim|tmo|to(pl|sh)|ts(70|m|m3|m5)|tx9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas|your|zeto|zte/i.test(t)}function xg(){var e=navigator.userAgent||navigator.vendor||window.opera||null;if(!e)throw new Error("Failed to look for user agent information.");return e}const Og={name:"RoomFooter",components:{SvgIcon:zt,EmojiPickerContainer:Hu,RoomFiles:Bp,RoomMessageReply:r3,RoomUsersTag:d3,RoomEmojis:_3,RoomTemplatesText:M3},directives:{clickOutside:xi},props:{room:{type:Object,required:!0},roomId:{type:[String,Number],required:!0},roomMessage:{type:String,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},showEmojis:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},captureFiles:{type:String,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},templatesText:{type:Array,default:null},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},initReplyMessage:{type:Object,default:null},initEditMessage:{type:Object,default:null},droppedFiles:{type:Array,default:null},emojiDataSource:{type:String,default:void 0}},emits:["edit-message","send-message","update-edited-message-id","textarea-action-handler","typing-message"],data(){return{message:"",editedMessage:{},messageReply:null,cursorRangePosition:null,files:[],fileDialog:!1,selectUsersTagItem:null,selectEmojiItem:null,selectTemplatesTextItem:null,format:"mp3",activeUpOrDownEmojis:null,activeUpOrDownUsersTag:null,activeUpOrDownTemplatesText:null,emojisDB:new wu({dataSource:this.emojiDataSource}),emojiOpened:!1,keepKeyboardOpen:!1,filteredEmojis:[],filteredUsersTag:[],selectedUsersTag:[],filteredTemplatesText:[],recorder:this.initRecorder(),isRecording:!1}},computed:{isMessageEmpty(){return!this.files.length&&!this.message.trim()},isFileLoading(){return this.files.some(e=>e.loading)},recordedTime(){return new Date(this.recorder.duration*1e3).toISOString().substr(14,5)},shadowFooter(){return!!this.filteredEmojis.length||!!this.filteredUsersTag.length||!!this.filteredTemplatesText.length||!!this.files.length||!!this.messageReply}},watch:{roomId(){this.resetMessage(!0,!0),this.roomMessage&&(this.message=this.roomMessage,setTimeout(()=>this.onChangeInput()))},message(e){this.getTextareaRef().value=e},roomMessage:{immediate:!0,handler(e){e&&(this.message=this.roomMessage)}},editedMessage(e){this.$emit("update-edited-message-id",e._id)},initReplyMessage(e){e&&this.replyMessage(e)},initEditMessage(e){e&&this.editMessage(e)},droppedFiles(e){e&&this.onFileChange(e)}},mounted(){const e=w1();let t=!0;this.getTextareaRef().addEventListener("keyup",s=>{s.key==="Enter"&&!s.shiftKey&&!this.fileDialog&&(e?(this.message=this.message+`
`,setTimeout(()=>this.onChangeInput())):t&&!this.filteredEmojis.length&&!this.filteredUsersTag.length&&!this.filteredTemplatesText.length&&this.sendMessage()),t=!s.isComposing,setTimeout(()=>{this.updateFooterLists()},60)}),this.getTextareaRef().addEventListener("click",()=>{e&&(this.keepKeyboardOpen=!0),this.updateFooterLists()}),this.getTextareaRef().addEventListener("blur",()=>{setTimeout(()=>{this.resetFooterList()},100),e&&setTimeout(()=>this.keepKeyboardOpen=!1)})},beforeUnmount(){this.stopRecorder()},methods:{getTextareaRef(){return this.$refs.roomTextarea},focusTextarea(e){w1()&&e||this.getTextareaRef()&&(this.getTextareaRef().focus(),this.cursorRangePosition&&setTimeout(()=>{const t=Rg()?0:1;this.getTextareaRef().setSelectionRange(this.cursorRangePosition+t,this.cursorRangePosition+t),this.cursorRangePosition=null}))},onChangeInput(){var e,t,s;((e=this.getTextareaRef())!=null&&e.value||((t=this.getTextareaRef())==null?void 0:t.value)==="")&&(this.message=(s=this.getTextareaRef())==null?void 0:s.value),this.keepKeyboardOpen=!0,this.resizeTextarea(),this.$emit("typing-message",this.message)},resizeTextarea(){const e=this.getTextareaRef();if(!e)return;const t=window.getComputedStyle(e,null).getPropertyValue("padding-top").replace("px","");e.style.height=0,e.style.height=e.scrollHeight-t*2+"px"},escapeTextarea(){this.filteredEmojis.length?this.filteredEmojis=[]:this.filteredUsersTag.length?this.filteredUsersTag=[]:this.filteredTemplatesText.length?this.filteredTemplatesText=[]:this.resetMessage()},onPasteImage(e){var t;const s=(t=e.clipboardData)==null?void 0:t.items;s&&Array.from(s).forEach(a=>{if(a.type.includes("image")){const n=a.getAsFile();this.onFileChange([n])}})},updateActiveUpOrDown(e,t){this.filteredEmojis.length?(this.activeUpOrDownEmojis=t,e.preventDefault()):this.filteredUsersTag.length?(this.activeUpOrDownUsersTag=t,e.preventDefault()):this.filteredTemplatesText.length&&(this.activeUpOrDownTemplatesText=t,e.preventDefault())},selectItem(){this.filteredEmojis.length?this.selectEmojiItem=!0:this.filteredUsersTag.length?this.selectUsersTagItem=!0:this.filteredTemplatesText.length&&(this.selectTemplatesTextItem=!0)},selectEmoji(e){if(this.selectEmojiItem=!1,!e)return;const{position:t,endPosition:s}=this.getCharPosition(":");this.message=this.message.substr(0,t-1)+e+this.message.substr(s,this.message.length-1),this.cursorRangePosition=t,this.focusTextarea()},selectTemplateText(e){if(this.selectTemplatesTextItem=!1,!e)return;const{position:t,endPosition:s}=this.getCharPosition("/"),a=this.message.substr(s,s).length?"":" ";this.message=this.message.substr(0,t-1)+e.text+a+this.message.substr(s,this.message.length-1),this.cursorRangePosition=t+e.text.length+a.length+1,this.focusTextarea()},addEmoji(e){this.message+=e.unicode,this.focusTextarea(!0)},launchFilePicker(){this.$refs.file.value="",this.$refs.file.click()},async onFileChange(e){this.fileDialog=!0,this.focusTextarea(),Array.from(e).forEach(async t=>{const s=URL.createObjectURL(t),a=t.name.lastIndexOf(".");this.files.push({loading:!0,name:t.name.substring(0,a),size:t.size,type:t.type,extension:t.name.substring(a+1),localUrl:s});const n=await fetch(s).then(o=>o.blob());let r=this.files.find(o=>o.localUrl===s);r&&(r.blob=n,r.loading=!1,delete r.loading)}),setTimeout(()=>this.fileDialog=!1,500)},removeFile(e){this.files.splice(e,1),this.focusTextarea()},toggleRecorder(e){if(this.isRecording=e,!this.recorder.isRecording)setTimeout(()=>this.recorder.start(),200);else try{this.recorder.stop();const t=this.recorder.records[0];this.files.push({blob:t.blob,name:`audio.${this.format}`,size:t.blob.size,duration:t.duration,type:t.blob.type,audio:!0,localUrl:URL.createObjectURL(t.blob)}),this.recorder=this.initRecorder(),this.sendMessage()}catch{setTimeout(()=>this.stopRecorder(),100)}},stopRecorder(){if(this.recorder.isRecording)try{this.recorder.stop(),this.recorder=this.initRecorder()}catch{setTimeout(()=>this.stopRecorder(),100)}},textareaActionHandler(){this.$emit("textarea-action-handler",this.message)},sendMessage(){var e;let t=this.message.trim();if(!this.files.length&&!t||this.isFileLoading)return;this.selectedUsersTag.forEach(a=>{t=t.replace(`@${a.username}`,`<usertag>${a._id}</usertag>`)});const s=this.files.length?this.files:null;this.editedMessage._id?(this.editedMessage.content!==t||(e=this.editedMessage.files)!=null&&e.length||this.files.length)&&this.$emit("edit-message",{messageId:this.editedMessage._id,newContent:t,files:s,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}):this.$emit("send-message",{content:t,files:s,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}),this.resetMessage(!0)},editMessage(e){this.resetMessage(),this.editedMessage={...e};let t=e.content;const s=t,a="<usertag>",n="</usertag>";[...t.matchAll(new RegExp(a,"gi"))].map(o=>o.index).forEach(o=>{const u=s.substring(o+a.length,s.indexOf(n,o)),_=this.room.users.find(l=>l._id===u);t=t.replace(`${a}${u}${n}`,`@${_?.username||"unknown"}`),this.selectUserTag(_,!0)}),this.message=t,e.files&&(this.files=[...e.files]),setTimeout(()=>this.resizeTextarea())},replyMessage(e){this.editedMessage={},this.messageReply=e,this.focusTextarea()},updateFooterLists(){this.updateFooterList("@"),this.updateFooterList(":"),this.updateFooterList("/")},updateFooterList(e){if(!this.getTextareaRef()||e===":"&&!this.emojisSuggestionEnabled||e==="@"&&(!this.userTagsEnabled||!this.room.users)||e==="/"&&!this.templatesText)return;const t=this.getTextareaRef().selectionStart;let s=t;for(;s>0&&this.message.charAt(s-1)!==e&&(this.message.charAt(s-1)!==" "||e!==":");)s--;const a=this.message.charAt(s-2),n=!a.match(/^[0-9a-zA-Z]+$/);if(this.message.charAt(s-1)===e&&(!a||a===" "||n)){const r=this.message.substring(s,t);e===":"?this.updateEmojis(r):e==="@"?this.updateShowUsersTag(r):e==="/"&&this.updateShowTemplatesText(r)}else this.resetFooterList(e)},updateShowUsersTag(e){this.filteredUsersTag=Lo(this.room.users,"username",e,!0).filter(t=>t._id!==this.currentUserId)},selectUserTag(e,t=!1){if(this.selectUsersTagItem=!1,!e)return;const{position:s,endPosition:a}=this.getCharPosition("@"),n=this.message.substr(a,a).length?"":" ";this.message=this.message.substr(0,s)+e.username+n+this.message.substr(a,this.message.length-1),this.selectedUsersTag=[...this.selectedUsersTag,{...e}],t||(this.cursorRangePosition=s+e.username.length+n.length+1),this.focusTextarea()},updateShowTemplatesText(e){this.filteredTemplatesText=Lo(this.templatesText,"tag",e,!0)},getCharPosition(e){let s=this.getTextareaRef().selectionStart;for(;s>0&&this.message.charAt(s-1)!==e;)s--;const a=this.getTextareaRef().selectionEnd;return{position:s,endPosition:a}},async updateEmojis(e){if(!e)return;const t=await this.emojisDB.getEmojiBySearchQuery(e);this.filteredEmojis=t.map(s=>s.unicode)},resetFooterList(e=null){e===":"?this.filteredEmojis=[]:e==="@"?this.filteredUsersTag=[]:e==="/"?this.filteredTemplatesText=[]:(this.filteredEmojis=[],this.filteredUsersTag=[],this.filteredTemplatesText=[])},resetMessage(e=!1,t=!1){t||this.$emit("typing-message",null),this.selectedUsersTag=[],this.resetFooterList(),this.resetTextareaSize(),this.message="",this.editedMessage={},this.messageReply=null,this.files=[],this.emojiOpened=!1,this.preventKeyboardFromClosing(),(this.textareaAutoFocus||!t)&&setTimeout(()=>this.focusTextarea(e))},resetTextareaSize(){this.getTextareaRef()&&(this.getTextareaRef().style.height="20px")},preventKeyboardFromClosing(){this.keepKeyboardOpen&&this.getTextareaRef().focus()},initRecorder(){return this.isRecording=!1,new Eg({bitRate:Number(this.audioBitRate),sampleRate:Number(this.audioSampleRate),beforeRecording:null,afterRecording:null,pauseRecording:null,micFailed:this.micFailed})},micFailed(){this.isRecording=!1,this.recorder=this.initRecorder()}}},Ig={key:0,class:"vac-icon-textarea-left"},Cg=pe("div",{class:"vac-dot-audio-record"},null,-1),Lg={class:"vac-dot-audio-record-time"},Bg=["placeholder"],Ng={class:"vac-icon-textarea"},jg={key:1},Fg=["accept","capture"];function Hg(e,t,s,a,n,r){const o=Ge("room-emojis"),u=Ge("room-users-tag"),_=Ge("room-templates-text"),l=Ge("room-message-reply"),v=Ge("room-files"),c=Ge("svg-icon"),b=Ge("emoji-picker-container"),w=_i("click-outside");return ma((J(),ce("div",{id:"room-footer",class:nt(["vac-room-footer",{"vac-app-box-shadow":r.shadowFooter}])},[Ie(o,{"filtered-emojis":n.filteredEmojis,"select-item":n.selectEmojiItem,"active-up-or-down":n.activeUpOrDownEmojis,onSelectEmoji:t[0]||(t[0]=i=>r.selectEmoji(i)),onActivateItem:t[1]||(t[1]=i=>n.activeUpOrDownEmojis=0)},null,8,["filtered-emojis","select-item","active-up-or-down"]),Ie(u,{"filtered-users-tag":n.filteredUsersTag,"select-item":n.selectUsersTagItem,"active-up-or-down":n.activeUpOrDownUsersTag,onSelectUserTag:t[2]||(t[2]=i=>r.selectUserTag(i)),onActivateItem:t[3]||(t[3]=i=>n.activeUpOrDownUsersTag=0)},null,8,["filtered-users-tag","select-item","active-up-or-down"]),Ie(_,{"filtered-templates-text":n.filteredTemplatesText,"select-item":n.selectTemplatesTextItem,"active-up-or-down":n.activeUpOrDownTemplatesText,onSelectTemplateText:t[4]||(t[4]=i=>r.selectTemplateText(i)),onActivateItem:t[5]||(t[5]=i=>n.activeUpOrDownTemplatesText=0)},null,8,["filtered-templates-text","select-item","active-up-or-down"]),Ie(l,{room:s.room,"message-reply":n.messageReply,"text-formatting":s.textFormatting,"link-options":s.linkOptions,onResetMessage:r.resetMessage},wt({_:2},[rt(e.$slots,(i,F)=>({name:F,fn:Ke(B=>[Le(e.$slots,F,yt(pt(B)))])}))]),1032,["room","message-reply","text-formatting","link-options","onResetMessage"]),Ie(v,{files:n.files,onRemoveFile:r.removeFile,onResetMessage:r.resetMessage},wt({_:2},[rt(e.$slots,(i,F)=>({name:F,fn:Ke(B=>[Le(e.$slots,F,yt(pt(B)))])}))]),1032,["files","onRemoveFile","onResetMessage"]),pe("div",{class:nt(["vac-box-footer",{"vac-box-footer-border":!n.files.length}])},[s.showAudio&&!n.files.length?(J(),ce("div",Ig,[n.isRecording?(J(),ce(dt,{key:0},[pe("div",{class:"vac-svg-button vac-icon-audio-stop",onClick:t[6]||(t[6]=(...i)=>r.stopRecorder&&r.stopRecorder(...i))},[Le(e.$slots,"audio-stop-icon",{},()=>[Ie(c,{name:"close-outline"})])]),Cg,pe("div",Lg,et(r.recordedTime),1),pe("div",{class:"vac-svg-button vac-icon-audio-confirm",onClick:t[7]||(t[7]=i=>r.toggleRecorder(!1))},[Le(e.$slots,"audio-check-icon",{},()=>[Ie(c,{name:"checkmark"})])])],64)):(J(),ce("div",{key:1,class:"vac-svg-button",onClick:t[8]||(t[8]=i=>r.toggleRecorder(!0))},[Le(e.$slots,"microphone-icon",{},()=>[Ie(c,{name:"microphone",class:"vac-icon-microphone"})])]))])):xe("",!0),pe("textarea",{id:"roomTextarea",ref:"roomTextarea",placeholder:s.textMessages.TYPE_MESSAGE,class:nt(["vac-textarea",{"vac-textarea-outline":n.editedMessage._id}]),style:{"min-height":"20px","padding-left":"12px"},onInput:t[9]||(t[9]=(...i)=>r.onChangeInput&&r.onChangeInput(...i)),onKeydown:[t[10]||(t[10]=Ia((...i)=>r.escapeTextarea&&r.escapeTextarea(...i),["esc"])),t[11]||(t[11]=Ia(Ps((...i)=>r.selectItem&&r.selectItem(...i),["exact","prevent"]),["enter"])),t[13]||(t[13]=Ia(Ps(()=>{},["exact","prevent"]),["tab"])),t[14]||(t[14]=Ia((...i)=>r.selectItem&&r.selectItem(...i),["tab"])),t[15]||(t[15]=Ia(i=>r.updateActiveUpOrDown(i,-1),["up"])),t[16]||(t[16]=Ia(i=>r.updateActiveUpOrDown(i,1),["down"]))],onPaste:t[12]||(t[12]=(...i)=>r.onPasteImage&&r.onPasteImage(...i))},null,42,Bg),pe("div",Ng,[n.editedMessage._id?(J(),ce("div",{key:0,class:"vac-svg-button",onClick:t[17]||(t[17]=(...i)=>r.resetMessage&&r.resetMessage(...i))},[Le(e.$slots,"edit-close-icon",{},()=>[Ie(c,{name:"close-outline"})])])):xe("",!0),s.showEmojis?ma((J(),ce("div",jg,[Le(e.$slots,"emoji-picker",ll({emojiOpened:n.emojiOpened},{addEmoji:r.addEmoji}),()=>[Ie(b,{"emoji-opened":n.emojiOpened,"position-top":!0,"emoji-data-source":s.emojiDataSource,onAddEmoji:r.addEmoji,onOpenEmoji:t[18]||(t[18]=i=>n.emojiOpened=i)},{"emoji-picker-icon":Ke(()=>[Le(e.$slots,"emoji-picker-icon")]),_:3},8,["emoji-opened","emoji-data-source","onAddEmoji"])])])),[[w,()=>n.emojiOpened=!1]]):xe("",!0),s.showFiles?(J(),ce("div",{key:2,class:"vac-svg-button",onClick:t[19]||(t[19]=(...i)=>r.launchFilePicker&&r.launchFilePicker(...i))},[Le(e.$slots,"paperclip-icon",{},()=>[Ie(c,{name:"paperclip"})])])):xe("",!0),s.textareaActionEnabled?(J(),ce("div",{key:3,class:"vac-svg-button",onClick:t[20]||(t[20]=(...i)=>r.textareaActionHandler&&r.textareaActionHandler(...i))},[Le(e.$slots,"custom-action-icon",{},()=>[Ie(c,{name:"deleted"})])])):xe("",!0),s.showFiles?(J(),ce("input",{key:4,ref:"file",type:"file",multiple:"",accept:s.acceptedFiles,capture:s.captureFiles,style:{display:"none"},onChange:t[21]||(t[21]=i=>r.onFileChange(i.target.files))},null,40,Fg)):xe("",!0),s.showSendIcon?(J(),ce("div",{key:5,class:nt(["vac-svg-button",{"vac-send-disabled":r.isMessageEmpty}]),onClick:t[22]||(t[22]=(...i)=>r.sendMessage&&r.sendMessage(...i))},[Le(e.$slots,"send-icon",{},()=>[Ie(c,{name:"send",param:r.isMessageEmpty||r.isFileLoading?"disabled":""},null,8,["param"])])],2)):xe("",!0)])],2)],2)),[[bi,Object.keys(s.room).length&&s.showFooter]])}var Pg=Tt(Og,[["render",Hg]]);const Dg={name:"MessageReply",components:{AudioPlayer:Ol,SvgIcon:zt,FormatMessage:vn},props:{message:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},roomUsers:{type:Array,required:!0}},computed:{replyUsername(){const{senderId:e}=this.message.replyMessage,t=this.roomUsers.find(s=>s._id===e);return t?t.username:""},firstFile(){var e,t;return(t=(e=this.message.replyMessage)==null?void 0:e.files)!=null&&t.length?this.message.replyMessage.files[0]:{}},isAudio(){return Oi(this.firstFile)},isImage(){return cr(this.firstFile)},isVideo(){return _n(this.firstFile)},isOtherFile(){var e;return((e=this.message.replyMessage.files)==null?void 0:e.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},Ug={class:"vac-reply-message"},qg={class:"vac-reply-username"},Vg={key:0,class:"vac-image-reply-container"},zg={key:1,class:"vac-video-reply-container"},Yg={controls:""},Xg=["src"],Kg={key:3,class:"vac-file-container"},Gg={class:"vac-text-ellipsis"},Wg={key:0,class:"vac-text-ellipsis vac-text-extension"},Zg={class:"vac-reply-content"};function Qg(e,t,s,a,n,r){const o=Ge("audio-player"),u=Ge("svg-icon"),_=Ge("format-message");return J(),ce("div",Ug,[pe("div",qg,et(r.replyUsername),1),r.isImage?(J(),ce("div",Vg,[pe("div",{class:"vac-message-image vac-message-image-reply",style:At({"background-image":`url('${r.firstFile.url}')`})},null,4)])):r.isVideo?(J(),ce("div",zg,[pe("video",Yg,[pe("source",{src:r.firstFile.url},null,8,Xg)])])):r.isAudio?(J(),ft(o,{key:2,src:r.firstFile.url,"message-selection-enabled":!1,onUpdateProgressTime:t[0]||(t[0]=l=>e.progressTime=l),onHoverAudioProgress:t[1]||(t[1]=l=>e.hoverAudioProgress=l)},wt({_:2},[rt(e.$slots,(l,v)=>({name:v,fn:Ke(c=>[Le(e.$slots,v,yt(pt(c)))])}))]),1032,["src"])):r.isOtherFile?(J(),ce("div",Kg,[pe("div",null,[Le(e.$slots,"file-icon",{},()=>[Ie(u,{name:"file"})])]),pe("div",Gg,et(r.firstFile.name),1),r.firstFile.extension?(J(),ce("div",Wg,et(r.firstFile.extension),1)):xe("",!0)])):xe("",!0),pe("div",Zg,[Ie(_,{"message-id":s.message.replyMessage._id,content:s.message.replyMessage.content,users:s.roomUsers,"text-formatting":s.textFormatting,"link-options":s.linkOptions,reply:!0},null,8,["message-id","content","users","text-formatting","link-options"])])])}var Jg=Tt(Dg,[["render",Qg]]);const $g={name:"ProgressBar",props:{progress:{type:Number,default:0}},data(){return{radius:35,stroke:4,normalizedRadius:27,circumference:54*Math.PI}},computed:{strokeDashoffset(){return this.circumference-this.progress/100*this.circumference}}},e4={ref:"progress",class:"vac-progress-wrapper"},t4=["height","width"],s4=["stroke-dasharray","stroke-width","r","cx","cy"],a4={class:"vac-progress-text"},r4=pe("span",{class:"vac-progress-pourcent"},"%",-1);function n4(e,t,s,a,n,r){return J(),ft(Nt,{name:"vac-fade-spinner",appear:""},{default:Ke(()=>[pe("div",e4,[(J(),ce("svg",{height:n.radius*2,width:n.radius*2},[pe("circle",{stroke:"rgba(255, 255, 255, 0.7)","stroke-dasharray":n.circumference+" "+n.circumference,style:At({strokeDashoffset:r.strokeDashoffset,strokeLinecap:"round"}),"stroke-width":n.stroke,fill:"transparent",r:n.normalizedRadius,cx:n.radius,cy:n.radius},null,12,s4)],8,t4)),pe("div",{class:"vac-progress-content",style:At({height:n.radius*2-19+"px",width:n.radius*2-19+"px"})},[pe("div",a4,[ha(et(s.progress),1),r4])],4)],512)]),_:1})}var Wu=Tt($g,[["render",n4]]);const i4={name:"MessageFile",components:{SvgIcon:zt,Loader:yi,ProgressBar:Wu},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},file:{type:Object,required:!0},index:{type:Number,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file"],data(){return{imageResponsive:"",imageLoading:!1,imageHover:!1}},computed:{isImageLoading(){return this.file.url.indexOf("blob:http")!==-1||this.imageLoading},isImage(){return cr(this.file)},isVideo(){return _n(this.file)}},watch:{file:{immediate:!0,handler(){this.checkImgLoad()}}},mounted(){const e=this.$refs["imageRef"+this.index];e&&(this.imageResponsive={maxHeight:e.clientWidth-18,loaderTop:e.clientHeight/2-9})},methods:{checkImgLoad(){if(!cr(this.file))return;this.imageLoading=!0;const e=new Image;e.src=this.file.url,e.addEventListener("load",()=>this.imageLoading=!1)},openFile(e,t){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:this.file,action:t}))}}},o4={class:"vac-message-file-container"},l4={key:0,class:"vac-image-buttons"},c4={controls:""},u4=["src"];function d4(e,t,s,a,n,r){const o=Ge("progress-bar"),u=Ge("loader"),_=Ge("svg-icon");return J(),ce("div",o4,[r.isImage?(J(),ce("div",{key:0,ref:"imageRef"+s.index,class:"vac-message-image-container",onMouseover:t[2]||(t[2]=l=>n.imageHover=!0),onMouseleave:t[3]||(t[3]=l=>n.imageHover=!1),onClick:t[4]||(t[4]=l=>r.openFile(l,"preview"))},[s.file.progress>=0?(J(),ft(o,{key:0,progress:s.file.progress,style:At({top:`${n.imageResponsive.loaderTop}px`})},null,8,["progress","style"])):(J(),ft(u,{key:1,show:r.isImageLoading,type:"message-file","message-id":s.message._id,style:At({top:`${n.imageResponsive.loaderTop}px`})},wt({_:2},[rt(e.$slots,(l,v)=>({name:v,fn:Ke(c=>[Le(e.$slots,v,yt(pt(c)))])}))]),1032,["show","message-id","style"])),pe("div",{class:nt(["vac-message-image",{"vac-blur-loading":r.isImageLoading&&s.message.senderId===s.currentUserId}]),style:At({"background-image":`url('${r.isImageLoading&&s.file.preview||s.file.url}')`,"max-height":`${n.imageResponsive.maxHeight}px`})},[Ie(Nt,{name:"vac-fade-image"},{default:Ke(()=>[!s.messageSelectionEnabled&&n.imageHover&&!r.isImageLoading?(J(),ce("div",l4,[pe("div",{class:"vac-svg-button vac-button-view",onClick:t[0]||(t[0]=l=>r.openFile(l,"preview"))},[Le(e.$slots,"eye-icon_"+s.message._id,{},()=>[Ie(_,{name:"eye"})])]),pe("div",{class:"vac-svg-button vac-button-download",onClick:t[1]||(t[1]=l=>r.openFile(l,"download"))},[Le(e.$slots,"document-icon_"+s.message._id,{},()=>[Ie(_,{name:"document"})])])])):xe("",!0)]),_:3})],6)],544)):r.isVideo?(J(),ce("div",{key:1,class:"vac-video-container",onClick:t[5]||(t[5]=Ps(l=>r.openFile(l,"preview"),["prevent"]))},[s.file.progress>=0?(J(),ft(o,{key:0,progress:s.file.progress},null,8,["progress"])):xe("",!0),pe("video",c4,[pe("source",{src:s.file.url},null,8,u4)])])):xe("",!0)])}var m4=Tt(i4,[["render",d4]]);const f4={name:"MessageFiles",components:{SvgIcon:zt,FormatMessage:vn,ProgressBar:Wu,MessageFile:m4},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},roomUsers:{type:Array,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file","open-user-tag"],computed:{imageVideoFiles(){return this.message.files.filter(e=>Tc(e))},otherFiles(){return this.message.files.filter(e=>!Tc(e))}},methods:{openFile(e,t,s){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:t,action:s}))}}},h4={class:"vac-message-files-container"},v4=["onClick"],_4={class:"vac-svg-button"},p4={class:"vac-text-ellipsis"},g4={key:0,class:"vac-text-ellipsis vac-text-extension"};function b4(e,t,s,a,n,r){const o=Ge("message-file"),u=Ge("progress-bar"),_=Ge("svg-icon"),l=Ge("format-message");return J(),ce("div",h4,[(J(!0),ce(dt,null,rt(r.imageVideoFiles,(v,c)=>(J(),ce("div",{key:c+"iv"},[Ie(o,{file:v,"current-user-id":s.currentUserId,message:s.message,index:c,"message-selection-enabled":s.messageSelectionEnabled,onOpenFile:t[0]||(t[0]=b=>e.$emit("open-file",b))},wt({_:2},[rt(e.$slots,(b,w)=>({name:w,fn:Ke(i=>[Le(e.$slots,w,yt(pt(i)))])}))]),1032,["file","current-user-id","message","index","message-selection-enabled"])]))),128)),(J(!0),ce(dt,null,rt(r.otherFiles,(v,c)=>(J(),ce("div",{key:c+"a",class:"vac-file-wrapper"},[v.progress>=0?(J(),ft(u,{key:0,progress:v.progress,style:{top:"44px"}},null,8,["progress"])):xe("",!0),pe("div",{class:nt(["vac-file-container",{"vac-file-container-progress":v.progress>=0}]),onClick:b=>r.openFile(b,v,"download")},[pe("div",_4,[Le(e.$slots,"document-icon",{},()=>[Ie(_,{name:"document"})])]),pe("div",p4,et(v.name),1),v.extension?(J(),ce("div",g4,et(v.extension),1)):xe("",!0)],10,v4)]))),128)),Ie(l,{"message-id":s.message._id,content:s.message.content,users:s.roomUsers,"text-formatting":s.textFormatting,"link-options":s.linkOptions,onOpenUserTag:t[1]||(t[1]=v=>e.$emit("open-user-tag",v))},null,8,["message-id","content","users","text-formatting","link-options"])])}var y4=Tt(f4,[["render",b4]]);const w4={name:"MessageActions",components:{SvgIcon:zt,EmojiPickerContainer:Hu},directives:{clickOutside:xi},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},messageActions:{type:Array,required:!0},showReactionEmojis:{type:Boolean,required:!0},messageHover:{type:Boolean,required:!0},hoverMessageId:{type:[String,Number],default:null},hoverAudioProgress:{type:Boolean,required:!0},emojiDataSource:{type:String,default:void 0},teleportTarget:{type:Object,default:void 0}},emits:["update-emoji-opened","update-options-opened","update-message-hover","message-action-handler","send-message-reaction"],data(){return{menuOptionsTop:0,optionsOpened:!1,optionsClosing:!1,emojiOpened:!1}},computed:{isMessageActions(){return this.filteredMessageActions.length&&this.messageHover&&!this.message.deleted&&!this.message.disableActions&&!this.hoverAudioProgress},isMessageReactions(){return this.showReactionEmojis&&this.messageHover&&!this.message.deleted&&!this.message.disableReactions&&!this.hoverAudioProgress},filteredMessageActions(){return this.message.senderId===this.currentUserId?this.messageActions:this.messageActions.filter(e=>!e.onlyMe)}},watch:{emojiOpened(e){this.$emit("update-emoji-opened",e),e&&(this.optionsOpened=!1)},optionsOpened(e){this.$emit("update-options-opened",e)}},methods:{openOptions(){this.optionsClosing||(this.optionsOpened=!this.optionsOpened,this.optionsOpened&&setTimeout(()=>{const e=Bu(this.$el,"#room-footer");if(!e||!this.$refs.menuOptions||!this.$refs.actionIcon)return;const t=this.$refs.menuOptions.getBoundingClientRect().height,s=this.$refs.actionIcon.getBoundingClientRect().top;e.getBoundingClientRect().top-s>t+50?this.menuOptionsTop=30:this.menuOptionsTop=-t}))},closeOptions(){this.optionsOpened=!1,this.optionsClosing=!0,this.updateMessageHover(),setTimeout(()=>this.optionsClosing=!1,100)},openEmoji(){this.emojiOpened=!this.emojiOpened},closeEmoji(){this.emojiOpened=!1,this.updateMessageHover()},updateMessageHover(){this.hoverMessageId!==this.message._id&&this.$emit("update-message-hover",!1)},messageActionHandler(e){this.closeOptions(),this.$emit("message-action-handler",e)},sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t}),this.closeEmoji()}}},S4={class:"vac-message-actions-wrapper"},E4={key:"3"},M4={class:"vac-menu-list"},A4=["onClick"];function T4(e,t,s,a,n,r){const o=Ge("svg-icon"),u=Ge("emoji-picker-container"),_=_i("click-outside");return J(),ce("div",S4,[pe("div",{class:"vac-options-container",style:At({display:s.hoverAudioProgress?"none":"initial",width:r.filteredMessageActions.length&&s.showReactionEmojis?"70px":"45px"})},[Ie(dl,{name:"vac-slide-left",tag:"span"},{default:Ke(()=>[r.isMessageActions||r.isMessageReactions?(J(),ce("div",{key:"1",class:nt(["vac-blur-container",{"vac-options-me":s.message.senderId===s.currentUserId}])},null,2)):xe("",!0),r.isMessageActions?(J(),ce("div",{ref:"actionIcon",key:"2",class:"vac-svg-button vac-message-options",onClick:t[0]||(t[0]=(...l)=>r.openOptions&&r.openOptions(...l))},[Le(e.$slots,"dropdown-icon_"+s.message._id,{},()=>[Ie(o,{name:"dropdown",param:"message"})])],512)):xe("",!0),r.isMessageReactions?(J(),ce("div",E4,[Le(e.$slots,"emoji-picker",ll({emojiOpened:n.emojiOpened},{addEmoji:r.sendMessageReaction}),()=>[Ie(u,{class:"vac-message-emojis","emoji-opened":n.emojiOpened,style:At({right:r.isMessageActions?"30px":"5px"}),"emoji-reaction":!0,"position-right":s.message.senderId===s.currentUserId,"message-id":s.message._id,"emoji-data-source":s.emojiDataSource,"teleport-target":s.teleportTarget,onAddEmoji:r.sendMessageReaction,onOpenEmoji:r.openEmoji},wt({_:2},[rt(e.$slots,(l,v)=>({name:v,fn:Ke(c=>[Le(e.$slots,v,yt(pt(c)))])}))]),1032,["emoji-opened","style","position-right","message-id","emoji-data-source","teleport-target","onAddEmoji","onOpenEmoji"])])])):xe("",!0)]),_:3})],4),r.filteredMessageActions.length?(J(),ft(Nt,{key:0,name:s.message.senderId===s.currentUserId?"vac-slide-left":"vac-slide-right"},{default:Ke(()=>[n.optionsOpened?ma((J(),ce("div",{key:0,ref:"menuOptions",class:nt(["vac-menu-options",{"vac-menu-left":s.message.senderId!==s.currentUserId}]),style:At({top:`${n.menuOptionsTop}px`})},[pe("div",M4,[(J(!0),ce(dt,null,rt(r.filteredMessageActions,l=>(J(),ce("div",{key:l.name},[pe("div",{class:"vac-menu-item",onClick:v=>r.messageActionHandler(l)},et(l.title),9,A4)]))),128))])],6)),[[_,r.closeOptions]]):xe("",!0)]),_:1},8,["name"])):xe("",!0)])}var k4=Tt(w4,[["render",T4]]);const R4={name:"MessageReactions",props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0}},emits:["send-message-reaction"],methods:{sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t})}}},x4=["onClick"];function O4(e,t,s,a,n,r){return s.message.deleted?xe("",!0):(J(),ft(dl,{key:0,name:"vac-slide-left",tag:"span"},{default:Ke(()=>[(J(!0),ce(dt,null,rt(s.message.reactions,(o,u)=>ma((J(),ce("button",{key:u+0,class:nt(["vac-button-reaction",{"vac-reaction-me":o.indexOf(s.currentUserId)!==-1}]),style:At({float:s.message.senderId===s.currentUserId?"right":"left"}),onClick:_=>r.sendMessageReaction({unicode:u},o)},[ha(et(u),1),pe("span",null,et(o.length),1)],14,x4)),[[bi,o.length]])),128))]),_:1}))}var I4=Tt(R4,[["render",O4]]);function C4(e){if(!((a,n)=>n.every(r=>{let o=!1;return(r.type[0]==="array"&&Array.isArray(a[r.key])||r.type.find(u=>u===typeof a[r.key]))&&(o=!0),o&&Cl(a,r.key)}))(e,[{key:"roomId",type:["string","number"]},{key:"roomName",type:["string"]},{key:"users",type:["array"]}]))throw new Error("Rooms object is not valid! Must contain at least roomId[String, Number], roomName[String] and users[Array]")}function L4(e){if(!((a,n)=>n.every(r=>r.type.find(u=>u===typeof a[r.key])&&Cl(a,r.key)))(e,[{key:"_id",type:["string","number"]},{key:"username",type:["string"]}]))throw new Error("Participants object is not valid! Must contain at least _id[String, Number] and username[String]")}function B4(e){if(!((a,n)=>n.every(r=>r.type.find(u=>u===typeof a[r.key])&&Cl(a,r.key)))(e,[{key:"_id",type:["string","number"]},{key:"senderId",type:["string","number"]}]))throw new Error("Messages object is not valid! Must contain at least _id[String, Number] and senderId[String, Number]")}function Cl(e,t){return Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==null&&e[t]!==void 0}const N4={name:"RoomMessage",components:{SvgIcon:zt,FormatMessage:vn,AudioPlayer:Ol,MessageReply:Jg,MessageFiles:y4,MessageActions:k4,MessageReactions:I4},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},index:{type:Number,required:!0},message:{type:Object,required:!0},messages:{type:Array,required:!0},editedMessageId:{type:[String,Number],default:null},roomUsers:{type:Array,default:()=>[]},messageActions:{type:Array,required:!0},newMessages:{type:Array,default:()=>[]},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},usernameOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},selectedMessages:{type:Array,default:()=>[]},emojiDataSource:{type:String,default:void 0}},emits:["message-added","open-file","open-user-tag","open-failed-message","message-action-handler","send-message-reaction","select-message","unselect-message"],data(){return{hoverMessageId:null,messageHover:!1,optionsOpened:!1,emojiOpened:!1,newMessage:{},progressTime:"- : -",hoverAudioProgress:!1}},computed:{showUsername(){return!this.usernameOptions.currentUser&&this.message.senderId===this.currentUserId?!1:this.roomUsers.length>=this.usernameOptions.minUsers},showDate(){return this.index>0&&this.message.date!==this.messages[this.index-1].date},messageOffset(){return this.index>0&&this.message.senderId!==this.messages[this.index-1].senderId},isMessageHover(){return this.editedMessageId===this.message._id||this.hoverMessageId===this.message._id},isAudio(){var e;return(e=this.message.files)==null?void 0:e.some(t=>Oi(t))},isCheckmarkVisible(){return this.message.senderId===this.currentUserId&&!this.message.deleted&&(this.message.saved||this.message.distributed||this.message.seen)},hasCurrentUserAvatar(){return this.messages.some(e=>e.senderId===this.currentUserId&&e.avatar)},hasSenderUserAvatar(){return this.messages.some(e=>e.senderId!==this.currentUserId&&e.avatar)},isMessageSelected(){return this.messageSelectionEnabled&&!!this.selectedMessages.find(e=>e._id===this.message._id)}},watch:{newMessages:{immediate:!0,deep:!0,handler(e){if(!e.length||!this.showNewMessagesDivider){this.newMessage={};return}this.newMessage=e.reduce((t,s)=>s.index<t.index?s:t)}},messageSelectionEnabled(){this.resetMessageHover()}},mounted(){B4(this.message),this.$emit("message-added",{message:this.message,index:this.index,ref:this.$refs.message})},methods:{onHoverMessage(){this.messageSelectionEnabled||(this.messageHover=!0,this.canEditMessage()&&(this.hoverMessageId=this.message._id))},canEditMessage(){return!this.message.deleted},onLeaveMessage(){this.messageSelectionEnabled||(!this.optionsOpened&&!this.emojiOpened&&(this.messageHover=!1),this.hoverMessageId=null)},resetMessageHover(){this.messageHover=!1,this.hoverMessageId=null},openFile(e){this.$emit("open-file",{message:this.message,file:e})},openUserTag(e){this.$emit("open-user-tag",{user:e})},messageActionHandler(e){this.resetMessageHover(),setTimeout(()=>{this.$emit("message-action-handler",{action:e,message:this.message})},300)},sendMessageReaction({emoji:e,reaction:t}){this.$emit("send-message-reaction",{messageId:this.message._id,reaction:e,remove:t&&t.indexOf(this.currentUserId)!==-1}),this.messageHover=!1},selectMessage(){this.messageSelectionEnabled&&(this.isMessageSelected?this.$emit("unselect-message",this.message._id):this.$emit("select-message",this.message))}}},j4=["id"],F4={key:0,class:"vac-card-info vac-card-date"},H4={key:1,class:"vac-line-new"},P4={key:2,class:"vac-card-info vac-card-system"},D4={key:1,class:"vac-avatar-offset"},U4={ref:"emojiTarget",class:"vac-emoji-wrapper vac-emoji-teleported"},q4={key:0,class:"vac-progress-time"},V4={class:"vac-text-timestamp"},z4={key:0,class:"vac-icon-edited"},Y4={key:1},X4=pe("div",{class:"vac-failure-text"},"!",-1),K4=[X4],G4={key:3,class:"vac-avatar-current-offset"};function W4(e,t,s,a,n,r){const o=Ge("format-message"),u=Ge("message-reply"),_=Ge("message-files"),l=Ge("audio-player"),v=Ge("svg-icon"),c=Ge("message-actions"),b=Ge("message-reactions");return J(),ce("div",{id:s.message._id,ref:"message",class:"vac-message-wrapper"},[r.showDate?(J(),ce("div",F4,et(s.message.date),1)):xe("",!0),n.newMessage._id===s.message._id?(J(),ce("div",H4,et(s.textMessages.NEW_MESSAGES),1)):xe("",!0),s.message.system?(J(),ce("div",P4,[Le(e.$slots,"message_"+s.message._id,{},()=>[Ie(o,{"message-id":s.message._id,content:s.message.content,deleted:!!s.message.deleted,users:s.roomUsers,"text-messages":s.textMessages,"text-formatting":s.textFormatting,"link-options":s.linkOptions,onOpenUserTag:r.openUserTag},wt({_:2},[rt(e.$slots,(w,i)=>({name:i,fn:Ke(F=>[Le(e.$slots,i,yt(pt(F)))])}))]),1032,["message-id","content","deleted","users","text-messages","text-formatting","link-options","onOpenUserTag"])])])):(J(),ce("div",{key:3,class:nt(["vac-message-box",{"vac-offset-current":s.message.senderId===s.currentUserId}]),onClick:t[8]||(t[8]=(...w)=>r.selectMessage&&r.selectMessage(...w))},[Le(e.$slots,"message_"+s.message._id,{},()=>[s.message.senderId!==s.currentUserId?Le(e.$slots,"message-avatar_"+s.message._id,{key:0},()=>[s.message.avatar?(J(),ce("div",{key:0,class:"vac-avatar",style:At({"background-image":`url('${s.message.avatar}')`})},null,4)):xe("",!0)]):xe("",!0),r.hasSenderUserAvatar&&!s.message.avatar?(J(),ce("div",D4)):xe("",!0),pe("div",{class:nt(["vac-message-container",{"vac-message-container-offset":r.messageOffset}])},[pe("div",{class:nt(["vac-message-card",{"vac-message-highlight":r.isMessageHover,"vac-message-current":s.message.senderId===s.currentUserId,"vac-message-deleted":s.message.deleted,"vac-item-clickable":s.messageSelectionEnabled,"vac-message-selected":r.isMessageSelected}]),onMouseover:t[5]||(t[5]=(...w)=>r.onHoverMessage&&r.onHoverMessage(...w)),onMouseleave:t[6]||(t[6]=(...w)=>r.onLeaveMessage&&r.onLeaveMessage(...w))},[pe("div",U4,null,512),r.showUsername?(J(),ce("div",{key:0,class:nt(["vac-text-username",{"vac-username-reply":!s.message.deleted&&s.message.replyMessage}])},[pe("span",null,et(s.message.username),1)],2)):xe("",!0),!s.message.deleted&&s.message.replyMessage?(J(),ft(u,{key:1,message:s.message,"room-users":s.roomUsers,"text-formatting":s.textFormatting,"link-options":s.linkOptions},wt({_:2},[rt(e.$slots,(w,i)=>({name:i,fn:Ke(F=>[Le(e.$slots,i,yt(pt(F)))])}))]),1032,["message","room-users","text-formatting","link-options"])):xe("",!0),s.message.deleted||!s.message.files||!s.message.files.length?(J(),ft(o,{key:2,"message-id":s.message._id,content:s.message.content,deleted:!!s.message.deleted,users:s.roomUsers,"text-formatting":s.textFormatting,"text-messages":s.textMessages,"link-options":s.linkOptions,onOpenUserTag:r.openUserTag},wt({_:2},[rt(e.$slots,(w,i)=>({name:i,fn:Ke(F=>[Le(e.$slots,i,yt(pt(F)))])}))]),1032,["message-id","content","deleted","users","text-formatting","text-messages","link-options","onOpenUserTag"])):!r.isAudio||s.message.files.length>1?(J(),ft(_,{key:3,"current-user-id":s.currentUserId,message:s.message,"room-users":s.roomUsers,"text-formatting":s.textFormatting,"link-options":s.linkOptions,"message-selection-enabled":s.messageSelectionEnabled,onOpenFile:r.openFile,onOpenUserTag:r.openUserTag},wt({_:2},[rt(e.$slots,(w,i)=>({name:i,fn:Ke(F=>[Le(e.$slots,i,yt(pt(F)))])}))]),1032,["current-user-id","message","room-users","text-formatting","link-options","message-selection-enabled","onOpenFile","onOpenUserTag"])):(J(),ce(dt,{key:4},[Ie(l,{"message-id":s.message._id,src:s.message.files[0].url,"message-selection-enabled":s.messageSelectionEnabled,onUpdateProgressTime:t[0]||(t[0]=w=>n.progressTime=w),onHoverAudioProgress:t[1]||(t[1]=w=>n.hoverAudioProgress=w)},wt({_:2},[rt(e.$slots,(w,i)=>({name:i,fn:Ke(F=>[Le(e.$slots,i,yt(pt(F)))])}))]),1032,["message-id","src","message-selection-enabled"]),s.message.deleted?xe("",!0):(J(),ce("div",q4,et(n.progressTime),1))],64)),pe("div",V4,[s.message.edited&&!s.message.deleted?(J(),ce("div",z4,[Le(e.$slots,"pencil-icon_"+s.message._id,{},()=>[Ie(v,{name:"pencil"})])])):xe("",!0),pe("span",null,et(s.message.timestamp),1),r.isCheckmarkVisible?(J(),ce("span",Y4,[Le(e.$slots,"checkmark-icon_"+s.message._id,{},()=>[Ie(v,{name:s.message.distributed?"double-checkmark":"checkmark",param:s.message.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):xe("",!0)]),Ie(c,{"current-user-id":s.currentUserId,message:s.message,"message-actions":s.messageActions,"show-reaction-emojis":s.showReactionEmojis,"message-hover":n.messageHover,"hover-message-id":n.hoverMessageId,"hover-audio-progress":n.hoverAudioProgress,"emoji-data-source":s.emojiDataSource,"teleport-target":e.$refs.emojiTarget,onUpdateMessageHover:t[2]||(t[2]=w=>n.messageHover=w),onUpdateOptionsOpened:t[3]||(t[3]=w=>n.optionsOpened=w),onUpdateEmojiOpened:t[4]||(t[4]=w=>n.emojiOpened=w),onMessageActionHandler:r.messageActionHandler,onSendMessageReaction:r.sendMessageReaction},wt({_:2},[rt(e.$slots,(w,i)=>({name:i,fn:Ke(F=>[Le(e.$slots,i,yt(pt(F)))])}))]),1032,["current-user-id","message","message-actions","show-reaction-emojis","message-hover","hover-message-id","hover-audio-progress","emoji-data-source","teleport-target","onMessageActionHandler","onSendMessageReaction"])],34),Ie(b,{"current-user-id":s.currentUserId,message:s.message,onSendMessageReaction:r.sendMessageReaction},null,8,["current-user-id","message","onSendMessageReaction"])],2),Le(e.$slots,"message-failure_"+s.message._id,{},()=>[s.message.failure&&s.message.senderId===s.currentUserId?(J(),ce("div",{key:0,class:nt(["vac-failure-container vac-svg-button",{"vac-failure-container-avatar":s.message.avatar&&s.message.senderId===s.currentUserId}]),onClick:t[7]||(t[7]=w=>e.$emit("open-failed-message",{message:s.message}))},K4,2)):xe("",!0)]),s.message.senderId===s.currentUserId?Le(e.$slots,"message-avatar_"+s.message._id,{key:2},()=>[s.message.avatar?(J(),ce("div",{key:0,class:"vac-avatar vac-avatar-current",style:At({"background-image":`url('${s.message.avatar}')`})},null,4)):xe("",!0)]):xe("",!0),r.hasCurrentUserAvatar&&!s.message.avatar?(J(),ce("div",G4)):xe("",!0)])],2))],8,j4)}var Z4=Tt(N4,[["render",W4]]);const Q4={name:"ChatRoom",components:{Loader:yi,SvgIcon:zt,RoomHeader:Rv,RoomFooter:Pg,RoomMessage:Z4},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},roomId:{type:[String,Number],required:!0},loadFirstRoom:{type:Boolean,required:!0},messages:{type:Array,required:!0},roomMessage:{type:String,default:null},messagesLoaded:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},messageActions:{type:Array,required:!0},messageSelectionActions:{type:Array,required:!0},autoScroll:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},showRoomHeader:{type:Boolean,default:!0},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},showEmojis:{type:Boolean,required:!0},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},captureFiles:{type:String,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},loadingRooms:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},scrollDistance:{type:Number,required:!0},templatesText:{type:Array,default:null},usernameOptions:{type:Object,required:!0},emojiDataSource:{type:String,default:void 0},showMessagesStartedText:{type:Boolean,default:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","message-selection-action-handler","edit-message","send-message","delete-message","message-action-handler","fetch-messages","send-message-reaction","typing-message","open-file","open-user-tag","open-failed-message","textarea-action-handler"],data(){return{editedMessageId:null,initReplyMessage:null,initEditMessage:null,loadingMessages:!1,observer:null,showLoader:!0,loadingMoreMessages:!1,scrollIcon:!1,scrollMessagesCount:0,newMessages:[],messageSelectionEnabled:!1,selectedMessages:[],droppedFiles:[]}},computed:{room(){return this.rooms.find(e=>e.roomId===this.roomId)||{}},showNoMessages(){return this.roomId&&!this.messages.length&&!this.loadingMessages&&!this.loadingRooms},showNoRoom(){const e=!this.rooms.length&&!this.loadingRooms||!this.roomId&&!this.loadFirstRoom;return e&&this.updateLoadingMessages(!1),e},showMessagesStarted(){return this.messages.length&&this.messagesLoaded&&this.showMessagesStartedText}},watch:{roomId:{immediate:!0,handler(){this.onRoomChanged()}},messages:{deep:!0,handler(e,t){e.forEach((s,a)=>{this.showNewMessagesDivider&&!s.seen&&s.senderId!==this.currentUserId&&this.newMessages.push({_id:s._id,index:a})}),t?.length===e?.length-1&&(this.newMessages=[]),setTimeout(()=>this.loadingMoreMessages=!1)}},messagesLoaded(e){e&&this.updateLoadingMessages(!1)}},mounted(){this.newMessages=[]},methods:{updateLoadingMessages(e){this.loadingMessages=e,e||setTimeout(()=>this.initIntersectionObserver())},initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=this.$el.querySelector("#infinite-loader-messages");if(e){const t={root:this.$el.querySelector("#messages-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(s=>{s[0].isIntersecting&&this.loadMoreMessages()},t),this.observer.observe(e)}},preventTopScroll(){const e=this.$refs.scrollContainer,t=e.scrollHeight,s=new ResizeObserver(n=>{e.scrollHeight!==t&&this.$refs.scrollContainer&&(this.$refs.scrollContainer.scrollTo({top:e.scrollHeight-t}),s.disconnect())});for(var a=0;a<e.children.length;a++)s.observe(e.children[a])},touchStart(e){if(!this.singleRoom&&e.changedTouches.length===1){const t=e.changedTouches[0].clientX,s=e.changedTouches[0].clientY;addEventListener("touchend",a=>this.touchEnd(a,t,s),{once:!0})}},touchEnd(e,t,s){if(e.changedTouches.length===1){const a=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,r=a-t>100,o=Math.abs(n-s)>50;r&&!o&&this.$emit("toggle-rooms-list")}},onRoomChanged(){this.updateLoadingMessages(!0),this.scrollIcon=!1,this.scrollMessagesCount=0,this.resetMessageSelection();const e=this.$watch(()=>this.messages,t=>{if(!t||!t.length)return;const s=this.$refs.scrollContainer;s&&(e(),setTimeout(()=>{s.scrollTo({top:s.scrollHeight}),this.updateLoadingMessages(!1)}))})},resetMessageSelection(){this.messageSelectionEnabled=!1,this.selectedMessages=[]},selectMessage(e){this.selectedMessages.push(e)},unselectMessage(e){this.selectedMessages=this.selectedMessages.filter(t=>t._id!==e)},onMessageAdded({message:e,index:t,ref:s}){if(t!==this.messages.length-1)return;const a=s.offsetHeight+60;setTimeout(()=>{const n=this.getBottomScroll(this.$refs.scrollContainer)>a;e.senderId===this.currentUserId?n?this.autoScroll.send.newAfterScrollUp&&this.scrollToBottom():this.autoScroll.send.new&&this.scrollToBottom():n?this.autoScroll.receive.newAfterScrollUp?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++):this.autoScroll.receive.new?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++)})},onContainerScroll(e){if(!e.target)return;const t=this.getBottomScroll(e.target);t<60&&(this.scrollMessagesCount=0),this.scrollIcon=t>500||this.scrollMessagesCount},loadMoreMessages(){this.loadingMessages||setTimeout(()=>{if(!this.loadingMoreMessages){if(this.messagesLoaded||!this.roomId){this.loadingMoreMessages=!1,this.showLoader=!1;return}this.preventTopScroll(),this.$emit("fetch-messages"),this.loadingMoreMessages=!0}},500)},messageActionHandler({action:e,message:t}){switch(e.name){case"replyMessage":this.initReplyMessage=t,setTimeout(()=>{this.initReplyMessage=null});return;case"editMessage":this.initEditMessage=t,setTimeout(()=>{this.initEditMessage=null});return;case"deleteMessage":return this.$emit("delete-message",t);case"selectMessages":this.selectedMessages=[t],this.messageSelectionEnabled=!0;return;default:return this.$emit("message-action-handler",{action:e,message:t})}},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{action:e,messages:this.selectedMessages}),this.resetMessageSelection()},sendMessageReaction(e){this.$emit("send-message-reaction",e)},getBottomScroll(e){const{scrollHeight:t,clientHeight:s,scrollTop:a}=e;return t-s-a},scrollToBottom(){setTimeout(()=>{const e=this.$refs.scrollContainer;e.classList.add("vac-scroll-smooth"),e.scrollTo({top:e.scrollHeight,behavior:"smooth"}),setTimeout(()=>e.classList.remove("vac-scroll-smooth"))},50)},openFile({message:e,file:t}){this.$emit("open-file",{message:e,file:t})},openUserTag(e){this.$emit("open-user-tag",e)},onDropFiles(e){this.showFiles&&(this.droppedFiles=e.dataTransfer.files)}}},J4={class:"vac-container-center vac-room-empty"},$4={class:"vac-messages-container"},e5={key:0,class:"vac-text-started"},t5={key:1,class:"vac-text-started"},s5={key:0,id:"infinite-loader-messages"},a5={key:2},r5={key:0,class:"vac-badge-counter vac-messages-count"};function n5(e,t,s,a,n,r){const o=Ge("room-header"),u=Ge("loader"),_=Ge("room-message"),l=Ge("svg-icon"),v=Ge("room-footer");return ma((J(),ce("div",{class:"vac-col-messages",onDrop:t[12]||(t[12]=Ps((...c)=>r.onDropFiles&&r.onDropFiles(...c),["prevent"])),onDragenter:t[13]||(t[13]=Ps(()=>{},["prevent"])),onDragover:t[14]||(t[14]=Ps(()=>{},["prevent"])),onDragleave:t[15]||(t[15]=Ps(()=>{},["prevent"])),onTouchstart:t[16]||(t[16]=(...c)=>r.touchStart&&r.touchStart(...c))},[r.showNoRoom?Le(e.$slots,"no-room-selected",{key:0},()=>[pe("div",J4,[pe("div",null,et(s.textMessages.ROOM_EMPTY),1)])]):s.showRoomHeader?(J(),ft(o,{key:1,"current-user-id":s.currentUserId,"text-messages":s.textMessages,"single-room":s.singleRoom,"show-rooms-list":s.showRoomsList,"is-mobile":s.isMobile,"room-info-enabled":s.roomInfoEnabled,"menu-actions":s.menuActions,room:r.room,"message-selection-enabled":n.messageSelectionEnabled,"message-selection-actions":s.messageSelectionActions,"selected-messages-total":n.selectedMessages.length,onToggleRoomsList:t[0]||(t[0]=c=>e.$emit("toggle-rooms-list")),onRoomInfo:t[1]||(t[1]=c=>e.$emit("room-info")),onMenuActionHandler:t[2]||(t[2]=c=>e.$emit("menu-action-handler",c)),onMessageSelectionActionHandler:r.messageSelectionActionHandler,onCancelMessageSelection:t[3]||(t[3]=c=>n.messageSelectionEnabled=!1)},wt({_:2},[rt(e.$slots,(c,b)=>({name:b,fn:Ke(w=>[Le(e.$slots,b,yt(pt(w)))])}))]),1032,["current-user-id","text-messages","single-room","show-rooms-list","is-mobile","room-info-enabled","menu-actions","room","message-selection-enabled","message-selection-actions","selected-messages-total","onMessageSelectionActionHandler"])):xe("",!0),pe("div",{id:"messages-list",ref:"scrollContainer",class:nt(["vac-container-scroll",{"vac-no-room-header":!s.showRoomHeader}]),onScroll:t[5]||(t[5]=(...c)=>r.onContainerScroll&&r.onContainerScroll(...c))},[Ie(u,{show:n.loadingMessages,type:"messages"},wt({_:2},[rt(e.$slots,(c,b)=>({name:b,fn:Ke(w=>[Le(e.$slots,b,yt(pt(w)))])}))]),1032,["show"]),pe("div",$4,[pe("div",{class:nt({"vac-messages-hidden":n.loadingMessages})},[Ie(Nt,{name:"vac-fade-message"},{default:Ke(()=>[pe("div",null,[r.showNoMessages?(J(),ce("div",e5,[Le(e.$slots,"messages-empty",{},()=>[ha(et(s.textMessages.MESSAGES_EMPTY),1)])])):xe("",!0),r.showMessagesStarted?(J(),ce("div",t5,et(s.textMessages.CONVERSATION_STARTED)+" "+et(s.messages[0].date),1)):xe("",!0)])]),_:3}),s.messages.length&&!s.messagesLoaded?(J(),ce("div",s5,[Ie(u,{show:!0,infinite:!0,type:"infinite-messages"},wt({_:2},[rt(e.$slots,(c,b)=>({name:b,fn:Ke(w=>[Le(e.$slots,b,yt(pt(w)))])}))]),1024)])):xe("",!0),(J(),ft(dl,{key:s.roomId,name:"vac-fade-message",tag:"span"},{default:Ke(()=>[(J(!0),ce(dt,null,rt(s.messages,(c,b)=>(J(),ce("div",{key:c.indexId||c._id},[Ie(_,{"current-user-id":s.currentUserId,message:c,index:b,messages:s.messages,"edited-message-id":n.editedMessageId,"message-actions":s.messageActions,"room-users":r.room.users,"text-messages":s.textMessages,"new-messages":n.newMessages,"show-reaction-emojis":s.showReactionEmojis,"show-new-messages-divider":s.showNewMessagesDivider,"text-formatting":s.textFormatting,"link-options":s.linkOptions,"username-options":s.usernameOptions,"message-selection-enabled":n.messageSelectionEnabled,"selected-messages":n.selectedMessages,"emoji-data-source":s.emojiDataSource,onMessageAdded:r.onMessageAdded,onMessageActionHandler:r.messageActionHandler,onOpenFile:r.openFile,onOpenUserTag:r.openUserTag,onOpenFailedMessage:t[4]||(t[4]=w=>e.$emit("open-failed-message",w)),onSendMessageReaction:r.sendMessageReaction,onSelectMessage:r.selectMessage,onUnselectMessage:r.unselectMessage},wt({_:2},[rt(e.$slots,(w,i)=>({name:i,fn:Ke(F=>[Le(e.$slots,i,yt(pt(F)))])}))]),1032,["current-user-id","message","index","messages","edited-message-id","message-actions","room-users","text-messages","new-messages","show-reaction-emojis","show-new-messages-divider","text-formatting","link-options","username-options","message-selection-enabled","selected-messages","emoji-data-source","onMessageAdded","onMessageActionHandler","onOpenFile","onOpenUserTag","onSendMessageReaction","onSelectMessage","onUnselectMessage"])]))),128))]),_:3}))],2)])],34),n.loadingMessages?xe("",!0):(J(),ce("div",a5,[Ie(Nt,{name:"vac-bounce"},{default:Ke(()=>[n.scrollIcon?(J(),ce("div",{key:0,class:"vac-icon-scroll",onClick:t[6]||(t[6]=(...c)=>r.scrollToBottom&&r.scrollToBottom(...c))},[Ie(Nt,{name:"vac-bounce"},{default:Ke(()=>[n.scrollMessagesCount?(J(),ce("div",r5,et(n.scrollMessagesCount),1)):xe("",!0)]),_:1}),Le(e.$slots,"scroll-icon",{},()=>[Ie(l,{name:"dropdown",param:"scroll"})])])):xe("",!0)]),_:3})])),Ie(v,{room:r.room,"room-id":s.roomId,"room-message":s.roomMessage,"text-messages":s.textMessages,"show-send-icon":s.showSendIcon,"show-files":s.showFiles,"show-audio":s.showAudio,"show-emojis":s.showEmojis,"show-footer":s.showFooter,"accepted-files":s.acceptedFiles,"capture-files":s.captureFiles,"textarea-action-enabled":s.textareaActionEnabled,"textarea-auto-focus":s.textareaAutoFocus,"user-tags-enabled":s.userTagsEnabled,"emojis-suggestion-enabled":s.emojisSuggestionEnabled,"templates-text":s.templatesText,"text-formatting":s.textFormatting,"link-options":s.linkOptions,"audio-bit-rate":s.audioBitRate,"audio-sample-rate":s.audioSampleRate,"init-reply-message":n.initReplyMessage,"init-edit-message":n.initEditMessage,"dropped-files":n.droppedFiles,"emoji-data-source":s.emojiDataSource,onUpdateEditedMessageId:t[7]||(t[7]=c=>n.editedMessageId=c),onEditMessage:t[8]||(t[8]=c=>e.$emit("edit-message",c)),onSendMessage:t[9]||(t[9]=c=>e.$emit("send-message",c)),onTypingMessage:t[10]||(t[10]=c=>e.$emit("typing-message",c)),onTextareaActionHandler:t[11]||(t[11]=c=>e.$emit("textarea-action-handler",c))},wt({_:2},[rt(e.$slots,(c,b)=>({name:b,fn:Ke(w=>[Le(e.$slots,b,yt(pt(w)))])}))]),1032,["room","room-id","room-message","text-messages","show-send-icon","show-files","show-audio","show-emojis","show-footer","accepted-files","capture-files","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","templates-text","text-formatting","link-options","audio-bit-rate","audio-sample-rate","init-reply-message","init-edit-message","dropped-files","emoji-data-source"])],544)),[[bi,s.isMobile&&!s.showRoomsList||!s.isMobile||s.singleRoom]])}var i5=Tt(Q4,[["render",n5]]);const o5={name:"MediaPreview",components:{SvgIcon:zt},props:{file:{type:Object,required:!0}},emits:["close-media-preview"],computed:{isImage(){return cr(this.file)},isVideo(){return _n(this.file)}},mounted(){this.$refs.modal.focus()},methods:{closeModal(){this.$emit("close-media-preview")}}},l5={key:0,class:"vac-media-preview-container"},c5={key:1,class:"vac-media-preview-container"},u5={controls:"",autoplay:""},d5=["src"],m5={class:"vac-svg-button"};function f5(e,t,s,a,n,r){const o=Ge("svg-icon");return J(),ce("div",{ref:"modal",tabindex:"0",class:"vac-media-preview",onClick:t[0]||(t[0]=Ps((...u)=>r.closeModal&&r.closeModal(...u),["stop"])),onKeydown:t[1]||(t[1]=Ia((...u)=>r.closeModal&&r.closeModal(...u),["esc"]))},[Ie(Nt,{name:"vac-bounce-preview",appear:""},{default:Ke(()=>[r.isImage?(J(),ce("div",l5,[pe("div",{class:"vac-image-preview",style:At({"background-image":`url('${s.file.url}')`})},null,4)])):r.isVideo?(J(),ce("div",c5,[pe("video",u5,[pe("source",{src:s.file.url},null,8,d5)])])):xe("",!0)]),_:1}),pe("div",m5,[Le(e.$slots,"preview-close-icon",{},()=>[Ie(o,{name:"close-outline",param:"preview"})])])],544)}var h5=Tt(o5,[["render",f5]]),v5={ROOMS_EMPTY:"No rooms",ROOM_EMPTY:"No room selected",NEW_MESSAGES:"New Messages",MESSAGE_DELETED:"This message was deleted",MESSAGES_EMPTY:"No messages",CONVERSATION_STARTED:"Conversation started on:",TYPE_MESSAGE:"Type message",SEARCH:"Search",IS_ONLINE:"is online",LAST_SEEN:"last seen ",IS_TYPING:"is writing...",CANCEL_SELECT_MESSAGE:"Cancel"};const _5={light:{general:{color:"#0a0a0a",colorButtonClear:"#1976d2",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#fff",colorPlaceholder:"#9ca6af",colorCaret:"#1976d2",colorSpinner:"#333",borderStyle:"1px solid #e1e4e8",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#fff",colorRoomName:"#0a0a0a",colorRoomInfo:"#9ca6af"},footer:{background:"#f8f9fa",borderStyleInput:"1px solid #e1e4e8",borderInputSelected:"#1976d2",backgroundReply:"#e5e5e6",backgroundTagActive:"#e5e5e6",backgroundTag:"#f8f9fa"},content:{background:"#f8f9fa"},sidemenu:{background:"#fff",backgroundHover:"#f6f6f6",backgroundActive:"#e5effa",colorActive:"#1976d2",borderColorSearch:"#e1e5e8"},dropdown:{background:"#fff",backgroundHover:"#f6f6f6"},message:{background:"#fff",backgroundMe:"#ccf2cf",color:"#0a0a0a",colorStarted:"#9ca6af",backgroundDeleted:"#dadfe2",backgroundSelected:"#c2dcf2",colorDeleted:"#757e85",colorUsername:"#9ca6af",colorTimestamp:"#828c94",backgroundDate:"#e5effa",colorDate:"#505a62",backgroundSystem:"#e5effa",colorSystem:"#505a62",backgroundMedia:"rgba(0, 0, 0, 0.15)",backgroundReply:"rgba(0, 0, 0, 0.08)",colorReplyUsername:"#0a0a0a",colorReply:"#6e6e6e",colorTag:"#0d579c",backgroundImage:"#ddd",colorNewMessages:"#1976d2",backgroundScrollCounter:"#0696c7",colorScrollCounter:"#fff",backgroundReaction:"#eee",borderStyleReaction:"1px solid #eee",backgroundReactionHover:"#fff",borderStyleReactionHover:"1px solid #ddd",colorReactionCounter:"#0a0a0a",backgroundReactionMe:"#cfecf5",borderStyleReactionMe:"1px solid #3b98b8",backgroundReactionHoverMe:"#cfecf5",borderStyleReactionHoverMe:"1px solid #3b98b8",colorReactionCounterMe:"#0b59b3",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(0, 0, 0, 0.15)",backgroundAudioProgress:"#455247",backgroundAudioProgressSelector:"#455247",colorFileExtension:"#757e85"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#0a0a0a",colorMessage:"#67717a",colorTimestamp:"#a2aeb8",colorStateOnline:"#4caf50",colorStateOffline:"#9ca6af",backgroundCounterBadge:"#0696c7",colorCounterBadge:"#fff"},emoji:{background:"#fff"},icons:{search:"#9ca6af",add:"#1976d2",toggle:"#0a0a0a",menu:"#0a0a0a",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#1976d2",closeOutline:"#000",closePreview:"#fff",send:"#1976d2",sendDisabled:"#9ca6af",emoji:"#1976d2",emojiReaction:"rgba(0, 0, 0, 0.3)",document:"#1976d2",pencil:"#9e9e9e",checkmark:"#9e9e9e",checkmarkSeen:"#0696c7",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#9e9e9e",dropdownScroll:"#0a0a0a",microphone:"#1976d2",audioPlay:"#455247",audioPause:"#455247",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}},dark:{general:{color:"#fff",colorButtonClear:"#fff",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#202223",colorPlaceholder:"#596269",colorCaret:"#fff",colorSpinner:"#fff",borderStyle:"none",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#181a1b",colorRoomName:"#fff",colorRoomInfo:"#9ca6af"},footer:{background:"#131415",borderStyleInput:"none",borderInputSelected:"#1976d2",backgroundReply:"#1b1c1c",backgroundTagActive:"#1b1c1c",backgroundTag:"#131415"},content:{background:"#131415"},sidemenu:{background:"#181a1b",backgroundHover:"#202224",backgroundActive:"#151617",colorActive:"#fff",borderColorSearch:"#181a1b"},dropdown:{background:"#2a2c33",backgroundHover:"#26282e"},message:{background:"#22242a",backgroundMe:"#1f7e80",color:"#fff",colorStarted:"#9ca6af",backgroundDeleted:"#1b1c21",backgroundSelected:"#c2dcf2",colorDeleted:"#a2a5a8",colorUsername:"#b3bac9",colorTimestamp:"#ebedf2",backgroundDate:"rgba(0, 0, 0, 0.3)",colorDate:"#bec5cc",backgroundSystem:"rgba(0, 0, 0, 0.3)",colorSystem:"#bec5cc",backgroundMedia:"rgba(0, 0, 0, 0.18)",backgroundReply:"rgba(0, 0, 0, 0.18)",colorReplyUsername:"#fff",colorReply:"#d6d6d6",colorTag:"#f0c60a",backgroundImage:"#ddd",colorNewMessages:"#fff",backgroundScrollCounter:"#1976d2",colorScrollCounter:"#fff",backgroundReaction:"none",borderStyleReaction:"none",backgroundReactionHover:"#202223",borderStyleReactionHover:"none",colorReactionCounter:"#fff",backgroundReactionMe:"#4e9ad1",borderStyleReactionMe:"none",backgroundReactionHoverMe:"#4e9ad1",borderStyleReactionHoverMe:"none",colorReactionCounterMe:"#fff",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(255, 255, 255, 0.15)",backgroundAudioProgress:"#b7d4d3",backgroundAudioProgressSelector:"#b7d4d3",colorFileExtension:"#a2a5a8"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#fff",colorMessage:"#6c7278",colorTimestamp:"#6c7278",colorStateOnline:"#4caf50",colorStateOffline:"#596269",backgroundCounterBadge:"#1976d2",colorCounterBadge:"#fff"},emoji:{background:"#343740"},icons:{search:"#596269",add:"#fff",toggle:"#fff",menu:"#fff",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#fff",closeOutline:"#fff",closePreview:"#fff",send:"#fff",sendDisabled:"#646a70",emoji:"#fff",emojiReaction:"#fff",document:"#1976d2",pencil:"#ebedf2",checkmark:"#ebedf2",checkmarkSeen:"#f0d90a",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#fff",dropdownScroll:"#0a0a0a",microphone:"#fff",audioPlay:"#b7d4d3",audioPause:"#b7d4d3",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}}},p5=({general:e,container:t,header:s,footer:a,sidemenu:n,content:r,dropdown:o,message:u,markdown:_,room:l,emoji:v,icons:c})=>({"--chat-color":e.color,"--chat-color-button-clear":e.colorButtonClear,"--chat-color-button":e.colorButton,"--chat-bg-color-button":e.backgroundColorButton,"--chat-bg-color-input":e.backgroundInput,"--chat-color-spinner":e.colorSpinner,"--chat-color-placeholder":e.colorPlaceholder,"--chat-color-caret":e.colorCaret,"--chat-border-style":e.borderStyle,"--chat-bg-scroll-icon":e.backgroundScrollIcon,"--chat-container-border":t.border,"--chat-container-border-radius":t.borderRadius,"--chat-container-box-shadow":t.boxShadow,"--chat-header-bg-color":s.background,"--chat-header-color-name":s.colorRoomName,"--chat-header-color-info":s.colorRoomInfo,"--chat-footer-bg-color":a.background,"--chat-border-style-input":a.borderStyleInput,"--chat-border-color-input-selected":a.borderInputSelected,"--chat-footer-bg-color-reply":a.backgroundReply,"--chat-footer-bg-color-tag-active":a.backgroundTagActive,"--chat-footer-bg-color-tag":a.backgroundTag,"--chat-content-bg-color":r.background,"--chat-sidemenu-bg-color":n.background,"--chat-sidemenu-bg-color-hover":n.backgroundHover,"--chat-sidemenu-bg-color-active":n.backgroundActive,"--chat-sidemenu-color-active":n.colorActive,"--chat-sidemenu-border-color-search":n.borderColorSearch,"--chat-dropdown-bg-color":o.background,"--chat-dropdown-bg-color-hover":o.backgroundHover,"--chat-message-bg-color":u.background,"--chat-message-bg-color-me":u.backgroundMe,"--chat-message-color-started":u.colorStarted,"--chat-message-bg-color-deleted":u.backgroundDeleted,"--chat-message-bg-color-selected":u.backgroundSelected,"--chat-message-color-deleted":u.colorDeleted,"--chat-message-color-username":u.colorUsername,"--chat-message-color-timestamp":u.colorTimestamp,"--chat-message-bg-color-date":u.backgroundDate,"--chat-message-color-date":u.colorDate,"--chat-message-bg-color-system":u.backgroundSystem,"--chat-message-color-system":u.colorSystem,"--chat-message-color":u.color,"--chat-message-bg-color-media":u.backgroundMedia,"--chat-message-bg-color-reply":u.backgroundReply,"--chat-message-color-reply-username":u.colorReplyUsername,"--chat-message-color-reply-content":u.colorReply,"--chat-message-color-tag":u.colorTag,"--chat-message-bg-color-image":u.backgroundImage,"--chat-message-color-new-messages":u.colorNewMessages,"--chat-message-bg-color-scroll-counter":u.backgroundScrollCounter,"--chat-message-color-scroll-counter":u.colorScrollCounter,"--chat-message-bg-color-reaction":u.backgroundReaction,"--chat-message-border-style-reaction":u.borderStyleReaction,"--chat-message-bg-color-reaction-hover":u.backgroundReactionHover,"--chat-message-border-style-reaction-hover":u.borderStyleReactionHover,"--chat-message-color-reaction-counter":u.colorReactionCounter,"--chat-message-bg-color-reaction-me":u.backgroundReactionMe,"--chat-message-border-style-reaction-me":u.borderStyleReactionMe,"--chat-message-bg-color-reaction-hover-me":u.backgroundReactionHoverMe,"--chat-message-border-style-reaction-hover-me":u.borderStyleReactionHoverMe,"--chat-message-color-reaction-counter-me":u.colorReactionCounterMe,"--chat-message-bg-color-audio-record":u.backgroundAudioRecord,"--chat-message-bg-color-audio-line":u.backgroundAudioLine,"--chat-message-bg-color-audio-progress":u.backgroundAudioProgress,"--chat-message-bg-color-audio-progress-selector":u.backgroundAudioProgressSelector,"--chat-message-color-file-extension":u.colorFileExtension,"--chat-markdown-bg":_.background,"--chat-markdown-border":_.border,"--chat-markdown-color":_.color,"--chat-markdown-color-multi":_.colorMulti,"--chat-room-color-username":l.colorUsername,"--chat-room-color-message":l.colorMessage,"--chat-room-color-timestamp":l.colorTimestamp,"--chat-room-color-online":l.colorStateOnline,"--chat-room-color-offline":l.colorStateOffline,"--chat-room-bg-color-badge":l.backgroundCounterBadge,"--chat-room-color-badge":l.colorCounterBadge,"--chat-emoji-bg-color":v.background,"--chat-icon-color-search":c.search,"--chat-icon-color-add":c.add,"--chat-icon-color-toggle":c.toggle,"--chat-icon-color-menu":c.menu,"--chat-icon-color-close":c.close,"--chat-icon-color-close-image":c.closeImage,"--chat-icon-color-file":c.file,"--chat-icon-color-paperclip":c.paperclip,"--chat-icon-color-close-outline":c.closeOutline,"--chat-icon-color-close-preview":c.closePreview,"--chat-icon-color-send":c.send,"--chat-icon-color-send-disabled":c.sendDisabled,"--chat-icon-color-emoji":c.emoji,"--chat-icon-color-emoji-reaction":c.emojiReaction,"--chat-icon-color-document":c.document,"--chat-icon-color-pencil":c.pencil,"--chat-icon-color-checkmark":c.checkmark,"--chat-icon-color-checkmark-seen":c.checkmarkSeen,"--chat-icon-color-eye":c.eye,"--chat-icon-color-dropdown-message":c.dropdownMessage,"--chat-icon-bg-dropdown-message":c.dropdownMessageBackground,"--chat-icon-color-dropdown-room":c.dropdownRoom,"--chat-icon-color-dropdown-scroll":c.dropdownScroll,"--chat-icon-color-microphone":c.microphone,"--chat-icon-color-audio-play":c.audioPlay,"--chat-icon-color-audio-pause":c.audioPause,"--chat-icon-color-audio-cancel":c.audioCancel,"--chat-icon-color-audio-confirm":c.audioConfirm});var g5=`.vac-fade-spinner-enter-from{opacity:0}.vac-fade-spinner-enter-active{transition:opacity .8s}.vac-fade-spinner-leave-active{transition:opacity .2s;opacity:0}.vac-fade-image-enter-from{opacity:0}.vac-fade-image-enter-active{transition:opacity 1s}.vac-fade-image-leave-active{transition:opacity .5s;opacity:0}.vac-fade-message-enter-from{opacity:0}.vac-fade-message-enter-active{transition:opacity .5s}.vac-fade-message-leave-active{transition:opacity .2s;opacity:0}.vac-slide-left-enter-active,.vac-slide-right-enter-active{transition:all .3s ease;transition-property:transform,opacity}.vac-slide-left-leave-active,.vac-slide-right-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)!important;transition-property:transform,opacity}.vac-slide-left-enter-from,.vac-slide-left-leave-to{transform:translate(10px);opacity:0}.vac-slide-right-enter-from,.vac-slide-right-leave-to{transform:translate(-10px);opacity:0}.vac-slide-up-enter-active{transition:all .3s ease}.vac-slide-up-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)}.vac-slide-up-enter-from,.vac-slide-up-leave-to{transform:translateY(10px);opacity:0}.vac-bounce-enter-active{animation:vac-bounce-in .5s}.vac-bounce-leave-active{animation:vac-bounce-in .3s reverse}@keyframes vac-bounce-in{0%{transform:scale(0)}50%{transform:scale(1.05)}to{transform:scale(1)}}.vac-fade-preview-enter{opacity:0}.vac-fade-preview-enter-active{transition:opacity .1s}.vac-fade-preview-leave-active{transition:opacity .2s;opacity:0}.vac-bounce-preview-enter-active{animation:vac-bounce-image-in .4s}.vac-bounce-preview-leave-active{animation:vac-bounce-image-in .3s reverse}@keyframes vac-bounce-image-in{0%{transform:scale(.6)}to{transform:scale(1)}}.vac-menu-list{border-radius:4px;display:block;cursor:pointer;background:var(--chat-dropdown-bg-color);padding:6px 0}.vac-menu-list :hover{background:var(--chat-dropdown-bg-color-hover);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-list :not(:hover){transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-item{-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex:1 1 100%;flex:1 1 100%;min-height:30px;padding:5px 16px;position:relative;white-space:nowrap;line-height:30px}.vac-menu-options{position:absolute;right:10px;top:20px;z-index:9999;min-width:150px;display:inline-block;border-radius:4px;font-size:14px;color:var(--chat-color);overflow-y:auto;overflow-x:hidden;contain:content;box-shadow:0 2px 2px -4px #0000001a,0 2px 2px 1px #0000001f,0 1px 8px 1px #0000001f}.vac-app-border{border:var(--chat-border-style)}.vac-app-border-t{border-top:var(--chat-border-style)}.vac-app-border-r{border-right:var(--chat-border-style)}.vac-app-border-b{border-bottom:var(--chat-border-style)}.vac-app-box-shadow{transition:all .5s;box-shadow:0 2px 2px -4px #0000001a,0 2px 2px 1px #0000001f,0 1px 8px 1px #0000001f}.vac-item-clickable{cursor:pointer}.vac-vertical-center{display:flex;align-items:center;height:100%}.vac-vertical-center .vac-vertical-container{width:100%;text-align:center}.vac-svg-button{max-height:30px;display:flex;cursor:pointer;transition:all .2s}.vac-svg-button:hover{transform:scale(1.1);opacity:.7}.vac-avatar{background-size:cover;background-position:center center;background-repeat:no-repeat;background-color:#ddd;height:42px;width:42px;min-height:42px;min-width:42px;margin-right:15px;border-radius:50%}.vac-blur-loading{filter:blur(3px)}.vac-badge-counter{height:13px;width:auto;min-width:13px;border-radius:50%;display:flex;align-items:center;justify-content:center;padding:3px;font-size:11px;font-weight:500}.vac-text-ellipsis{width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vac-text-bold{font-weight:700}.vac-text-italic{font-style:italic}.vac-text-strike{text-decoration:line-through}.vac-text-underline{text-decoration:underline}.vac-text-inline-code{display:inline-block;font-size:12px;color:var(--chat-markdown-color);background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;margin:2px 0;padding:2px 3px}.vac-text-multiline-code{display:block;font-size:12px;color:var(--chat-markdown-color-multi);background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;margin:4px 0;padding:7px}.vac-text-tag{color:var(--chat-message-color-tag);cursor:pointer}.vac-file-container{display:flex;align-content:center;justify-content:center;flex-wrap:wrap;text-align:center;background:var(--chat-bg-color-input);border:var(--chat-border-style-input);border-radius:4px;padding:10px}.vac-file-container svg{height:28px;width:28px}.vac-file-container .vac-text-extension{font-size:12px;color:var(--chat-message-color-file-extension);margin-top:-2px}.vac-card-window{width:100%;display:block;max-width:100%;background:var(--chat-content-bg-color);color:var(--chat-color);overflow-wrap:break-word;white-space:normal;border:var(--chat-container-border);border-radius:var(--chat-container-border-radius);box-shadow:var(--chat-container-box-shadow);-webkit-tap-highlight-color:transparent}.vac-card-window *{font-family:inherit}.vac-card-window a{color:#0d579c;font-weight:500}.vac-card-window .vac-chat-container{height:100%;display:flex}.vac-card-window .vac-chat-container input{min-width:10px}.vac-card-window .vac-chat-container textarea,.vac-card-window .vac-chat-container input[type=text],.vac-card-window .vac-chat-container input[type=search]{-webkit-appearance:none}.vac-media-preview{position:fixed;top:0;left:0;z-index:10000000;width:100vw;height:100vh;display:flex;align-items:center;background-color:#000c;outline:none}.vac-media-preview .vac-media-preview-container{height:calc(100% - 140px);width:calc(100% - 80px);padding:70px 40px;margin:0 auto}.vac-media-preview .vac-image-preview{width:100%;height:100%;background-size:contain;background-repeat:no-repeat;background-position:center}.vac-media-preview video{width:100%;height:100%}.vac-media-preview .vac-svg-button{position:absolute;top:30px;right:30px;transform:scale(1.4)}@media only screen and (max-width: 768px){.vac-media-preview .vac-svg-button{top:20px;right:20px;transform:scale(1.2)}.vac-media-preview .vac-media-preview-container{width:calc(100% - 40px);padding:70px 20px}}.vac-col-messages{position:relative;height:100%;flex:1;overflow:hidden;display:flex;flex-flow:column}.vac-col-messages .vac-container-center{height:100%;width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}.vac-col-messages .vac-room-empty{font-size:14px;color:#9ca6af;font-style:italic;line-height:20px;white-space:pre-line}.vac-col-messages .vac-room-empty div{padding:0 10%}.vac-col-messages .vac-container-scroll{background:var(--chat-content-bg-color);flex:1;overflow-y:auto;margin-right:1px;margin-top:65px;-webkit-overflow-scrolling:touch}.vac-col-messages .vac-container-scroll.vac-scroll-smooth{scroll-behavior:smooth}.vac-col-messages .vac-container-scroll.vac-no-room-header{margin-top:0}.vac-col-messages .vac-messages-container{padding:0 5px 5px}.vac-col-messages .vac-text-started{font-size:14px;color:var(--chat-message-color-started);font-style:italic;text-align:center;margin-top:25px;margin-bottom:20px}.vac-col-messages .vac-icon-scroll{position:absolute;bottom:80px;right:20px;padding:8px;background:var(--chat-bg-scroll-icon);border-radius:50%;box-shadow:0 1px 1px -1px #0003,0 1px 1px #00000024,0 1px 2px #0000001f;display:flex;cursor:pointer;z-index:10}.vac-col-messages .vac-icon-scroll svg{height:25px;width:25px}.vac-col-messages .vac-messages-count{position:absolute;top:-8px;left:11px;background-color:var(--chat-message-bg-color-scroll-counter);color:var(--chat-message-color-scroll-counter)}.vac-col-messages .vac-messages-hidden{opacity:0}@media only screen and (max-width: 768px){.vac-col-messages .vac-container-scroll{margin-top:50px}.vac-col-messages .vac-text-started{margin-top:20px}.vac-col-messages .vac-icon-scroll{bottom:70px}}.vac-room-header{position:absolute;display:flex;align-items:center;height:64px;width:100%;z-index:10;margin-right:1px;background:var(--chat-header-bg-color);border-top-right-radius:var(--chat-container-border-radius)}.vac-room-header .vac-room-wrapper{display:flex;align-items:center;min-width:0;height:100%;width:100%;padding:0 16px}.vac-room-header .vac-toggle-button{margin-right:15px}.vac-room-header .vac-toggle-button svg{height:26px;width:26px}.vac-room-header .vac-rotate-icon{transform:rotate(180deg)!important}.vac-room-header .vac-rotate-icon-init{transform:rotate(360deg)}.vac-room-header .vac-info-wrapper,.vac-room-header .vac-room-selection{display:flex;align-items:center;min-width:0;width:100%;height:100%}.vac-room-header .vac-room-selection .vac-selection-button{padding:8px 16px;color:var(--chat-color-button);background-color:var(--chat-bg-color-button);border-radius:4px;margin-right:10px;cursor:pointer;transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-button:hover{opacity:.7}.vac-room-header .vac-room-selection .vac-selection-button:active{opacity:.9}.vac-room-header .vac-room-selection .vac-selection-button .vac-selection-button-count{margin-left:6px;opacity:.9}.vac-room-header .vac-room-selection .vac-selection-cancel{display:flex;align-items:center;margin-left:auto;white-space:nowrap;color:var(--chat-color-button-clear);transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-cancel:hover{opacity:.7}.vac-room-header .vac-room-name{font-size:17px;font-weight:500;line-height:22px;color:var(--chat-header-color-name)}.vac-room-header .vac-room-info{font-size:13px;line-height:18px;color:var(--chat-header-color-info)}.vac-room-header .vac-room-options{margin-left:auto}@media only screen and (max-width: 768px){.vac-room-header{height:50px}.vac-room-header .vac-room-wrapper{padding:0 10px}.vac-room-header .vac-room-name{font-size:16px;line-height:22px}.vac-room-header .vac-room-info{font-size:12px;line-height:16px}.vac-room-header .vac-avatar{height:37px;width:37px;min-height:37px;min-width:37px}}.vac-room-footer{width:100%;border-bottom-right-radius:4px;z-index:10}.vac-box-footer{display:flex;position:relative;background:var(--chat-footer-bg-color);padding:10px 8px}.vac-textarea{max-height:300px;overflow-y:auto;height:20px;width:100%;line-height:20px;outline:0;resize:none;border-radius:20px;padding:12px 16px;box-sizing:content-box;font-size:16px;background:var(--chat-bg-color-input);color:var(--chat-color);caret-color:var(--chat-color-caret);border:var(--chat-border-style-input)}.vac-textarea::placeholder{color:var(--chat-color-placeholder);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vac-textarea-outline{border:1px solid var(--chat-border-color-input-selected);box-shadow:inset 0 0 0 1px var(--chat-border-color-input-selected)}.vac-icon-textarea,.vac-icon-textarea-left{display:flex;align-items:center}.vac-icon-textarea svg,.vac-icon-textarea .vac-wrapper,.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 7px}.vac-icon-textarea{margin-left:5px}.vac-icon-textarea-left{display:flex;align-items:center;margin-right:5px}.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 7px}.vac-icon-textarea-left .vac-icon-microphone{fill:var(--chat-icon-color-microphone);margin:0 7px}.vac-icon-textarea-left .vac-dot-audio-record{height:15px;width:15px;border-radius:50%;background-color:var(--chat-message-bg-color-audio-record);animation:vac-scaling .8s ease-in-out infinite alternate}@keyframes vac-scaling{0%{transform:scale(1);opacity:.4}to{transform:scale(1.1);opacity:1}}.vac-icon-textarea-left .vac-dot-audio-record-time{font-size:16px;color:var(--chat-color);margin-left:8px;width:45px}.vac-icon-textarea-left .vac-icon-audio-stop,.vac-icon-textarea-left .vac-icon-audio-confirm{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop svg,.vac-icon-textarea-left .vac-icon-audio-confirm svg{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop{margin-right:20px}.vac-icon-textarea-left .vac-icon-audio-stop #vac-icon-close-outline{fill:var(--chat-icon-color-audio-cancel)}.vac-icon-textarea-left .vac-icon-audio-confirm{margin-right:3px;margin-left:12px}.vac-icon-textarea-left .vac-icon-audio-confirm #vac-icon-checkmark{fill:var(--chat-icon-color-audio-confirm)}.vac-send-disabled,.vac-send-disabled svg{cursor:none!important;pointer-events:none!important;transform:none!important}@media only screen and (max-width: 768px){.vac-room-footer{width:100%}.vac-box-footer{padding:7px 2px 7px 7px}.vac-box-footer.vac-box-footer-border{border-top:var(--chat-border-style-input)}.vac-textarea{padding:7px;line-height:18px}.vac-textarea::placeholder{color:transparent}.vac-icon-textarea svg,.vac-icon-textarea .vac-wrapper,.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 5px!important}}@media only screen and (max-height: 768px){.vac-textarea{max-height:120px}}.vac-emojis-container{width:calc(100% - 16px);padding:10px 8px;background:var(--chat-footer-bg-color);display:flex;align-items:center;overflow:auto}.vac-emojis-container .vac-emoji-element{padding:0 8px;font-size:30px;border-radius:4px;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-emojis-container .vac-emoji-element-active{background:var(--chat-footer-bg-color-tag-active)}@media only screen and (max-width: 768px){.vac-emojis-container{width:calc(100% - 10px);padding:7px 5px}.vac-emojis-container .vac-emoji-element{padding:0 7px;font-size:26px}}.vac-reply-container{display:flex;padding:10px 10px 0;background:var(--chat-footer-bg-color);align-items:center;width:calc(100% - 20px)}.vac-reply-container .vac-reply-box{width:100%;overflow:hidden;background:var(--chat-footer-bg-color-reply);border-radius:4px;padding:8px 10px}.vac-reply-container .vac-reply-info{overflow:hidden}.vac-reply-container .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-container .vac-reply-content{font-size:12px;color:var(--chat-message-color-reply-content);white-space:pre-line}.vac-reply-container .vac-icon-reply{margin-left:10px}.vac-reply-container .vac-icon-reply svg{height:20px;width:20px}.vac-reply-container .vac-image-reply{max-height:100px;max-width:200px;margin:4px 10px 0 0;border-radius:4px}.vac-reply-container .vac-audio-reply{margin-right:10px}.vac-reply-container .vac-file-container{max-width:80px}@media only screen and (max-width: 768px){.vac-reply-container{padding:5px 8px;width:calc(100% - 16px)}}.vac-room-files-container{display:flex;align-items:center;padding:10px 6px 0;background:var(--chat-footer-bg-color)}.vac-room-files-container .vac-files-box{display:flex;overflow:auto;flex:1 1 0;width:0}.vac-room-files-container video{height:100px;border:var(--chat-border-style-input);border-radius:4px}.vac-room-files-container .vac-icon-close{flex:none;margin-left:5px}.vac-room-files-container .vac-icon-close svg{height:20px;width:20px}@media only screen and (max-width: 768px){.vac-files-container{padding:6px 4px 4px 2px}}.vac-room-file-container{display:flex;position:relative;margin:0 4px}.vac-room-file-container .vac-message-image{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:cover!important;background-position:center center!important;background-repeat:no-repeat!important;height:100px;width:100px;border:var(--chat-border-style-input);border-radius:4px}.vac-room-file-container .vac-file-container{height:80px;width:80px}.vac-room-file-container .vac-icon-remove{position:absolute;top:6px;left:6px;z-index:10}.vac-room-file-container .vac-icon-remove svg{height:20px;width:20px;border-radius:50%}.vac-room-file-container .vac-icon-remove:before{content:" ";position:absolute;width:100%;height:100%;background:rgba(0,0,0,.5);border-radius:50%;z-index:-1}.vac-tags-container{display:flex;flex-direction:column;align-items:center;width:100%}.vac-tags-container .vac-tags-box{display:flex;width:100%;height:54px;overflow:hidden;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-tags-container .vac-tags-box-active{background:var(--chat-footer-bg-color-tag-active)}.vac-tags-container .vac-tags-info{display:flex;overflow:hidden;padding:0 20px;align-items:center}.vac-tags-container .vac-tags-avatar{height:34px;width:34px;min-height:34px;min-width:34px}.vac-tags-container .vac-tags-username{font-size:14px}@media only screen and (max-width: 768px){.vac-tags-container .vac-tags-box{height:50px}.vac-tags-container .vac-tags-info{padding:0 12px}}.vac-template-container{display:flex;flex-direction:column;align-items:center;width:100%}.vac-template-container .vac-template-box{display:flex;width:100%;height:54px;overflow:hidden;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-template-container .vac-template-active{background:var(--chat-footer-bg-color-tag-active)}.vac-template-container .vac-template-info{display:flex;overflow:hidden;padding:0 20px;align-items:center}.vac-template-container .vac-template-tag{font-size:14px;font-weight:700;margin-right:10px}.vac-template-container .vac-template-text{font-size:14px}@media only screen and (max-width: 768px){.vac-template-container .vac-template-box{height:50px}.vac-template-container .vac-template-info{padding:0 12px}}.vac-rooms-container{display:flex;flex-flow:column;flex:0 0 25%;min-width:260px;max-width:500px;position:relative;background:var(--chat-sidemenu-bg-color);height:100%;border-top-left-radius:var(--chat-container-border-radius);border-bottom-left-radius:var(--chat-container-border-radius)}.vac-rooms-container.vac-rooms-container-full{flex:0 0 100%;max-width:100%}.vac-rooms-container .vac-rooms-empty{font-size:14px;color:#9ca6af;font-style:italic;text-align:center;margin:40px 0;line-height:20px;white-space:pre-line}.vac-rooms-container .vac-room-list{flex:1;position:relative;max-width:100%;cursor:pointer;padding:0 10px 5px;overflow-y:auto}.vac-rooms-container .vac-room-item{border-radius:8px;align-items:center;display:flex;flex:1 1 100%;margin-bottom:5px;padding:0 14px;position:relative;min-height:71px;transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-rooms-container .vac-room-item:hover{background:var(--chat-sidemenu-bg-color-hover)}.vac-rooms-container .vac-room-selected{color:var(--chat-sidemenu-color-active)!important;background:var(--chat-sidemenu-bg-color-active)!important}.vac-rooms-container .vac-room-selected:hover{background:var(--chat-sidemenu-bg-color-active)!important}@media only screen and (max-width: 768px){.vac-rooms-container .vac-room-list{padding:0 7px 5px}.vac-rooms-container .vac-room-item{min-height:60px;padding:0 8px}}.vac-room-container{display:flex;flex:1;align-items:center;width:100%}.vac-room-container .vac-name-container{flex:1}.vac-room-container .vac-title-container{display:flex;align-items:center;line-height:25px}.vac-room-container .vac-state-circle{width:9px;height:9px;border-radius:50%;background-color:var(--chat-room-color-offline);margin-right:6px;transition:.3s}.vac-room-container .vac-state-online{background-color:var(--chat-room-color-online)}.vac-room-container .vac-room-name{flex:1;color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-text-date{margin-left:5px;font-size:11px;color:var(--chat-room-color-timestamp)}.vac-room-container .vac-text-last{display:flex;align-items:center;font-size:12px;line-height:19px;color:var(--chat-room-color-message)}.vac-room-container .vac-message-new{color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-icon-check{display:flex;vertical-align:middle;height:14px;width:14px;margin-top:-2px;margin-right:2px}.vac-room-container .vac-icon-microphone{height:15px;width:15px;vertical-align:middle;margin:-3px 1px 0 -2px;fill:var(--chat-room-color-message)}.vac-room-container .vac-room-options-container{display:flex;margin-left:auto}.vac-room-container .vac-room-badge{background-color:var(--chat-room-bg-color-badge);color:var(--chat-room-color-badge);margin-left:5px}.vac-room-container .vac-list-room-options{height:19px;width:19px;align-items:center;margin-left:5px}.vac-box-empty{margin-top:10px}@media only screen and (max-width: 768px){.vac-box-empty{margin-top:7px}}.vac-box-search{position:sticky;display:flex;align-items:center;height:64px;padding:0 15px}.vac-box-search .vac-icon-search{display:flex;position:absolute;left:30px}.vac-box-search .vac-icon-search svg{width:18px;height:18px}.vac-box-search .vac-input{height:38px;width:100%;background:var(--chat-bg-color-input);color:var(--chat-color);font-size:15px;outline:0;caret-color:var(--chat-color-caret);padding:10px 10px 10px 40px;border:1px solid var(--chat-sidemenu-border-color-search);border-radius:20px}.vac-box-search .vac-input::placeholder{color:var(--chat-color-placeholder)}.vac-box-search .vac-add-icon{margin-left:auto;padding-left:10px}@media only screen and (max-width: 768px){.vac-box-search{height:58px}}.vac-message-wrapper .vac-card-info{border-radius:4px;text-align:center;margin:10px auto;font-size:12px;padding:4px;display:block;overflow-wrap:break-word;position:relative;white-space:normal;box-shadow:0 1px 1px -1px #0000001a,0 1px 1px -1px #0000001c,0 1px 2px -1px #0000001c}.vac-message-wrapper .vac-card-date{max-width:150px;font-weight:500;text-transform:uppercase;color:var(--chat-message-color-date);background-color:var(--chat-message-bg-color-date)}.vac-message-wrapper .vac-card-system{max-width:250px;padding:8px 4px;color:var(--chat-message-color-system);background-color:var(--chat-message-bg-color-system)}.vac-message-wrapper .vac-line-new{color:var(--chat-message-color-new-messages);position:relative;text-align:center;font-size:13px;padding:10px 0}.vac-message-wrapper .vac-line-new:after,.vac-message-wrapper .vac-line-new:before{border-top:1px solid var(--chat-message-color-new-messages);content:"";left:0;position:absolute;top:50%;width:calc(50% - 60px)}.vac-message-wrapper .vac-line-new:before{left:auto;right:0}.vac-message-wrapper .vac-message-box{display:flex;flex:0 0 50%;justify-content:flex-start;line-height:1.4}.vac-message-wrapper .vac-avatar{height:28px;width:28px;min-height:28px;min-width:28px;margin:0 0 2px;align-self:flex-end}.vac-message-wrapper .vac-avatar-current-offset{margin-right:28px}.vac-message-wrapper .vac-avatar-offset{margin-left:28px}.vac-message-wrapper .vac-failure-container{position:relative;align-self:flex-end;height:20px;width:20px;margin:0 0 2px -4px;border-radius:50%;background-color:#f44336}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:6px}.vac-message-wrapper .vac-failure-container .vac-failure-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:15px;font-weight:700}.vac-message-wrapper .vac-message-container{position:relative;padding:2px 10px;align-items:end;min-width:116px;box-sizing:content-box;width:80%;max-width:260px;flex-grow:1}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-offset-current{justify-content:flex-end}.vac-message-wrapper .vac-message-card{background-color:var(--chat-message-bg-color);color:var(--chat-message-color);border-radius:8px;font-size:14px;padding:6px 9px 3px;white-space:pre-line;max-width:100%;-webkit-transition-property:box-shadow,opacity;transition-property:box-shadow,opacity;transition:box-shadow .28s cubic-bezier(.4,0,.2,1);will-change:box-shadow;box-shadow:0 1px 1px -1px #0000001a,0 1px 1px -1px #0000001c,0 1px 2px -1px #0000001c}.vac-message-wrapper .vac-message-highlight{box-shadow:0 1px 2px -1px #0000001a,0 1px 2px -1px #0000001c,0 1px 5px -1px #0000001c}.vac-message-wrapper .vac-message-current{background-color:var(--chat-message-bg-color-me)!important}.vac-message-wrapper .vac-message-deleted{color:var(--chat-message-color-deleted)!important;font-size:13px!important;font-style:italic!important;background-color:var(--chat-message-bg-color-deleted)!important}.vac-message-wrapper .vac-message-selected{background-color:var(--chat-message-bg-color-selected)!important;transition:background-color .2s}.vac-message-wrapper .vac-message-image{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:cover!important;background-position:center center!important;background-repeat:no-repeat!important;height:250px;width:250px;max-width:100%;border-radius:4px;margin:4px auto 5px;transition:.4s filter linear}.vac-message-wrapper .vac-text-username{font-size:13px;color:var(--chat-message-color-username);margin-bottom:2px}.vac-message-wrapper .vac-username-reply{margin-bottom:5px}.vac-message-wrapper .vac-text-timestamp{font-size:10px;color:var(--chat-message-color-timestamp);text-align:right}.vac-message-wrapper .vac-progress-time{float:left;margin:-2px 0 0 40px;color:var(--chat-color);font-size:12px}.vac-message-wrapper .vac-icon-edited{-webkit-box-align:center;align-items:center;display:-webkit-inline-box;display:inline-flex;justify-content:center;letter-spacing:normal;line-height:1;text-indent:0;vertical-align:middle;margin:0 4px 2px}.vac-message-wrapper .vac-icon-edited svg{height:12px;width:12px}.vac-message-wrapper .vac-icon-check{height:14px;width:14px;vertical-align:middle;margin:-3px -3px 0 3px}@media only screen and (max-width: 768px){.vac-message-wrapper .vac-message-container{padding:2px 3px 1px}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-message-box{flex:0 0 80%}.vac-message-wrapper .vac-avatar{height:25px;width:25px;min-height:25px;min-width:25px;margin:0 6px 1px 0}.vac-message-wrapper .vac-avatar.vac-avatar-current{margin:0 0 1px 6px}.vac-message-wrapper .vac-avatar-current-offset{margin-right:31px}.vac-message-wrapper .vac-avatar-offset{margin-left:31px}.vac-message-wrapper .vac-failure-container{margin-left:2px}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:0}.vac-message-wrapper .vac-progress-time{margin-left:37px}}.vac-audio-player{display:flex;margin:8px 0 5px}.vac-audio-player .vac-svg-button{max-width:18px;margin-left:7px}@media only screen and (max-width: 768px){.vac-audio-player{margin:4px 0 0}.vac-audio-player .vac-svg-button{max-width:16px;margin-left:5px;flex-grow:0;flex-shrink:0}.vac-audio-player .vac-audio-progress-container{flex-grow:1;flex-shrink:0}}.vac-player-bar{display:flex;align-items:center;max-width:calc(100% - 18px);margin-right:7px;margin-left:20px;width:100%}.vac-player-bar .vac-player-progress{width:100%}.vac-player-bar .vac-player-progress .vac-line-container{position:relative;height:4px;border-radius:5px;background-color:var(--chat-message-bg-color-audio-line);width:100%;display:flex;max-width:190px}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-progress{position:absolute;height:inherit;background-color:var(--chat-message-bg-color-audio-progress);border-radius:inherit}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{position:absolute;top:-5px;margin-left:-7px;height:14px;width:14px;border-radius:50%;background-color:var(--chat-message-bg-color-audio-progress-selector);transition:transform .25s}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot__active{transform:scale(1.2)}@media only screen and (max-width: 768px){.vac-player-bar{margin-right:5px}.vac-player-bar .vac-player-progress .vac-line-container{height:3px}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{height:12px;width:12px;top:-5px;margin-left:-5px}}.vac-message-actions-wrapper .vac-options-container{position:absolute;top:2px;right:10px;height:40px;width:70px;overflow:hidden;border-top-right-radius:8px}.vac-message-actions-wrapper .vac-blur-container{position:absolute;height:100%;width:100%;left:8px;bottom:10px;background:var(--chat-message-bg-color);filter:blur(3px);border-bottom-left-radius:8px}.vac-message-actions-wrapper .vac-options-me{background:var(--chat-message-bg-color-me)}.vac-message-actions-wrapper .vac-message-options{background:var(--chat-icon-bg-dropdown-message);border-radius:50%;position:absolute;top:7px;right:7px}.vac-message-actions-wrapper .vac-message-options svg{height:17px;width:17px;padding:5px;margin:-5px}.vac-message-actions-wrapper .vac-message-emojis{position:absolute;top:6px;right:30px}.vac-message-actions-wrapper .vac-menu-options{right:15px}.vac-message-actions-wrapper .vac-menu-left{right:-118px}@media only screen and (max-width: 768px){.vac-message-actions-wrapper .vac-options-container{right:3px}.vac-message-actions-wrapper .vac-menu-left{right:-50px}}.vac-message-files-container .vac-file-wrapper{position:relative;width:fit-content}.vac-message-files-container .vac-file-wrapper .vac-file-container{height:60px;width:60px;margin:3px 0 5px;cursor:pointer;transition:all .6s}.vac-message-files-container .vac-file-wrapper .vac-file-container:hover{opacity:.85}.vac-message-files-container .vac-file-wrapper .vac-file-container svg{height:30px;width:30px}.vac-message-files-container .vac-file-wrapper .vac-file-container.vac-file-container-progress{background-color:#0000004d}.vac-message-file-container{position:relative;z-index:0}.vac-message-file-container .vac-message-image-container{cursor:pointer}.vac-message-file-container .vac-image-buttons{position:absolute;width:100%;height:100%;border-radius:4px;background:linear-gradient(to bottom,rgba(0,0,0,0) 55%,rgba(0,0,0,.02) 60%,rgba(0,0,0,.05) 65%,rgba(0,0,0,.1) 70%,rgba(0,0,0,.2) 75%,rgba(0,0,0,.3) 80%,rgba(0,0,0,.5) 85%,rgba(0,0,0,.6) 90%,rgba(0,0,0,.7) 95%,rgba(0,0,0,.8) 100%)}.vac-message-file-container .vac-image-buttons svg{height:26px;width:26px}.vac-message-file-container .vac-image-buttons .vac-button-view,.vac-message-file-container .vac-image-buttons .vac-button-download{position:absolute;bottom:6px;left:7px}.vac-message-file-container .vac-image-buttons :first-child{left:40px}.vac-message-file-container .vac-image-buttons .vac-button-view{max-width:18px;bottom:8px}.vac-message-file-container .vac-video-container{width:350px;max-width:100%;margin:4px auto 5px;cursor:pointer}.vac-message-file-container .vac-video-container video{width:100%;height:100%;border-radius:4px}.vac-button-reaction{display:inline-flex;align-items:center;border:var(--chat-message-border-style-reaction);outline:none;background:var(--chat-message-bg-color-reaction);border-radius:4px;margin:4px 2px 0;transition:.3s;padding:0 5px;font-size:18px;line-height:23px}.vac-button-reaction span{font-size:11px;font-weight:500;min-width:7px;color:var(--chat-message-color-reaction-counter)}.vac-button-reaction:hover{border:var(--chat-message-border-style-reaction-hover);background:var(--chat-message-bg-color-reaction-hover);cursor:pointer}.vac-button-reaction.vac-reaction-me{border:var(--chat-message-border-style-reaction-me);background:var(--chat-message-bg-color-reaction-me)}.vac-button-reaction.vac-reaction-me span{color:var(--chat-message-color-reaction-counter-me)}.vac-button-reaction.vac-reaction-me:hover{border:var(--chat-message-border-style-reaction-hover-me);background:var(--chat-message-bg-color-reaction-hover-me)}.vac-reply-message{background:var(--chat-message-bg-color-reply);border-radius:4px;margin:-1px -5px 8px;padding:8px 10px}.vac-reply-message .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-message .vac-image-reply-container{width:70px}.vac-reply-message .vac-image-reply-container .vac-message-image-reply{height:70px;width:70px;margin:4px auto 3px}.vac-reply-message .vac-video-reply-container{width:200px;max-width:100%}.vac-reply-message .vac-video-reply-container video{width:100%;height:100%;border-radius:4px}.vac-reply-message .vac-reply-content{font-size:12px;color:var(--chat-message-color-reply-content)}.vac-reply-message .vac-file-container{height:60px;width:60px}.vac-emoji-wrapper{position:relative;display:flex}.vac-emoji-wrapper .vac-emoji-reaction svg{height:19px;width:19px}.vac-emoji-wrapper .vac-emoji-picker{position:absolute;z-index:9999;bottom:32px;right:10px;width:300px;padding-top:4px;overflow:scroll;box-sizing:border-box;border-radius:.5rem;background:var(--chat-emoji-bg-color);box-shadow:0 1px 2px -2px #0000001a,0 1px 2px -1px #0000001a,0 1px 2px 1px #0000001a;scrollbar-width:none}.vac-emoji-wrapper .vac-emoji-picker::-webkit-scrollbar{display:none}.vac-emoji-wrapper .vac-emoji-picker.vac-picker-reaction{position:fixed;top:initial;right:initial}.vac-emoji-wrapper .vac-emoji-picker emoji-picker{height:100%;width:100%;--emoji-size: 1.2rem;--background: var(--chat-emoji-bg-color);--emoji-padding: .4rem;--border-color: var(--chat-sidemenu-border-color-search);--button-hover-background: var(--chat-sidemenu-bg-color-hover);--button-active-background: var(--chat-sidemenu-bg-color-hover)}.vac-emoji-teleported .vac-emoji-picker{top:0!important;right:0!important;position:absolute!important;max-height:320px!important}.vac-format-message-wrapper .vac-format-container{display:inline}.vac-format-message-wrapper .vac-icon-deleted{height:14px;width:14px;vertical-align:middle;margin:-2px 2px 0 0;fill:var(--chat-message-color-deleted)}.vac-format-message-wrapper .vac-icon-deleted.vac-icon-deleted-room{margin:-3px 1px 0 0;fill:var(--chat-room-color-message)}.vac-format-message-wrapper .vac-image-link-container{background-color:var(--chat-message-bg-color-media);padding:8px;margin:2px auto;border-radius:4px}.vac-format-message-wrapper .vac-image-link{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:contain;background-position:center center!important;background-repeat:no-repeat!important;height:150px;width:150px;max-width:100%;border-radius:4px;margin:0 auto}.vac-format-message-wrapper .vac-image-link-message{max-width:166px;font-size:12px}.vac-loader-wrapper.vac-container-center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-loader-wrapper.vac-container-top{padding:21px}.vac-loader-wrapper.vac-container-top #vac-circle{height:20px;width:20px}.vac-loader-wrapper #vac-circle{margin:auto;height:28px;width:28px;border:3px rgba(0,0,0,.25) solid;border-top:3px var(--chat-color-spinner) solid;border-right:3px var(--chat-color-spinner) solid;border-bottom:3px var(--chat-color-spinner) solid;border-radius:50%;-webkit-animation:vac-spin 1s infinite linear;animation:vac-spin 1s infinite linear}@media only screen and (max-width: 768px){.vac-loader-wrapper #vac-circle{height:24px;width:24px}.vac-loader-wrapper.vac-container-top{padding:18px}.vac-loader-wrapper.vac-container-top #vac-circle{height:16px;width:16px}}@-webkit-keyframes vac-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes vac-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}#vac-icon-search{fill:var(--chat-icon-color-search)}#vac-icon-add{fill:var(--chat-icon-color-add)}#vac-icon-toggle{fill:var(--chat-icon-color-toggle)}#vac-icon-menu{fill:var(--chat-icon-color-menu)}#vac-icon-close{fill:var(--chat-icon-color-close)}#vac-icon-close-image{fill:var(--chat-icon-color-close-image)}#vac-icon-file{fill:var(--chat-icon-color-file)}#vac-icon-paperclip{fill:var(--chat-icon-color-paperclip)}#vac-icon-close-outline{fill:var(--chat-icon-color-close-outline)}#vac-icon-close-outline-preview{fill:var(--chat-icon-color-close-preview)}#vac-icon-send{fill:var(--chat-icon-color-send)}#vac-icon-send-disabled{fill:var(--chat-icon-color-send-disabled)}#vac-icon-emoji{fill:var(--chat-icon-color-emoji)}#vac-icon-emoji-reaction{fill:var(--chat-icon-color-emoji-reaction)}#vac-icon-document{fill:var(--chat-icon-color-document)}#vac-icon-pencil{fill:var(--chat-icon-color-pencil)}#vac-icon-checkmark,#vac-icon-double-checkmark{fill:var(--chat-icon-color-checkmark)}#vac-icon-checkmark-seen,#vac-icon-double-checkmark-seen{fill:var(--chat-icon-color-checkmark-seen)}#vac-icon-eye{fill:var(--chat-icon-color-eye)}#vac-icon-dropdown-message{fill:var(--chat-icon-color-dropdown-message)}#vac-icon-dropdown-room{fill:var(--chat-icon-color-dropdown-room)}#vac-icon-dropdown-scroll{fill:var(--chat-icon-color-dropdown-scroll)}#vac-icon-audio-play{fill:var(--chat-icon-color-audio-play)}#vac-icon-audio-pause{fill:var(--chat-icon-color-audio-pause)}.vac-progress-wrapper{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-progress-wrapper circle{transition:stroke-dashoffset .35s;transform:rotate(-90deg);transform-origin:50% 50%}.vac-progress-wrapper .vac-progress-content{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:-1;margin-top:-2px;background-color:#000000b3;border-radius:50%}.vac-progress-wrapper .vac-progress-content .vac-progress-text{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-weight:700;color:#fff}.vac-progress-wrapper .vac-progress-content .vac-progress-text .vac-progress-pourcent{font-size:9px;font-weight:400}
`;const b5={name:"ChatContainer",components:{RoomsList:mv,Room:i5,MediaPreview:h5},props:{height:{type:String,default:"600px"},theme:{type:String,default:"light"},styles:{type:[Object,String],default:()=>({})},responsiveBreakpoint:{type:Number,default:900},singleRoom:{type:[Boolean,String],default:!1},roomsListOpened:{type:[Boolean,String],default:!0},textMessages:{type:[Object,String],default:()=>({})},currentUserId:{type:String,default:""},rooms:{type:[Array,String],default:()=>[]},roomsOrder:{type:String,default:"desc"},loadingRooms:{type:[Boolean,String],default:!1},roomsLoaded:{type:[Boolean,String],default:!1},roomId:{type:String,default:null},loadFirstRoom:{type:[Boolean,String],default:!0},messages:{type:[Array,String],default:()=>[]},messagesLoaded:{type:[Boolean,String],default:!1},roomActions:{type:[Array,String],default:()=>[]},menuActions:{type:[Array,String],default:()=>[]},messageActions:{type:[Array,String],default:()=>[{name:"replyMessage",title:"Reply"},{name:"editMessage",title:"Edit Message",onlyMe:!0},{name:"deleteMessage",title:"Delete Message",onlyMe:!0},{name:"selectMessages",title:"Select"}]},messageSelectionActions:{type:[Array,String],default:()=>[]},autoScroll:{type:[Object,String],default:()=>({send:{new:!0,newAfterScrollUp:!0},receive:{new:!0,newAfterScrollUp:!1}})},customSearchRoomEnabled:{type:[Boolean,String],default:!1},showSearch:{type:[Boolean,String],default:!0},showAddRoom:{type:[Boolean,String],default:!0},showSendIcon:{type:[Boolean,String],default:!0},showFiles:{type:[Boolean,String],default:!0},showAudio:{type:[Boolean,String],default:!0},audioBitRate:{type:Number,default:128},audioSampleRate:{type:Number,default:44100},showEmojis:{type:[Boolean,String],default:!0},showReactionEmojis:{type:[Boolean,String],default:!0},showNewMessagesDivider:{type:[Boolean,String],default:!0},showFooter:{type:[Boolean,String],default:!0},showRoomHeader:{type:Boolean,default:!0},textFormatting:{type:[Object,String],default:()=>({disabled:!1,italic:"_",bold:"*",strike:"~",underline:"°",multilineCode:"```",inlineCode:"`"})},linkOptions:{type:[Object,String],default:()=>({disabled:!1,target:"_blank",rel:null})},roomInfoEnabled:{type:[Boolean,String],default:!1},textareaActionEnabled:{type:[Boolean,String],default:!1},textareaAutoFocus:{type:[Boolean,String],default:!0},userTagsEnabled:{type:[Boolean,String],default:!0},emojisSuggestionEnabled:{type:[Boolean,String],default:!0},roomMessage:{type:String,default:""},scrollDistance:{type:Number,default:60},acceptedFiles:{type:String,default:"*"},captureFiles:{type:String,default:void 0},templatesText:{type:[Array,String],default:()=>[]},mediaPreviewEnabled:{type:[Boolean,String],default:!0},usernameOptions:{type:[Object,String],default:()=>({minUsers:3,currentUser:!1})},emojiDataSource:{type:String,default:void 0},handleCustomOpenFiles:{type:Boolean,default:!1},showMessagesStarted:{type:Boolean,default:!0}},emits:["toggle-rooms-list","room-info","fetch-messages","send-message","edit-message","delete-message","open-file","open-user-tag","open-failed-message","menu-action-handler","message-action-handler","send-message-reaction","typing-message","textarea-action-handler","fetch-more-rooms","add-room","search-room","room-action-handler","message-selection-action-handler"],data(){return{slots:[],room:{},loadingMoreRooms:!1,showRoomsList:!0,isMobile:!1,showMediaPreview:!1,previewFile:{}}},computed:{t(){return{...v5,...this.textMessagesCasted}},cssVars(){const e=_5[this.theme],t={};return Object.keys(e).map(s=>{t[s]={...e[s],...this.stylesCasted[s]||{}}}),p5(t)},orderedRooms(){return this.roomsCasted.slice().sort((e,t)=>{const s=e.index||0,a=t.index||0;return this.roomsOrder==="asc"?s<a?-1:a<s?1:0:s>a?-1:a>s?1:0})},singleRoomCasted(){return this.castBoolean(this.singleRoom)},roomsListOpenedCasted(){return this.castBoolean(this.roomsListOpened)},loadingRoomsCasted(){return this.castBoolean(this.loadingRooms)},roomsLoadedCasted(){return this.castBoolean(this.roomsLoaded)},loadFirstRoomCasted(){return this.castBoolean(this.loadFirstRoom)},messagesLoadedCasted(){return this.castBoolean(this.messagesLoaded)},showSearchCasted(){return this.castBoolean(this.showSearch)},showAddRoomCasted(){return this.castBoolean(this.showAddRoom)},showSendIconCasted(){return this.castBoolean(this.showSendIcon)},showFilesCasted(){return this.castBoolean(this.showFiles)},showAudioCasted(){return this.castBoolean(this.showAudio)},showEmojisCasted(){return this.castBoolean(this.showEmojis)},showReactionEmojisCasted(){return this.castBoolean(this.showReactionEmojis)},showNewMessagesDividerCasted(){return this.castBoolean(this.showNewMessagesDivider)},showFooterCasted(){return this.castBoolean(this.showFooter)},roomInfoEnabledCasted(){return this.castBoolean(this.roomInfoEnabled)},textareaActionEnabledCasted(){return this.castBoolean(this.textareaActionEnabled)},textareaAutoFocusCasted(){return this.castBoolean(this.textareaAutoFocus)},userTagsEnabledCasted(){return this.castBoolean(this.userTagsEnabled)},emojisSuggestionEnabledCasted(){return this.castBoolean(this.emojisSuggestionEnabled)},mediaPreviewEnabledCasted(){return this.castBoolean(this.mediaPreviewEnabled)},roomsCasted(){return this.castArray(this.rooms)},messagesCasted(){return this.castArray(this.messages)},roomActionsCasted(){return this.castArray(this.roomActions)},menuActionsCasted(){return this.castArray(this.menuActions)},messageActionsCasted(){return this.castArray(this.messageActions)},messageSelectionActionsCasted(){return this.castArray(this.messageSelectionActions)},templatesTextCasted(){return this.castArray(this.templatesText)},stylesCasted(){return this.castObject(this.styles)},textMessagesCasted(){return this.castObject(this.textMessages)},autoScrollCasted(){return this.castObject(this.autoScroll)},textFormattingCasted(){return this.castObject(this.textFormatting)},linkOptionsCasted(){return this.castObject(this.linkOptions)},usernameOptionsCasted(){return this.castObject(this.usernameOptions)},handleCustomOpenFilesCasted(){return this.castBoolean(this.handleCustomOpenFiles)}},watch:{roomsCasted:{immediate:!0,deep:!0,handler(e,t){if((!e[0]||!e.find(s=>s.roomId===this.room.roomId))&&(this.showRoomsList=!0),!this.loadingMoreRooms&&this.loadFirstRoomCasted&&e[0]&&(!t||e.length!==t.length))if(this.roomId){const s=e.find(a=>a.roomId===this.roomId)||{};this.fetchRoom({room:s})}else!this.isMobile||this.singleRoomCasted?this.fetchRoom({room:this.orderedRooms[0]}):this.showRoomsList=!0}},loadingRoomsCasted(e){e&&(this.room={})},roomId:{immediate:!0,handler(e,t){if(e&&!this.loadingRoomsCasted&&this.roomsCasted.length){const s=this.roomsCasted.find(a=>a.roomId===e);this.fetchRoom({room:s})}else t&&!e&&(this.room={})}},room(e){!e||Object.entries(e).length===0||(C4(e),e.users.forEach(t=>{L4(t)}))},roomsListOpenedCasted:{immediate:!0,handler(e){this.showRoomsList=e}}},created(){this.updateResponsive(),window.addEventListener("resize",e=>{e.isTrusted&&this.updateResponsive()})},updated(){const e=document.querySelectorAll("[slot]");this.slots.length!==e.length&&(this.slots=e)},methods:{castBoolean(e){return e==="true"||e===!0},castArray(e){return e?Array.isArray(e)?e:JSON.parse(e):[]},castObject(e){return e?typeof e=="object"?e:JSON.parse(e):{}},updateResponsive(){this.isMobile=window.innerWidth<Number(this.responsiveBreakpoint)},toggleRoomsList(){this.showRoomsList=!this.showRoomsList,this.isMobile&&(this.room={}),this.$emit("toggle-rooms-list",{opened:this.showRoomsList})},fetchRoom({room:e}){this.room=e,this.fetchMessages({reset:!0}),this.isMobile&&(this.showRoomsList=!1)},fetchMoreRooms(){this.$emit("fetch-more-rooms")},roomInfo(){this.$emit("room-info",this.room)},addRoom(){this.$emit("add-room")},searchRoom(e){this.$emit("search-room",{value:e,roomId:this.room.roomId})},fetchMessages(e){this.$emit("fetch-messages",{room:this.room,options:e})},sendMessage(e){this.$emit("send-message",{...e,roomId:this.room.roomId})},editMessage(e){this.$emit("edit-message",{...e,roomId:this.room.roomId})},deleteMessage(e){this.$emit("delete-message",{message:e,roomId:this.room.roomId})},openFile({message:e,file:t}){this.handleCustomOpenFilesCasted?this.$emit("open-file",{message:e,file:t,defaultHandle:()=>{this._openFile({message:e,file:t})}}):this._openFile({message:e,file:t})},_openFile({message:e,file:t}){this.mediaPreviewEnabledCasted&&t.action==="preview"?(this.previewFile=t.file,this.showMediaPreview=!0):this.$emit("open-file",{message:e,file:t})},openUserTag({user:e}){this.$emit("open-user-tag",{user:e})},openFailedMessage({message:e}){this.$emit("open-failed-message",{message:e,roomId:this.room.roomId})},menuActionHandler(e){this.$emit("menu-action-handler",{action:e,roomId:this.room.roomId})},roomActionHandler({action:e,roomId:t}){this.$emit("room-action-handler",{action:e,roomId:t})},messageActionHandler(e){this.$emit("message-action-handler",{...e,roomId:this.room.roomId})},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{...e,roomId:this.room.roomId})},sendMessageReaction(e){this.$emit("send-message-reaction",{...e,roomId:this.room.roomId})},typingMessage(e){this.$emit("typing-message",{message:e,roomId:this.room.roomId})},textareaActionHandler(e){this.$emit("textarea-action-handler",{message:e,roomId:this.room.roomId})}}},y5={class:"vac-chat-container"};function w5(e,t,s,a,n,r){const o=Ge("rooms-list"),u=Ge("room"),_=Ge("media-preview");return J(),ce("div",{class:"vac-card-window",style:At([{height:s.height},r.cssVars])},[pe("div",y5,[r.singleRoomCasted?xe("",!0):(J(),ft(o,{key:0,"current-user-id":s.currentUserId,rooms:r.orderedRooms,"loading-rooms":r.loadingRoomsCasted,"rooms-loaded":r.roomsLoadedCasted,room:n.room,"room-actions":r.roomActionsCasted,"custom-search-room-enabled":s.customSearchRoomEnabled,"text-messages":r.t,"show-search":r.showSearchCasted,"show-add-room":r.showAddRoomCasted,"show-rooms-list":n.showRoomsList&&r.roomsListOpenedCasted,"text-formatting":r.textFormattingCasted,"link-options":r.linkOptionsCasted,"is-mobile":n.isMobile,"scroll-distance":s.scrollDistance,onFetchRoom:r.fetchRoom,onFetchMoreRooms:r.fetchMoreRooms,onLoadingMoreRooms:t[0]||(t[0]=l=>n.loadingMoreRooms=l),onAddRoom:r.addRoom,onSearchRoom:r.searchRoom,onRoomActionHandler:r.roomActionHandler},wt({_:2},[rt(n.slots,l=>({name:l.slot,fn:Ke(v=>[Le(e.$slots,l.slot,yt(pt(v)))])}))]),1032,["current-user-id","rooms","loading-rooms","rooms-loaded","room","room-actions","custom-search-room-enabled","text-messages","show-search","show-add-room","show-rooms-list","text-formatting","link-options","is-mobile","scroll-distance","onFetchRoom","onFetchMoreRooms","onAddRoom","onSearchRoom","onRoomActionHandler"])),Ie(u,{"current-user-id":s.currentUserId,rooms:r.roomsCasted,"room-id":n.room.roomId||"","load-first-room":r.loadFirstRoomCasted,messages:r.messagesCasted,"room-message":s.roomMessage,"messages-loaded":r.messagesLoadedCasted,"menu-actions":r.menuActionsCasted,"message-actions":r.messageActionsCasted,"message-selection-actions":r.messageSelectionActionsCasted,"auto-scroll":r.autoScrollCasted,"show-send-icon":r.showSendIconCasted,"show-files":r.showFilesCasted,"show-audio":r.showAudioCasted,"audio-bit-rate":s.audioBitRate,"audio-sample-rate":s.audioSampleRate,"show-emojis":r.showEmojisCasted,"show-reaction-emojis":r.showReactionEmojisCasted,"show-new-messages-divider":r.showNewMessagesDividerCasted,"show-footer":r.showFooterCasted,"show-room-header":s.showRoomHeader,"text-messages":r.t,"single-room":r.singleRoomCasted,"show-rooms-list":n.showRoomsList&&r.roomsListOpenedCasted,"text-formatting":r.textFormattingCasted,"link-options":r.linkOptionsCasted,"is-mobile":n.isMobile,"loading-rooms":r.loadingRoomsCasted,"room-info-enabled":r.roomInfoEnabledCasted,"textarea-action-enabled":r.textareaActionEnabledCasted,"textarea-auto-focus":r.textareaAutoFocusCasted,"user-tags-enabled":r.userTagsEnabledCasted,"emojis-suggestion-enabled":r.emojisSuggestionEnabledCasted,"scroll-distance":s.scrollDistance,"accepted-files":s.acceptedFiles,"capture-files":s.captureFiles,"templates-text":r.templatesTextCasted,"username-options":r.usernameOptionsCasted,"emoji-data-source":s.emojiDataSource,"show-messages-started-text":s.showMessagesStarted,onToggleRoomsList:r.toggleRoomsList,onRoomInfo:r.roomInfo,onFetchMessages:r.fetchMessages,onSendMessage:r.sendMessage,onEditMessage:r.editMessage,onDeleteMessage:r.deleteMessage,onOpenFile:r.openFile,onOpenUserTag:r.openUserTag,onOpenFailedMessage:r.openFailedMessage,onMenuActionHandler:r.menuActionHandler,onMessageActionHandler:r.messageActionHandler,onMessageSelectionActionHandler:r.messageSelectionActionHandler,onSendMessageReaction:r.sendMessageReaction,onTypingMessage:r.typingMessage,onTextareaActionHandler:r.textareaActionHandler},wt({_:2},[rt(n.slots,l=>({name:l.slot,fn:Ke(v=>[Le(e.$slots,l.slot,yt(pt(v)))])}))]),1032,["current-user-id","rooms","room-id","load-first-room","messages","room-message","messages-loaded","menu-actions","message-actions","message-selection-actions","auto-scroll","show-send-icon","show-files","show-audio","audio-bit-rate","audio-sample-rate","show-emojis","show-reaction-emojis","show-new-messages-divider","show-footer","show-room-header","text-messages","single-room","show-rooms-list","text-formatting","link-options","is-mobile","loading-rooms","room-info-enabled","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","scroll-distance","accepted-files","capture-files","templates-text","username-options","emoji-data-source","show-messages-started-text","onToggleRoomsList","onRoomInfo","onFetchMessages","onSendMessage","onEditMessage","onDeleteMessage","onOpenFile","onOpenUserTag","onOpenFailedMessage","onMenuActionHandler","onMessageActionHandler","onMessageSelectionActionHandler","onSendMessageReaction","onTypingMessage","onTextareaActionHandler"])]),Ie(Nt,{name:"vac-fade-preview",appear:""},{default:Ke(()=>[n.showMediaPreview?(J(),ft(_,{key:0,file:n.previewFile,onCloseMediaPreview:t[1]||(t[1]=l=>n.showMediaPreview=!1)},wt({_:2},[rt(n.slots,l=>({name:l.slot,fn:Ke(v=>[Le(e.$slots,l.slot,yt(pt(v)))])}))]),1032,["file"])):xe("",!0)]),_:3})],4)}var S5=Tt(b5,[["render",w5],["styles",[g5]]]);const E5=jf(S5),S1="vue-advanced-chat";function M5(){customElements.get(S1)||customElements.define(S1,E5)}const A5=[".current-user-id",".rooms","messages-loaded","loading-rooms",".messages",".message-actions",".height",".text-messages"];M5();const I5=Qu({__name:"ContextChat",props:{context:{type:Object,required:!0},createContext:{type:Object,default:void 0},height:{type:String,default:void 0},localUploadMeta:{type:Object,default:void 0}},setup(e){const t=e,{t:s}=Ju(),a=nd(),n=id(),r=od().createScope(),o=ld().createScope(),u=cd().createScope(),_=ud().createScope(),l=dd().createScope(),v=$u(),{getAssignmentNameToShow:c}=md(),{data:b}=r.useGet({id:ga(()=>t.context.assignmentId)}),w=Pl([]),i=ga(()=>{const Y=[];for(const ie of w)ie.uploads&&Array.isArray(ie.uploads)&&Y.push(...ie.uploads);return Y});function F(Y){return{url:_d(Y),name:Y.originalName,type:Y.mimeType,size:Y.fileSize,audio:pd(Y),originalId:Y.id}}const B=Pl([]),N=ga(()=>w.map(Y=>{const ie={_id:Y.meta?.frontendId??Y.uuid,content:Y.text??"",date:Y.createdAt?Ul(Y.createdAt,"dd.MM.yyyy"):void 0,timestamp:Y.createdAt?Ul(Y.createdAt,"HH:mm"):void 0,senderId:Y.userId?`${Y.userId}`:"system",username:Y.user?Y.user.fullName:"System",files:Y.uploads?.map(F)??[],saved:!!Y.id,reactions:{},deleted:!!Y.deletedAt,failure:B.some(W(Y)),replyMessage:Y.replyTo?{content:Y.replyTo.text,_id:Y.replyToId,senderId:`${Y.replyTo.userId}`,files:Y.replyTo?.uploads?.map(F)??[]}:null};if(Y.reactions?.length)for(const ae of Y.reactions)ae.text&&(ie.reactions[ae.text]||(ie.reactions[ae.text]=[]),ie.reactions[ae.text].push(`${ae.userId}`));return ie})),f=ga(()=>N.value.at(-1)),R=ga(()=>[...[...new Set(w.map(Y=>Y.user).filter(Y=>!!Y))].map(Y=>({_id:`${Y?.id}`,username:Y?.fullName})),{_id:"system",username:"System"}]),C=ga(()=>({companyId:a.value,assignmentId:t.context.assignmentId,assignmentEventGroupId:t.context.assignmentEventGroupId,assignmentEventId:t.context.assignmentEventId})),k=ga(()=>({...C.value,$limit:30,$sort:{createdAt:-1},type:["user_send_message","user_send_file"],createdAt:w.length?{$lt:w.at(0)?.createdAt}:void 0})),L=ed(!1);let m=new Date;const{call:T,isPending:E}=ba(async(Y=!1)=>{if(Y===!1){const ae=(await _.find({query:{...k.value},$populateParams:{name:"forChat"}})).data;for(const le of ae)w.some(W(le))||("uploads"in le&&(le.uploads=le.uploads.map(Ue=>l.localFind(Ue.id)??l.construct(Ue))),w.unshift(le));(!ae.length||ae.length<k.value.$limit)&&(L.value=!0)}else{const ie=w.length?w.at(-1)?.createdAt??m:m,le=(await _.find({query:{...C.value,createdAt:{$gt:ie},$sort:{createdAt:1},$limit:30,type:["user_send_message","user_send_file","user_reaction"]},$populateParams:{name:"forChat"}})).data,Ue=le.filter(H=>["user_send_message","user_send_file"].includes(H.type)),Ze=le.filter(H=>H.type==="user_reaction");for(const H of Ue)w.some(W(H))||("uploads"in H&&(H.uploads=H.uploads.map(z=>l.localFind(z.id)??l.construct(z))),w.push(H));m=new Date;for(const H of Ze){const z=w.find(ee=>ee.id===H.reactionToId);z&&(z.reactions||=[],z.reactions.some(W(H))||z.reactions.push(H))}}},{useNProgress:!0}),{call:h}=ba(async Y=>{await Ui(),l.addToConstructBacklog(Y);const ie=w.find(ae=>ae.id===Y.messageId);if(ie&&Y.id){const ae=l.localFind(Y.id);ie.uploads||=[],ie.uploads.some(le=>le.frontendId===Y.frontendId)||ie.uploads.push(ae??Y)}},{useNProgress:!0}),{call:y}=ba(async Y=>{if(await Ui(),w.some(ie=>ie.id===Y.messageId)&&Y.id){const ie=l.localFind(Y.id)??l.construct(Y),ae=w.find(le=>le.id===ie.messageId);if(!ae)return;ae.uploads||=[],ae.uploads.some(le=>le.id===ie.id)||ae.uploads.push(ie)}}),{call:g}=ba(async Y=>{if(await Ui(),rd(C.value)(Y)&&Y.id){const ie=_.construct(Y);if(ie){const ae=B.findIndex(W(ie));ae>-1&&B.splice(ae,1)}ie&&(ie.type==="user_send_file"||ie.type==="user_send_message")?w.some(W(ie))||w.push(ie):ie?.type==="user_reaction"&&ve(ie)}},{useNProgress:!0}),{startListening:p}=wn("assignment-messages","created",g,{lazy:!0}),{startListening:M}=wn("assignment-messages","removed",Y=>{Y.type==="user_reaction"&&Me(Y)},{lazy:!0}),{startListening:S}=wn("uploads","created",h,{lazy:!0}),{startListening:j}=wn("uploads","patched",y,{lazy:!0});Dl(()=>!E.value,()=>{p(),M(),S(),j()});const{upload:X}=gd(),{call:D}=ba(async Y=>{for(const ie of Y.detail){const ae=_.construct({assignmentId:t.context.assignmentId,assignmentEventId:t.createContext?.assignmentEventId??t.context.assignmentEventId??null,assignmentEventGroupId:t.createContext?.assignmentEventGroupId??t.context.assignmentEventGroupId??null,companyId:a.value??1,userId:n.value?.id??null,type:ie.files?.length?"user_send_file":"user_send_message",meta:{frontendId:qi()},text:ie.content,replyToId:ie.replyMessage?._id?Q(ie.replyMessage._id)?.id??null:null,reactionToId:null});w.push(ae);const le=Ze=>l.construct({frontendId:qi(),blobUrl:URL.createObjectURL(Ze.blob),file:Ze.blob,messageId:ae.id,originalName:`${Ze.name}.${Ze.extension??""}`,mimeType:Ze.type}),Ue=(ie.files??[]).map(Ze=>le(Ze));try{await _.save(ae)}catch(Ze){console.error(Ze),B.push(ae);return}if(!ae.id){console.error("No message id for file upload"),B.push(ae);return}if(Ue.length)try{const Ze=await Promise.all(Ue.map(async H=>{let z,ee;return ae.assignmentEventId?(z=o.servicePath,ee=ae.assignmentEventId):ae.assignmentEventGroupId?(z=u.servicePath,ee=ae.assignmentEventGroupId):(z=r.servicePath,ee=ae.assignmentId),await X(new File([H.file],H.originalName,{type:H.mimeType}),{properties:{messageId:ae.id,frontendId:H.frontendId,associatedServicePath:z,associatedId:ee,associatedParentId:ae.assignmentId,associatedParentServicePath:r.servicePath},localMeta:t.localUploadMeta})}));ae.uploads=Ze}catch(Ze){console.error(Ze),B.push(ae)}}},{useNProgress:!0}),{call:V}=ba(async Y=>{for(const ie of Y.detail)if(!(!n.value||a.value===null||a.value===void 0))if(ie.remove){const ae=(await _.find({query:{reactionToId:ie.messageId,type:"user_reaction",userId:n.value.id,text:ie.reaction.unicode,companyId:a.value}})).data;for(const le of ae)Me(le),await _.remove(le)}else{const ae=Q(ie.messageId)?.id;if(!ae)return;const le=_.construct({assignmentId:t.context.assignmentId,assignmentEventId:t.createContext?.assignmentEventId??t.context.assignmentEventId??null,assignmentEventGroupId:t.createContext?.assignmentEventGroupId??t.context.assignmentEventGroupId??null,companyId:a.value,userId:n.value?.id,type:"user_reaction",meta:{frontendId:qi()},text:ie.reaction.unicode,replyToId:null,reactionToId:ae});ve(le),_.save(le)}}),{call:d}=ba(async Y=>{await Promise.all(Y.detail.map(async ie=>{const ae=w.find(le=>le.id===Q(ie.message._id)?.id);ae&&(ae.deletedAt=new Date,_.save(ae))}))});function A(Y){const ie=Y.detail.at(0);if(!ie?.file?.file)return;const ae=i.value.find(le=>le.id===ie.file.file.originalId);ae&&(ie.file.action==="download"?fd(ae):hd(ae,i.value))}function W(Y){return ie=>ie.meta?.frontendId&&Y.meta?.frontendId?ie.meta.frontendId===Y.meta?.frontendId:ie.uuid===Y.uuid}function Q(Y){return typeof Y=="number"?w.find(ie=>ie.id===Y):w.find(ie=>ie.meta?.frontendId&&ie.meta.frontendId===Y||ie.uuid===Y)}function ve(Y){const ie=w.findIndex(le=>le.id===Y.reactionToId),ae=w.at(ie);ie>-1&&ae&&(ae.reactions||=[],ae.reactions.some(W(Y))||ae.reactions.push(Y))}function Me(Y){const ie=w.find(ae=>ae.id===Y.reactionToId);if(ie){ie.reactions||=[];const ae=ie.reactions.findIndex(le=>le.id===Y.id);ae>-1&&ie.reactions.splice(ae,1)}}function Te(){T(!0)}return td(vd,"reconnect",Te),Dl(v,()=>{if(!v.value||!v.value.shadowRoot)return;const Y=new CSSStyleSheet;Y.replace(`
    .vac-icon-textarea > div > .vac-emoji-wrapper > .vac-emoji-picker {
      right: 10px !important;
      bottom: 45px !important;
      height: 500px !important;
    }

    .vac-icon-textarea > div > .vac-emoji-wrapper {
      position: unset !important;
    }

    .vac-options-container > span > div > .vac-emoji-wrapper > .vac-emoji-picker {
      right: unset !important;
      top: unset !important;
    }
  `),v.value.shadowRoot.adoptedStyleSheets=[Y]}),(Y,ie)=>(sd(),ad("vue-advanced-chat",{ref_key:"vueAdvancedChatRef",ref:v,".current-user-id":_t(n)?.id,".rooms":[{roomId:1,users:_t(R),lastMessage:_t(f),roomName:_t(c)(_t(b))}],"messages-loaded":_t(L),"loading-rooms":_t(E),".messages":_t(N),".message-actions":[{name:"replyMessage",title:_t(s)("chat.vueAdvancedChat.Reply")},{name:"deleteMessage",title:_t(s)("chat.vueAdvancedChat.Delete Message"),onlyMe:!0}],"rooms-loaded":!0,"single-room":!0,".styles":{content:{background:"#f8f9fa",paddingTop:"10px"}},".username-options":{minUsers:0,currentUser:!1},".height":e.height,"show-new-messages-divider":!1,"show-search":!1,"room-info-enabled":!1,".show-room-header":!1,".text-messages":{ROOMS_EMPTY:_t(s)("chat.vueAdvancedChat.ROOMS_EMPTY"),ROOM_EMPTY:_t(s)("chat.vueAdvancedChat.ROOM_EMPTY"),NEW_MESSAGES:_t(s)("chat.vueAdvancedChat.NEW_MESSAGES"),MESSAGE_DELETED:_t(s)("chat.vueAdvancedChat.MESSAGE_DELETED"),MESSAGES_EMPTY:_t(s)("chat.vueAdvancedChat.MESSAGES_EMPTY"),CONVERSATION_STARTED:_t(s)("chat.vueAdvancedChat.CONVERSATION_STARTED"),TYPE_MESSAGE:_t(s)("chat.vueAdvancedChat.TYPE_MESSAGE"),SEARCH:_t(s)("chat.vueAdvancedChat.SEARCH"),IS_ONLINE:_t(s)("chat.vueAdvancedChat.IS_ONLINE"),LAST_SEEN:_t(s)("chat.vueAdvancedChat.LAST_SEEN"),IS_TYPING:_t(s)("chat.vueAdvancedChat.IS_TYPING"),CANCEL_SELECT_MESSAGE:_t(s)("chat.vueAdvancedChat.CANCEL_SELECT_MESSAGE")},".show-messages-started":!1,".handle-custom-open-files":!0,class:"chat-container",theme:"light",style:{"--chat-container-box-shadow":"none"},onDeleteMessage:ie[0]||(ie[0]=(...ae)=>_t(d)&&_t(d)(...ae)),onSendMessageReaction:ie[1]||(ie[1]=(...ae)=>_t(V)&&_t(V)(...ae)),onSendMessage:ie[2]||(ie[2]=(...ae)=>_t(D)&&_t(D)(...ae)),onFetchMessages:ie[3]||(ie[3]=()=>_t(T)(!1)),onOpenFile:A},null,40,A5))}});export{I5 as _};
